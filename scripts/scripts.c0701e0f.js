!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.ui=e.ui||{};e.ui.version="1.12.1";var a,r=0,t=Array.prototype.slice;e.cleanData=(a=e.cleanData,function(r){var t,n,o;for(o=0;null!=(n=r[o]);o++)try{(t=e._data(n,"events"))&&t.remove&&e(n).triggerHandler("remove")}catch(e){}a(r)}),e.widget=function(a,r,t){var n,o,i,s={},u=a.split(".")[0],l=u+"-"+(a=a.split(".")[1]);return t||(t=r,r=e.Widget),e.isArray(t)&&(t=e.extend.apply(null,[{}].concat(t))),e.expr[":"][l.toLowerCase()]=function(a){return!!e.data(a,l)},e[u]=e[u]||{},n=e[u][a],o=e[u][a]=function(e,a){if(!this._createWidget)return new o(e,a);arguments.length&&this._createWidget(e,a)},e.extend(o,n,{version:t.version,_proto:e.extend({},t),_childConstructors:[]}),(i=new r).options=e.widget.extend({},i.options),e.each(t,function(a,t){e.isFunction(t)?s[a]=function(){function e(){return r.prototype[a].apply(this,arguments)}function n(e){return r.prototype[a].apply(this,e)}return function(){var a,r=this._super,o=this._superApply;return this._super=e,this._superApply=n,a=t.apply(this,arguments),this._super=r,this._superApply=o,a}}():s[a]=t}),o.prototype=e.widget.extend(i,{widgetEventPrefix:n&&i.widgetEventPrefix||a},s,{constructor:o,namespace:u,widgetName:a,widgetFullName:l}),n?(e.each(n._childConstructors,function(a,r){var t=r.prototype;e.widget(t.namespace+"."+t.widgetName,o,r._proto)}),delete n._childConstructors):r._childConstructors.push(o),e.widget.bridge(a,o),o},e.widget.extend=function(a){for(var r,n,o=t.call(arguments,1),i=0,s=o.length;i<s;i++)for(r in o[i])n=o[i][r],o[i].hasOwnProperty(r)&&void 0!==n&&(e.isPlainObject(n)?a[r]=e.isPlainObject(a[r])?e.widget.extend({},a[r],n):e.widget.extend({},n):a[r]=n);return a},e.widget.bridge=function(a,r){var n=r.prototype.widgetFullName||a;e.fn[a]=function(o){var i="string"==typeof o,s=t.call(arguments,1),u=this;return i?this.length||"instance"!==o?this.each(function(){var r,t=e.data(this,n);return"instance"===o?(u=t,!1):t?e.isFunction(t[o])&&"_"!==o.charAt(0)?(r=t[o].apply(t,s))!==t&&void 0!==r?(u=r&&r.jquery?u.pushStack(r.get()):r,!1):void 0:e.error("no such method '"+o+"' for "+a+" widget instance"):e.error("cannot call methods on "+a+" prior to initialization; attempted to call method '"+o+"'")}):u=void 0:(s.length&&(o=e.widget.extend.apply(null,[o].concat(s))),this.each(function(){var a=e.data(this,n);a?(a.option(o||{}),a._init&&a._init()):e.data(this,n,new r(o,this))})),u}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(a,t){t=e(t||this.defaultElement||this)[0],this.element=e(t),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},t!==this&&(e.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=e(t.style?t.ownerDocument:t.document||t),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),a),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var a=this;this._destroy(),e.each(this.classesElementLookup,function(e,r){a._removeClass(r,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(a,r){var t,n,o,i=a;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof a)if(i={},a=(t=a.split(".")).shift(),t.length){for(n=i[a]=e.widget.extend({},this.options[a]),o=0;o<t.length-1;o++)n[t[o]]=n[t[o]]||{},n=n[t[o]];if(a=t.pop(),1===arguments.length)return void 0===n[a]?null:n[a];n[a]=r}else{if(1===arguments.length)return void 0===this.options[a]?null:this.options[a];i[a]=r}return this._setOptions(i),this},_setOptions:function(e){var a;for(a in e)this._setOption(a,e[a]);return this},_setOption:function(e,a){return"classes"===e&&this._setOptionClasses(a),this.options[e]=a,"disabled"===e&&this._setOptionDisabled(a),this},_setOptionClasses:function(a){var r,t,n;for(r in a)n=this.classesElementLookup[r],a[r]!==this.options.classes[r]&&n&&n.length&&(t=e(n.get()),this._removeClass(n,r),t.addClass(this._classes({element:t,keys:r,classes:a,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(a){var r=[],t=this;function n(n,o){var i,s;for(s=0;s<n.length;s++)i=t.classesElementLookup[n[s]]||e(),i=a.add?e(e.unique(i.get().concat(a.element.get()))):e(i.not(a.element).get()),t.classesElementLookup[n[s]]=i,r.push(n[s]),o&&a.classes[n[s]]&&r.push(a.classes[n[s]])}return a=e.extend({element:this.element,classes:this.options.classes||{}},a),this._on(a.element,{remove:"_untrackClassesElement"}),a.keys&&n(a.keys.match(/\S+/g)||[],!0),a.extra&&n(a.extra.match(/\S+/g)||[]),r.join(" ")},_untrackClassesElement:function(a){var r=this;e.each(r.classesElementLookup,function(t,n){-1!==e.inArray(a.target,n)&&(r.classesElementLookup[t]=e(n.not(a.target).get()))})},_removeClass:function(e,a,r){return this._toggleClass(e,a,r,!1)},_addClass:function(e,a,r){return this._toggleClass(e,a,r,!0)},_toggleClass:function(e,a,r,t){t="boolean"==typeof t?t:r;var n="string"==typeof e||null===e,o={extra:n?a:r,keys:n?e:a,element:n?this.element:e,add:t};return o.element.toggleClass(this._classes(o),t),this},_on:function(a,r,t){var n,o=this;"boolean"!=typeof a&&(t=r,r=a,a=!1),t?(r=n=e(r),this.bindings=this.bindings.add(r)):(t=r,r=this.element,n=this.widget()),e.each(t,function(t,i){function s(){if(a||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof i?o[i]:i).apply(o,arguments)}"string"!=typeof i&&(s.guid=i.guid=i.guid||s.guid||e.guid++);var u=t.match(/^([\w:-]*)\s*(.*)$/),l=u[1]+o.eventNamespace,c=u[2];c?n.on(l,c,s):r.on(l,s)})},_off:function(a,r){r=(r||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.off(r).off(r),this.bindings=e(this.bindings.not(a).get()),this.focusable=e(this.focusable.not(a).get()),this.hoverable=e(this.hoverable.not(a).get())},_delay:function(e,a){var r=this;return setTimeout(function(){return("string"==typeof e?r[e]:e).apply(r,arguments)},a||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a),this._on(a,{mouseenter:function(a){this._addClass(e(a.currentTarget),null,"ui-state-hover")},mouseleave:function(a){this._removeClass(e(a.currentTarget),null,"ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a),this._on(a,{focusin:function(a){this._addClass(e(a.currentTarget),null,"ui-state-focus")},focusout:function(a){this._removeClass(e(a.currentTarget),null,"ui-state-focus")}})},_trigger:function(a,r,t){var n,o,i=this.options[a];if(t=t||{},(r=e.Event(r)).type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase(),r.target=this.element[0],o=r.originalEvent)for(n in o)n in r||(r[n]=o[n]);return this.element.trigger(r,t),!(e.isFunction(i)&&!1===i.apply(this.element[0],[r].concat(t))||r.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(a,r){e.Widget.prototype["_"+a]=function(t,n,o){var i;"string"==typeof n&&(n={effect:n});var s=n?!0===n||"number"==typeof n?r:n.effect||r:a;"number"==typeof(n=n||{})&&(n={duration:n}),i=!e.isEmptyObject(n),n.complete=o,n.delay&&t.delay(n.delay),i&&e.effects&&e.effects.effect[s]?t[a](n):s!==a&&t[s]?t[s](n.duration,n.easing,o):t.queue(function(r){e(this)[a](),o&&o.call(t[0]),r()})}});e.widget,e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(a){return function(r){return!!e.data(r,a)}}):function(a,r,t){return!!e.data(a,t[3])}});e.ui.focusable=function(a,r){var t,n,o,i,s,u=a.nodeName.toLowerCase();return"area"===u?(n=(t=a.parentNode).name,!(!a.href||!n||"map"!==t.nodeName.toLowerCase())&&((o=e("img[usemap='#"+n+"']")).length>0&&o.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(u)?(i=!a.disabled)&&(s=e(a).closest("fieldset")[0])&&(i=!s.disabled):i="a"===u&&a.href||r,i&&e(a).is(":visible")&&function(e){var a=e.css("visibility");for(;"inherit"===a;)e=e.parent(),a=e.css("visibility");return"hidden"!==a}(e(a)))},e.extend(e.expr[":"],{focusable:function(a){return e.ui.focusable(a,null!=e.attr(a,"tabindex"))}});e.ui.focusable,e.fn.scrollParent=function(a){var r=this.css("position"),t="absolute"===r,n=a?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var a=e(this);return(!t||"static"!==a.css("position"))&&n.test(a.css("overflow")+a.css("overflow-y")+a.css("overflow-x"))}).eq(0);return"fixed"!==r&&o.length?o:e(this[0].ownerDocument||document)},e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var n=!1;e(document).on("mouseup",function(){n=!1});e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.on("mousedown."+this.widgetName,function(e){return a._mouseDown(e)}).on("click."+this.widgetName,function(r){if(!0===e.data(r.target,a.widgetName+".preventClickEvent"))return e.removeData(r.target,a.widgetName+".preventClickEvent"),r.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(a){if(!n){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(a),this._mouseDownEvent=a;var r=this,t=1===a.which,o=!("string"!=typeof this.options.cancel||!a.target.nodeName)&&e(a.target).closest(this.options.cancel).length;return!(t&&!o&&this._mouseCapture(a))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(a),!this._mouseStarted)?(a.preventDefault(),!0):(!0===e.data(a.target,this.widgetName+".preventClickEvent")&&e.removeData(a.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),a.preventDefault(),n=!0,!0))}},_mouseMove:function(a){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!a.button)return this._mouseUp(a);if(!a.which)if(a.originalEvent.altKey||a.originalEvent.ctrlKey||a.originalEvent.metaKey||a.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(a)}return(a.which||a.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(a),a.preventDefault()):(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,a),this._mouseStarted?this._mouseDrag(a):this._mouseUp(a)),!this._mouseStarted)},_mouseUp:function(a){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,a.target===this._mouseDownEvent.target&&e.data(a.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(a)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,n=!1,a.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.ui.plugin={add:function(a,r,t){var n,o=e.ui[a].prototype;for(n in t)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([r,t[n]])},call:function(e,a,r,t){var n,o=e.plugins[a];if(o&&(t||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;n<o.length;n++)e.options[o[n][0]]&&o[n][1].apply(e.element,r)}},e.ui.safeActiveElement=function(e){var a;try{a=e.activeElement}catch(r){a=e.body}return a||(a=e.body),a.nodeName||(a=e.body),a},e.ui.safeBlur=function(a){a&&"body"!==a.nodeName.toLowerCase()&&e(a).trigger("blur")};e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,a){this._super(e,a),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(a){var r=this.options;return!(this.helper||r.disabled||e(a.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(a),!!this.handle&&(this._blurActiveElement(a),this._blockFrames(!0===r.iframeFix?"iframe":r.iframeFix),!0))},_blockFrames:function(a){this.iframeBlocks=this.document.find(a).map(function(){var a=e(this);return e("<div>").css("position","absolute").appendTo(a.parent()).outerWidth(a.outerWidth()).outerHeight(a.outerHeight()).offset(a.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(a){var r=e.ui.safeActiveElement(this.document[0]);e(a.target).closest(r).length||e.ui.safeBlur(r)},_mouseStart:function(a){var r=this.options;return this.helper=this._createHelper(a),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(a),this.originalPosition=this.position=this._generatePosition(a,!1),this.originalPageX=a.pageX,this.originalPageY=a.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this._setContainment(),!1===this._trigger("start",a)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,a),this._mouseDrag(a,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,a),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(a,r){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(a,!0),this.positionAbs=this._convertPositionTo("absolute"),!r){var t=this._uiHash();if(!1===this._trigger("drag",a,t))return this._mouseUp(new e.Event("mouseup",a)),!1;this.position=t.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,a),!1},_mouseStop:function(a){var r=this,t=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(t=e.ui.ddmanager.drop(this,a)),this.dropped&&(t=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!t||"valid"===this.options.revert&&t||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,t)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==r._trigger("stop",a)&&r._clear()}):!1!==this._trigger("stop",a)&&this._clear(),!1},_mouseUp:function(a){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,a),this.handleElement.is(a.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,a)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(a){return!this.options.handle||!!e(a.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(a){var r=this.options,t=e.isFunction(r.helper),n=t?e(r.helper.apply(this.element[0],[a])):"clone"===r.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===r.appendTo?this.element[0].parentNode:r.appendTo),t&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" ")),e.isArray(a)&&(a={left:+a[0],top:+a[1]||0}),"left"in a&&(this.offset.click.left=a.left+this.margins.left),"right"in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left),"top"in a&&(this.offset.click.top=a.top+this.margins.top),"bottom"in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var a=this.offsetParent.offset(),r=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==r&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(a={top:0,left:0}),{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),a=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(a?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(a?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a,r,t,n=this.options,o=this.document[0];this.relativeContainer=null,n.containment?"window"!==n.containment?"document"!==n.containment?n.containment.constructor!==Array?("parent"===n.containment&&(n.containment=this.helper[0].parentNode),(t=(r=e(n.containment))[0])&&(a=/(scroll|auto)/.test(r.css("overflow")),this.containment=[(parseInt(r.css("borderLeftWidth"),10)||0)+(parseInt(r.css("paddingLeft"),10)||0),(parseInt(r.css("borderTopWidth"),10)||0)+(parseInt(r.css("paddingTop"),10)||0),(a?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(r.css("borderRightWidth"),10)||0)-(parseInt(r.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(a?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(r.css("borderBottomWidth"),10)||0)-(parseInt(r.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=r)):this.containment=n.containment:this.containment=[0,0,e(o).width()-this.helperProportions.width-this.margins.left,(e(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,a){a||(a=this.position);var r="absolute"===e?1:-1,t=this._isRootNode(this.scrollParent[0]);return{top:a.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.offset.scroll.top:t?0:this.offset.scroll.top)*r,left:a.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.offset.scroll.left:t?0:this.offset.scroll.left)*r}},_generatePosition:function(e,a){var r,t,n,o,i=this.options,s=this._isRootNode(this.scrollParent[0]),u=e.pageX,l=e.pageY;return s&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),a&&(this.containment&&(this.relativeContainer?(t=this.relativeContainer.offset(),r=[this.containment[0]+t.left,this.containment[1]+t.top,this.containment[2]+t.left,this.containment[3]+t.top]):r=this.containment,e.pageX-this.offset.click.left<r[0]&&(u=r[0]+this.offset.click.left),e.pageY-this.offset.click.top<r[1]&&(l=r[1]+this.offset.click.top),e.pageX-this.offset.click.left>r[2]&&(u=r[2]+this.offset.click.left),e.pageY-this.offset.click.top>r[3]&&(l=r[3]+this.offset.click.top)),i.grid&&(n=i.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY,l=r?n-this.offset.click.top>=r[1]||n-this.offset.click.top>r[3]?n:n-this.offset.click.top>=r[1]?n-i.grid[1]:n+i.grid[1]:n,o=i.grid[0]?this.originalPageX+Math.round((u-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX,u=r?o-this.offset.click.left>=r[0]||o-this.offset.click.left>r[2]?o:o-this.offset.click.left>=r[0]?o-i.grid[0]:o+i.grid[0]:o),"y"===i.axis&&(u=this.originalPageX),"x"===i.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top),left:u-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(a,r,t){return t=t||this._uiHash(),e.ui.plugin.call(this,a,[r,t,this],!0),/^(drag|start|stop)/.test(a)&&(this.positionAbs=this._convertPositionTo("absolute"),t.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,a,r,t)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(a,r,t){var n=e.extend({},r,{item:t.element});t.sortables=[],e(t.options.connectToSortable).each(function(){var r=e(this).sortable("instance");r&&!r.options.disabled&&(t.sortables.push(r),r.refreshPositions(),r._trigger("activate",a,n))})},stop:function(a,r,t){var n=e.extend({},r,{item:t.element});t.cancelHelperRemoval=!1,e.each(t.sortables,function(){this.isOver?(this.isOver=0,t.cancelHelperRemoval=!0,this.cancelHelperRemoval=!1,this._storedCSS={position:this.placeholder.css("position"),top:this.placeholder.css("top"),left:this.placeholder.css("left")},this._mouseStop(a),this.options.helper=this.options._helper):(this.cancelHelperRemoval=!0,this._trigger("deactivate",a,n))})},drag:function(a,r,t){e.each(t.sortables,function(){var n=!1,o=this;o.positionAbs=t.positionAbs,o.helperProportions=t.helperProportions,o.offset.click=t.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,e.each(t.sortables,function(){return this.positionAbs=t.positionAbs,this.helperProportions=t.helperProportions,this.offset.click=t.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&e.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,t._parent=r.helper.parent(),o.currentItem=r.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return r.helper[0]},a.target=o.currentItem[0],o._mouseCapture(a,!0),o._mouseStart(a,!0,!0),o.offset.click.top=t.offset.click.top,o.offset.click.left=t.offset.click.left,o.offset.parent.left-=t.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=t.offset.parent.top-o.offset.parent.top,t._trigger("toSortable",a),t.dropped=o.element,e.each(t.sortables,function(){this.refreshPositions()}),t.currentItem=t.element,o.fromOutside=t),o.currentItem&&(o._mouseDrag(a),r.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",a,o._uiHash(o)),o._mouseStop(a,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),r.helper.appendTo(t._parent),t._refreshOffsets(a),r.position=t._generatePosition(a,!0),t._trigger("fromSortable",a),t.dropped=!1,e.each(t.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(a,r,t){var n=e("body"),o=t.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(a,r,t){var n=t.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(a,r,t){var n=e(r.helper),o=t.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(a,r,t){var n=t.options;n._opacity&&e(r.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,a,r){r.scrollParentNotHidden||(r.scrollParentNotHidden=r.helper.scrollParent(!1)),r.scrollParentNotHidden[0]!==r.document[0]&&"HTML"!==r.scrollParentNotHidden[0].tagName&&(r.overflowOffset=r.scrollParentNotHidden.offset())},drag:function(a,r,t){var n=t.options,o=!1,i=t.scrollParentNotHidden[0],s=t.document[0];i!==s&&"HTML"!==i.tagName?(n.axis&&"x"===n.axis||(t.overflowOffset.top+i.offsetHeight-a.pageY<n.scrollSensitivity?i.scrollTop=o=i.scrollTop+n.scrollSpeed:a.pageY-t.overflowOffset.top<n.scrollSensitivity&&(i.scrollTop=o=i.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(t.overflowOffset.left+i.offsetWidth-a.pageX<n.scrollSensitivity?i.scrollLeft=o=i.scrollLeft+n.scrollSpeed:a.pageX-t.overflowOffset.left<n.scrollSensitivity&&(i.scrollLeft=o=i.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(a.pageY-e(s).scrollTop()<n.scrollSensitivity?o=e(s).scrollTop(e(s).scrollTop()-n.scrollSpeed):e(window).height()-(a.pageY-e(s).scrollTop())<n.scrollSensitivity&&(o=e(s).scrollTop(e(s).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(a.pageX-e(s).scrollLeft()<n.scrollSensitivity?o=e(s).scrollLeft(e(s).scrollLeft()-n.scrollSpeed):e(window).width()-(a.pageX-e(s).scrollLeft())<n.scrollSensitivity&&(o=e(s).scrollLeft(e(s).scrollLeft()+n.scrollSpeed)))),!1!==o&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(t,a)}}),e.ui.plugin.add("draggable","snap",{start:function(a,r,t){var n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var a=e(this),r=a.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:a.outerWidth(),height:a.outerHeight(),top:r.top,left:r.left})})},drag:function(a,r,t){var n,o,i,s,u,l,c,d,p,m,f=t.options,g=f.snapTolerance,_=r.offset.left,h=_+t.helperProportions.width,v=r.offset.top,b=v+t.helperProportions.height;for(p=t.snapElements.length-1;p>=0;p--)l=(u=t.snapElements[p].left-t.margins.left)+t.snapElements[p].width,d=(c=t.snapElements[p].top-t.margins.top)+t.snapElements[p].height,h<u-g||_>l+g||b<c-g||v>d+g||!e.contains(t.snapElements[p].item.ownerDocument,t.snapElements[p].item)?(t.snapElements[p].snapping&&t.options.snap.release&&t.options.snap.release.call(t.element,a,e.extend(t._uiHash(),{snapItem:t.snapElements[p].item})),t.snapElements[p].snapping=!1):("inner"!==f.snapMode&&(n=Math.abs(c-b)<=g,o=Math.abs(d-v)<=g,i=Math.abs(u-h)<=g,s=Math.abs(l-_)<=g,n&&(r.position.top=t._convertPositionTo("relative",{top:c-t.helperProportions.height,left:0}).top),o&&(r.position.top=t._convertPositionTo("relative",{top:d,left:0}).top),i&&(r.position.left=t._convertPositionTo("relative",{top:0,left:u-t.helperProportions.width}).left),s&&(r.position.left=t._convertPositionTo("relative",{top:0,left:l}).left)),m=n||o||i||s,"outer"!==f.snapMode&&(n=Math.abs(c-v)<=g,o=Math.abs(d-b)<=g,i=Math.abs(u-_)<=g,s=Math.abs(l-h)<=g,n&&(r.position.top=t._convertPositionTo("relative",{top:c,left:0}).top),o&&(r.position.top=t._convertPositionTo("relative",{top:d-t.helperProportions.height,left:0}).top),i&&(r.position.left=t._convertPositionTo("relative",{top:0,left:u}).left),s&&(r.position.left=t._convertPositionTo("relative",{top:0,left:l-t.helperProportions.width}).left)),!t.snapElements[p].snapping&&(n||o||i||s||m)&&t.options.snap.snap&&t.options.snap.snap.call(t.element,a,e.extend(t._uiHash(),{snapItem:t.snapElements[p].item})),t.snapElements[p].snapping=n||o||i||s||m)}}),e.ui.plugin.add("draggable","stack",{start:function(a,r,t){var n,o=t.options,i=e.makeArray(e(o.stack)).sort(function(a,r){return(parseInt(e(a).css("zIndex"),10)||0)-(parseInt(e(r).css("zIndex"),10)||0)});i.length&&(n=parseInt(e(i[0]).css("zIndex"),10)||0,e(i).each(function(a){e(this).css("zIndex",n+a)}),this.css("zIndex",n+i.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(a,r,t){var n=e(r.helper),o=t.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(a,r,t){var n=t.options;n._zIndex&&e(r.helper).css("zIndex",n._zIndex)}});e.ui.draggable}),function(e,a){"use strict";var r=a.module("angular-sortable-view",[]);function t(e){if(!("clientX"in e||"clientY"in e)){var a=e.touches||e.originalEvent.touches;a&&a.length&&(e.clientX=a[0].clientX,e.clientY=a[0].clientY),e.preventDefault()}}r.directive("svRoot",[function(){function e(e){return o[e]}function r(e){return[{x:e.left,y:e.top},{x:e.left+e.width,y:e.top},{x:e.left,y:e.top+e.height},{x:e.left+e.width,y:e.top+e.height},{x:e.left+e.width/2,y:e.top+e.height/2}]}function t(e,a){return e.x>=a[0].x&&e.x<=a[1].x&&e.y>=a[0].y&&e.y<=a[2].y?0:Math.min.apply(Math,a.map(function(a){return(a.x-e.x)*(a.x-e.x)+(a.y-e.y)*(a.y-e.y)}))}var n,o=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(s,u,l,c){var d=l(u.svRoot)(s)||s.$id;o[d]||(o[d]=[]);var p,m,f,g,_,h=!1,v=c(u.svOnSort);u.svOnStart=u.$$element[0].attributes["sv-on-start"],u.svOnStart=u.svOnStart&&u.svOnStart.value,u.svOnStop=u.$$element[0].attributes["sv-on-stop"],u.svOnStop=u.svOnStop&&u.svOnStop.value;var b=c(u.svOnStart),y=c(u.svOnStop);if(this.sortingInProgress=function(){return n},u.svGrid){if(null===(h="true"===u.svGrid||"false"!==u.svGrid&&null))throw"Invalid value of sv-grid attribute"}else s.$watchCollection(function(){return e(d)},function(e){h=!1;var a=e.filter(function(e){return!e.container}).map(function(e){return{part:e.getPart().id,y:e.element[0].getBoundingClientRect().top}}),r=Object.create(null);a.forEach(function(e){r[e.part]?r[e.part].push(e.y):r[e.part]=[e.y]}),Object.keys(r).forEach(function(e){r[e].sort(),r[e].forEach(function(a,t){t<r[e].length-1&&a>0&&a===r[e][t+1]&&(h=!0)})})});this.$moveUpdate=function(o,u,l,c,v,y,w){var C=l[0].getBoundingClientRect();"element"===o.tolerance&&(u={x:~~(C.left+C.width/2),y:~~(C.top+C.height/2)}),n=!0,p=[],m||(v?(m=v.clone()).removeClass("ng-hide"):((m=c.clone()).addClass("sv-visibility-hidden"),m.addClass("sv-placeholder"),m.css({height:C.height+"px",width:C.width+"px"})),c.after(m),y.copyMode||c.addClass("ng-hide"),g=c,o,b(s,{$helper:{element:f=l},$part:y.model(y.scope),$index:w,$item:y.model(y.scope)[w]}),s.$root&&s.$root.$$phase||s.$apply()),f[0].reposition({x:u.x+document.body.scrollLeft-u.offset.x*C.width,y:u.y+document.body.scrollTop-u.offset.y*C.height}),e(d).forEach(function(e,a){if(null==o.containment||i(e.element,o.containment)||i(e.element,o.containment+" *")){var n=e.element[0].getBoundingClientRect(),s=r(n),l={x:~~(n.left+n.width/2),y:~~(n.top+n.height/2)},c={x:~~(n.left+n.width/2),y:~~n.top},d={x:~~n.left,y:~~(n.top+n.height/2)};if(!e.container&&(e.element[0].scrollHeight||e.element[0].scrollWidth)){var m=e.getPart();p.push({element:e.element,q:t(u,s),view:m,targetIndex:e.getIndex(),after:function(e,a,r){return r?e.x-a.x<0:e.y-a.y<0}(l,u,"isGrid"in m?m.isGrid:h)})}if(e.container&&!e.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")){var f=l;"vertical"===e.centerVariant?f=d:"horizontal"===e.centerVariant&&(f=c),p.push({element:e.element,q:(f.x-u.x)*(f.x-u.x)+(f.y-u.y)*(f.y-u.y),view:e.getPart(),targetIndex:0,container:!0})}}});var S=m[0].getBoundingClientRect();p.push({q:t(u,r(S)),element:m,placeholder:!0}),p.sort(function(e,a){return e.q-a.q}),p.forEach(function(e,r){var t,n,o;0!==r||e.placeholder||e.container?0===r&&e.container?(_=e,e.element.append(m)):e.element.removeClass("sv-candidate"):(_=e,e.element.addClass("sv-candidate"),e.after?e.element.after(m):(t=e.element,n=m,(o=function(e){if((e=e[0]).previousElementSibling)return a.element(e.previousElementSibling);for(var r=e.previousSibling;null!=r&&1!=r.nodeType;)r=r.previousSibling;return a.element(r)}(t)).length>0?o.after(n):t.parent().prepend(n)))})},this.$drop=function(e,a,r){if(m)if(!r.revert||_&&_.view&&_.view.noRevert)l();else{var t=m[0].getBoundingClientRect(),o=f[0].getBoundingClientRect(),i=Math.sqrt(Math.pow(o.top-t.top,2)+Math.pow(o.left-t.left,2)),u=+r.revert*i/200;u=Math.min(u,+r.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(e){void 0!==f[0].style[e+"transition"]&&(f[0].style[e+"transition"]="all "+u+"ms ease")}),setTimeout(l,u),f.css({top:t.top+document.body.scrollTop+"px",left:t.left+document.body.scrollLeft+"px"})}function l(){if(n=!1,m.remove(),f.remove(),g.removeClass("ng-hide"),p=void 0,m=void 0,r=void 0,f=void 0,g=void 0,y(s,{$part:e.model(e.scope),$index:a,$item:e.model(e.scope)[a]}),_){_.element.removeClass("sv-candidate");var t=e.model(e.scope).splice(a,1),o=_.targetIndex;_.view===e&&_.targetIndex>a&&o--,_.after&&o++,_.view.model(_.view.scope).splice(o,0,t[0]),_.view===e&&a===o||v(s,{$partTo:_.view.model(_.view.scope),$partFrom:e.model(e.scope),$item:t[0],$indexTo:o,$indexFrom:a})}_=void 0,s.$root&&s.$root.$$phase||s.$apply()}},this.addToSortableElements=function(a){e(d).push(a)},this.removeFromSortableElements=function(a){var r=e(d),t=r.indexOf(a);t>-1&&(r.splice(t,1),0===r.length&&delete o[d])}}]}}]),r.directive("svPart",["$parse",function(e){return{restrict:"A",require:"^svRoot",controller:["$scope",function(e){e.$ctrl=this,this.getPart=function(){return e.part},this.$drop=function(a,r){e.$sortableRoot.$drop(e.part,a,r)}}],scope:!0,link:function(a,r,t,n){if(!t.svPart)throw new Error("no model provided");var o=e(t.svPart);if(!o.assign)throw new Error("model not assignable");a.part={id:a.$id,element:r,model:o,copyMode:"true"===t.svCopy,noRevert:"true"===t.svNoRevert,scope:a},"isGrid"in t&&(a.part.isGrid="true"===t.isGrid),a.$sortableRoot=n;var i={element:r,getPart:a.$ctrl.getPart,container:!0,centerVariant:t.svCenter||"both"};n.addToSortableElements(i),a.$on("$destroy",function(){n.removeFromSortableElements(i)})}}}]),r.directive("svElement",["$parse",function(e){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(e){e.$ctrl=this}],link:function(r,n,o,i){var u={element:n,getPart:i[0].getPart,getIndex:function(){return r.$index}};i[1].addToSortableElements(u),r.$on("$destroy",function(){i[1].removeFromSortableElements(u)});var l,c,d=n;d.on("mousedown touchstart",f),r.$watch("$ctrl.handle",function(e){e&&(d.off("mousedown touchstart",f),(d=e).on("mousedown touchstart",f))}),r.$watch("$ctrl.helper",function(e){e&&(l=e)}),r.$watch("$ctrl.placeholder",function(e){e&&(c=e)});a.element(document.body);var p,m=a.element(document.documentElement);function f(u){if(t(u),!i[1].sortingInProgress()&&(0==u.button||"mousedown"!==u.type)){var d=u.target.attributes["sv-handle-disabled"];if(!d||"true"!==d.value){p=!1;var f=e(o.svElement)(r);if((f=a.extend({},{tolerance:"pointer",revert:200,containment:"html"},f)).containment)var g=s.call(n,f.containment)[0].getBoundingClientRect();var _,h=n,v=n[0].getBoundingClientRect();l||(l=i[0].helper),c||(c=i[0].placeholder),l?((_=l.clone()).removeClass("ng-hide"),_.css({left:v.left+document.body.scrollLeft+"px",top:v.top+document.body.scrollTop+"px"}),h.addClass("sv-visibility-hidden")):(_=h.clone()).addClass("sv-helper").css({left:v.left+document.body.scrollLeft+"px",top:v.top+document.body.scrollTop+"px",width:v.width+"px"}),_[0].reposition=function(e){var a=e.x,r=e.y,t=_[0].getBoundingClientRect(),n=document.body;g&&(r<g.top+n.scrollTop&&(r=g.top+n.scrollTop),r+t.height>g.top+n.scrollTop+g.height&&(r=g.top+n.scrollTop+g.height-t.height),a<g.left+n.scrollLeft&&(a=g.left+n.scrollLeft),a+t.width>g.left+n.scrollLeft+g.width&&(a=g.left+n.scrollLeft+g.width-t.width)),this.style.left=a-n.scrollLeft+"px",this.style.top=r-n.scrollTop+"px"};var b={x:(u.clientX-v.left)/v.width,y:(u.clientY-v.top)/v.height};m.addClass("sv-sorting-in-progress"),m.on("mousemove touchmove",y).on("mouseup touchend touchcancel",function e(a){m.off("mousemove touchmove",y),m.off("mouseup touchend touchcancel",e),m.removeClass("sv-sorting-in-progress"),p&&i[0].$drop(r.$index,f),n.removeClass("sv-visibility-hidden")})}}function y(e){t(e),p||(n.parent().prepend(_),p=!0),i[1].$moveUpdate(f,{x:e.clientX,y:e.clientY,offset:b},_,n,c,i[0].getPart(),r.$index)}}}}}]),r.directive("svHandle",function(){return{require:"?^svElement",link:function(e,a,r,t){t&&(t.handle=a.add(t.handle))}}}),r.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(e,a,r,t){a.addClass("sv-helper").addClass("ng-hide"),t[1]?t[1].helper=a:t[0]&&(t[0].helper=a)}}}),r.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(e,a,r,t){a.addClass("sv-placeholder").addClass("ng-hide"),t[1]?t[1].placeholder=a:t[0]&&(t[0].placeholder=a)}}}),a.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var n=document.documentElement,o=n.matches?"matches":n.matchesSelector?"matchesSelector":n.webkitMatches?"webkitMatches":n.webkitMatchesSelector?"webkitMatchesSelector":n.msMatches?"msMatches":n.msMatchesSelector?"msMatchesSelector":n.mozMatches?"mozMatches":n.mozMatchesSelector?"mozMatchesSelector":null;if(null==o)throw"This browser doesn't support the HTMLElement.matches method";function i(e,r){if(e instanceof a.element&&(e=e[0]),null!==o)return e[o](r)}var s=a.element.prototype.closest||function(e){for(var r=this[0].parentNode;r!==document.documentElement&&!r[o](e);)r=r.parentNode;return r[o](e)?a.element(r):a.element()};"function"!=typeof a.element.prototype.add&&(a.element.prototype.add=function(e){var r,t=a.element();for(e=a.element(e),r=0;r<this.length;r++)t.push(this[r]);for(r=0;r<e.length;r++)t.push(e[r]);return t})}(window,angular),window.saveAs=window.saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var a=function(){return e.URL||e.webkitURL||e},r=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),t="download"in r,n=/constructor/i.test(e.HTMLElement)||e.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),i=e.setImmediate||e.setTimeout,s=function(e){i(function(){throw e},0)},u=function(e){setTimeout(function(){"string"==typeof e?a().revokeObjectURL(e):e.remove()},4e4)},l=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},c=function(c,d,p){p||(c=l(c));var m,f=this,g="application/octet-stream"===c.type,_=function(){!function(e,a,r){for(var t=(a=[].concat(a)).length;t--;){var n=e["on"+a[t]];if("function"==typeof n)try{n.call(e,r||e)}catch(e){s(e)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,t)return m=a().createObjectURL(c),void i(function(){var e,a;r.href=m,r.download=d,e=r,a=new MouseEvent("click"),e.dispatchEvent(a),_(),u(m),f.readyState=f.DONE},0);!function(){if((o||g&&n)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var a=o?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(a,"_blank")||(e.location.href=a),a=void 0,f.readyState=f.DONE,_()},r.readAsDataURL(c),void(f.readyState=f.INIT)}m||(m=a().createObjectURL(c)),g?e.location.href=m:e.open(m,"_blank")||(e.location.href=m);f.readyState=f.DONE,_(),u(m)}()},d=c.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,a,r){return a=a||e.name||"download",r||(e=l(e)),navigator.msSaveOrOpenBlob(e,a)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(e,a,r){return new c(e,a||e.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this),function(){"use strict";var e,a;angular.module("myvcFrontApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngSanitize","ngTouch","ui.bootstrap","ui.router","ui.select","angular-loading-bar","ckeditor","uiBreadcrumbs","toastr","http-auth-interceptor","ui.grid","ui.grid.edit","ui.grid.resizeColumns","ui.grid.exporter","ui.grid.selection","ui.grid.cellNav","ui.grid.autoResize","ui.grid.pinning","ui.grid.expandable","ui.grid.moveColumns","ngFileUpload","FBAngular","nvd3","angular-sortable-view","ui.calendar"]).constant("App",(e=location.protocol+"//"+location.hostname+"/8myvc/public/","localhost"===location.hostname&&(e=location.protocol+"//"+location.hostname+"/"),a=e+"api/",location.origin,location.href.indexOf("demo")>0&&(a=e+"demo/5myvc/public/"),{Server:a,views:"views/",images:e+"images/",perfilPath:e+"images/perfil/",imgSharedPath:e+"images/shared/",parentescos:[{parentesco:"Padre"},{parentesco:"Madre"},{parentesco:"Hermano"},{parentesco:"Hermana"},{parentesco:"Abuelo"},{parentesco:"Abuela"},{parentesco:"Tío"},{parentesco:"Tía"},{parentesco:"Primo(a)"},{parentesco:"Otro"}],opciones_programar:[{opcion:"MATRIC CONDICIONAL"},{opcion:"COMPROM ACADÉMICO"},{opcion:"COMPROM DISCIPLINARIO"},{opcion:"COMPROM ACADÉMICO Y DISCIPLINARIO"},{opcion:"PÉRDIDA DE CUPO"},{opcion:"CAMBIO INSTITUCIÓN"},{opcion:"OTRO"}],sangres:[{sangre:"O+"},{sangre:"O-"},{sangre:"A+"},{sangre:"A-"},{sangre:"B+"},{sangre:"B-"},{sangre:"AB+"},{sangre:"AB-"}],religiones:["Adventista","Católico","Pentecostal","Cuadrangular","Testigo de Jehová","Mormón","Otra","Ninguna"],tipos_sangre:["AB+","AB-","A+","A-","B+","B-","O+","O-"]})).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",alumno:"alumno",acudiente:"acudiente",profesor:"profesor",guest:"guest",rector:"rector",enfermero:"enfermero",psicologo:"psicólogo",coord_academico:"Coord académico",coord_disciplinario:"Coord disciplinario",secretario:"Secretario"}).constant("PERMISSIONS",{can_work_like_admin:"can_work_like_admin",can_work_like_teacher:"can_work_like_teacher",can_work_like_student:"can_work_like_student",can_work_like_acudiente:"can_work_like_acudiente",can_accept_images:"can_accept_images",can_edit_alumnos:"can_edit_alumnos",can_edit_usuarios:"can_edit_usuarios",can_edit_notas:"can_edit_notas",can_edit_years:"can_edit_years",can_edit_periodos:"can_edit_periodos",can_edit_paises:"can_edit_paises",can_edit_ciudades:"can_edit_ciudades",can_edit_disciplinas:"can_edit_disciplinas",can_edit_profesores:"can_edit_profesores",can_edit_eventos:"can_edit_eventos",can_edit_votaciones:"can_edit_votaciones",can_edit_aspiraciones:"can_edit_aspiraciones",can_edit_participantes:"can_edit_participantes",can_edit_candidatos:"can_edit_candidatos",can_edit_unidades_subunidades:"can_edit_unidades_subunidades"}),window.validateEmail=function(e){return/\S+@\S+\.\S+/.test(e)},window.fixHora=function(e){var a,r,t;return(a=e.getHours())<10&&(a="0"+a),(r=e.getMinutes())<10&&(r="0"+r),(t=e.getSeconds())<10&&(t="0"+t),a+":"+r+":"+t}}.call(this),function(){angular.module("myvcFrontApp").config(["$cookiesProvider","$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$httpProvider","$locationProvider","App","PERMISSIONS","$intervalProvider","$rootScopeProvider","USER_ROLES","toastrConfig","uiSelectConfig",function(e,a,r,t,n,o,i,s,u,l,c,d,p){return n.defaults.headers.post["X-CSRFToken"]=e.csrftoken,n.defaults.headers.put["X-CSRFToken"]=e.csrftoken,n.defaults.useXDomain=!0,n.defaults.xsrfCookieName="csrftoken",n.defaults.xsrfHeaderName="X-CSRFToken",delete n.defaults.headers.common["X-Requested-With"],n.interceptors.push(["$q",function(e){return{request:function(e){var a;return(a=e.url.split("::")).length>1?e.url=i.Server+a[1]:(a=e.url.split("==")).length>1&&(e.url=i.views+a[1]),e}}}]),p.theme="select2",p.resetSearchInput=!0,t.strictMode(!1),r.otherwise("/login"),r.when("/user/:username",["$match","$state",function(e,a){return a.transitionTo("panel.user.resumen",e)}]),a.state("main",{url:"/",views:{principal:{templateUrl:i.views+"main/main.tpl.html",controller:"MainCtrl"}},data:{displayName:"principal",icon_fa:"",pageTitle:"Construcción - MyVc"}}).state("login",{url:"/login",views:{principal:{templateUrl:`${i.views}login/login.tpl.html`,controller:"LoginCtrl"}},data:{displayName:"Login",icon_fa:"fa fa-user",pageTitle:"Ingresar a MyVc"}}).state("reset-password",{url:"/reset-password/:numero/:username",views:{principal:{templateUrl:`${i.views}login/reset-password.tpl.html`,controller:"ResetPasswordCtrl"}},data:{displayName:"Resetear",icon_fa:"fa fa-user",pageTitle:"Ingreso a MyVc"}}).state("logout",{url:"/logout",views:{principal:{templateUrl:`${i.views}login/logout.tpl.html`,controller:"LogoutCtrl"}},data:{displayName:"Logout",icon_fa:"fa fa-user"}}).state("panel",{url:"/panel",views:{principal:{templateUrl:`${i.views}panel/panel.tpl.html`,controller:"PanelCtrl"}},resolve:{resolved_user:["AuthService",function(e){return e.verificar()}]},data:{displayName:"Inicio",icon_fa:"fa fa-home",pageTitle:"Bienvenido - MyVc"}}),angular.extend(d,{allowHtml:!0,closeButton:!0,extendedTimeOut:1e3,preventOpenDuplicates:!1,maxOpened:3,tapToDismiss:!0,target:"body",timeOut:4e3}),this}]).filter("capitalize",function(){return function(e,a){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}})}.call(this),function(){angular.module("myvcFrontApp").run(["$rootScope","cfpLoadingBar","$state","$stateParams","$cookies","Perfil","AuthService","AUTH_EVENTS","toastr",function(e,a,r,t,n,o,i,s,u){return e.$state=r,e.$stateParams=t,e.lastState=null,e.lastStateParam=null,e.notaRapida={enable:!1,valorNota:0},e.menucompacto=!1,e.$on("event:auth-loginRequired",function(e){return console.log("Acceso no permitido, vamos a loguear",e),r.transitionTo("login")}),e.ingresar=function(){return null===e.lastState||"login"===e.lastState||"/"===e.lastState||"main"===e.lastState?r.transitionTo("panel"):r.transitionTo(e.lastState,e.lastStateParam)},e.$on("event:auth-loginConfirmed",function(){return console.log("Logueado con éxito!"),e.ingresar()}),e.$on("$stateChangeStart",function(a,r,t,n,o){if(null===e.lastState||"logout"!==r.name&&"login"!==r.name&&"main"!==r.name)return e.lastState=r.name,e.lastStateParam=t}),e.$on("$stateChangeSuccess",function(a,t,n,o,i){return e.pageTitle=r.current.name}),e.$on("$stateChangeError",function(a,t,n,o,i){if(console.log("Evento fallido: ",a),u.warning("Lo sentimos, hubo un error o no puedes acceder a esta vista"),"panel"!==e.lastState)return r.transitionTo("panel")}),e.$on(s.loginSuccess,function(){var a;if(a=o.User())return a.votaciones?(1===a.votaciones.length?u.success("Hay 1 votación en ejecución."):u.success("Hay "+a.votaciones.length+" votaciones en ejecución."),r.go("panel.actividades.votaciones.votar")):e.ingresar()}),e.$on(s.loginFailed,function(e){}),e.$on(s.notAuthenticated,function(e){return u.warning("No está autorizado.","Acceso exclusivo"),console.log("Evento notAuthenticated: ",e),r.transitionTo("login")}),e.$on(s.notAuthorized,function(a){return u.warning("No está autorizado para entrar a esta vista","Restringido"),r.go("panel"),console.log("Evento notAuthorized: ",a,e.lastState)})}])}.call(this),function(){"use strict";function e(e){return{restrict:"A",scope:{fixedColumns:"@"},link:function(a,r){var t=r[0];function n(){t.addEventListener("scroll",function(){var e=t.scrollLeft;t.scrollTop;$(".inmovible td.fixed-cell").css({transform:"translate("+e+"px, 0)"})})}e(function(){n()},0),a.$on("refreshFixedColumns",function(){e(function(){n(),t.scrollLeft=0},0)})}}}angular.module("myvcFrontApp").directive("fixedColumnTable",e),e.$inject=["$timeout"]}(),function(){"use strict";angular.module("myvcFrontApp").controller("ApplicationController",["$scope",function(e){return e.isLoginPage=!1,Date.prototype.yyyymmdd=function(){var e,a;return a=this.getMonth()+1,e=this.getDate(),[this.getFullYear(),(a>9?"":"0")+a,(e>9?"":"0")+e].join("-")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("MainCtrl",["$scope","$window","$interval",function(e,a,r){}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("PanelCtrl",["$scope","$http","$state","$cookies","$rootScope","AuthService","Perfil","App","resolved_user","toastr","cfpLoadingBar","$window","$uibModal",function(e,a,r,t,n,o,i,s,u,l,c,d,p){e.USER=u,e.pageTitle=n.pageTitle,e.perfilPath=s.images+"perfil/",e.views=s.views,localStorage.cambia_anio&&(parseInt(localStorage.cambia_anio),p.open({templateUrl:"==panel/cuidadoCambiaPeriodoModal.tpl.html",controller:"PoliticasPrivacidadCtrl",size:"lg"}),delete localStorage.cambia_anio),e.logoPathDefault="images/Logo_MyVc_Header.gif",e.logoPath="images/Logo_Colegio_Header.gif",a.get(e.logoPath).then(function(){},function(){return e.logoPath=e.logoPathDefault}),localStorage.menucompacto?n.menucompacto="true"===localStorage.menucompacto:d.innerWidth<600&&(n.menucompacto=!0,localStorage.menucompacto=n.menucompacto),c.complete(),o.verificar_acceso(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.date=new Date,a.get("::years").then(function(a){return e.years=a.data.reverse()},function(e){return l.error("No se trajeron los años")}),a.get("::periodos").then(function(a){return e.periodos=a.data},function(e){return l.error("No se trajeron los periodos")}),"Acudiente"===e.USER.tipo&&a.put("::acudientes/mis-acudidos").then(function(a){return e.mis_acudidos=a.data.alumnos},function(e){return l.error("No se trajeron los acudidos")}),e.setImagenPrincipal=function(){var a,r,t;return t=(a=s.images+"perfil/")+e.USER.imagen_nombre,r=a+e.USER.foto_nombre,e.imagenPrincipal=t,e.imagenOficial=r},e.setImagenPrincipal(),e.nameToShow=i.nameToShow,e.usuario=function(){return i.User().username},e.toggleCompactMenu=function(){return n.menucompacto=!n.menucompacto,localStorage.menucompacto=n.menucompacto},e.seeDropdownPeriodos=!1,e.togglePeriodos=function(){return e.seeDropdownPeriodos=!e.seeDropdownPeriodos,console.log(e.seeDropdownPeriodos)},e.cambiarPeriodo=function(r){return a.put("::periodos/useractive/"+r.id).then(function(a){return l.success("Periodo cambiado con éxito al perido "+r.numero,"Cambiado"),e.USER.periodo_id=r.id,e.USER.numero_periodo=r.numero,d.location.reload()},function(e){return l.warning("No se pudo cambiar de periodo.","Problema")})},e.cambiarYear=function(r){return a.put("::years/useractive/"+r.id).then(function(a){return a=a.data,e.USER.year_id=r.id,e.USER.year=r.year,e.USER.numero_periodo=a.numero,e.USER.periodo_id=a.id,l.success("Año cambiado con éxito: "+r.year,"Cambiado"),d.location.reload()},function(e){return l.warning("No se pudo cambiar el año.","Problema")})},e.logout=function(){return o.logout()},e.goFileManager=function(){return r.go("panel.filemanager")},e.indexChar=function(e){return String.fromCharCode(65+e)},e.verPoliticasPrivacidad=function(){return p.open({templateUrl:"==panel/politicasPrivacidadModal.tpl.html",controller:"PoliticasPrivacidadCtrl",size:"lg"})},e.$on("cambianImgs",function(a,r){return e.USER=i.User(),e.setImagenPrincipal()})}]).controller("PoliticasPrivacidadCtrl",["$scope","$uibModalInstance","$http","toastr","App",function(e,a,r,t,n){return e.perfilPath=n.images+"perfil/",e.ok=function(){return a.close()},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider","USER_ROLES","PERMISSIONS",function(e,a,r){e.state("panel.alumnos",{url:"^/alumnos",views:{maincontent:{templateUrl:"==alumnos/alumnos.tpl.html",controller:"AlumnosCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Alumnos"}]}}},data:{displayName:"Alumnos",icon_fa:"fa fa-male",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos],pageTitle:"Alumnos - MyVc"}}).state("panel.mensajes",{url:"^/mensajes",views:{maincontent:{templateUrl:"==mensajes/mensajes.tpl.html",controller:"MensajesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Mensajes"}]}}},data:{displayName:"Mensajes",icon_fa:"fa fa-envelope"}}).state("panel.years",{url:"^/years",views:{maincontent:{templateUrl:"==colegio/years.tpl.html",controller:"YearsCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Años"}]}}},data:{displayName:"Años",icon_fa:"fa fa-graduation-cap",needed_permissions:[r.can_work_like_admin],pageTitle:"Años - MyVc"}}).state("panel.paises",{url:"^/paises",views:{maincontent:{templateUrl:"==paises/paises.tpl.html",controller:"PaisesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Paises"}]}}},data:{displayName:"Paises",icon_fa:"fa fa-flag-checkered",needed_permissions:[r.can_work_like_admin],pageTitle:"Paises - MyVc"}}).state("panel.profesores",{url:"^/profesores",views:{maincontent:{templateUrl:"==profesores/profesores.tpl.html",controller:"ProfesoresCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Profesores"}]}}},data:{displayName:"Profesores",icon_fa:"fa fa-graduation-cap",needed_permissions:[r.can_work_like_admin],pageTitle:"Profesores - MyVc"}}).state("panel.ciudades",{url:"/ciudades",views:{maincontent:{templateUrl:"==ciudades/ciudades.tpl.html",controller:"CiudadesCtrl",resolve:{paises:["$http",function(e){return e.get("::paises")}]}},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Ciudades"}],paises:["$http",function(e){return e.get("::paises")}]}}},data:{displayName:"Ciudades",icon_fa:"fa fa-map-marker",needed_permissions:[r.can_work_like_admin],pageTitle:"Ciudades - MyVc"}}).state("panel.disciplinas",{url:"/disciplinas",views:{maincontent:{templateUrl:"==disciplinas/disciplinas.tpl.html",controller:"DisciplinasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Disciplinas"}]}}},data:{displayName:"Disciplinas",icon_fa:"fa fa-align-justify",pageTitle:"Disciplinas - MyVc"}}).state("panel.eventos",{url:"/eventos",views:{maincontent:{templateUrl:"==eventos/eventos.tpl.html",controller:"EventosCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Eventos"}]}}},data:{displayName:"Eventos",icon_fa:"fa fa-laptop",needed_permissions:[r.can_work_like_admin],pageTitle:"Eventos - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("PanelHeaderCtrl",["$scope","titulo","$state","$stateParams","Fullscreen","$rootScope",function(e,a,r,t,n,o){e.titulo=a,o.reload=function(){return r.go(r.current,t,{reload:!0})},e.setFullScreen=function(){return n.toggleAll()}}])}.call(this),function(){angular.module("myvcFrontApp").directive("anunciosDir",["App","$http","toastr","$uibModal","$state","AuthService","$sce","$timeout","$window",function(e,a,r,t,n,o,i,s,u){return{restrict:"E",templateUrl:`${e.views}panel/anunciosDir.tpl.html`,link:function(l,c,d){if(l.perfilPath=e.images+"perfil/",l.views=e.views,l.anchoWindow=u.innerWidth,l.mostrandoHoy=!0,l.dato={},n.is("panel"))return a.get("::ChangesAsked/to-me",{params:{anchoWindow:l.anchoWindow}}).then(function(e){var a,n,u,c,d,p,m,f,g,_,h,v,b,y,w,C,S,A,E,P,N,$,U,O;if(l.changes_asked=e.data,s(function(){var e,a,r,t;for(a=0,r=(t=l.changes_asked.eventos).length;a<r;a++)(e=t[a]).start=new Date(e.start),e.end=e.end?new Date(e.end):null,e.solo_profes?e.className="evento-solo-profes":e.className=e.cumple_alumno_id||e.cumple_profe_id?"evento-cumpleanios":null;return l.eventos=[l.changes_asked.eventos]},500),(null!=(C=l.changes_asked.alumnos)?C.length:void 0)>0){for(n=0,p=(S=l.changes_asked.alumnos).length;n<p;n++)if((a=S[n]).uniformes)for(u=0,m=(A=a.uniformes).length;u<m;u++)(U=A[u]).fecha_hora=new Date(U.fecha_hora.replace(/-/g,"/"))}else if(l.changes_asked.uniformes)for(c=0,f=(E=l.changes_asked.uniformes).length;c<f;c++)(U=E[c]).fecha_hora=new Date(U.fecha_hora.replace(/-/g,"/"));for(d=0,g=(P=l.changes_asked.publicaciones).length;d<g;d++)(w=P[d]).contenido_tr=i.trustAsHtml(w.contenido);if(l.changes_asked.mis_publicaciones)for(v=0,_=(N=l.changes_asked.mis_publicaciones).length;v<_;v++)(w=N[v]).contenido_tr=i.trustAsHtml(w.contenido);if((o.hasRoleOrPerm(["alumno","acudiente"])||"Alumno"===l.USER.tipo)&&(l.publicaciones_actuales=[l.changes_asked.publicaciones[0]],l.changes_asked.publicaciones.length>1&&l.publicaciones_actuales.push(l.changes_asked.publicaciones[1])),o.hasRoleOrPerm(["admin","profesor","secretario"])&&l.changes_asked.publicaciones.length>0&&(l.publicacion_actual=l.changes_asked.publicaciones[0]),l.anchoWindow>500&&o.hasRoleOrPerm(["admin","profesor","alumno","secretario"])){if(l.options={chart:{type:"discreteBarChart",height:180,margin:{top:20,right:20,bottom:60,left:55},useInteractiveGuideline:!0,x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.0f")(e)},transitionDuration:500,xAxis:{axisLabel:"X Axis",rotateLabels:30,showMaxMin:!1},zoom:{enabled:!0,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!1,verticalOff:!0,unzoomEventType:"dblclick.zoom"}},title:{enable:!1,text:"Asignaturas correctas"}},O=[],l.changes_asked.profes_actuales)for(b=0,h=($=l.changes_asked.profes_actuales).length;b<h;b++)y=$[b],O.push({label:y.nombres+" "+y.apellidos.substr(0,1)+".",value:y.porcentaje});l.data=[{key:"Asignaturas correctas",values:O}]}return l.prematricular=function(e){var a;if(e.grupo_prematr)return a={matricula_id:e.next_year.matricula_id,alumno_id:e.alumno_id,grupo_id:e.grupo_prematr.id,year_id:e.next_year.year_id,estado:"PREA"},t.open({templateUrl:"==alumnos/prematricularConfirmarModal.tpl.html",controller:"PrematricularConfirmarCtrl",resolve:{datos:function(){return a},alumno:function(){return e},USER:function(){return l.USER}}}).result.then(function(e){return console.log("Prematriculado")});r.warning("Debe seleccionar el grupo")}},function(e){return console.log(e)})},controller:"AnunciosDirCtrl"}}]).directive("publicacionesPanelDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}panel/publicacionesPanelDir.tpl.html`}}]).directive("horarioHoyPanelDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}panel/horarioHoyPanelDir.tpl.html`}}]).controller("PrematricularConfirmarCtrl",["$scope","$uibModalInstance","datos","alumno","USER","$http","toastr","App",function(e,a,r,t,n,o,i,s){return e.imagesPath=s.images+"perfil/",e.USER=n,e.alumno=t,e.ok=function(){if(!e.prematriculando)return e.prematriculando=!0,o.put("::matriculas/prematricular",r).then(function(r){return i.success("Alumno prematriculado"),e.prematriculando=!1,r.data.matricula.prematriculado=new Date(r.data.matricula.prematriculado.replace(/-/g,"/")),e.alumno.next_year=r.data.matricula,a.close(r.data)},function(a){return i.error("Tal vez no existe el "+(e.USER.year+1),"Problema"),e.prematriculando=!1})},e.cancel=function(){return a.dismiss("cancel")}}]).controller("AceptarAskedCtrl",["$scope","$uibModalInstance","asked","tipo","valor_nuevo","$http","toastr","App",function(e,a,r,t,n,o,i,s){return e.imagesPath=s.images+"perfil/",e.asked=r,e.aceptarAsignatura=function(){var e;return e={pedido:r,tipo:t,asker_id:r.asked_by_user_id},o.put("::ChangesAsked/aceptar-asignatura",e).then(function(e){return a.close(e.data)},function(e){return i.warning("Problema","No se pudo aceptar petición.")})},e.ok=function(){var s;return r.assignment_id?e.aceptarAsignatura():(s={asked_id:r.asked_id,data_id:r.detalles.data_id,tipo:t,valor_nuevo:n,asker_id:r.asked_by_user_id},r.alumno_id&&(s.alumno_id=r.alumno_id),o.put("::ChangesAsked/aceptar-alumno",s).then(function(e){return a.close(e.data)},function(e){return i.warning("Problema","No se pudo aceptar petición.")}))},e.cancel=function(){return a.dismiss("cancel")}}]).controller("RechazarAskedCtrl",["$scope","$uibModalInstance","asked","tipo","$http","toastr","App",function(e,a,r,t,n,o,i){return e.imagesPath=i.images+"perfil/",e.asked=r,e.ok=function(){var e,i,s;return i=r.detalles?r.detalles.data_id:r.assignment_id,e=r.detalles.assignment_id,s={asked_id:r.asked_id,data_id:i,assignment_id:e,tipo:t,asker_id:r.asked_by_user_id},n.put("::ChangesAsked/rechazar",s).then(function(e){return a.close(e.data)},function(e){return o.error("Problema","No se pudo rechazar petición.")})},e.cancel=function(){return a.dismiss("cancel")}}]).controller("EliminarAskedCtrl",["$scope","$uibModalInstance","asked","$http","toastr","App",function(e,a,r,t,n,o){return e.imagesPath=o.images+"perfil/",e.asked=r,e.ok=function(){var e;return e={asked_id:r.asked_id,data_id:r.detalles.data_id},t.put("::ChangesAsked/destruir",e).then(function(e){return a.close(e.data)},function(e){return n.error("Problema","No se pudo eliminar peticiones.")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").controller("AnunciosDirCtrl",["$scope","$uibModal","AuthService","$http","toastr","$filter","App","$timeout","Upload","$sce","uiCalendarConfig","$compile","EscalasValorativasServ",function(e,a,r,t,n,o,i,s,u,l,c,d,p){var m,f;return e.hasRoleOrPerm=r.hasRoleOrPerm,e.perfilPath=i.images+"perfil/",e.views=i.views,e.srcCant=e.views+"informes2/verCantAlumnosPorGrupos.tpl.html",e.fileReaderSupported=null!==window.FileReader&&null===window.FileAPI,e.imgFiles=[],e.imagen_subida=!0,e.mostrar_publicaciones=!0,e.guardando_publicacion=!1,e.USER=e.USER,e.profe_seleccionado=!1,e.mostrando_edit_evento=!1,e.actualizando_cumples=!1,e.IS_PROF_ADMIN=e.hasRoleOrPerm(["admin","profesor"]),e.IS_ALUM_ACUD=e.hasRoleOrPerm(["alumno","acudiente","psicólogo","enfermero","coord disciplinario"])||"Acudiente"===e.USER.tipo,e.new_publicacion={publi_para:"publi_para_todos",para_alumnos:1},e.evento_actual={title:"",start:null,end:null,allDay:1,solo_profes:0},e.data={},e.dateOptions={formatYear:"yyyy"},localStorage.panel_tab_actual&&(e.panel_tab_actual=localStorage.panel_tab_actual),e.guardarEvento=function(a){if(0!==a.title.length&&a.start){if(a.allDay||a.end)return a.guardando=!0,a.editar?t.put("::calendario/guardar-evento",a).then(function(){return n.success("Guardado"),a.guardando=!1,a.editar=!1,e.evento_actual={title:"",start:null,end:null,allDay:1,solo_profes:0,id:null}},function(){return n.error("Error guardando"),a.guardando=!1}):t.put("::calendario/crear-evento",a).then(function(r){return n.success("Creado"),a.guardando=!1,a.id=r.data.evento_id,e.eventos[0].push(a),e.evento_actual={title:"",start:null,end:null,allDay:1,solo_profes:0,id:null}},function(){return n.error("Error creando"),a.guardando=!1});n.warning("Escribe fecha fin o elige Todo el día")}else n.warning("Escribe título y fecha inicio")},e.actualizarEventos=function(){return t.put("::calendario/this-year",{is_prof_admin:e.IS_PROF_ADMIN}).then(function(a){return e.eventos=null,s(function(){var r,t,o,i;for(t=0,o=(i=a.data).length;t<o;t++)(r=i[t]).start=new Date(r.start),r.end=r.end?new Date(r.end):null,r.solo_profes?r.className="evento-solo-profes":r.className=r.cumple_alumno_id||r.cumple_profe_id?"evento-cumpleanios":null;return e.eventos=[a.data],n.success("Actualizado")},500)},function(){return n.error("Error actualizando")})},e.noMostrarEditEvento=function(){return e.mostrando_edit_evento=!1},e.mostrarEditEvento=function(){return e.mostrando_edit_evento=!0},e.cancelarEdicion=function(){return e.evento_actual={title:"",start:null,end:null,allDay:1,id:null}},e.eliminarEvento=function(a){if(!a.guardando&&confirm("¿Seguro que desea eliminar evento?"))return a.guardando=!0,a.editar?t.put("::calendario/eliminar-evento",a).then(function(){return n.success("Eliminado"),a.guardando=!1,e.evento_actual={title:"",start:null,end:null,solo_profes:0,allDay:1}},function(){return n.error("Error eliminando"),a.guardando=!1}):void 0},e.actualizarCumplesEnCalendario=function(){if(confirm("Esto borrará y creará de nuevo los cumpleaños, ¿continuar?"))return e.actualizando_cumples=!0,t.put("::calendario/sincronizar-cumples").then(function(){return n.success("Sincronizado","Actualice"),e.actualizando_cumples=!1},function(){return n.error("Error sincronizando"),e.actualizando_cumples=!1})},e.fromEventoToActual=function(a){return e.evento_actual={title:a.title,start:a.start?new Date(a.start):null,end:a.end?new Date(a.end):null,allDay:a.allDay?1:0,solo_profes:a.solo_profes,editar:!0,id:a.id}},e.alertOnEventClick=function(a,r,t){return e.fromEventoToActual(a),e.mostrando_edit_evento=!0},e.alertOnDrop=function(a,r,t,n,o,i){return e.fromEventoToActual(a),e.guardarEvento(e.evento_actual),console.log("Event Droped to make dayDelta "+r,a)},e.alertOnResize=function(a,r,t,n,o,i){return e.fromEventoToActual(a),e.guardarEvento(e.evento_actual),console.log("Event Resized to make dayDelta "+r,a)},e.eventRender=function(a,r,t){return r.attr({"uib-tooltip-html":"'<p>"+a.title+"</p>Por: "+a.created_by_nombres+"'","tooltip-append-to-body":!0}),d(r)(e)},e.uiConfig={calendar:{height:450,editable:!!e.IS_PROF_ADMIN,eventRender:e.eventRender,header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},eventDurationEditable:!!e.IS_PROF_ADMIN,eventClick:e.alertOnEventClick,eventDrop:e.alertOnDrop,eventResize:e.IS_PROF_ADMIN?e.alertOnResize:null,buttonText:{today:"Hoy",month:"Mes",agendaWeek:"Semana",agendaDay:"Día"}}},e.selectTab=function(a){if(e.panel_tab_actual=a,localStorage.panel_tab_actual=e.panel_tab_actual,"calendario"===a)return e.actualizarEventos()},e.UNIDAD=e.USER.unidad_displayname,e.GENERO_UNI=e.USER.genero_unidad,e.SUBUNIDAD=e.USER.subunidad_displayname,e.GENERO_SUB=e.USER.genero_subunidad,e.UNIDADES=e.USER.unidades_displayname,e.SUBUNIDADES=e.USER.subunidades_displayname,e.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),p.escalas().then(function(a){return e.escalas=a,e.escala_maxima=p.escala_maxima()},function(e){return console.log("No se trajeron las escalas valorativas",e)}),e.mostrarClasesDeHoy=function(){return e.mostrandoHoy=!0},e.mostrarClasesDeManana=function(){return e.mostrandoHoy=!1},e.seleccionarAsignatura=function(a){return 0!==a.unidades.length||a.seleccionada||t.get("::unidades/de-asignatura-periodo/"+a.asignatura_id+"/"+e.USER.periodo_id).then(function(e){if(e.data.length>0)return a.unidades=e.data},function(){return n.error("Error comprobando notas de asignatura")}),a.seleccionada=!a.seleccionada},e.cargarAlumnosAsistencia=function(a,r,o){return e.subunidad_actual=!1,e.asignatura_actual=a,t.put("::notas/subunidad",{grupo_id:r,asignatura_id:o}).then(function(a){var r,t,n,o,i,s,u,l,c;for(e.alumnos_subunidad=a.data.alumnos,e.pasandoNotas=!0,l=[],t=0,o=(s=e.alumnos_subunidad).length;t<o;t++){for(n=0,i=(u=(r=s[t]).uniformes).length;n<i;n++)(c=u[n]).fecha_hora=new Date(c.fecha_hora.replace(/-/g,"/"));l.push(e.verificarFallaHoy(r))}return l},function(){return n.error("Error trayendo notas")})},e.verificarFallaHoy=function(e){var a,r,t,n,o,i,s,u,l,c,d,p,m,f;for(r=new Date,e.falla_hoy="",e.uniforme_hoy=!1,t=0,i=(l=e.tardanzas).length;t<i;t++)(m=l[t]).fecha_hora&&(m.fecha_hora.replace&&(m.fecha_hora=new Date(m.fecha_hora.replace(/-/g,"/"))),r.toDateString()===m.fecha_hora.toDateString()&&(e.falla_hoy="tardanza"));for(n=0,s=(c=e.ausencias).length;n<s;n++)(a=c[n]).fecha_hora&&(a.fecha_hora.replace&&(a.fecha_hora=new Date(a.fecha_hora.replace(/-/g,"/"))),r.toDateString()===a.fecha_hora.toDateString()&&(e.falla_hoy="ausencia"));for(p=[],o=0,u=(d=e.uniformes).length;o<u;o++)(f=d[o]).fecha_hora?(f.fecha_hora.replace&&(f.fecha_hora=new Date(f.fecha_hora.replace(/-/g,"/"))),r.toDateString()===f.fecha_hora.toDateString()?p.push(e.uniforme_hoy=!0):p.push(void 0)):p.push(void 0);return p},e.cargarAlumnosSubunidad=function(a,r,o,i){return e.subunidad_actual=a,e.asignatura_actual=r,t.put("::notas/subunidad",{subunidad:a,grupo_id:o,asignatura_id:i}).then(function(a){var r,t,n,o,i;for(e.alumnos_subunidad=a.data.alumnos,e.pasandoNotas=!0,i=[],t=0,n=(o=e.alumnos_subunidad).length;t<n;t++)r=o[t],i.push(e.verificarFallaHoy(r));return i},function(){return n.error("Error trayendo notas")})},e.cambiarNota=function(r,t){return a.open({templateUrl:"==panel/cambiarNotaModal.tpl.html",controller:"CambiarNotaModalCtrl",animation:!1,resolve:{alumno:function(){return r},subunidad:function(){return e.subunidad_actual},nota:function(){return t}}}).result.then(function(e){return console.log(e)},function(){})},e.quitarAusenciaHoy=function(a,r){var t,n,o,i,u,l,c,d;if(a.repeticion_proceso?a.repeticion_proceso++:a.repeticion_proceso=0,!a.quitandoAusenciaHoy){for(a.quitandoAusenciaHoy=!0,n=(n=new Date).toDateString(),o=0,u=(c=a.tardanzas).length;o<u;o++)(t=c[o]).fecha_hora&&n===t.fecha_hora.toDateString()&&e.eliminarAusencia(t,a,!0);for(i=0,l=(d=a.ausencias).length;i<l;i++)(t=d[i]).fecha_hora&&(console.log(t.fecha_hora,t.fecha_hora.toDateString()),n===t.fecha_hora.toDateString()&&e.eliminarAusencia(t,a,!0));return s(function(){return a.quitandoAusenciaHoy=!1,e.verificarFallaHoy(a)},500),a.repeticion_proceso<2?s(function(){return e.verificarFallaHoy(a)},2e3):void 0}},e.verTardanzasAusencias=function(e){e.mostrandoFallas=!e.mostrandoFallas},e.verUniformes=function(e){e.mostrandoUniformes=!e.mostrandoUniformes},e.verAgregarUniforme=function(e){e.new_uni={fecha_hora:new Date},e.creandoUniforme=!e.creandoUniforme},e.cancelarGuardarUniforme=function(e){return e.guardando_uniforme=!1,e.creandoUniforme=!1},e.guardarUniforme=function(a){a.guardando_uniforme||(a.guardando_uniforme=!0,a.new_uni.alumno_id=a.alumno_id,a.new_uni.asignatura_id=e.asignatura_actual.asignatura_id,a.new_uni.materia=e.asignatura_actual.materia,a.new_uni.fecha_hora=a.new_uni.fecha_hora.yyyymmdd()+" "+window.fixHora(a.new_uni.fecha_hora),t.put("::uniformes/agregar",a.new_uni).then(function(e){return a.uniforme_hoy=!0,a.guardando_uniforme=!1,e.data.uniforme.fecha_hora=new Date(e.data.uniforme.fecha_hora.replace(/-/g,"/")),a.uniformes.push(e.data.uniforme),a.uniformes_count++,a.creandoUniforme=!1},function(){return n.error("Error agregando uniformes"),a.guardando_uniforme=!1,a.creandoUniforme=!1}))},e.editarUniforme=function(e,a){return e.editando=!e.editando},e.cancelarGuardarUniformeEditado=function(e){return e.guardando=!1,e.editando=!1},e.guardarUniformeEditado=function(e,a){e.guardando||(e.guardando=!0,t.put("::uniformes/actualizar",e).then(function(a){return e.guardando=!1,n.success("Uniforme actualizado."),e.editando=!1},function(){return n.error("Error actualizado uniforme."),e.guardando=!1}))},e.guardarValorUniforme=function(a,r,i,s){var u;return u={uniforme_id:a.id,fecha_hora:o("date")(a.fecha_hora,"yyyy-MM-dd HH:mm:ss")},t.put("::uniformes/guardar-cambios-uniforme",u).then(function(a){return e.verificarFallaHoy(s)},function(e){return n.warning("No se pudo cambiar.","Problema")})},e.eliminarUniforme=function(a,r){if(confirm("¿Seguro que deseas eliminar este registro de uniforme?"))return t.put("::uniformes/eliminar",{uniforme_id:a.id,alumno_id:r.alumno_id,asignatura_id:e.asignatura_actual.asignatura_id}).then(function(a){return r.uniformes=a.data.uniformes,r.uniformes_count=a.data.uniformes_count,e.verificarFallaHoy(r)},function(e){return n.warning("No se pudo cambiar.","Problema")})},e.volverClases=function(){return e.pasandoNotas=!1},e.agregarTardanza=function(a){var r,o;if(!a.guardando_falla)return a.guardando_falla=!0,o=(r=new Date).yyyymmdd()+" "+window.fixHora(r),t.post("::ausencias/agregar-tardanza",{now:o,alumno_id:a.alumno_id,asignatura_id:e.asignatura_actual.asignatura_id}).then(function(e){return a.falla_hoy="tardanza",a.guardando_falla=!1,e.data.fecha_hora=new Date(e.data.fecha_hora.replace("T"," ")),a.tardanzas.push(e.data),a.tardanzas_count++},function(){return n.error("Error agregando tardanza"),a.guardando_falla=!1})},e.agregarAusencia=function(a){var r,o;if(!a.guardando_falla)return a.guardando_falla=!0,o=(r=new Date).yyyymmdd()+" "+window.fixHora(r),t.post("::ausencias/agregar-ausencia",{now:o,alumno_id:a.alumno_id,asignatura_id:e.asignatura_actual.asignatura_id}).then(function(e){return a.falla_hoy="ausencia",a.guardando_falla=!1,e.data.fecha_hora=new Date(e.data.fecha_hora.replace("T"," ")),a.ausencias.push(e.data),a.ausencias_count++},function(){return n.error("Error agregando ausencia"),a.guardando_falla=!1})},e.cambiarTipo=function(e,a,r){var i;return i={ausencia_id:e.id,new_tipo:a},t.put("::ausencias/cambiar-tipo-ausencia",i).then(function(t){var n;if("tardanza"===a&&(e.tipo="tardanza",e.cantidad_ausencia=e.cantidad_tardanza,e.tardanzas_count++,e.ausencias_count--,r.tardanzas.push(e),r.ausencias=o("filter")(r.ausencias,{id:"!"+e.id}),n=new Date,e.fecha_hora&&n.toDateString()===e.fecha_hora.toDateString()&&(r.falla_hoy="tardanza")),"ausencia"===a&&(e.tipo="ausencia",e.cantidad_tardanza=e.cantidad_ausencia,e.tardanzas_count--,e.ausencias_count++,r.ausencias.push(e),r.tardanzas=o("filter")(r.tardanzas,{id:"!"+e.id}),n=new Date,e.fecha_hora&&n.toDateString()===e.fecha_hora.toDateString()))return r.falla_hoy="ausencia"},function(e){return n.warning("No se pudo cambiar el tipo.","Problema")})},e.guardarValorAusencia=function(a,r,i,s){var u;return u={ausencia_id:a.id,fecha_hora:o("date")(a.fecha_hora,"yyyy-MM-dd HH:mm:ss")},t.put("::ausencias/guardar-cambios-ausencia",u).then(function(a){return e.verificarFallaHoy(s)},function(e){return n.warning("No se pudo cambiar.","Problema")})},e.eliminarAusencia=function(a,r,i){var u;if(!a.eliminando)return a.eliminando=!0,u=!0,i||(u=confirm("¿Seguro que quiere eliminar?")),u?t.delete("::ausencias/destroy/"+a.id).then(function(t){return t=t.data,"tardanza"===a.tipo&&(r.tardanzas=o("filter")(r.tardanzas,{id:"!"+t.id}),r.tardanzas_count--),"ausencia"===a.tipo&&(r.ausencias=o("filter")(r.ausencias,{id:"!"+t.id}),r.ausencias_count--),i||s(function(){return e.verificarFallaHoy(r)},100),a.isOpen=!1},function(e){return n.warning("No se pudo quitar ausencia.","Problema")}):a.eliminando=!1},e.editarPublicacion=function(a){return a.para_todos?a.publi_para="publi_para_todos":a.publi_para="publi_privada",a.editar=!0,e.new_publicacion=a,e.creando_publicacion=!0},e.verPublicacion=function(a,r){return r>-1?(e.publicaciones_actuales=[a],e.changes_asked.publicaciones.length>r+1&&e.publicaciones_actuales.push(e.changes_asked.publicaciones[r+1]),e.creando_publicacion=!1):(e.publicacion_actual=a,e.creando_publicacion=!1)},e.eliminarPublicacion=function(e){return t.put("::publicaciones/delete",{publi_id:e.id}).then(function(a){return n.success("Eliminada."),e.deleted_at=(new Date).toString()},function(e){return n.error("Error al eliminar","Problema"),{}})},e.verPublicacionDetalle=function(r){return a.open({templateUrl:"==panel/VerPublicacionModal.tpl.html",controller:"VerPublicacionModalCtrl",size:"lg",windowClass:"modal-publicacion",resolve:{publicacion_actual:function(){return r},USER:function(){return e.USER}}}).result.then(function(e){return console.log("Cerrado")})},e.restaurarPublicacion=function(e){return t.put("::publicaciones/restaurar",{publi_id:e.id}).then(function(a){return n.success("Restaurada."),e.deleted_at=null},function(e){return n.error("Error al Restaur","Problema"),{}})},e.crearPublicacion=function(a){return e.guardando_publicacion=!0,a.editar?t.put("::publicaciones/guardar-edicion",a).then(function(r){return a.id=r.data.publicacion_id,a.imagen_nombre=e.new_publicacion.imagen?e.new_publicacion.imagen.nombre:null,a.contenido_tr=l.trustAsHtml(a.contenido),a.updated_at=o("date")(new Date,"short"),e.imagen_temporal=void 0,n.success("Guardado. Recargue la página"),e.new_publicacion={publi_para:"publi_para_todos",para_alumnos:1},e.creando_publicacion=!1,e.guardando_publicacion=!1},function(a){return n.error("Error al publicar","Problema"),e.guardando_publicacion=!1,{}}):t.put("::publicaciones/store",a).then(function(r){return a.id=r.data.publicacion_id,a.imagen_nombre=e.new_publicacion.imagen?e.new_publicacion.imagen.name:null,a.contenido_tr=l.trustAsHtml(a.contenido),a.updated_at=o("date")(new Date,"short"),e.changes_asked.mis_publicaciones.unshift(a),e.changes_asked.publicaciones.unshift(a),e.imagen_temporal=void 0,n.success("Publicado con éxito"),e.new_publicacion={publi_para:"publi_para_todos",publi_para_alumnos:1},e.creando_publicacion=!1,e.guardando_publicacion=!1},function(a){return n.error("Error al publicar","Problema"),e.guardando_publicacion=!1,{}})},e.toggle_mis_publicaciones=function(a){return e.mostrar_publicaciones=!1,e.mostrar_mis_publicaciones=!e.mostrar_mis_publicaciones},e.toggle_publicaciones=function(a){return e.mostrar_mis_publicaciones=!1,e.mostrar_publicaciones=!e.mostrar_publicaciones},e.uploadFiles=function(a){var r,t,n,o,i;if(e.errorMsg="",a&&a.length){for(i=[],t=n=0,o=a.length;0<=o?n<o:n>o;t=0<=o?++n:--n)r=a[t],e.imagen_temporal=r,i.push(m(r));return i}},m=function(a){return e.errorMsg=null,f(a),e.generateThumb(a)},e.generateThumb=function(a){if(console.log(a),null!==a&&e.fileReaderSupported&&a.type.indexOf("image")>-1)return s(function(){var r;return(r=new FileReader).readAsDataURL(a),r.onload=function(r){return s(function(){return a.dataUrl=r.target.result,e.imgFiles.push(a)})}})},f=function(a){if(e.imagen_subida=!1,!(a.size>5e6))return u.upload({url:i.Server+"myimages/store-intacta-privada",file:a}).progress(function(e){var r;return r=parseInt(100*e.loaded/e.total),a.porcentaje=r}).success(function(a,r,t,n){return e.new_publicacion.imagen=a,e.imagen_subida=!0}).error(function(a){return e.imagen_subida=!0,console.log("Falla uploading: ",a)});e.errorMsg="Archivo excede los 5MB permitidos."},e.borrarImagen=function(r){var o;return o={},angular.copy(r,o),o.imagen_id&&(o.id=o.imagen_id,o.nombre=o.imagen_nombre),a.open({templateUrl:"==fileManager/removeImage.tpl.html",controller:"RemoveImageCtrl",size:"md",resolve:{imagen:function(){return o},user_id:function(){return e.USER.user_id},datos_imagen:function(){var a;return a={imagen_id:o.imagen_id?o.imagen_id:o.id,user_id:e.USER.user_id},t.put("::myimages/datos-imagen",a).then(function(a){return e.datos_imagen=a.data},function(e){return n.error("Error al traer datos de imagen","Problema"),{}})}}}).result.then(function(a){return e.new_publicacion.imagen=void 0,e.new_publicacion.imagen_nombre=void 0,e.new_publicacion.imagen_id=void 0,e.imgFiles=[]})},e.seleccionar_profe=function(a){return t.put("::historiales/de-usuario",{user_id:a.user_id}).then(function(r){return e.profe_seleccionado=r.data,e.profe_seleccionado.profesor=a},function(e){return console.log("Error trayendo detalles",e)})},e.mostrar_crear_publicacion=function(){return e.creando_publicacion=!0,s(function(){return $("#textarea-new-publicacion").focus()})},e.options={language:"es",allowedContent:!0,entities:!1},e.onReady=function(){return console.log("Listo para editar")},e.desseleccionar_profe=function(){return e.profe_seleccionado=!1},e.verDetalles=function(e){var a;return e.mostrando?e.mostrando=!1:(e.mostrando=!0,e.detalles?void 0:(a={asked_id:e.asked_id},t.put("::ChangesAsked/ver-detalles",a).then(function(a){return e.detalles=a.data.detalles},function(e){return console.log("Error trayendo detalles",e)})))},e.traerCatAlumnosPorGrupos=function(){return t.put("::grupos/con-cantidad-alumnos").then(function(a){var r,t,n,o,i;for(e.grupos_cantidades=a.data.grupos,e.periodos_total=a.data.periodos_total,e.cant_total_alumnos=0,i=[],t=0,n=(o=e.grupos_cantidades).length;t<n;t++)r=o[t],i.push(e.cant_total_alumnos=e.cant_total_alumnos+r.cant_alumnos);return i},function(e){return console.log("Error trayendo cantidad de alumnos",e)})},e.rechazarCambio=function(e,r){return a.open({templateUrl:"==panel/rechazarAsked.tpl.html",controller:"RechazarAskedCtrl",resolve:{asked:function(){return e},tipo:function(){return r}}}).result.then(function(a){if(n.info("Pedido rechazado."),e.finalizado=a.finalizado,"img_perfil"===r&&(e.detalles.image_id_accepted=!1),"foto_oficial"===r&&(e.detalles.foto_id_accepted=!1),"img_delete"===r&&(e.detalles.image_to_delete_accepted=!1),"nombres"===r&&(e.detalles.nombres_accepted=!1),"apellidos"===r&&(e.detalles.apellidos_accepted=!1),"sexo"===r&&(e.detalles.sexo_accepted=!1),"fecha_nac"===r)return e.detalles.fecha_nac_accepted=!1})},e.aprobarCambio=function(e,r,t){return a.open({templateUrl:"==panel/aceptarAsked.tpl.html",controller:"AceptarAskedCtrl",resolve:{asked:function(){return e},tipo:function(){return r},valor_nuevo:function(){return t}}}).result.then(function(a){if(n.success("Pedido aceptado."),e.finalizado=a.finalizado,"img_perfil"===r&&(e.detalles.image_id_accepted=!0),"img_delete"===r&&(e.detalles.image_to_delete_accepted=!0),"nombres"===r&&(e.detalles.nombres_accepted=!0),"apellidos"===r&&(e.detalles.apellidos_accepted=!0),"sexo"===r&&(e.detalles.sexo_accepted=!0),"fecha_nac"===r&&(e.detalles.fecha_nac_accepted=!0),"foto_oficial"===r&&(e.detalles.foto_id_accepted=!0,e.foto_nombre=e.detalles.foto_new_nombre),"asignatura"===r)return e.finalizado=!0})},e.eliminarSolicitudes=function(e){return a.open({templateUrl:"==panel/eliminarAsked.tpl.html",controller:"EliminarAskedCtrl",resolve:{asked:function(){return e}}}).result.then(function(a){return n.success("Pedido eliminado."),e.finalizado=!0})},e.verDetalleDeMiSesion=function(e){return t.put("::historiales/sesion",{historial_id:e.id,tipo:e.tipo}).then(function(r){return a.open({templateUrl:"==panel/modalDetallesSesion.tpl.html",controller:"ModalDetallesSesionCtrl",resolve:{historial:function(){return r.data.historial}}}).result.then(function(a){return console.log(e)})},function(e){return n.error("No se pudo traer el detalle")})},e.eliminarIntentoFallido=function(a){if(!1,confirm("¿Está seguro de eliminar este registro?"))return t.delete("::bitacoras/destroy/"+a.id).then(function(r){return n.success("Eliminado. Recargue para ver los cambios."),a.eliminada=!0,e.changes_asked.intentos_fallidos=o("filter")(e.changes_asked.intentos_fallidos,{id:"!"+a.id},!0)},function(e){return n.error("No se pudo eliminar")})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("ModalDetallesSesionCtrl",["$scope","$uibModalInstance","historial","$http","toastr","App","$filter",function(e,a,r,t,n,o,i){var s,u,l,c,d;return e.imagesPath=o.images+"perfil/",e.historial=r,r.logout_at?(s=new Date(r.created_at),u=new Date(r.logout_at).getTime()-s.getTime(),parseInt(u%1e3/100),d=parseInt(u/1e3%60),c=parseInt(u/6e4%60),l=(l=parseInt(u/36e5%24))<10?"0"+l:l,c=c<10?"0"+c:c,d=d<10?"0"+d:d,e.duracion=l+":"+c+":"+d):e.duracion="No cerró sesión.",e.ok=function(){return a.close()},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("VerPublicacionModalCtrl",["$scope","App","$uibModalInstance","publicacion_actual","USER","$http","toastr","$filter","$timeout",function(e,a,r,t,n,o,i,s,u){return e.publicacion_actual=t,e.perfilPath=a.images+"perfil/",e.USER=n,e.new_comentario="",e.guardando_coment=!1,e.abrirImagenBlank=function(e){return window.open(e,"_blank")},e.eliminarComentario=function(a){if(confirm("¿Seguro que desea eliminar comentario: "+a.comentario+"?"))return a.eliminado=!0,o.put("::publicaciones/borrar-comentario",{comentario_id:a.id}).then(function(r){return i.success("Eliminado."),e.publicacion_actual.comentarios=s("filter")(e.publicacion_actual.comentarios,{id:"!"+a.id},!0),u(function(){return e.$apply()})},function(e){return i.error("Error al eliminar","Problema"),{}})},e.agregarComentario=function(a){var r;if(0!==e.new_comentario.length)return e.guardando_coment=!0,r={publi_id:e.publicacion_actual.id,comentario:a},o.put("::publicaciones/comentar",r).then(function(r){var t;return e.new_comentario="",t={id:r.data.comentario_id,publicacion_id:e.publicacion_actual.id,comentario:a,nombre_autor:e.USER.nombres?e.USER.nombres+" "+e.USER.apellidos:e.USER.username,foto_autor:e.USER.foto_nombre},e.publicacion_actual.comentarios.push(t),e.guardando_coment=!1},function(a){return i.error("Error al eliminar","Problema"),e.guardando_coment=!1})},e.cancel=function(){return r.dismiss("cancel")},e.ok=function(){return r.close(t)}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("CambiarNotaModalCtrl",["$scope","App","$uibModalInstance","alumno","subunidad","nota","$http","toastr","EscalasValorativasServ",function(e,a,r,t,n,o,i,s,u){return e.subunidad=n,e.datos={},e.perfilPath=a.images+"perfil/",e.alumno=t,e.nota=o,u.escalas().then(function(a){return e.escalas=a},function(e){return console.log("No se trajeron las escalas valorativas",e)}),e.cambiaNota=function(e){return console.log(e),i.put("::notas/update/"+o.id,{nota:e}).then(function(a){return s.success("Cambiada: "+e),o.nota=e,r.close(o.nota)},function(e){return 400===e.status?s.warning("Parece que no tienes permisos","Lo sentimos"):s.error("No pudimos guardar la nota "+o.nota,"",{timeOut:8e3})})},e.ok=function(){return r.close()}}])}.call(this),function(){angular.module("myvcFrontApp").controller("verUniformesAlumnoPeriodoModal",["$scope","$uibModalInstance","alumno","per_num","periodos","config","profesores","$http","toastr","App","AuthService",function(e,a,r,t,n,o,i,s,u,l,c){var d,p,m,f;for(e.alumno=r,e.datos={},e.config=o,e.periodos=n,e.profesores=i,e.perfilPath=l.images+"perfil/",e.hasRoleOrPerm=c.hasRoleOrPerm,e.per_num=t,d=0,p=(f=e.periodos).length;d<p;d++)(m=f[d]).activo=!1,m.numero===t&&(m.activo=!0,m.creando=!1,e.datos.periodo=m);return e.verAgregarUniforme=function(e){e.new_uni={fecha_hora:new Date},e.creandoUniforme=!e.creandoUniforme},e.cancelarGuardarUniforme=function(e){return e.guardando_uniforme=!1,e.creandoUniforme=!1},e.guardarUniforme=function(a){a.guardando_uniforme||(a.guardando_uniforme=!0,a.new_uni.alumno_id=a.alumno_id,a.new_uni.periodo_id=e.datos.periodo.id,a.new_uni.fecha_hora=a.new_uni.fecha_hora.yyyymmdd()+" "+window.fixHora(a.new_uni.fecha_hora),s.put("::uniformes/agregar",a.new_uni).then(function(e){return console.log(a,t),a.guardando_uniforme=!1,e.data.uniforme.fecha_hora=new Date(e.data.uniforme.fecha_hora.replace(/-/g,"/")),a["uniformes_per"+t].push(e.data.uniforme),a.creandoUniforme=!1},function(){return u.error("Error agregando uniformes"),a.guardando_uniforme=!1,a.creandoUniforme=!1}))},e.editarUniforme=function(e,a){return e.editando=!e.editando},e.cancelarGuardarUniformeEditado=function(e){return e.guardando=!1,e.editando=!1},e.guardarUniformeEditado=function(e,a){e.guardando||(e.guardando=!0,s.put("::uniformes/actualizar",e).then(function(a){return e.guardando=!1,u.success("Uniforme actualizado."),e.editando=!1},function(){return u.error("Error actualizado uniforme."),e.guardando=!1}))},e.eliminarUniforme=function(e,a){if(confirm("¿Seguro que deseas eliminar este registro de uniforme?"))return s.put("::uniformes/eliminar",{uniforme_id:e.id,alumno_id:a.alumno_id}).then(function(e){return a["uniformes_per"+t]=e.data.uniformes},function(e){return u.warning("No se pudo cambiar.","Problema")})},e.ok=function(){return a.close(e.alumno)}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("TardanzasAusenciasAlumnoAsignModalCtrl",["$scope","App","$uibModalInstance","alumno","$http","toastr","EscalasValorativasServ",function(e,a,r,t,n,o,i){return e.datos={},e.perfilPath=a.images+"perfil/",e.alumno=t,e.guardarCambioAusencia=function(e){var a;return a={ausencia_id:e.id,fecha_hora:$filter("date")(e.fecha_hora,"yyyy-MM-dd HH:mm:ss")},n.put("::ausencias/guardar-cambios-ausencia",a).then(function(e){return e=e.data,t.tardanzas.push(e)},function(e){return o.warning("No se pudo agregar tardanza.","Problema")})},e.eliminarAusencia=function(e,a){return n.delete("::ausencias/destroy/"+e.id).then(function(r){return r=r.data,a.ausencias=$filter("filter")(a.ausencias,{id:"!"+r.id}),e.isOpen=!1},function(e){return o.warning("No se pudo quitar ausencia.","Problema")})},e.eliminarTardanza=function(e,a){return n.delete("::ausencias/destroy/"+e.id).then(function(r){return r=r.data,a.tardanzas=$filter("filter")(a.tardanzas,{id:"!"+r.id}),e.isOpen=!1},function(e){return o.warning("No se pudo quitar tardanza.","Problema")})},e.ok=function(){return r.close()}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("YearsCtrl",["App","$scope","$http","$uibModal","$state","ProfesoresServ","$cookies","$rootScope","$filter","toastr","$timeout",function(e,a,r,t,n,o,i,s,u,l,c){a.perfilPath=e.images+"perfil/",a.status={open_year:!0},r.get("::years/colegio").then(function(e){var t,n,o,i,s,u,d;for(t=0,o=(u=(e=e.data).years).length;t<o;t++)for(n=0,i=(d=u[t].periodos).length;n<i;n++)(s=d[n]).fecha_inicio=new Date(s.fecha_inicio),s.fecha_fin=new Date(s.fecha_fin),s.fecha_plazo=new Date(s.fecha_plazo);return a.years=e.years,a.certificados=e.certificados,a.imagenes=e.imagenes,r.get("::profesores/todos").then(function(e){return a.profesores=e.data,a.fixControles()},function(e){return l.error("No se pudo traer los profesores")}),c(function(){return a.cargado=!0},100)},function(e){return l.error("No se trajeron los años")}),a.fixControles=function(){var e,r,t,n,o,i;for(o=a.years.length-1,a.newcertif={},a.newYear={nombre_colegio:a.years[o].nombre_colegio,abrev_colegio:a.years[o].abrev_colegio,year:a.years[o].year+1,actual:!0,alumnos_can_see_notas:!0,nota_minima_aceptada:a.years[o].nota_minima_aceptada,resolucion:a.years[o].resolucion,codigo_dane:a.years[o].codigo_dane,telefono:a.years[o].telefono,celular:a.years[o].celular,unidad_displayname:a.years[o].unidad_displayname,unidades_displayname:a.years[o].unidades_displayname,genero_unidad:a.years[o].genero_unidad,subunidad_displayname:a.years[o].subunidad_displayname,subunidades_displayname:a.years[o].subunidades_displayname,genero_subunidad:a.years[o].genero_subunidad,solo_valorativas:a.years[o].solo_escalas_valorativas},n=[],e=0,r=(t=a.years).length;e<r;e++)(i=t[e]).ocultando=!i.actual,i.rector=u("filter")(a.profesores,{profesor_id:i.rector_id},!0)[0],i.secretario=u("filter")(a.profesores,{profesor_id:i.secretario_id},!0)[0],n.push(i.tesorero=u("filter")(a.profesores,{profesor_id:i.tesorero_id},!0)[0]);return n},a.addPeriodo=function(e){return t.open({templateUrl:"==colegio/addPeriodo.tpl.html",controller:"AddPeriodoCtrl",resolve:{year:function(){return e}}}).result.then(function(a){return e.periodos.push(a)})},a.removePeriodo=function(e,a){return t.open({templateUrl:"==colegio/removePeriodo.tpl.html",controller:"RemovePeriodoCtrl",resolve:{periodo:function(){return a}}}).result.then(function(a){return e.periodos=u("filter")(e.periodos,{id:"!"+a.id})})},a.toggleAnioActual=function(e,a){return r.put("::years/set-actual",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se establecer como actual.","Problema")})},a.toggleBloquearNotas=function(e,a){return r.put("::years/alumnos-can-see-notas",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo bloquear o desbloquear el sistema.","Problema")})},a.toggleBloquearProfesEditAlumnos=function(e,a){return r.put("::years/profes-can-edit-alumnos",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo bloquear o desbloquear la edición.","Problema")})},a.toggleMostrarPuestoEnBoletin=function(e,a){return r.put("::years/toggle-mostrar-puestos-en-boletin",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo bloquear o desbloquear la edición.","Problema")})},a.toggleMostrarNotaComportamientoEnBoletin=function(e,a){return r.put("::years/toggle-mostrar-nota-comport-en-boletin",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo cambiar.","Problema")})},a.toggleMostrarAnioPasado=function(e,a){return r.put("::years/toggle-mostrar-anio-pasado-en-boletin",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo cambiar.","Problema")})},a.toggleSoloValorativas=function(e,a){return r.put("::years/toggle-solo-valorativas",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo cambiar.","Problema")})},a.toggleIgnorarNotasPerdidas=function(e,a){return r.put("::years/toggle-ignorar-notas-perdidas",{can:a,year_id:e}).then(function(e){return l.success(e.data)},function(e){return l.warning("No se pudo bloquear o desbloquear la edición.","Problema")})},a.restarNewYear=function(){if(a.newYear.year>1990)return a.newYear.year=a.newYear.year-1},a.sumarNewYear=function(){if(a.newYear.year<3e3)return a.newYear.year=a.newYear.year+1},a.restarNewNota=function(){if(a.newYear.nota_minima_aceptada>0)return a.newYear.nota_minima_aceptada=a.newYear.nota_minima_aceptada-.1},a.sumarNewNota=function(){if(a.newYear.nota_minima_aceptada<1e3)return a.newYear.nota_minima_aceptada=a.newYear.nota_minima_aceptada+.1},a.actualPeriodo=function(e,a){return r.put("::periodos/establecer-actual/"+a.id).then(function(r){var t,n,o;for(l.success("Periodo "+a.numero+" establecido como actual."),t=0,n=(o=e.periodos).length;t<n;t++)o[t].actual=!1;return a.actual=!0},function(e){return l.warning("No se pudo establecer como actual.","Problema")})},a.crearNewYear=function(){return r.post("::years/store",a.newYear).then(function(e){var r,t,n;for(l.success("Año "+a.newYear.year+" creado. Por favor configúrelo."),a.nonuevo=!1,r=0,t=(n=a.years).length;r<t;r++)n[r].actual=0;return a.years.push(e.data)},function(e){return l.warning("No se pudo crear año.","Problema")})},a.guardar_cambios=function(e){return e.rector_id=e.rector?e.rector.profesor_id:null,e.secretario_id=e.secretario?e.secretario.profesor_id:null,e.tesorero_id=e.tesorero?e.tesorero.profesor_id:null,r.put("::years/guardar-cambios",e).then(function(e){return l.success("Cambios guardados.")},function(e){return l.warning("No se pudo guardar cambios.","Problema")})},a.deleteYear=function(e){return t.open({templateUrl:"==colegio/removeYear.tpl.html",controller:"RemoveYearCtrl",resolve:{year:function(){return e}}}).result.then(function(e){return a.years=u("filter")(a.years,{id:"!"+e.id})})},a.cambiarFechaInicio=function(e,a){return r.put("::periodos/cambiar-fecha-inicio",{periodo_id:e.id,fecha:a}).then(function(e){return l.success("Fecha guardada.")},function(e){return l.warning("No se pudo guardar fecha.","Problema")})},a.cambiarFechaFin=function(e,a){return r.put("::periodos/cambiar-fecha-fin",{periodo_id:e.id,fecha:a}).then(function(e){return l.success("Fecha guardada.")},function(e){return l.warning("No se pudo guardar fecha.","Problema")})},a.toggleProfesPuedenEditarNotas=function(e,a){return r.put("::periodos/toggle-profes-pueden-editar-notas",{periodo_id:e.id,pueden:a}).then(function(e){return l.success("Cambiado.")},function(e){return l.warning("No se pudo guardar fecha.","Problema")})},a.toggleProfesPuedenNivelar=function(e,a){return r.put("::periodos/toggle-profes-pueden-nivelar",{periodo_id:e.id,pueden:a}).then(function(e){return l.success("Cambiado.")},function(e){return l.warning("No se pudo guardar fecha.","Problema")})}}]).controller("RemoveYearCtrl",["$scope","$uibModalInstance","year","$http","toastr",function(e,a,r,t,n){return e.year=r,e.ok=function(){return t.delete("::years/delete/"+r.id).then(function(e){return n.success("Año "+r.year+" enviado a la papelera."),a.close(r)},function(e){return n.warning("No se pudo eliminar el año.","Problema"),a.dismiss()})},e.cancel=function(){return a.dismiss("cancel")}}]).controller("RemovePeriodoCtrl",["$scope","$uibModalInstance","periodo","$http","toastr",function(e,a,r,t,n){return e.periodo=r,e.ok=function(){return t.delete("::periodos/destroy/"+r.id).then(function(e){return n.success("Periodo eliminado con éxito.","Eliminado"),a.close(r)},function(e){return n.warning("No se pudo eliminar el periodo.","Problema"),a.dismiss()})},e.cancel=function(){return a.dismiss("cancel")}}]).controller("AddPeriodoCtrl",["$scope","$uibModalInstance","year","$http","toastr",function(e,a,r,t,n){return e.year=r,e.new_periodo={},e.year_id=e.year.id,e.ok=function(){return t.post("::periodos/store/"+r.id,e.new_periodo).then(function(e){return n.success("Periodo creado con éxito.","Creado"),a.close(e.data)},function(e){return n.warning("No se pudo crear el periodo.","Problema"),a.dismiss()})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").directive("configuracionCertificados",["App",function(e){return{restrict:"E",templateUrl:`${e.views}colegio/configCertificados.tpl.html`,link:function(e,a,r){},controller:"ConfigCertificadosCtrl"}}]).controller("ConfigCertificadosCtrl",["$scope","App","$http","$state","toastr","uiGridConstants","$filter",function(e,a,r,t,n,o,i){var s,u,l;e.newcertif={encabezado_width:0,encabezado_height:0,encabezado_margin_top:0,encabezado_margin_left:0,piepagina_width:0,piepagina_height:0,piepagina_margin_bottom:0,piepagina_margin_left:0},e.creando_certificado=!1,e.editando=!1,e.currentCertif={},e.certificado={},(l=i("filter")(e.certificados,{id:e.year.config_certificado_estudio_id}))&&l.length>0&&(e.certificado.config_actual=l[0]),e.crearConfig=function(){return e.creando_certificado=!0},e.cancelConfig=function(){return e.creando_certificado=!1},s='<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',u='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!1,enebleGridColumnMenu:!1,columnDefs:[{field:"id",displayName:"Id",width:50,enableCellEdit:!1,enableColumnMenu:!1},{field:"nombre",displayName:"Nombre",minWidth:80,enableSorting:!1,enableColumnMenu:!1},{name:"edicion",displayName:"Edición",width:60,enableSorting:!1,enableFiltering:!1,cellTemplate:s+u,enableCellEdit:!1,enableColumnMenu:!1},{field:"encabezado_width",displayName:"AnchoE",filter:{condition:o.filter.CONTAINS}},{field:"encabezado_height",displayName:"AltoE",filter:{condition:o.filter.CONTAINS}},{field:"encabezado_margin_top",displayName:"MargenEArr",filter:{condition:o.filter.CONTAINS}},{field:"encabezado_margin_left",displayName:"MargenEIzq",filter:{condition:o.filter.CONTAINS}},{field:"piepagina_width",displayName:"AnchoP"},{field:"piepagina_height",displayName:"AltoP"},{field:"piepagina_margin_left",displayName:"MargenPIzq"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,t,o,i){return o!==i&&r.put("::certificados/update",a).then(function(e){return n.success("Certificado modificado","Actualizado")},function(e){return n.error("Cambio no guardado","Error")}),e.$apply()})}},e.gridOptions.data=e.certificados,e.guardar=function(){return r.post("::certificados/store",e.newcertif).then(function(a){return n.success("Certificado creado."),e.creando_certificado=!1,e.certificados.push(a.data),e.gridOptions.data=e.certificados},function(e){return n.error("Certificado no guardado","Error")})},e.editar=function(a){var r,t;if(e.editando=!0,e.currentCertif=a,r=i("filter")(e.imagenes,{id:a.encabezado_img_id}),t=i("filter")(e.imagenes,{id:a.piepagina_img_id}),r.length>0&&(r=r[0],e.currentCertif.encabezado_img=r),t.length>0)return t=t[0],e.currentCertif.piepagina_img=t},e.cancelEdit=function(){return e.editando=!1},e.actualizar=function(){return r.put("::certificados/update",e.currentCertif).then(function(a){return n.success("Certificado modificado","Actualizado"),e.editando=!1},function(e){return n.error("Cambio no guardado","Error")})},e.eliminar=function(a){return r.delete("::certificados/destroy/"+a.id).then(function(r){return n.success("Certificado eliminado."),e.certificados=i("filter")(e.certificados,{id:"!"+a.id}),e.gridOptions.data=e.certificados},function(e){return n.error("Certificado no eliminado","Error")})},e.certificadoSelect=function(a,t){return r.put("::certificados/actual",{config_certificado_estudio_id:a.id,year_id:e.year.id}).then(function(e){return n.success("Certificado actual cambiado.")},function(e){return n.error("Certificado no cambiado","Error")})},e.guardarEncabezado=function(){return r.put("::certificados/encabezado",{encabezado_certificado:e.year.encabezado_certificado,year_id:e.year.id}).then(function(e){return n.success("Encabezado guardado.")},function(e){return n.error("Encabezado no guardado","Error")})}}])}.call(this),function(){angular.module("myvcFrontApp").directive("configuracionEscalas",["App",function(e){return{restrict:"E",templateUrl:`${e.views}colegio/configEscalas.tpl.html`,link:function(e,a,r){},controller:"ConfigEscalasCtrl"}}]).controller("ConfigEscalasCtrl",["$scope","App","$http","$state","$cookies","toastr","uiGridConstants","$filter",function(e,a,r,t,n,o,i,s){var u;e.creando_escala=!1,u='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminarEscala(row.entity)"><i class="fa fa-trash "></i></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enebleGridColumnMenu:!1,columnDefs:[{field:"id",displayName:"Id",width:50,enableCellEdit:!1,enableColumnMenu:!1},{field:"desempenio",displayName:"Desempeño",enableSorting:!1,enableColumnMenu:!1},{name:"eliminar",displayName:"Elimin",width:50,enableSorting:!1,enableFiltering:!1,cellTemplate:u,enableCellEdit:!1,enableColumnMenu:!1},{field:"descripcion",displayName:"Descripción"},{field:"porc_inicial",displayName:"Valor inicial"},{field:"porc_final",displayName:"Valor final"},{field:"orden",type:"number"},{field:"perdido",type:"boolean",cellTemplate:'<input type="checkbox" ng-model="row.entity.perdido" ng-true-value="1" ng-false-value="0">'},{field:"valoracion",displayName:"Valoración"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,t,n,i){return n!==i&&r.put("::escalas/update",a).then(function(e){return o.success("Escala modificada","Actualizada")},function(e){return o.error("Cambio no guardado","Error")}),e.$apply()})}},e.gridOptions.data=e.year.escalas,e.crearEscala=function(){return r.post("::escalas/store").then(function(a){return o.success("Escala creada."),e.creando_escala=!1,e.year.escalas.push(a.data),e.gridOptions.data=e.year.escalas},function(e){return o.error("Escala no guardada","Error")})},e.eliminarEscala=function(a){return r.delete("::escalas/destroy/"+a.id).then(function(r){return o.success("Escala eliminada."),e.year.escalas=s("filter")(e.year.escalas,{id:"!"+a.id}),e.gridOptions.data=e.year.escalas},function(e){return o.error("Escala no eliminada","Error")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider","App","PERMISSIONS","USER_ROLES",function(e,a,r,t){e.state("panel.prematriculas",{url:"^/prematriculas",views:{maincontent:{templateUrl:"==alumnos/prematriculas.tpl.html",controller:"PrematriculasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Prematrículas"}]}}},data:{displayName:"Prematrículas",icon_fa:"fa fa-male",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos],pageTitle:"Prematrículas - MyVc"}}).state("panel.prematriculas.nuevo",{url:"/nuevo",views:{edit_alumno:{templateUrl:`${a.views}alumnos/alumnosNew.tpl.html`,controller:"AlumnosNewCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo alumno"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-male",pageTitle:"Nuevo alumno - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos]}}).state("panel.requisitos",{url:"^/requisitos",views:{maincontent:{templateUrl:"==alumnos/requisitos.tpl.html",controller:"RequisitosCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Requisitos"}]}}},data:{displayName:"Requisitos",icon_fa:"fa fa-file",needed_permissions:[r.can_work_like_admin],pageTitle:"Requisitos - MyVc"}}).state("panel.promocionar_notas",{url:"/promocionar_notas",views:{maincontent:{templateUrl:`${a.views}alumnos/promocionarNotas.tpl.html`,controller:"PromocionarNotasCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Promocionar notas de alumno promovido"}]}}},data:{displayName:"Promocionar notas",icon_fa:"fa fa-apple",pageTitle:"Promocionar notas - MyVc",needed_permissions:[r.can_work_like_teacher]}}).state("panel.alumnos.nuevo",{url:"/nuevo",views:{edit_alumno:{templateUrl:`${a.views}alumnos/alumnosNew.tpl.html`,controller:"AlumnosNewCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo alumno"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-male",pageTitle:"Nuevo alumno - MyVc",needed_permissions:[r.can_work_like_admin,r.can_edit_alumnos]}}).state("panel.alumnos.editar",{url:"/editar/:alumno_id",views:{edit_alumno:{templateUrl:`${a.views}alumnos/alumnosEdit.tpl.html`,controller:"AlumnosEditCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar alumno"}]}}},data:{displayName:"Editar",icon_fa:"fa fa-users",pageTitle:"Editar alumno - MyVc",needed_permissions:[r.can_work_like_admin,r.can_edit_alumnos]}}).state("panel.listalumnos",{url:"^/listalumnos/:grupo_id",param:{grupo_id:null},views:{maincontent:{templateUrl:`${a.views}alumnos/listAlumnos.tpl.html`,controller:"ListAlumnosCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Listado de alumnos"}]}}},data:{displayName:"Listado",icon_fa:"fa fa-users",pageTitle:"Listado alumnos - MyVc",needed_permissions:[r.can_work_like_teacher]}}).state("panel.matriculas",{url:"^/matriculas",views:{maincontent:{templateUrl:`${a.views}alumnos/matriculas.tpl.html`,controller:"MatriculasCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Matrículas de alumnos"}]}}},data:{displayName:"matriculas",icon_fa:"fa fa-users",pageTitle:"Matrículas alumnos - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos]}}),e.state("panel.matriculas.nuevo",{url:"/nuevo",views:{edit_alumno:{templateUrl:`${a.views}alumnos/alumnosNew.tpl.html`,controller:"AlumnosNewCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo alumno"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-male",pageTitle:"Nuevo alumno - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos]}}),e.state("panel.persona.nuevo",{url:"/nuevo",views:{edit_alumno:{templateUrl:`${a.views}alumnos/alumnosNew.tpl.html`,controller:"AlumnosNewCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo alumno"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-male",pageTitle:"Nuevo alumno - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos]}}).state("panel.persona.ver_todos_los_certificados",{url:"/todos_los_certificados",params:{alumno_id:{value:null}},views:{report_content:{templateUrl:`${a.views}persona/certificadoEstudioPersona.tpl.html`,controller:"VerTodosLosCertificadosCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Ver todos los certificados"}]}}},data:{displayName:"Todos los certificados",icon_fa:"fa fa-print",pageTitle:"Todos los certificados - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin,r.can_edit_alumnos]}}).state("panel.matriculas.detalles",{url:"^/matriculas/detalles/:alumno_id",param:{alumno_id:null},views:{matricula_detalle:{templateUrl:`${a.views}alumnos/matriculasDetalles.tpl.html`,controller:"MatriculasDetallesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Matrículas detalladas"}]}}},data:{displayName:"detalles",icon_fa:"fa fa-pencil",pageTitle:"Matrículas alumnos - MyVc",needed_permissions:[r.can_work_like_admin]}}).state("panel.alumnos.matricula_detalles",{url:"^/alumnos/matricula_detalles/:alumno_id",param:{alumno_id:null},views:{matricula_detalle:{templateUrl:`${a.views}alumnos/matriculasDetalles.tpl.html`,controller:"MatriculasDetallesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Matrículas detalladas"}]}}},data:{displayName:"detalles",icon_fa:"fa fa-pencil",pageTitle:"Matrículas alumnos - MyVc",needed_permissions:[r.can_work_like_admin]}}).state("panel.prematriculas.matricula_detalles",{url:"^/prematriculas/matricula_detalles/:alumno_id",param:{alumno_id:null},views:{matricula_detalle:{templateUrl:`${a.views}alumnos/matriculasDetalles.tpl.html`,controller:"MatriculasDetallesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Matrículas detalladas"}]}}},data:{displayName:"detalles",icon_fa:"fa fa-pencil",pageTitle:"Matrículas alumnos - MyVc",needed_permissions:[r.can_work_like_admin]}}).state("panel.matriculas.detalles.periodos",{url:"^/matriculas/detalles/:alumno_id/periodos",param:{alumno_id:null},views:{matricula_detalle_periodos:{templateUrl:`${a.views}alumnos/matriculasDetallesPeriodos.tpl.html`,controller:"MatriculasDetallesPeriodosCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Matrículas detalladas"}]}}},data:{displayName:"periodos",icon_fa:"fa fa-ioxhost",pageTitle:"Matrículas alumnos - MyVc",needed_permissions:[r.can_work_like_admin]}}).state("panel.cartera",{url:"^/cartera",views:{maincontent:{templateUrl:`${a.views}alumnos/cartera.tpl.html`,controller:"CarteraCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Cartera"}]}}},data:{displayName:"cartera",icon_fa:"fa fa-money",pageTitle:"Cartera - MyVc",needed_permissions:[r.can_work_like_teacher]}}).state("panel.cartera.editar",{url:"/editar/:alumno_id",views:{edit_alumno:{templateUrl:`${a.views}alumnos/alumnosEdit.tpl.html`,controller:"AlumnosEditCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar"}]}}},data:{displayName:"editar",icon_fa:"fa fa-users",pageTitle:"Editar alumno - MyVc",needed_permissions:[r.can_work_like_teacher]}}).state("panel.acudientes",{url:"^/acudientes",views:{maincontent:{templateUrl:`${a.views}alumnos/acudientes.tpl.html`,controller:"AcudientesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Acudientes"}]}}},data:{displayName:"Acudientes",icon_fa:"fa fa-users",pageTitle:"Acudientes - MyVc",needed_permissions:[r.can_work_like_teacher],needed_roles:[t.coord_academico,t.coord_disciplinario]}}).state("panel.asistencias",{url:"^/asistencias",views:{maincontent:{templateUrl:`${a.views}alumnos/asistencias.tpl.html`,controller:"AsistenciasCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Asistencias a la institución"}]}}},data:{displayName:"Asistencias a la institución",icon_fa:"fa fa-users",pageTitle:"Asistencias - MyVc",needed_permissions:[r.can_work_like_teacher]}}).state("panel.persona",{url:"^/persona/:persona_id/:tipo",param:{persona_id:null,tipo:null},views:{maincontent:{templateUrl:`${a.views}alumnos/persona.tpl.html`,controller:"PersonaCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Detalle de persona"}]}}},data:{displayName:"Persona",icon_fa:"fa fa-users",pageTitle:"Persona - MyVc",needed_roles:[t.admin,t.psicologo,t.enfermero,t.acudiente,t.alumno,t.coord_academico,t.coord_disciplinario]}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("AlumnosCtrl",["$scope","App","$rootScope","$state","$interval","uiGridConstants","uiGridEditConstants","$uibModal","$filter","AuthService","toastr","$http","DownloadServ","Upload","Acentos","$timeout",function(e,a,r,t,n,o,i,s,u,l,c,d,p,m,f,g){var _,h,v,b,y,w,C,S,A,E,P,N,$,U;l.verificar_acceso(),l.hasRoleOrPerm("Profesor")&&!e.USER.profes_can_edit_alumnos&&(c.warning("No tienes permiso para editar alumnos"),t.transitionTo("panel")),e.dato={},e.dato.mostrartoolgrupo=!0,e.gridScope=e,e.views=a.views,e.perfilPath=a.images+"perfil/",e.year_ant=e.USER.year-1,e.gridOptions={},e.gridOptionsSinMatricula={},e.paises=[],e.religiones=a.religiones,e.tipos_sangre=a.tipos_sangre,e.mostrar_pasado=!1,e.mostrar_retirados=!1,e.texto_a_buscar="",e.hombresGrupo=0,e.mujeresGrupo=0,e.creandoUsuario=!1,e.parentescos=a.parentescos,e.dato.grupo="",d.get("::grupos/con-paises-tipos").then(function(a){var r,t,n,o,i,s;for(o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),e.grupos=a.data.grupos,e.paises=a.data.paises,e.tipos_doc=a.data.tipos_doc,s=[],t=0,n=(i=e.grupos).length;t<n;t++)r=i[t],parseInt(r.id)===parseInt(o)?(e.dato.grupo=r,s.push(e.selectGrupo(e.dato.grupo))):s.push(void 0);return s}),e.selectGrupo=function(a){var r,t,n,o,i,s,u,l,p;for(localStorage.matr_grupo=a.id,e.dato.grupo=a,o=0,s=(l=e.grupos).length;o<s;o++)(t=l[o]).active=!1;for(a.active=!0,n=[],i=0,u=(p=e.grupos).length;i<u;i++)(t=p[i]).orden_grado===a.orden_grado-1&&n.push(t);return r=n.length>0?n[0].grado_id:null,e.traerAlumnnosConGradosAnterior=function(){return d.put("::matriculas/alumnos-con-grado-anterior",{grupo_actual:a,grado_ant_id:r,year_ant:e.year_ant}).then(function(a){var r,t,n,o,i,s,u,l,p,m,f,g,_,h,v,b,y,w,C;for(e.gridOptions.data=a.data.AlumnosActuales,e.AlumnosDesertRetir=a.data.AlumnosDesertRetir,e.gridOptionsSinMatricula.data=a.data.AlumnosSinMatricula,t=0,o=(_=e.gridOptions.data).length;t<o;t++){for((r=_[t]).estado_ant=r.estado,r.fecha_retiro_ant=r.fecha_retiro,r.fecha_retiro=r.fecha_retiro?new Date(r.fecha_retiro.replace(/-/g,"/")):r.fecha_retiro,r.fecha_matricula_ant=r.fecha_matricula,r.fecha_matricula=r.fecha_matricula?new Date(r.fecha_matricula.replace(/-/g,"/")):r.fecha_matricula,r.fecha_nac=r.fecha_nac?new Date(r.fecha_nac.replace(/-/g,"/")):r.fecha_nac,n=0,i=(h=e.tipos_doc).length;n<i;n++)(C=h[n]).id===r.tipo_doc&&(r.tipo_doc=C);for(p=0,s=(v=r.subGridOptions.data).length;p<s;p++)(g=v[p]).fecha_nac_ant=g.fecha_nac,g.fecha_nac=g.fecha_nac?new Date(g.fecha_nac.replace(/-/g,"/")):g.fecha_nac;r.subGridOptions.onRegisterApi=function(a){return a.edit.on.afterCellEdit(e,function(a,r,t,n){if(t!==n){if("sexo"===r.field&&"M"!==(t=t.toUpperCase())&&"F"!==t)return c.warning("Debe usar M o F"),void(a.sexo=n);if("email"===r.field&&!/\S+@\S+\.\S+/.test(t))return c.warning("Email no válido"),void(a.email=n);d.put("::acudientes/guardar-valor",{parentesco_id:a.parentesco_id,acudiente_id:a.id,user_id:a.user_id,propiedad:r.field,valor:t}).then(function(e){return c.success("Acudiente actualizado con éxito")},function(e){return a[r.field]=n,c.error("Cambio no guardado","Error")})}return e.$apply()})}}for(m=0,u=(b=e.AlumnosDesertRetir).length;m<u;m++)(r=b[m]).estado_ant=r.estado,r.fecha_retiro_ant=r.fecha_retiro,r.fecha_retiro=r.fecha_retiro?new Date(r.fecha_retiro.replace(/-/g,"/")):r.fecha_retiro,r.fecha_matricula_ant=r.fecha_matricula,r.fecha_matricula=r.fecha_matricula?new Date(r.fecha_matricula.replace(/-/g,"/")):r.fecha_matricula;for(w=[],f=0,l=(y=e.gridOptionsSinMatricula.data).length;f<l;f++)(r=y[f]).estado_ant=r.estado,r.fecha_retiro_ant=r.fecha_retiro,r.fecha_retiro=r.fecha_retiro?new Date(r.fecha_retiro.replace(/-/g,"/")):r.fecha_retiro,r.fecha_matricula_ant=r.fecha_matricula,w.push(r.fecha_matricula=r.fecha_matricula?new Date(r.fecha_matricula.replace(/-/g,"/")):r.fecha_matricula);return w})},e.traerAlumnnosConGradosAnterior()},e.cambiandoClave=!1,e.cambiarVariasClaves=function(){return e.cambiandoClave=!e.cambiandoClave},e.guardarClaves=function(){return!e.dato.grupo.id>0&&c.info("Primero debes elegir el grupo"),d.put("::alumnos/cambiar-claves",{clave:e.clave_cambiar,grupo_id:e.dato.grupo.id}).then(function(e){return c.success("Claves cambiadas")},function(e){return c.error("Hubo un problema cambiando las claves","Error")})},e.guardarClavesTodosAlumnos=function(){if(confirm("¿Seguro que quiere cambiar la contraseña a TODOS los alumnos?"))return d.put("::cambiar-usuarios/poner-password-todos-alumnos",{clave:e.clave_cambiar}).then(function(e){return c.success("Claves cambiadas")},function(e){return c.error("Hubo un problema cambiando las claves","Error")})},e.guardarClavesTodosAcudientes=function(){if(confirm("¿Seguro que quiere cambiar la contraseña a TODOS los ACUDIENTES?"))return d.put("::cambiar-usuarios/poner-password-todos-acudientes",{clave:e.clave_cambiar}).then(function(e){return c.success("Claves cambiadas")},function(e){return c.error("Hubo un problema cambiando las claves","Error")})},e.PonerDocumentoComoUsernameAlumnos=function(){if(confirm("¿Seguro que quiere establecer documento de identidad como usuario a TODOS los alumnos?"))return d.put("::cambiar-usuarios/poner-documento-como-username-alumnos").then(function(e){return c.success("Usuarios de alumnos cambiados")},function(e){return c.error("Hubo un problema cambiando los usuarios","Error")})},e.PonerDocumentoComoUsernameAcudientes=function(){if(confirm("¿Seguro que quiere establecer documento de identidad como usuario a TODOS los ACUDIENTES?"))return d.put("::cambiar-usuarios/poner-documento-como-username-acudientes").then(function(e){return c.success("Usuarios de acudientes cambiados")},function(e){return c.error("Hubo un problema cambiando los usuarios","Error")})},e.editar=function(e){return t.go("panel.persona",{persona_id:e.alumno_id,tipo:"alumno"})},e.restaurar=function(a){return e.restaurando=!0,d.put("::alumnos/restore/"+a.alumno_id).then(function(r){return c.success("Alumno restaurado, para verlo, debe recargar la página"),e.restaurando=!1,a.restaurado=!0},function(a){return c.error("Alumno no restaurado","Error"),e.restaurando=!1})},e.eliminar=function(a){return s.open({templateUrl:"==alumnos/removeAlumno.tpl.html",controller:"RemoveAlumnoCtrl",resolve:{alumno:function(){return a}}}).result.then(function(a){return e.gridOptions.data=u("filter")(e.gridOptions.data,{alumno_id:"!"+a.alumno_id})},function(){})},e.agregarAcudiente=function(a){return delete r.acudiente_cambiar,s.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(e){return a.subGridOptions.data.splice(a.subGridOptions.data.length-1,0,e)},function(){})},e.cambiarAcudiente=function(a,t){return r.acudiente_cambiar=t,s.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(e){var r,n,o,i,s,u;for(u=[],n=r=0,o=(s=a.subGridOptions.data).length;r<o;n=++r)(i=s[n])&&i.id===t.id?u.push(a.subGridOptions.data.splice(n,1,e)):u.push(void 0);return u},function(){})},e.quitarAcudiente=function(e,a){return s.open({templateUrl:"==alumnos/quitarAcudienteModalConfirm.tpl.html",controller:"QuitarAcudienteModalConfirmCtrl",resolve:{alumno:function(){return e},acudiente:function(){return a}}}).result.then(function(a){var r,t,n,o,i,s;for(console.log(e.subGridOptions.data,a),s=[],t=r=0,n=(i=e.subGridOptions.data).length;r<n;t=++r)(o=i[t])&&o.id===a.acudiente_id?s.push(e.subGridOptions.data.splice(t,1)):s.push(void 0);return s},function(){})},e.cambiarPromovido=function(e){return s.open({animation:!1,templateUrl:"==alumnos/cambiarPromovido.tpl.html",controller:"CambiarPromovidoModalCtrl",resolve:{persona:function(){return e}}}).result.then(function(a){return e=a})},e.cambiarCiudad=function(a,r){return s.open({templateUrl:"==alumnos/cambiarCiudadModal.tpl.html",controller:"CambiarCiudadModalCtrl",resolve:{persona:function(){return a},paises:function(){return e.paises},tipo_ciudad:function(){return r},tipo_persona:function(){return a.subGridOptions?"alumno":"acudiente"}}}).result.then(function(e){return a=e})},e.cambiarPazysalvo=function(e){var a;return e.pazysalvo=!e.pazysalvo,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"pazysalvo",valor:e.pazysalvo},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.pazysalvo=!e.pazysalvo,c.error("Cambio no guardado","Error")})},e.cambiarPresencial=function(e){var a;return e.presencial=!e.presencial,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"presencial",valor:e.presencial},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.presencial=!e.presencial,c.error("Cambio no guardado","Error")})},e.toggleNuevo=function(e){var a;return e.nuevo=!e.nuevo,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"nuevo",valor:e.nuevo},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.nuevo=!e.nuevo,c.error("Cambio no guardado","Error")})},e.toggleRepitente=function(e){var a;return e.repitente=!e.repitente,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"repitente",valor:e.repitente},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.repitente=!e.repitente,c.error("Cambio no guardado","Error")})},e.toggleEgresado=function(e){var a;return e.egresado=!e.egresado,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"egresado",valor:e.egresado},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.egresado=!e.egresado,c.error("Cambio no guardado","Error")})},e.toggleActive=function(e){var a;return e.is_active=!e.is_active,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,user_id:e.user_id,propiedad:"is_active",valor:e.is_active},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.is_active=!e.is_active,c.error("Cambio no guardado","Error")})},e.toggleNEE=function(e){var a;return e.nee=!e.nee,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,user_id:e.user_id,propiedad:"nee",valor:e.nee},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.nee=!e.nee,c.error("Cambio no guardado","Error")})},e.crearUsuario=function(a){if(!e.creandoUsuario){if(!a.user_id){if("Acudiente"===a.tipo){if(!a.id)return void c.info("Solo con acudientes creados");e.creandoUsuario=!0,d.post("::acudientes/crear-usuario",{acudiente:a}).then(function(r){return e.usuario_creado=!0,a.user_id=r.data.id,a.username=r.data.username,c.success("Usuario creado"),e.creandoUsuario=!1},function(){return c.error("No se pudo crear el usuario"),e.creandoUsuario=!1})}return"Acudiente"!==a.tipo?c.info("Aquí solo puede crear usuario de acudiente","Lo sentimos"):void 0}c.warning("Ya tiene usuario")}},e.resetPass=function(e){if(e.user_id)return s.open({templateUrl:a.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){});c.warning("Aún no tiene usuario")},e.cambiaUsernameCheck=function(a){return e.verificandoUsername=!0,d.put("::users/usernames-check",{texto:a}).then(function(a){return e.username_match=a.data.usernames,e.verificandoUsername=!1,e.username_match.map(function(e){return e.username})})},e.asignarAOtro=function(e){return s.open({templateUrl:"==alumnos/asignarAcudienteAOtro.tpl.html",controller:"AsignarAcudienteAOtroModalCtrl",resolve:{elemento:function(){return e}}}).result.then(function(e){return c.success("Asignado.")})},e.eliminarMatricula=function(e){return d.delete("::matriculas/destroy/"+e.matricula_id).then(function(a){return e.currentyear=0,c.success("Alumno desmatriculado"),e},function(e){return c.error("No se pudo desmatricular","Problema")})},h='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>'+'<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a>'+"</span>",S="==directives/botonesPrematricularMas.tpl.html",E="==directives/botonPazysalvo.tpl.html",P="==directives/botonPresencial.tpl.html",w="==directives/botonIsNuevo.tpl.html",y="==directives/botonIsEgresado.tpl.html",N="==directives/botonPromovido.tpl.html",b="==directives/botonIsActive.tpl.html",A="==directives/botonNEE.tpl.html",U="==directives/botonesResetPassword.tpl.html",v="==directives/botonCiudadDoc.tpl.html",$="==directives/botonTipoDoc.tpl.html",_='uib-popover-template="views+\'==alumnos/popoverAlumnoGrid.tpl.html\'" popover-trigger="\'mouseenter\'" popover-title="{{ row.entity.nombres + \' \' + row.entity.apellidos }}" popover-popup-delay="500" popover-append-to-body="true"',e.gridOptions={showGridFooter:!0,showColumnFooter:!0,showFooter:!0,gridFooterTemplate:"==alumnos/gridFooterCartera.tpl.html",enableSorting:!0,enableFiltering:!0,exporterSuppressColumns:["edicion"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Alumnos - MyVC.csv",enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,expandableRowTemplate:"==alumnos/expandableRowTemplate.tpl.html",expandableRowHeight:120,expandableRowScope:{agregarAcudiente:e.agregarAcudiente,quitarAcudiente:e.quitarAcudiente,cambiarAcudiente:e.cambiarAcudiente,asignarAOtro:e.asignarAOtro,crearUsuario:e.crearUsuario,resetPass:e.resetPass,cambiarCiudad:e.cambiarCiudad,cambiarPromovido:e.cambiarPromovido,cambiaUsernameCheck:e.cambiaUsernameCheck},columnDefs:[{field:"no",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{field:"nombres",minWidth:130,pinnedLeft:!0,filter:{condition:f.buscarEnGrid},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;" '+_+'><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:110,filter:{condition:f.buscarEnGrid}},{name:"edicion",displayName:"Edit",width:54,enableSorting:!1,enableFiltering:!1,cellTemplate:h,enableCellEdit:!1,enableColumnMenu:!0},{field:"sexo",displayName:"Sex",width:40},{field:"grupo_id",displayName:"Matrícula",enableCellEdit:!1,cellTemplate:S,minWidth:270,enableFiltering:!1},{field:"promovido",displayName:"Promovido?",minWidth:120,cellTemplate:N,enableCellEdit:!1},{field:"fecha_matricula",displayName:"Fecha matrícula",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"no_matricula",displayName:"# matrícula",minWidth:80,enableColumnMenu:!0},{field:"username",filter:{condition:f.buscarEnGrid},displayName:"Usuario",cellTemplate:U,editableCellTemplate:"==alumnos/botonEditUsername.tpl.html",minWidth:135},{field:"deuda",displayName:"Deuda",type:"number",cellFilter:'currency:"$":0',minWidth:85,aggregationType:o.aggregationTypes.sum,aggregationHideLabel:!0,footerCellTemplate:'<div class="ui-grid-cell-contents" >{{col.getAggregationValue() | currency:"$":0 }}</div>'},{field:"pazysalvo",displayName:"A paz?",cellTemplate:E,minWidth:60,enableCellEdit:!1},{field:"presencial",displayName:"Presencial",cellTemplate:P,minWidth:60,enableCellEdit:!1},{field:"nuevo",displayName:"Nuevo?",cellTemplate:w,minWidth:60,enableCellEdit:!1},{field:"repitente",displayName:"Repitente?",cellTemplate:"==directives/botonIsRepitente.tpl.html",minWidth:60,enableCellEdit:!1},{field:"egresado",displayName:"Egresado?",cellTemplate:y,minWidth:60,enableCellEdit:!1},{field:"is_active",displayName:"Activo?",cellTemplate:b,minWidth:60,enableCellEdit:!1},{field:"nee",displayName:"ERE?",cellTemplate:A,minWidth:60,enableCellEdit:!1},{field:"religion",displayName:"Religión",minWidth:70,editableCellTemplate:"==alumnos/botonEditReligion.tpl.html"},{field:"tipo_doc",displayName:"Tipo documento",minWidth:120,cellTemplate:$,enableCellEdit:!1},{field:"documento",minWidth:100,cellFilter:"formatNumberDocumento"},{field:"nro_folio",minWidth:100},{field:"ciudad_doc",displayName:"Ciud Docu",minWidth:120,cellTemplate:v,enableCellEdit:!1},{field:"estrato",minWidth:70,type:"number"},{field:"fecha_nac",displayName:"Nacimiento",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"edad",minWidth:70,enableCellEdit:!1},{field:"direccion",displayName:"Dirección",minWidth:80},{field:"barrio",minWidth:80},{field:"telefono",displayName:"Telefono",minWidth:80},{field:"celular",displayName:"Celular",minWidth:100}],multiSelect:!1,exporterHeaderFilter:function(e){return"A paz?"===e?"Paz y salvo":"Matrícula"===e?"Grupo":e},exporterFieldCallback:function(a,r,t,n){return"no"===t.name?a.renderContainers.body.visibleRowCache.indexOf(r)+1:"grupo_id"===t.name?e.dato.grupo.nombre:"ciudad_nac"===t.name?r.entity.ciudad_nac_nombre:"pazysalvo"===t.name||"nuevo"===t.name?n?"Si":"No":"tipo_doc"===t.name&&n&&n.tipo?n.tipo:n},onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){var o;if(t!==n){if(a.alumno_id||(a.alumno_id=fila.id),"sexo"===r.field&&"M"!==(t=t.toUpperCase())&&"F"!==t)return c.warning("Debe usar M o F"),void(a.sexo=n);if("fecha_matricula"===r.field)return e.cambiarFechaMatricula(a);if("username"===r.field&&(o=a.user_id),"tipo_sangre"===r.field&&(t=t.toUpperCase(),!(e.tipos_sangre.indexOf(t)>-1)))return c.warning("Debe usar: "+e.tipos_sangre.join(" ")),void(a.tipo_sangre=n);if("estrato"===r.field&&(t<0||t>9))return c.warning("Valor no admitido"),void(a.estrato=n);if("documento"===r.field&&10!==t.length&&0!==t.length)return void c.warning("Debe ser de diez dígitos");d.put("::alumnos/guardar-valor",{alumno_id:a.alumno_id,propiedad:r.field,valor:t,user_id:o}).then(function(e){return c.success("Alumno(a) actualizado con éxito")},function(e){return a[r.field]=n,c.error("Cambio no guardado","Error")})}if("religion"!==r.field)return e.$apply()})}},e.cantidadDeudores=function(){var a,r,t,n,o,i,s;if(s=0,r=0,o=0,e.gridOptions.data)for(t=0,n=(i=e.gridOptions.data).length;t<n;t++)(a=i[t]).pazysalvo||(s+=1),"M"===a.sexo?r++:o++;return e.hombresGrupo=r,e.mujeresGrupo=o,s},C='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<label ng-click="grid.appScope.setNewAsistente(row.entity)" uib-tooltip="Inscribir como asistente" tooltip-append-to-body="true" class="btn btn-success shiny btn-xs">Asis</label>'+'<label ng-click="grid.appScope.matricularUno(row.entity, true)" uib-tooltip="Matricular" tooltip-append-to-body="true" tooltip-popup-delay="1000" class="btn btn-success shiny btn-xs">Matric</label>'+'<label ng-click="grid.appScope.matricularEn(row.entity)" uib-tooltip="Matricular en..." tooltip-append-to-body="true" tooltip-placement="right" class="btn btn-success shiny btn-xs">Otro grupo...</label>'+"</span>",e.gridOptionsSinMatricula={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,columnDefs:[{field:"no",cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40},{field:"nombres",minWidth:120,filter:{condition:function(e,a,r){return r.entity.nombres.toLowerCase().indexOf(e.toLowerCase())>-1}},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;" '+_+'><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:80,filter:{condition:o.filter.CONTAINS}},{field:"sexo",displayName:"Sex",width:40},{field:"grupo_id",displayName:"Matrícula",cellTemplate:C,minWidth:200,enableFiltering:!1},{field:"fecha_matricula",displayName:"Fecha matrícula",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"no_matricula",displayName:"# matrícula",minWidth:80,enableColumnMenu:!0},{field:"abrev_grupo",displayName:"Grupo "+(e.USER.year-1),minWidth:80},{field:"telefono",displayName:"Teléfono",minWidth:70}],multiSelect:!0},e.religionSelected=function(a,r){if(e.religiones.indexOf(a.religion)>-1)return e.$broadcast(i.events.END_CELL_EDIT)},e.religionEditPressEnter=function(a){return e.$broadcast(i.events.END_CELL_EDIT)},e.tipoDocSeleccionado=function(e,a){var r,t;return r={propiedad:"tipo_doc",valor:e.id},t="acudientes",a.subGridOptions?(t="alumnos",r.alumno_id=a.alumno_id):(r.acudiente_id=a.acudiente_id,r.parentesco_id=a.parentesco_id,r.user_acud_id=a.user_id),d.put("::"+t+"/guardar-valor",r).then(function(e){return c.success("Alumno(a) actualizado con éxito","Actualizado")},function(e){return a.tipo_doc=oldValue,c.error("Cambio no guardado","Error")})},e.matricularUno=function(a,r){var t;if(e.dato.grupo.id)return t={alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,year_id:e.USER.year_id},d.post("::matriculas/matricularuno",t).then(function(t){return t=t.data,a.matricula_id=t.id,a.grupo_id=t.grupo_id,a.estado="MATR",a.fecha_matricula_ant=t.fecha_matricula.date,a.fecha_matricula=new Date(t.fecha_matricula.date),c.success("Alumno matriculado con éxito","Matriculado"),r&&e.traerAlumnnosConGradosAnterior(),a},function(e){return c.error("No se pudo matricular el alumno.","Error")});c.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.cambiaEpsCheck=function(a){return e.verificandoEps=!0,d.put("::alumnos/eps-check",{texto:a}).then(function(a){return e.eps_match=a.data.eps,e.verificandoEps=!1,e.eps_match.map(function(e){return e.eps})})},e.reMatricularUno=function(a){var r;if(e.dato.grupo.id)return r={matricula_id:a.matricula_id},d.put("::matriculas/re-matricularuno",r).then(function(e){return e=e.data,c.success("Alumno rematriculado.","Matriculado"),a},function(e){return c.error("No se pudo matricular el alumno.","Error")});c.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.matricularEn=function(a){return s.open({templateUrl:"==alumnos/matricularEn.tpl.html",controller:"MatricularEnCtrl",resolve:{alumno:function(){return a},grupos:function(){return e.grupos},USER:function(){return e.USER}}}).result.then(function(a){return console.log("Cierra"),e.traerAlumnnosConGradosAnterior()})},e.setAsistente=function(a){return d.put("::matriculas/set-asistente",{matricula_id:a.matricula_id,grupo_id:e.dato.grupo.grupo_id}).then(function(e){return c.success("Guardado como asistente.")},function(e){return c.error("No se pudo guardar como asistente","Error")})},e.setPrematriculado=function(a){return d.put("::matriculas/prematricular",{alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,anio_sig:0}).then(function(a){return c.success("Guardado como Prematriculado."),e.traerAlumnnosConGradosAnterior()},function(e){return c.error("No se pudo crear asistente.","Error")})},e.setPrematriculadoA=function(a){return d.put("::matriculas/prematricular",{alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,anio_sig:0,estado:"PREA"}).then(function(a){return c.success("Prematriculado por acudiente en la plataforma."),e.traerAlumnnosConGradosAnterior()},function(e){return c.error("No se pudo crear asistente.","Error")})},e.setNewAsistente=function(a){return d.put("::matriculas/set-new-asistente",{alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id}).then(function(a){return console.log("Cambios guardados"),e.traerAlumnnosConGradosAnterior()},function(e){return c.error("No se pudo crear asistente","Error")})},e.cambiarFechaRetiro=function(e){return d.put("::matriculas/cambiar-fecha-retiro",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return c.success("Fecha retiro guardada")},function(a){return e.fecha_retiro=e.fecha_retiro_ant,c.error("No se pudo guardar la fecha","Error")})},e.cambiarFechaMatricula=function(e){return d.put("::matriculas/cambiar-fecha-matricula",{matricula_id:e.matricula_id,fecha_matricula:e.fecha_matricula}).then(function(e){return c.success("Fecha matrícula guardada")},function(a){return e.fecha_matricula=e.fecha_matricula_ant,c.error("No se pudo guardar la fecha","Error")})},e.desertar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),d.put("::matriculas/desertar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return c.success("Alumno desertado")},function(e){return c.error("No se pudo desertar","Problema")})},e.retirar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),d.put("::matriculas/retirar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return c.success("Alumno retirado")},function(e){return c.error("No se pudo desmatricular","Problema")})},e.buscar_por=function(a){if(""!==e.texto_a_buscar)return d.put("::buscar/por-"+a,{texto_a_buscar:e.texto_a_buscar}).then(function(a){return e.alumnos_encontrados=a.data},function(e){return c.error("No se pudo buscar","Problema")});c.warning("Escriba término a buscar")},e.exportarAlumnos=function(){return p.download("::simat/alumnos-exportar","Alumnos a importar "+e.USER.year+".xlsx")},e.importarSimat=function(r,t){if(e.f=r,e.errFile=t&&t[0],r)return r.upload=m.upload({url:a.Server+"importar/algo/"+e.USER.year,data:{file:r}}),r.upload.then(function(e){return g(function(){return r.result=e.data})},function(a){if(a.status>0)return e.errorMsg=a.status+": "+a.data},function(e){return r.progress=Math.min(100,parseInt(100*e.loaded/e.total))})},e.$on("alumnoguardado",function(a,r){return e.gridOptions.data.push(r),t.go("panel.alumnos")})}]).controller("RemoveAlumnoCtrl",["$scope","$uibModalInstance","alumno","$http","toastr","App",function(e,a,r,t,n,o){return e.alumno=r,e.perfilPath=o.images+"perfil/",e.ok=function(){return t.delete("::alumnos/destroy/"+r.alumno_id).then(function(e){return n.success("Alumno enviado a la papelera.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("PrematriculasCtrl",["$scope","App","$rootScope","$state","$interval","uiGridConstants","uiGridEditConstants","$uibModal","$filter","AuthService","toastr","$http","DownloadServ","Upload","Acentos",function(e,a,r,t,n,o,i,s,u,l,c,d,p,m,f){var g,_,h,v,b,y,w,C,S,A;l.verificar_acceso(),l.hasRoleOrPerm("Profesor")&&!e.USER.profes_can_edit_alumnos&&(c.warning("No tienes permiso para editar alumnos"),t.transitionTo("panel")),e.dato={},e.dato.mostrartoolgrupo=!0,e.gridScope=e,e.views=a.views,e.perfilPath=a.images+"perfil/",e.year_ant=e.USER.year-1,e.gridOptions={},e.gridOptionsSinMatricula={},e.paises=[],e.tipos_sangre=a.tipos_sangre,e.mostrar_pasado=!0,e.mostrar_retirados=!1,e.texto_a_buscar="",e.hombresGrupo=0,e.mujeresGrupo=0,e.parentescos=a.parentescos,e.dato.grupo="",d.get("::grupos/con-paises-tipos-next-year").then(function(a){var r,t,n,o,i,s,u,l,c,d,p,m,f,g,_,h;for(m=0,localStorage.matr_grupo_premat&&(m=parseInt(localStorage.matr_grupo_premat)),e.grupos=a.data.grupos,e.paises=a.data.paises,e.tipos_doc=a.data.tipos_doc,l=0,d=(g=e.grupos).length;l<d;l++)u=g[l],parseInt(u.id)===parseInt(m)&&(e.dato.grupo=u,e.selectGrupo(e.dato.grupo));for(n=0,h=0,t=0,o=0,i=0,f=0,r=0,c=0,p=(_=e.grupos).length;c<p;c++)n+=(s=_[c]).cantidad,h+=s.sin_matricular,t+=s.cupo,o+=s.cant_faltantes,i+=s.cant_formularios,f+=s.cant_matriculados,r+=s.cant_asistentes,s.active=!1;return e.total_prematriculados=n,e.total_sin_prematric=h,e.total_cupo=t,e.total_taltantes=o,e.total_formularios=i,e.total_matriculados=f,e.total_asistentes=r}),e.selectGrupo=function(a){var r,t,n,o,i,s,u,l,p,m,f;for(localStorage.matr_grupo_premat=a.id,e.dato.grupo=a,r=0,f=0,i=0,u=(p=e.grupos).length;i<u;i++)r+=(n=p[i]).cantidad,f+=n.sin_matricular,n.active=!1;for(e.total_prematriculados=r,e.total_sin_prematric=f,a.active=!0,o=[],s=0,l=(m=e.grupos).length;s<l;s++)(n=m[s]).orden_grado===a.orden_grado-1&&o.push(n);return t=o.length>0?o[0].grado_id:null,e.traerAlumnnosConGradosAnterior=function(){return d.put("::prematriculas/alumnos-con-grado-anterior",{grupo_actual:a,grado_ant_id:t,year_ant:e.year_ant}).then(function(a){var r,t,n,o,i,s,u,l,p,m,f,g,_,h,v,b;for(e.gridOptions.data=a.data.AlumnosActuales,e.gridOptionsSinMatricula.data=a.data.AlumnosSinMatricula,e.AlumnosFormularios=a.data.AlumnosFormularios,e.AlumnosPrematriculadosA=a.data.AlumnosPrematriculadosA,t=0,o=(f=e.gridOptions.data).length;t<o;t++){for((r=f[t]).estado_ant=r.estado,r.fecha_retiro_ant=r.fecha_retiro,r.fecha_retiro=r.fecha_retiro?new Date(r.fecha_retiro.replace(/-/g,"/")):r.fecha_retiro,r.fecha_matricula_ant=r.fecha_matricula,r.fecha_matricula=r.fecha_matricula?new Date(r.fecha_matricula.replace(/-/g,"/")):r.fecha_matricula,r.premarticulado_ant=r.prematriculado,r.prematriculado=r.prematriculado?new Date(r.prematriculado.replace(/-/g,"/")):r.prematriculado,n=0,i=(g=e.tipos_doc).length;n<i;n++)(b=g[n]).id===r.tipo_doc&&(r.tipo_doc=b);for(l=0,s=(_=r.subGridOptions.data).length;l<s;l++)(m=_[l]).fecha_nac_ant=m.fecha_nac,m.fecha_nac=m.fecha_nac?new Date(m.fecha_nac.replace(/-/g,"/")):m.fecha_nac;r.subGridOptions.onRegisterApi=function(a){return a.edit.on.afterCellEdit(e,function(a,r,t,n){if(t!==n){if("sexo"===r.field&&"M"!==(t=t.toUpperCase())&&"F"!==t)return c.warning("Debe usar M o F"),void(a.sexo=n);if("email"===r.field&&!/\S+@\S+\.\S+/.test(t))return c.warning("Email no válido"),void(a.email=n);d.put("::acudientes/guardar-valor",{parentesco_id:a.parentesco_id,acudiente_id:a.id,user_id:a.user_id,propiedad:r.field,valor:t}).then(function(e){return c.success("Acudiente actualizado con éxito")},function(e){return a[r.field]=n,c.error("Cambio no guardado","Error")})}return e.$apply()})}}for(v=[],p=0,u=(h=e.gridOptionsSinMatricula.data).length;p<u;p++)(r=h[p]).estado_ant=r.estado,r.fecha_retiro_ant=r.fecha_retiro,r.fecha_retiro=r.fecha_retiro?new Date(r.fecha_retiro.replace(/-/g,"/")):r.fecha_retiro,r.fecha_matricula_ant=r.fecha_matricula,v.push(r.fecha_matricula=r.fecha_matricula?new Date(r.fecha_matricula.replace(/-/g,"/")):r.fecha_matricula);return v})},e.traerAlumnnosConGradosAnterior()},e.editar=function(e){return t.go("panel.alumnos.editar",{alumno_id:e.alumno_id})},e.eliminar=function(a){return s.open({templateUrl:"==alumnos/removeAlumno.tpl.html",controller:"RemoveAlumnoCtrl",resolve:{alumno:function(){return a}}}).result.then(function(a){return e.gridOptions.data=u("filter")(e.gridOptions.data,{alumno_id:"!"+a.alumno_id})},function(){})},e.agregarAcudiente=function(a){return delete r.acudiente_cambiar,s.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(e){return a.subGridOptions.data.splice(a.subGridOptions.data.length-1,0,e)},function(){})},e.cambiarAcudiente=function(a,t){return r.acudiente_cambiar=t,s.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(e){var r,n,o,i,s,u;for(u=[],n=r=0,o=(s=a.subGridOptions.data).length;r<o;n=++r)(i=s[n])&&i.id===t.id?u.push(a.subGridOptions.data.splice(n,1,e)):u.push(void 0);return u},function(){})},e.restaurar=function(a){return e.restaurando=!0,d.put("::alumnos/restore/"+a.alumno_id).then(function(r){return c.success("Alumno restaurado, para verlo, debe recargar la página"),e.restaurando=!1,a.restaurado=!0},function(a){return c.error("Alumno no restaurado","Error"),e.restaurando=!1})},e.quitarAcudiente=function(e,a){return s.open({templateUrl:"==alumnos/quitarAcudienteModalConfirm.tpl.html",controller:"QuitarAcudienteModalConfirmCtrl",resolve:{alumno:function(){return e},acudiente:function(){return a}}}).result.then(function(a){var r,t,n,o,i,s;for(s=[],t=r=0,n=(i=e.subGridOptions.data).length;r<n;t=++r)(o=i[t])&&o.id===a.id?s.push(e.subGridOptions.data.splice(t,1)):s.push(void 0);return s},function(){})},e.cantidadDeudores=function(){var a,r,t,n,o,i,s;if(s=0,r=0,o=0,e.gridOptions.data)for(t=0,n=(i=e.gridOptions.data).length;t<n;t++)(a=i[t]).pazysalvo||(s+=1),"M"===a.sexo?r++:o++;return e.hombresGrupo=r,e.mujeresGrupo=o,s},e.crear_alumno=function(){return r.grupos_siguientes=e.grupos,t.go("panel.prematriculas.nuevo")},e.cambiarCiudad=function(a,r){return s.open({templateUrl:"==alumnos/cambiarCiudadModal.tpl.html",controller:"CambiarCiudadModalCtrl",resolve:{persona:function(){return a},paises:function(){return e.paises},tipo_ciudad:function(){return r},tipo_persona:function(){return a.subGridOptions?"alumno":"acudiente"}}}).result.then(function(e){return a=e})},e.cambiarPazysalvo=function(e){var a;return e.pazysalvo=!e.pazysalvo,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"pazysalvo",valor:e.pazysalvo},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.pazysalvo=!e.pazysalvo,c.error("Cambio no guardado","Error")})},e.toggleNuevo=function(e){var a;return e.nuevo=!e.nuevo,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"nuevo",valor:e.nuevo},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.nuevo=!e.nuevo,c.error("Cambio no guardado","Error")})},e.toggleRepitente=function(e){var a;return e.repitente=!e.repitente,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"repitente",valor:e.repitente},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.repitente=!e.repitente,c.error("Cambio no guardado","Error")})},e.toggleEgresado=function(e){var a;return e.egresado=!e.egresado,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"egresado",valor:e.egresado},d.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.egresado=!e.egresado,c.error("Cambio no guardado","Error")})},e.crearUsuario=function(a){if(!a.user_id){if("Acudiente"===a.tipo){if(!a.id)return void c.info("Solo con acudientes creados");d.post("::acudientes/crear-usuario",{acudiente:a}).then(function(r){return e.usuario_creado=!0,a.user_id=r.data.id,a.username=r.data.username,c.success("Usuario creado")},function(){return c.error("No se pudo crear el usuario")})}return"Acudiente"!==a.tipo?c.info("Aquí solo puede crear usuario de acudiente","Lo sentimos"):void 0}c.warning("Ya tiene usuario")},e.resetPass=function(e){if(e.user_id)return s.open({templateUrl:a.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){});c.warning("Aún no tiene usuario")},e.cambiaUsernameCheck=function(a){return e.verificandoUsername=!0,d.put("::users/usernames-check",{texto:a}).then(function(a){return e.username_match=a.data.usernames,e.verificandoUsername=!1,e.username_match.map(function(e){return e.username})})},e.eliminarMatricula=function(e){return d.delete("::matriculas/destroy/"+e.matricula_id).then(function(a){return e.currentyear=0,c.success("Alumno desmatriculado"),e},function(e){return c.error("No se pudo desmatricular","Problema")})},_='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>'+"</span>",w="==directives/botonesPrematricularMas.tpl.html",C="==directives/botonPazysalvo.tpl.html",b="==directives/botonIsNuevo.tpl.html",v="==directives/botonIsEgresado.tpl.html",A="==directives/botonesResetPassword.tpl.html",h="==directives/botonCiudadDoc.tpl.html",S="==directives/botonTipoDoc.tpl.html",g='uib-popover-template="views+\'==alumnos/popoverAlumnoGrid.tpl.html\'" popover-trigger="\'mouseenter\'" popover-title="{{ row.entity.nombres + \' \' + row.entity.apellidos }}" popover-popup-delay="500" popover-append-to-body="true"',e.gridOptions={showGridFooter:!0,showColumnFooter:!0,gridFooterTemplate:"==alumnos/gridFooterCartera.tpl.html",enableSorting:!0,enableFiltering:!0,exporterSuppressColumns:["edicion"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Alumnos - MyVC.csv",enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,expandableRowTemplate:"==alumnos/expandableRowTemplate.tpl.html",expandableRowHeight:120,expandableRowScope:{agregarAcudiente:e.agregarAcudiente,quitarAcudiente:e.quitarAcudiente,cambiarAcudiente:e.cambiarAcudiente,crearUsuario:e.crearUsuario,resetPass:e.resetPass,cambiarCiudad:e.cambiarCiudad,cambiaUsernameCheck:e.cambiaUsernameCheck},columnDefs:[{field:"no",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{field:"nombres",minWidth:130,pinnedLeft:!0,filter:{condition:f.buscarEnGrid},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;" '+g+'><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:110,filter:{condition:f.buscarEnGrid}},{name:"edicion",displayName:"Edit",width:54,enableSorting:!1,enableFiltering:!1,cellTemplate:_,enableCellEdit:!1,enableColumnMenu:!0},{field:"sexo",displayName:"Sex",width:40},{field:"grupo_id",displayName:"Matrícula",enableCellEdit:!1,cellTemplate:w,minWidth:270,enableFiltering:!1},{field:"prematriculado",displayName:"Fech prematriculado",cellFilter:"date:mediumDate",type:"date",minWidth:120},{field:"fecha_matricula",displayName:"Fecha matrícula",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"no_matricula",displayName:"# matrícula",minWidth:80,enableColumnMenu:!0},{field:"username",filter:{condition:f.buscarEnGrid},displayName:"Usuario",cellTemplate:A,editableCellTemplate:"==alumnos/botonEditUsername.tpl.html",minWidth:135},{field:"deuda",displayName:"Deuda",type:"number",cellFilter:'currency:"$":0',minWidth:70},{field:"pazysalvo",displayName:"A paz?",cellTemplate:C,minWidth:60,enableCellEdit:!1},{field:"nuevo",displayName:"Nuevo?",cellTemplate:b,minWidth:60,enableCellEdit:!1},{field:"repitente",displayName:"Repitente?",cellTemplate:"==directives/botonIsRepitente.tpl.html",minWidth:60,enableCellEdit:!1},{field:"egresado",displayName:"Egresado?",cellTemplate:v,minWidth:60,enableCellEdit:!1},{field:"tipo_doc",displayName:"Tipo documento",minWidth:120,cellTemplate:S,enableCellEdit:!1},{field:"documento",minWidth:100,cellFilter:"formatNumberDocumento"},{field:"ciudad_doc",displayName:"Ciud Docu",minWidth:120,cellTemplate:h,enableCellEdit:!1}],multiSelect:!1,exporterHeaderFilter:function(e){return"A paz?"===e?"Paz y salvo":"Matrícula"===e?"Grupo":e},exporterFieldCallback:function(a,r,t,n){return"no"===t.name?a.renderContainers.body.visibleRowCache.indexOf(r)+1:"grupo_id"===t.name?e.dato.grupo.nombre:"ciudad_nac"===t.name?r.entity.ciudad_nac_nombre:"pazysalvo"===t.name||"nuevo"===t.name?n?"Si":"No":"tipo_doc"===t.name&&n&&n.tipo?n.tipo:n},onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){if(t!==n){if(a.alumno_id||(a.alumno_id=fila.id),"sexo"===r.field&&"M"!==(t=t.toUpperCase())&&"F"!==t)return c.warning("Debe usar M o F"),void(a.sexo=n);if("fecha_matricula"===r.field)return e.cambiarFechaMatricula(a);if("tipo_sangre"===r.field&&(t=t.toUpperCase(),!(e.tipos_sangre.indexOf(t)>-1)))return c.warning("Debe usar: "+e.tipos_sangre.join(" ")),void(a.tipo_sangre=n);if("estrato"===r.field&&(t<0||t>9))return c.warning("Valor no admitido"),void(a.estrato=n);if("documento"===r.field&&10!==t.length&&0!==t.length)return void c.warning("Debe ser de diez dígitos");d.put("::alumnos/guardar-valor",{alumno_id:a.alumno_id,propiedad:r.field,valor:t}).then(function(e){return c.success("Alumno(a) actualizado con éxito")},function(e){return a[r.field]=n,c.error("Cambio no guardado","Error")})}return e.$apply()})}},y='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<label ng-click="grid.appScope.setFormulario(row.entity)" uib-tooltip="Vender formulario" tooltip-append-to-body="true" class="btn btn-success shiny btn-xs">Form</label>'+'<label ng-click="grid.appScope.setPrematriculado(row.entity)" uib-tooltip="Prematricular" tooltip-append-to-body="true" class="btn btn-success shiny btn-xs">Prem</label>'+'<label ng-click="grid.appScope.setNewAsistente(row.entity)" uib-tooltip="Inscribir como asistente" tooltip-append-to-body="true" class="btn btn-success shiny btn-xs">Asis</label>'+'<label ng-click="grid.appScope.matricularUno(row.entity, true)" uib-tooltip="Matricular" tooltip-append-to-body="true" tooltip-popup-delay="1000" class="btn btn-success shiny btn-xs">Matric</label>'+'<label ng-click="grid.appScope.matricularEn(row.entity)" uib-tooltip="Prematricular en..." tooltip-append-to-body="true" tooltip-placement="right" class="btn btn-success shiny btn-xs">Otro grupo...</label>'+"</span>",e.gridOptionsSinMatricula={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,columnDefs:[{field:"no",cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40},{field:"nombres",minWidth:120,filter:{condition:function(e,a,r){return r.entity.nombres.toLowerCase().indexOf(e.toLowerCase())>-1}},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;" '+g+'><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:80,filter:{condition:o.filter.CONTAINS}},{field:"sexo",displayName:"Sex",width:40},{field:"grupo_id",displayName:"Matrícula",cellTemplate:y,minWidth:260,enableFiltering:!1},{field:"fecha_matricula",displayName:"Fecha matrícula",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"no_matricula",displayName:"# matrícula",minWidth:80,enableColumnMenu:!0},{field:"fecha_nac",displayName:"Nacimiento",cellFilter:"date:mediumDate",type:"date",minWidth:100}],multiSelect:!0},e.tipoDocSeleccionado=function(e,a){var r,t;return r={propiedad:"tipo_doc",valor:e.id},t="acudientes",a.subGridOptions?(t="alumnos",r.alumno_id=a.alumno_id):(r.acudiente_id=a.acudiente_id,r.parentesco_id=a.parentesco_id,r.user_acud_id=a.user_id),d.put("::"+t+"/guardar-valor",r).then(function(e){return c.success("Alumno(a) actualizado con éxito","Actualizado")},function(e){return a.tipo_doc=oldValue,c.error("Cambio no guardado","Error")})},e.matricularUno=function(a,r){var t;if(e.dato.grupo.id)return t={alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,year_id:e.dato.grupo.year_id},d.post("::matriculas/matricularuno",t).then(function(t){return t=t.data,a.matricula_id=t.id,a.grupo_id=t.grupo_id,a.estado="MATR",a.fecha_matricula_ant=t.fecha_matricula.date,a.fecha_matricula=new Date(t.fecha_matricula.date),c.success("Alumno matriculado con éxito","Matriculado"),r&&e.traerAlumnnosConGradosAnterior(),a},function(e){return c.error("No se pudo matricular el alumno.","Error")});c.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.eliminarFormulario=function(a){if(confirm("¿Seguro que desea eliminar este formulario?"))return d.delete("::matriculas/destroy/"+a.matricula_id).then(function(r){return a.currentyear=0,c.success("Alumno desmatriculado"),e.selectGrupo(e.dato.grupo)},function(e){return c.error("No se pudo desmatricular","Problema")})},e.cambiaEpsCheck=function(a){return e.verificandoEps=!0,d.put("::alumnos/eps-check",{texto:a}).then(function(a){return e.eps_match=a.data.eps,e.verificandoEps=!1,e.eps_match.map(function(e){return e.eps})})},e.reMatricularUno=function(a){var r;if(e.dato.grupo.id)return r={matricula_id:a.matricula_id},d.put("::matriculas/re-matricularuno",r).then(function(e){return e=e.data,c.success("Alumno rematriculado","Matriculado"),a},function(e){return c.error("No se pudo matricular el alumno.","Error")});c.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.matricularEn=function(a){return s.open({templateUrl:"==alumnos/matricularEn.tpl.html",controller:"MatricularEnCtrl",resolve:{alumno:function(){return a},grupos:function(){return e.grupos},USER:function(){return e.USER}}}).result.then(function(a){return console.log("Cierra"),e.traerAlumnnosConGradosAnterior()})},e.setAsistente=function(a){return d.put("::matriculas/set-asistente",{matricula_id:a.matricula_id,grupo_id:e.dato.grupo.grupo_id}).then(function(e){return c.success("Guardado como asistente")},function(e){return c.error("No se pudo guardar como asistente","Error")})},e.setFormulario=function(a){return e.setPrematriculado(a,"FORM")},e.setPrematriculado=function(a,r){return r||(r="PREM"),d.put("::matriculas/prematricular",{alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,estado:r}).then(function(a){return console.log("Cambios guardados"),e.traerAlumnnosConGradosAnterior()},function(e){return c.error("No se pudo crear asistente","Error")})},e.setNewAsistente=function(a){return d.put("::matriculas/set-new-asistente",{alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id}).then(function(a){return console.log("Cambios guardados"),e.traerAlumnnosConGradosAnterior()},function(e){return c.error("No se pudo crear asistente","Error")})},e.cambiarFechaRetiro=function(e){return d.put("::matriculas/cambiar-fecha-retiro",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return c.success("Fecha retiro guardada")},function(a){return e.fecha_retiro=e.fecha_retiro_ant,c.error("No se pudo guardar la fecha","Error")})},e.cambiarFechaMatricula=function(e){return d.put("::matriculas/cambiar-fecha-matricula",{matricula_id:e.matricula_id,fecha_matricula:e.fecha_matricula}).then(function(e){return c.success("Fecha matrícula guardada")},function(a){return e.fecha_matricula=e.fecha_matricula_ant,c.error("No se pudo guardar la fecha","Error")})},e.desertar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),d.put("::matriculas/desertar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return c.success("Alumno desertado")},function(e){return c.error("No se pudo desertar","Problema")})},e.retirar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),d.put("::matriculas/retirar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return c.success("Alumno retirado")},function(e){return c.error("No se pudo desmatricular","Problema")})},e.buscar_por=function(a){if(""!==e.texto_a_buscar)return d.put("::buscar/por-"+a,{texto_a_buscar:e.texto_a_buscar}).then(function(a){return e.alumnos_encontrados=a.data},function(e){return c.error("No se pudo buscar","Problema")});c.warning("Escriba término a buscar")},e.exportarAlumnos=function(){return p.download("::simat/alumnos-exportar","Alumnos a importar "+e.USER.year+".xls")},e.importarSimat=function(r,t){if(e.f=r,e.errFile=t&&t[0],r)return r.upload=m.upload({url:a.Server+"importar/algo/"+e.USER.year,data:{file:r}}),r.upload.then(function(e){return $timeout(function(){return r.result=e.data})},function(a){if(a.status>0)return e.errorMsg=a.status+": "+a.data},function(e){return r.progress=Math.min(100,parseInt(100*e.loaded/e.total))})},e.verObservacionesRequisitos=function(){return e.viendo_requisitos=!e.viendo_requisitos,e.viendo_requisitos?d.put("::requisitos/listado-observaciones").then(function(a){return e.requisitos=a.data.requisitos},function(){return c.error("Error trayendo observaciones de requisitos")}):e.viendo_observaciones_requisitos=!1},e.requisitoSeleccionado=function(a){return e.viendo_observaciones_requisitos=!0,e.alumnos_observaciones=a.alumnos_observaciones},e.guardarCambioRequisito=function(e){return d.post("::requisitos/alumno",e).then(function(e){return c.success("Requisito actualizado")},function(e){return c.error("Cambio no guardado","Error")})},e.$on("alumnoguardado",function(a,r){return e.gridOptions.data.push(r)})}]).controller("RemoveAlumnoCtrl",["$scope","$uibModalInstance","alumno","$http","toastr","App",function(e,a,r,t,n,o){return e.alumno=r,e.perfilPath=o.images+"perfil/",e.ok=function(){return t.delete("::alumnos/destroy/"+r.alumno_id).then(function(e){return n.success("Alumno enviado a la papelera.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("RequisitosCtrl",["$scope","App","$state","$interval","$uibModal","$filter","AuthService","toastr","$http",function(e,a,r,t,n,o,i,s,u){i.verificar_acceso(),e.requisitos=[],e.mostrar_crear=!1,e.guardando=!1,e.req_nuevo={requisito:"",descripcion:""},u.put("::requisitos").then(function(a){return e.years_requisitos=a.data},function(e){return s.error("No se pudo traer los requisitos")}),e.crear_requisito=function(a){return e.mostrar_crear=!0,e.req_nuevo.year_id=a.id,e.req_nuevo.year=a.year},e.guardar_nuevo=function(){return e.guardando=!0,u.post("::requisitos/store",e.req_nuevo).then(function(a){var r,t,n,o;for(r=0,t=(n=e.years_requisitos).length;r<t;r++)o=n[r],console.log("oNO",o,a.data.requisito.year_id),o.id===a.data.requisito.year_id&&(console.log(o,a.data.requisito.year_id),o.requisitos.push(a.data.requisito));return e.mostrar_crear=!1,e.guardando=!1,e.req_nuevo={requisito:"",descripcion:""}},function(a){return s.error("No se pudo crear"),e.guardando=!1})},e.guardar_cambios=function(a){return e.guardando=!0,u.put("::requisitos/update",a).then(function(a){return e.mostrar_editar=!1,e.guardando=!1},function(a){return s.error("No se pudo crear"),e.guardando=!1})},e.editar=function(a,r){return a.year=r.year,a.year_id=r.id,e.mostrar_editar=!0,e.req_edit=a},e.eliminar=function(a){return n.open({templateUrl:"==alumnos/removeRequisito.tpl.html",controller:"RemoveRequisitoCtrl",resolve:{elemento:function(){return a}}}).result.then(function(a){var r,t,n,o,i,s;for(s=[],t=r=0,n=(o=e.requisitos).length;r<n;t=++r)i=o[t],a.id===i.id?s.push(e.requisitos.splice(t,1)):s.push(void 0);return s},function(){})}}]).controller("RemoveRequisitoCtrl",["$scope","$uibModalInstance","elemento","$http","toastr","App",function(e,a,r,t,n,o){return e.elemento=r,e.perfilPath=o.images+"perfil/",e.ok=function(){return t.delete("::requisitos/destroy/"+r.id).then(function(e){return n.success("Requisito removido.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").directive("personaBasicoDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}alumnos/personaBasicoDir.tpl.html`}}]).directive("personaMatriculasDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}alumnos/personaMatriculasDir.tpl.html`}}]).directive("personaNeeDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}alumnos/personaNeeDir.tpl.html`}}]).directive("personaDatosExtrasDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}alumnos/personaDatosExtrasDir.tpl.html`}}]).directive("personaEnfermeriaDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}alumnos/personaEnfermeriaDir.tpl.html`}}]).directive("personaAcudientesDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}alumnos/personaAcudientesDir.tpl.html`}}]).controller("PersonaCtrl",["$scope","$state","$http","toastr","$uibModal","App","$rootScope","$timeout","AuthService",function(e,a,r,t,n,o,i,s,u){var l,c,d,p,m,f;e.data={},e.alumno={},e.religiones=o.religiones,e.tipos_sangre=o.tipos_sangre,e.dato={},e.hasRoleOrPerm=u.hasRoleOrPerm,e.enfermedia_cargada=!1,e.opciones_programar=o.opciones_programar,e.sangres=o.sangres,e.mostrar_mas=!1,e.mostrar_compromisos=!1,e.mostrar_prematricula=!0,e.gridScope=e,e.gridOptions={},e.gridOptionsAcudientes={},e.parentescos=o.parentescos,e.new_suceso={fecha_suceso:new Date,signo_fc:60,signo_fr:12,signo_t:35.5},localStorage.mostrar_mas_deta_alum&&(e.mostrar_mas="true"===localStorage.mostrar_mas_deta_alum),localStorage.mostrar_compromisos&&(e.mostrar_compromisos="true"===localStorage.mostrar_compromisos),localStorage.mostrar_prematricula&&(e.mostrar_prematricula="true"===localStorage.mostrar_prematricula),"alumno"===a.params.tipo&&r.put("::alumnos/show",{id:a.params.persona_id,con_grupos:!0}).then(function(a){var t,n,o,i,s,u,l,c,d,p,m,f,g,_,h,v,b;for(e.grupos=a.data.grupos,e.grupos_siguientes=a.data.grupos_siguientes,e.tipos_doc=a.data.tipos_doc,e.alumno=a.data.alumno,e.matriculas=a.data.matriculas,e.alum_copy=angular.copy(e.alumno),e.alumno.next_year.estado_ant=e.alumno.next_year.estado,e.alumno.ciudad_nac_id=e.alumno.ciudad_nac,e.alumno.ciudad_doc_id=e.alumno.ciudad_doc,e.alumno.fecha_retiro=e.alumno.fecha_retiro?new Date(e.alumno.fecha_retiro.replace(/-/g,"/")):e.alumno.fecha_retiro,e.alumno.fecha_matricula=e.alumno.fecha_matricula?new Date(e.alumno.fecha_matricula.replace(/-/g,"/")):e.alumno.fecha_matricula,e.alumno.fecha_nac=e.alumno.fecha_nac?new Date(e.alumno.fecha_nac.replace(/-/g,"/")):e.alumno.fecha_nac,e.alumno.llevo_formulario=e.alumno.llevo_formulario?new Date(e.alumno.llevo_formulario):e.alumno.llevo_formulario,e.alumno.llevo_formulario_bool=e.alumno.llevo_formulario?"Si":"No",e.cant_compromisos=0,n=0,u=(f=e.opciones_programar).length;n<u;n++){for(m=f[n],o=0,l=(g=e.matriculas).length;o<l;o++)(p=g[o]).programar===m.opcion&&(p.programar=m),p.efectuar_una===m.opcion&&(p.efectuar_una=m);e.alumno.programar===m.opcion&&(e.dato.programar=m,e.cant_compromisos++),e.alumno.efectuar_una===m.opcion&&(e.dato.efectuar_una=m,e.cant_compromisos++),e.alumno.next_year.programar===m.opcion&&(e.dato.programar_next=m),e.alumno.next_year.efectuar_una===m.opcion&&(e.dato.efectuar_una_next=m)}if(e.alumno.next_year)for(e.alumno.next_year.prematriculado=e.alumno.next_year.prematriculado?new Date(e.alumno.next_year.prematriculado.replace(/-/g,"/")):e.alumno.next_year.prematriculado,e.alumno.next_year.fecha_matricula=e.alumno.next_year.fecha_matricula?new Date(e.alumno.next_year.fecha_matricula.replace(/-/g,"/")):e.alumno.next_year.fecha_matricula,i=0,c=(_=e.grupos_siguientes).length;i<c;i++)(t=_[i]).id===e.alumno.next_year.grupo_id&&(e.dato.grupo_prematr=t);if(null===e.alumno.ciudad_nac?(e.alumno.pais_nac={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisNacSelect(e.alumno.pais_nac,e.alumno.pais_nac)):r.get("::ciudades/datosciudad/"+e.alumno.ciudad_nac).then(function(a){return a=a.data,e.paises=a.paises,e.departamentosNac=a.departamentos,e.ciudadesNac=a.ciudades,e.alumno.pais_nac=a.pais,e.alumno.departamento_nac=a.departamento,e.alumno.ciudad_nac=a.ciudad}),e.alumno.ciudad_doc>0?r.get("::ciudades/datosciudad/"+e.alumno.ciudad_doc).then(function(a){return a=a.data,e.paises=a.paises,e.departamentos=a.departamentos,e.ciudades=a.ciudades,e.alumno.pais_doc=a.pais,e.alumno.departamento_doc=a.departamento,e.alumno.ciudad_doc=a.ciudad}):(e.alumno.pais_doc={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisSeleccionado(e.alumno.pais_doc,e.alumno.pais_doc)),e.alumno.ciudad_resid>0?r.get("::ciudades/datosciudad/"+e.alumno.ciudad_resid).then(function(a){return a=a.data,e.paises=a.paises,e.departamentosResid=a.departamentos,e.ciudadesResid=a.ciudades,e.alumno.pais_resid=a.pais,e.alumno.departamento_resid=a.departamento,e.alumno.ciudad_resid=a.ciudad}):(e.alumno.pais_resid={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisResidSelecionado(e.alumno.pais_resid,e.alumno.pais_resid)),e.alumno.tipo_doc){for(v=[],s=0,d=(h=e.tipos_doc).length;s<d;s++)(b=h[s]).id===e.alumno.tipo_doc?v.push(e.alumno.tipo_doc=b):v.push(void 0);return v}}),e.openDatePicker=function(e,a){return e[a]=!0},e.mostarMasDetalle=function(){return e.mostrar_mas=!e.mostrar_mas,localStorage.mostrar_mas_deta_alum=e.mostrar_mas},e.toggleNuevoRepite=function(e,a,n){var o;return n||(n=e.next_year.year_id),o={alumno_id:e.alumno_id,propiedad:a,valor:e.nuevo,year_id:e.next_year.year_id},r.put("::alumnos/guardar-valor",o).then(function(e){return console.log("Cambios guardados")},function(a){return e.nuevo=!e.nuevo,t.error("Cambio no guardado","Error")})},e.cerrarEdicionSuceso=function(){return e.editando_suceso=!1},e.editarSuceso=function(a){return e.act_suceso=a,e.editando_suceso=!0},e.eliminarSuceso=function(a){return n.open({templateUrl:"==alumnos/removeSuceso.tpl.html",controller:"RemoveSucesoCtrl",resolve:{elemento:function(){return a}}}).result.then(function(a){return e.gridOptions.data=$filter("filter")(e.gridOptions.data,{alumno_id:"!"+a.alumno_id})},function(){})},c='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<a uib-tooltip="Editar" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editarSuceso(row.entity)"><i class="fa fa-edit "></i></a>'+'<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminarSuceso(row.entity)"><i class="fa fa-trash "></i></a>'+"</span>",d="==directives/botonPresionArterial.tpl.html",e.gridOptions={showGridFooter:!0,showColumnFooter:!0,showFooter:!0,enableSorting:!0,enableFiltering:!0,enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"no",cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{name:"edicion",displayName:"Edit",width:55,enableSorting:!1,enableFiltering:!1,cellTemplate:c,enableCellEdit:!1,enableColumnMenu:!0},{field:"fecha_suceso",displayName:"Fecha matrícula",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"signo_fc",displayName:"Frec cardiaca",minWidth:60,enableColumnMenu:!0,type:"number"},{field:"signo_fr",displayName:"Frec respiratoria",minWidth:60,type:"number"},{field:"signo_t",displayName:"Temperatura",minWidth:60,type:"number"},{field:"signo_glu",displayName:"Glucometría",minWidth:60,type:"number"},{field:"signo_spo2",displayName:"SPO2",minWidth:60,type:"number"},{field:"signo_pa_dia",displayName:"Presión arterial",cellTemplate:d,minWidth:60,enableCellEdit:!1},{field:"asignatura",displayName:"Asignatura",minWidth:70},{field:"motivo_consulta",displayName:"Motivo consulta",minWidth:120},{field:"descripcion_suceso",displayName:"Descripción suceso",minWidth:120},{field:"tratamiento",displayName:"Tratamiento",minWidth:120},{field:"observaciones",displayName:"Observaciones",minWidth:120},{field:"insumos_utilizados",displayName:"insumos_utilizados",minWidth:120},{field:"created_by_name",displayName:"Creado por",minWidth:90},{field:"updated_by_name",displayName:"Actualizado por",minWidth:90}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,n,o,i){if(o!==i)return r.put("::enfermeria/guardar-valor-suceso",{suceso_id:a.id,propiedad:n.field,valor:o}).then(function(e){return t.success("Suceso actualizado")},function(e){return a[n.field]=i,t.error("Cambio no guardado","Error")}),e.$apply()})}},e.eliminarAlumno=function(){return e.eliminando=!0,n.open({templateUrl:"==alumnos/removeAlumno.tpl.html",controller:"RemoveAlumnoCtrl",resolve:{alumno:function(){return e.alumno}}}).result.then(function(r){return a.reload(),e.eliminando=!1},function(){return e.eliminando=!1})},e.restaurarAlumno=function(){return e.restaurando=!0,r.put("::alumnos/restore/"+e.alumno.alumno_id).then(function(e){return a.reload()},function(a){return t.error("Alumno no restaurado","Error"),e.restaurando=!1})},e.asignarAOtro=function(e){return n.open({templateUrl:"==alumnos/asignarAcudienteAOtro.tpl.html",controller:"AsignarAcudienteAOtroModalCtrl",resolve:{elemento:function(){return e}}}).result.then(function(e){return t.success("Asignado.")})},l='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<a uib-tooltip="Cambiar" ng-show="row.entity.nombres" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.cambiarAcudiente(row.entity, row.entity)" tooltip-append-to-body="true"><i class="fa fa-edit "></i></a>'+'<a uib-tooltip="Quitar parentesco" ng-show="row.entity.nombres" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.quitarAcudiente(row.entity, row.entity)" tooltip-append-to-body="true"><i class="fa fa-trash "></i></a>'+'<a uib-tooltip="Asignar también a otro alumno" class="btn btn-default btn-xs shiny" ng-click="grid.appScope.asignarAOtro(row.entity)" tooltip-append-to-body="true" style="height: 24px;">Compartir con...</a>'+"</span>",p={name:"edicion"},m={name:"usuario"},(f=!u.hasRoleOrPerm(["psicólogo","enfermero"]))&&(p={name:"edicion",displayName:"Edición",width:170,enableSorting:!1,enableFiltering:!1,cellTemplate:l,enableCellEdit:!1}),f&&(m={name:"Usuario",field:"username",minWidth:135,cellTemplate:"==directives/botonesResetPassword.tpl.html",editableCellTemplate:"==alumnos/botonEditUsername.tpl.html"}),e.gridOptionsAcudientes={enableSorting:!0,enableFiltering:!0,enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:f,columnDefs:[p,{name:"Id",field:"id",minWidth:60,enableCellEdit:!1},{name:"Nombres",field:"nombres",minWidth:120},{name:"Apellidos",field:"apellidos",minWidth:100},{name:"Sex",field:"sexo",minWidth:40},{name:"Parentesco",field:"parentesco",minWidth:90},m,{name:"Documento",field:"documento",minWidth:100,cellFilter:"formatNumberDocumento"},{name:"Teléfono",field:"telefono",minWidth:90},{name:"Celular",field:"celular",minWidth:90},{name:"Ocupación",field:"ocupacion",minWidth:100},{name:"Fecha nac",field:"fecha_nac",cellFilter:"date:mediumDate",type:"date",minWidth:120}],multiSelect:!1,onRegisterApi:function(a){if(e.gridApi=a,f)return a.edit.on.afterCellEdit(e,function(a,n,o,i){if(o!==i)return"sexo"===n.field&&"M"!==(o=o.toUpperCase())&&"F"!==o?(t.warning("Debe usar M o F"),void(a.sexo=i)):"email"!==n.field||/\S+@\S+\.\S+/.test(o)?(r.put("::acudientes/guardar-valor",{parentesco_id:a.parentesco_id,acudiente_id:a.id,user_id:a.user_id,propiedad:n.field,valor:o}).then(function(e){return t.success("Acudiente actualizado con éxito")},function(e){return a[n.field]=i,t.error("Cambio no guardado","Error")}),e.$apply()):(t.warning("Email no válido"),void(a.email=i))})}},e.$on("alumnoguardado",function(e,r){return a.go("panel.persona",{persona_id:r.id,tipo:"alumno"})}),e.guardar_valor_suceso=function(e,a,n){return r.put("::enfermeria/guardar-valor-suceso",{suceso_id:e.id,propiedad:a,valor:n}).then(function(e){return t.success("Suceso actualizado")},function(e){return t.error("Cambio no guardado","Error")})},e.crear_alumno=function(){return i.grupos_siguientes=e.grupos_siguientes,a.go("panel.persona.nuevo")},e.cargarAcudientes=function(){return r.put("::acudientes/de-persona",{alumno_id:e.alumno.alumno_id}).then(function(a){var r,t,n,o;for(r=0,t=(o=a.data.acudientes).length;r<t;r++)(n=o[r]).fecha_nac_ant=n.fecha_nac,n.fecha_nac=n.fecha_nac?new Date(n.fecha_nac.replace(/-/g,"/")):n.fecha_nac;return e.gridOptionsAcudientes.data=a.data.acudientes,e.acudientes_cargado=!0})},e.crearUsuario=function(a){if(a.user_id)t.warning("Ya tiene usuario");else{if(a.id)return r.post("::acudientes/crear-usuario",{acudiente:a}).then(function(r){return e.usuario_creado=!0,a.user_id=r.data.id,a.username=r.data.username,t.success("Usuario creado")},function(){return t.error("No se pudo crear el usuario")});t.info("Solo con acudientes creados")}},e.crear_suceso=function(){return e.creando_suceso=!0},e.cargarEnfermeria=function(){return r.put("::enfermeria/datos",{alumno_id:e.alumno.alumno_id}).then(function(a){var r,t,n,o,i,s,u,l;for(r=0,n=(i=e.sangres).length;r<n;r++)l=i[r],e.alumno.tipo_sangre===l.sangre&&(e.dato.tipo_sangre=l);for(t=0,o=(s=a.data.registros_enfermeria).length;t<o;t++)(u=s[t]).fecha_suceso=new Date(u.fecha_suceso),u.signo_t=parseFloat(u.signo_t);return e.enfermeria=a.data.antecedentes,e.gridOptions.data=a.data.registros_enfermeria,e.enfermedia_cargada=!0})},e.guardar_nuevo_suceso=function(a){return e.guardando_suceso=!0,a.alumno_id=e.alumno.alumno_id,r.post("::enfermeria/crear-suceso",a).then(function(a){return e.guardando_suceso=!1,e.gridOptions.data.push(a.data)},function(){return t.error("Error creando suceso"),e.guardando_suceso=!1})},r.get("::paises").then(function(a){return e.paises=a.data}),e.toggleMostrarCompromisos=function(){return e.mostrar_compromisos=!e.mostrar_compromisos,localStorage.mostrar_compromisos=e.mostrar_compromisos},e.toggleMostrarPrematricula=function(){return e.mostrar_prematricula=!e.mostrar_prematricula,localStorage.mostrar_prematricula=e.mostrar_prematricula},e.religionSelected=function(a,r){if(e.religiones.indexOf(a.religion)>-1)return e.guardarValor(a,"religion",a.religion)},e.llevo_formulario=function(a){var n;return n={alumno_id:a.alumno_id,llevo_formulario:null,year:e.USER.year+1},a.llevo_formulario||(n.llevo_formulario=new Date),r.put("::prematriculas/llevo-formulario",n).then(function(e){return t.success("Dato guardado"),a.llevo_formulario?(a.llevo_formulario_bool="No",a.llevo_formulario=null):(a.llevo_formulario_bool="Si",a.llevo_formulario=n.llevo_formulario)},function(){return t.error("Error cambiando si llevó formulario")})},e.paisNacSelect=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(r){if(e.departamentosNac=r.data,void 0===e.alumno.pais_doc)return e.alumno.pais_doc=a,e.paisSeleccionado(a)})},e.departNacSelect=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(r){if(e.ciudadesNac=r.data,void 0===e.alumno.departamento_doc)return e.alumno.departamento_doc=a,e.departSeleccionado(a)})},e.paisSeleccionado=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentos=a.data})},e.departSeleccionado=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.paisResidSelecionado=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentosResid=a.data})},e.departResidSeleccionado=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudadesResid=a.data})},e.ciudadSeleccionada=function(a,r){return e.guardarValor(e.alumno,r,a.id)},e.dateOptions={formatYear:"yyyy"},e.restarEstrato=function(){if(e.alumno.estrato>0)return e.alumno.estrato=e.alumno.estrato-1},e.sumarEstrato=function(){if(e.alumno.estrato<10)return e.alumno.estrato=parseInt(e.alumno.estrato)+1},e.cambiarGrupo=function(){if(e.hasRoleOrPerm(["admin","secretario","rector"]))return n.open({templateUrl:"==alumnos/matricularEn.tpl.html",controller:"MatricularEnCtrl",resolve:{alumno:function(){return e.alumno},grupos:function(){return e.grupos},USER:function(){return e.USER}}}).result.then(function(a){var r,t,n,o,i;for(i=[],t=0,n=(o=e.grupos).length;t<n;t++)(r=o[t]).id===a.grupo_id?(e.alumno.grupo_nombre=r.nombre,i.push(e.alumno.grupo_id=r.id)):i.push(void 0);return i})},e.persona_buscar="",e.templateTypeahead="==alumnos/personaTemplateTypeahead.tpl.html",e.personaCheck=function(a){return e.verificandoPersona=!0,r.put("::alumnos/personas-check",{texto:a,todos_anios:e.dato.todos_anios}).then(function(a){return e.personas_match=a.data.personas,e.personas_match.map(function(a){return a.perfilPath=e.perfilPath}),e.verificandoPersona=!1,e.personas_match})},e.cambiaEpsCheck=function(a){return e.verificandoEps=!0,r.put("::alumnos/eps-check",{texto:a}).then(function(a){return e.eps_match=a.data.eps,e.verificandoEps=!1,e.eps_match.map(function(e){return e.eps})})},e.ir_a_persona=function(e,r,t){var n;return n={persona_id:e.alumno_id,tipo:e.tipo},a.go("panel.persona",n)},e.religionEditPressEnter=function(a){return e.$broadcast(uiGridEditConstants.events.END_CELL_EDIT)},e.tipoDocSeleccionado=function(e,a){var n,o;return n={propiedad:"tipo_doc",valor:e.id},o="acudientes",a.subGridOptions?(o="alumnos",n.alumno_id=a.alumno_id):(n.acudiente_id=a.acudiente_id,n.parentesco_id=a.parentesco_id,n.user_acud_id=a.user_id),r.put("::"+o+"/guardar-valor",n).then(function(e){return t.success("Alumno(a) actualizado con éxito","Actualizado")},function(e){return a.tipo_doc=oldValue,t.error("Cambio no guardado","Error")})},e.matricularUno=function(a,n){var o;if(e.dato.grupo.id)return o={alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,year_id:e.USER.year_id},r.post("::matriculas/matricularuno",o).then(function(r){return r=r.data,a.matricula_id=r.id,a.grupo_id=r.grupo_id,a.estado="MATR",a.fecha_matricula_ant=r.fecha_matricula.date,a.fecha_matricula=new Date(r.fecha_matricula.date),t.success("Alumno matriculado con éxito","Matriculado"),n&&e.traerAlumnnosConGradosAnterior(),a},function(e){return t.error("No se pudo. Tal vez no tienes permiso.","Error")});t.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.cambiaEpsCheck=function(a){return e.verificandoEps=!0,r.put("::alumnos/eps-check",{texto:a}).then(function(a){return e.eps_match=a.data.eps,e.verificandoEps=!1,e.eps_match.map(function(e){return e.eps})})},e.reMatricularUno=function(e){var a;return a={matricula_id:e.matricula_id},r.put("::matriculas/re-matricularuno",a).then(function(a){return a=a.data,t.success("Alumno rematriculado","Matriculado"),e},function(e){return t.error("No se pudo. Tal vez no tienes permiso.","Error")})},e.setAsistente=function(a){return r.put("::matriculas/set-asistente",{matricula_id:a.matricula_id,grupo_id:e.alumno.grupo_id}).then(function(e){return t.success("Guardado como asistente")},function(e){return t.error("No se pudo. Tal vez no tienes permiso.","Error")})},e.cambiarFechaRetiro=function(e){return r.put("::matriculas/cambiar-fecha-retiro",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return t.success("Fecha retiro guardada")},function(a){return e.fecha_retiro=e.fecha_retiro_ant,t.error("No se pudo. Tal vez no tienes permiso.","Error")})},e.cambiarFechaMatricula=function(e){return r.put("::matriculas/cambiar-fecha-matricula",{matricula_id:e.matricula_id,fecha_matricula:e.fecha_matricula}).then(function(e){return t.success("Fecha matrícula guardada")},function(a){return e.fecha_matricula=e.fecha_matricula_ant,t.error("No se pudo. Tal vez no tienes permiso.","Error")})},e.desertar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),r.put("::matriculas/desertar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return t.success("Alumno desertado")},function(e){return t.error("No se pudo desertar. Tal vez no tienes permiso.","Problema")})},e.retirar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),r.put("::matriculas/retirar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return t.success("Alumno retirado")},function(e){return t.error("No se pudo desmatricular. Tal vez no tienes permiso.","Problema")})},e.prematricular=function(a){var n;if(!e.prematriculando){if(e.dato.grupo_prematr)return e.prematriculando=!0,n={matricula_id:a.next_year.matricula_id,alumno_id:a.alumno_id,grupo_id:e.dato.grupo_prematr.id,year_id:a.next_year.year_id},r.put("::matriculas/prematricular",n).then(function(a){return t.success("Alumno prematriculado"),e.prematriculando=!1,a.data.matricula.prematriculado=new Date(a.data.matricula.prematriculado.replace(/-/g,"/")),e.alumno.next_year=a.data.matricula,s(function(){return e.$apply()},100)},function(a){return t.error("Tal vez no existe el "+(e.USER.year+1),"Problema"),e.prematriculando=!1});t.warning("Debe seleccionar el grupo")}},e.cambiaUsernameCheck=function(a){return e.username_cambiado=!0,e.verificandoUsername=!0,r.put("::users/usernames-check",{texto:a}).then(function(a){return e.username_match=a.data.usernames,e.verificandoUsername=!1,e.username_match.map(function(e){return e.username})})},e.resetPass=function(e){if(e.user_id)return n.open({templateUrl:o.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){});t.warning("Aún no tiene usuario")},e.set_estado_next_matricula=function(a){var n,o,i,u,l;if(!e.matriculando){if(e.dato.grupo_prematr){if("MATR"===a.next_year.estado){for(o=0,i=0,u=(l=e.matriculas[0].requisitos).length;i<u;i++)"falta"===l[i].estado&&(o+=1);if(o>0){if(!confirm("A este estudiante aún le falta por cumplir "+(1===o?o+" requisito.":o+" requisitos. ")+" ¿Desea matricular de todos modos?"))return void(e.alumno.next_year.estado=e.alumno.next_year.estado_ant);console.log(e.alumno.next_year.estado,e.alumno.next_year.estado_ant)}}return e.matriculando=!0,n={matricula_id:a.next_year.matricula_id,alumno_id:a.alumno_id,grupo_id:e.dato.grupo_prematr.id,year_id:a.next_year.year_id,estado:a.next_year.estado},r.put("::matriculas/prematricular",n).then(function(a){return t.success("Cambios guardados"),e.matriculando=!1,a.data.matricula.prematriculado=a.data.matricula.prematriculado?new Date(a.data.matricula.prematriculado.replace(/-/g,"/")):a.data.matricula.prematriculado,e.alumno.next_year=a.data.matricula,e.alumno.next_year.estado_ant=e.alumno.next_year.estado,s(function(){return e.$apply()},100)},function(a){return t.error("Tal vez no existe el "+(e.USER.year+1),"Problema"),e.matriculando=!1})}t.warning("Debe seleccionar el grupo")}},e.quitarPrematricula=function(a){var n;if(!e.prematriculando)return e.prematriculando=!0,n={matricula_id:a.next_year.matricula_id},r.put("::matriculas/quitar-prematricula",n).then(function(a){return t.success("Matrícula quitada"),e.prematriculando=!1,e.alumno.next_year={}},function(a){return t.error("No se pudo quitar","Problema"),e.prematriculando=!1})},e.cambiarPazysalvo=function(a){var n;if(e.hasRoleOrPerm(["admin","secretario","rector"]))return a.pazysalvo=!a.pazysalvo,a.alumno_id||(a.alumno_id=a.id),n={alumno_id:a.alumno_id,propiedad:"pazysalvo",valor:a.pazysalvo},r.put("::alumnos/guardar-valor",n).then(function(e){return console.log("Cambios guardados")},function(e){return a.pazysalvo=!a.pazysalvo,t.error("Cambio no guardado","Error")})},e.guardarCambioRequisito=function(e){return r.post("::requisitos/alumno",e).then(function(e){return t.success("Requisito actualizado")},function(e){return t.error("Cambio no guardado","Error")})},e.guardarValor=function(a,n,o,i){var s;if(s={},"username"===n){if(!e.username_cambiado)return;s.user_id=a.user_id}if("email"===n&&(s.user_id=a.user_id,o.length>0&&!window.validateEmail(o)))t.warning("No es un correo válido");else{if(a.alumno_id||(a.alumno_id=a.id),"sexo"===n&&"M"!==(o=o.toUpperCase())&&"F"!==o)return t.warning("Debe usar M o F"),void(a.sexo=e.alum_copy.sexo);if("tipo_sangre"===n&&(o=o.toUpperCase(),!(e.tipos_sangre.indexOf(o)>-1)))return t.warning("Debe usar: "+e.tipos_sangre.join(" ")),void(a.tipo_sangre=e.alum_copy.tipo_sangre);if("estrato"===n&&(o<0||o>9))return t.warning("Valor no admitido"),void(a.estrato=e.alum_copy.estrato);if("documento"!==n||10===o.length||0===o.length)return s.alumno_id=a.alumno_id,s.propiedad=n,s.valor=o,s.year_id=a.year_id,i&&(s.year_id=i),r.put("::alumnos/guardar-valor",s).then(function(a){if(t.success("Alumno(a) actualizado con éxito"),"tipo_sangre"===n)return e.alumno.tipo_sangre=o},function(r){return a[n]=e.alum_copy[n],t.error("Cambio no guardado","Error")});t.warning("Debe ser de diez dígitos")}},e.guardarValorEnfermeria=function(e,a,n){var o;return(o={}).antec_id=e.id,o.propiedad=a,o.valor=n,r.put("::enfermeria/guardar-valor",o).then(function(e){return t.success("Enfermería actualizada")},function(e){return t.error("Cambio no guardado","Error")})},e.verTodosLosCertificados=function(){return a.go("panel.persona.ver_todos_los_certificados",{alumno_id:e.alumno.alumno_id},{reload:!0})},e.agregarAcudiente=function(){return delete i.acudiente_cambiar,e.alumno.parientes=e.gridOptionsAcudientes.data,n.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return e.alumno},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(a){return e.gridOptionsAcudientes.data.splice(e.alumno.parientes.length-1,0,a)},function(){})},e.cambiarAcudiente=function(a){return i.acudiente_cambiar=a,n.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return e.alumno},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(r){var t,n,o,i,s,u;for(u=[],n=t=0,o=(s=e.gridOptionsAcudientes.data).length;t<o;n=++t)(i=s[n])&&i.id===a.id?u.push(e.gridOptionsAcudientes.data.splice(n,1,r)):u.push(void 0);return u},function(){})},e.quitarAcudiente=function(a){return n.open({templateUrl:"==alumnos/quitarAcudienteModalConfirm.tpl.html",controller:"QuitarAcudienteModalConfirmCtrl",resolve:{alumno:function(){return e.alumno},acudiente:function(){return a}}}).result.then(function(a){var r,t,n,o,i,s;for(s=[],t=r=0,n=(i=e.gridOptionsAcudientes.data).length;r<n;t=++r)(o=i[t])&&o.id===a.acudiente_id?s.push(e.gridOptionsAcudientes.data.splice(t,1)):s.push(void 0);return s},function(){})}}]).controller("RemoveSucesoCtrl",["$scope","$uibModalInstance","elemento","$http","toastr","App",function(e,a,r,t,n,o){return e.elemento=r,e.ok=function(){return t.delete("::enfermeria/destroy/"+r.id).then(function(e){return n.success("Suceso eliminado.","Eliminado")},function(e){return n.warning("No se pudo eliminar.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("VerTodosLosCertificadosCtrl",["$scope","App","$state","$interval","$uibModal","$filter","AuthService","toastr","$http",function(e,a,r,t,n,o,i,s,u){i.verificar_acceso(),console.log(r),u.put("::certificados-persona",{alumno_id:r.params.alumno_id}).then(function(a){return console.log(a.data),e.certificados=a.data},function(e){return s.error("No se pudo traer los requisitos")})}])}.call(this),function(){angular.module("myvcFrontApp").directive("selectorGrupoDir",["App","Perfil",function(e,a){return{restrict:"EA",templateUrl:"==grados/selectorGrupoDir.tpl.html",controller:["$scope","App",function(e,a){}]}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("AlumnosNewCtrl",["$scope","$rootScope","toastr","$http","$filter","$state",function(e,a,r,t,n,o){e.data={},e.$state=o,e.data.proceso="matriculando",e.formatear_nuevo=function(){return e.alumno={no_matricula:"",nombres:"",apellidos:"",sexo:"M",documento:"",password:"1234567",fecha_nac:new Date("2000-06-26"),tipo_sangre:{},eps:"",telefono:"",celular:"",direccion:"",barrio:"",estrato:1,email:"@gmail.com",foto:"perfil/default_male.jpg",pazysalvo:!0,deuda:0,nuevo:0,repitente:0,pais_nac:{id:1,pais:"COLOMBIA",abrev:"CO"}}},e.formatear_nuevo(),e.sangres=[{sangre:"O+"},{sangre:"O-"},{sangre:"A+"},{sangre:"A-"},{sangre:"B+"},{sangre:"B-"},{sangre:"AB+"},{sangre:"AB-"}],localStorage.mostrar_mas_new&&(e.mostrar_mas_new="true"===localStorage.mostrar_mas_new),t.get("::paises").then(function(a){return a=a.data,e.paises=a,e.pais_nac=a[0],e.paisNacSelect(a[0],e.pais_nac)},function(){return console.log("No se pudo traer los paises")}),t.get("::tiposdocumento").then(function(a){return e.tipos_doc=a.data}),e.persona_buscar="",e.templateTypeahead="==alumnos/personaTemplateTypeahead.tpl.html",e.templateTypeDoc="==alumnos/documentoTemplateTypeahead.tpl.html",e.personaCheck=function(a){return e.verificandoPersona=!0,t.put("::alumnos/personas-check",{texto:a,todos_anios:e.dato.todos_anios}).then(function(a){return e.personas_match=a.data.personas,e.personas_match.map(function(a){return a.perfilPath=e.perfilPath}),e.verificandoPersona=!1,e.personas_match})},e.documentoCheck=function(a){return e.verificandoDoc=!0,t.put("::alumnos/documento-check",{texto:a}).then(function(a){return e.personas_match=a.data.personas,e.personas_match.map(function(a){return a.perfilPath=e.perfilPath}),e.verificandoDoc=!1,e.personas_match})},e.seleccionarPersona=function(e,a,t){return r.info("Esta persona ya existe, búscala en Alumnos - Todos","No crear")},e.mostarMasDetalleNew=function(){return e.mostrar_mas_new=!e.mostrar_mas_new,localStorage.mostrar_mas_new=e.mostrar_mas_new},a.grupos_siguientes?(e.grupos_siguientes=a.grupos_siguientes,e.data.proceso="prematriculando"):t.get("::grupos/next-year").then(function(a){return e.grupos_siguientes=a.data},function(){return console.log("No se pudo traer los grupos del siguiente año")}),t.get("::grupos").then(function(a){return e.grupos=a.data},function(){return console.log("No se pudo traer los grupos")}),e.crear=function(i,s){return i.nombres=$.trim(i.nombres),i.apellidos=$.trim(i.apellidos),i.documento=$.trim(i.documento),e.guardando=!0,(i.grupo||"matriculando"!==s)&&(i.grupo_sig||"prematriculando"!==s)?0===i.nombres.length?(e.guardando=!1,void r.warning("Debe copiar el nombre.")):(i.fecha_nac=n("date")(i.fecha_nac,"yyyy-MM-dd"),"prematriculando"===s&&(i.prematricula=!0,i.grupo=i.grupo_sig),"formulario"===s&&(i.llevo_formulario=!0,i.grupo=i.grupo_sig),t.post("::alumnos/store",i).then(function(t){return r.success("Alumno "+t.data.nombres+" creado"),"prematriculando"===s&&o.go("panel.persona",{persona_id:t.data.id,tipo:"alumno"}),e.guardando=!1,a.grupos_siguientes=null,e.formatear_nuevo(),e.$emit("alumnoguardado",t.data)},function(a){return e.guardando=!1,r.warning("No se pudo guardar alumno","Problema")})):(e.guardando=!1,void r.warning("Debe seleccionar el grupo."))},e.paisNacSelect=function(a,r){return t.get("::ciudades/departamentos/"+a.id).then(function(r){if(e.departamentosNac=r.data,void 0===e.alumno.pais_doc)return e.alumno.pais_doc=a,e.paisSelecionado(a)})},e.departNacSelect=function(a){return t.get("::ciudades/por-departamento/"+a.departamento).then(function(r){if(e.ciudadesNac=r.data,void 0===e.alumno.departamento_doc)return e.alumno.departamento_doc=a,e.departSeleccionado(a)})},e.paisSelecionado=function(a,r){return t.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentos=a.data})},e.cambiaUsernameCheck=function(a){return e.verificandoUsername=!0,t.put("::users/usernames-check",{texto:a}).then(function(a){return e.username_match=a.data.usernames,e.verificandoUsername=!1,e.username_match.map(function(e){return e.username})})},e.departSeleccionado=function(a){return t.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yy"},e.restarEstrato=function(){if(e.alumno.estrato>0)return e.alumno.estrato=e.alumno.estrato-1},e.sumarEstrato=function(){if(e.alumno.estrato<10)return e.alumno.estrato=e.alumno.estrato+1}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("AlumnosEditCtrl",["$scope","$state","$http","toastr",function(e,a,r,t){e.data={},e.alumno={},e.sangres=[{sangre:"O+"},{sangre:"O-"},{sangre:"A+"},{sangre:"A-"},{sangre:"B+"},{sangre:"B-"},{sangre:"AB+"},{sangre:"AB-"}],r.get("::alumnos/show/"+a.params.alumno_id).then(function(a){if(e.alumno=a.data,a.data.user&&(e.alumno.username=a.data.user.username),a.data.user&&(e.alumno.email2=a.data.user.email),e.alumno.ciudad_nac_id=a.data.ciudad_nac,e.alumno.ciudad_doc_id=a.data.ciudad_doc,null===e.alumno.ciudad_nac?(e.alumno.pais_nac={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisNacSelect(e.alumno.pais_nac,e.alumno.pais_nac)):r.get("::ciudades/datosciudad/"+e.alumno.ciudad_nac_id).then(function(a){return e.paises=a.data.paises,e.departamentosNac=a.departamentos,e.ciudadesNac=a.ciudades,e.alumno.pais_nac=a.pais,e.alumno.departamento_nac=a.departamento,e.alumno.ciudad_nac=a.ciudad}),e.alumno.ciudad_doc>0)return r.get("::ciudades/datosciudad/"+e.alumno.ciudad_doc_id).then(function(a){return e.paises=a.data.paises,e.departamentos=a.departamentos,e.ciudades=a.ciudades,e.alumno.pais_doc=a.pais,e.alumno.departamento_doc=a.departamento,e.alumno.ciudad_doc=a.ciudad})}),r.get("::paises").then(function(a){return e.paises=a.data}),r.get("::tiposdocumento").then(function(a){return e.tipos_doc=a.data}),e.guardar=function(){return r.put("::alumnos/update/"+e.alumno.id,e.alumno).then(function(e){return t.success("Alumno actualizado correctamente")},function(e){return t.error("No se pudo guardar el alumno")})},e.paisNacSelect=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(r){if(e.departamentosNac=r.data,void 0===e.alumno.pais_doc)return e.alumno.pais_doc=a,e.paisSelecionado(a)})},e.departNacSelect=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(r){if(e.ciudadesNac=r.data,void 0===e.alumno.departamento_doc)return e.alumno.departamento_doc=a,e.departSeleccionado(a)})},e.paisSelecionado=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentos=a.data})},e.departSeleccionado=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yyyy"},e.restarEstrato=function(){if(e.alumno.estrato>0)return e.alumno.estrato=e.alumno.estrato-1},e.sumarEstrato=function(){if(e.alumno.estrato<10)return e.alumno.estrato=parseInt(e.alumno.estrato)+1}}])}.call(this),function(){angular.module("myvcFrontApp").controller("ListAlumnosCtrl",["$scope","App","$rootScope","$state","$interval","uiGridConstants","uiGridEditConstants","$uibModal","$filter","AuthService","toastr","$http","$stateParams",function(e,a,r,t,n,o,i,s,u,l,c,d,p){var m,f,g,_,h,v,b;return l.verificar_acceso(),e.dato={},e.dato.mostrartoolgrupo=!0,e.gridScope=e,e.views=a.views,e.perfilPath=a.images+"perfil/",e.year_ant=e.USER.year-1,e.gridOptions={},e.gridOptionsSinMatricula={},e.paises=[],e.religiones=a.religiones,e.tipos_sangre=a.tipos_sangre,e.mostrar_pasado=!1,e.mostrar_retirados=!1,e.es_titular=!0,e.parentescos=a.parentescos,e.dato.grupo="",d.get("::grupos/con-paises-tipos").then(function(a){var r,t,n,o,i,s;for(o=0,p.grupo_id&&(localStorage.matr_grupo=parseInt(p.grupo_id),o=parseInt(localStorage.matr_grupo)),e.grupos=a.data.grupos,e.paises=a.data.paises,e.tipos_doc=a.data.tipos_doc,e.grupos_titularia=a.data.grupos_titularia,s=[],t=0,n=(i=e.grupos).length;t<n;t++)r=i[t],parseInt(r.id)===parseInt(o)?(e.dato.grupo=r,s.push(e.selectGrupo(e.dato.grupo))):s.push(void 0);return s}),e.selectGrupo=function(a){var r,t,n;for(localStorage.matr_grupo=a.id,e.dato.grupo=a,r=0,t=(n=e.grupos).length;r<t;r++)n[r].active=!1;return a.active=!0,l.hasRoleOrPerm("Profesor")&&(a.es_titular?e.es_titular=!0:e.es_titular=!1),e.traerAlumnnos=function(){return d.put("::grupos/alumnos-con-datos",{grupo_actual:a}).then(function(a){var r,t,n,o,i,s,u,l,p,m,f,g;for(e.gridOptions.data=a.data.AlumnosActuales,t=0,i=(p=e.gridOptions.data).length;t<i;t++){for((r=p[t]).fecha_nac=r.fecha_nac?new Date(r.fecha_nac.replace(/-/g,"/")):r.fecha_nac,n=0,s=(m=e.tipos_doc).length;n<s;n++)(g=m[n]).id===r.tipo_doc&&(r.tipo_doc=g);for(o=0,u=(f=r.subGridOptions.data).length;o<u;o++)(l=f[o]).fecha_nac_ant=l.fecha_nac,l.fecha_nac=l.fecha_nac?new Date(l.fecha_nac.replace(/-/g,"/")):l.fecha_nac;if(!e.es_titular)return;r.subGridOptions.onRegisterApi=function(a){return a.edit.on.afterCellEdit(e,function(a,r,t,n){if(t!==n){if("sexo"===r.field&&"M"!==(t=t.toUpperCase())&&"F"!==t)return c.warning("Debe usar M o F"),void(a.sexo=n);if("email"===r.field&&!/\S+@\S+\.\S+/.test(t))return c.warning("Email no válido"),void(a.email=n);d.put("::acudientes/guardar-valor",{parentesco_id:a.parentesco_id,acudiente_id:a.id,user_id:a.user_id,propiedad:r.field,valor:t}).then(function(e){return c.success("Acudiente actualizado con éxito")},function(e){return a[r.field]=n,c.error("Cambio no guardado","Error")})}return e.$apply()})}}})},e.traerAlumnnos()},e.agregarAcudiente=function(a){if(e.es_titular)return delete r.acudiente_cambiar,s.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(e){return a.subGridOptions.data.splice(a.subGridOptions.data.length-1,0,e)},function(){});c.warning("No eres titular","No puedes editar.")},e.cambiarAcudiente=function(a,t){if(e.es_titular)return r.acudiente_cambiar=t,s.open({templateUrl:"==alumnos/newAcudienteModal.tpl.html",controller:"NewAcudienteModalCtrl",resolve:{alumno:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(e){var r,n,o,i,s,u;for(u=[],n=r=0,o=(s=a.subGridOptions.data).length;r<o;n=++r)(i=s[n])&&i.id===t.id?u.push(a.subGridOptions.data.splice(n,1,e)):u.push(void 0);return u},function(){});c.warning("No eres titular","No puedes editar.")},e.quitarAcudiente=function(a,r){if(e.es_titular)return s.open({templateUrl:"==alumnos/quitarAcudienteModalConfirm.tpl.html",controller:"QuitarAcudienteModalConfirmCtrl",resolve:{alumno:function(){return a},acudiente:function(){return r}}}).result.then(function(e){var r,t,n,o,i,s;for(s=[],t=r=0,n=(i=a.subGridOptions.data).length;r<n;t=++r)(o=i[t])&&o.id===e.id?s.push(a.subGridOptions.data.splice(t,1)):s.push(void 0);return s},function(){});c.warning("No eres titular","No puedes editar.")},e.cambiarCiudad=function(a,r){if(e.es_titular)return s.open({templateUrl:"==alumnos/cambiarCiudadModal.tpl.html",controller:"CambiarCiudadModalCtrl",resolve:{persona:function(){return a},paises:function(){return e.paises},tipo_ciudad:function(){return r},tipo_persona:function(){return a.subGridOptions?"alumno":"acudiente"}}}).result.then(function(e){return a=e});c.warning("No eres titular","No puedes editar.")},e.cambiarPazysalvo=function(a){var r;if(e.es_titular)return a.pazysalvo=!a.pazysalvo,a.alumno_id||(a.alumno_id=a.id),r={alumno_id:a.alumno_id,propiedad:"pazysalvo",valor:a.pazysalvo},d.put("::alumnos/guardar-valor",r).then(function(e){return console.log("Cambios guardados")},function(e){return a.pazysalvo=!a.pazysalvo,c.error("Cambio no guardado","Error")});c.warning("No eres titular","No puedes editar.")},e.resetPass=function(r){if(e.es_titular)return s.open({templateUrl:a.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return r}}}).result.then(function(e){});c.warning("No eres titular","No puedes editar.")},e.religionSelected=function(a,r){if(e.es_titular)return e.religiones.indexOf(a.religion)>-1?e.$broadcast(i.events.END_CELL_EDIT):void 0;c.warning("No eres titular","No puedes editar.")},e.religionEditPressEnter=function(a){return e.$broadcast(i.events.END_CELL_EDIT)},e.tipoDocSeleccionado=function(a,r){var t,n;if(e.es_titular)return t={propiedad:"tipo_doc",valor:a.id},n="acudientes",r.subGridOptions?(n="alumnos",t.alumno_id=r.alumno_id):(t.acudiente_id=r.acudiente_id,t.parentesco_id=r.parentesco_id,t.user_acud_id=r.user_id),d.put("::"+n+"/guardar-valor",t).then(function(e){return c.success("Alumno(a) actualizado con éxito","Actualizado")},function(e){return c.error("Cambio no guardado.","Error")});c.warning("No eres titular","No puedes editar.")},e.cambiaUsernameCheck=function(a){if(e.es_titular)return e.verificandoUsername=!0,d.put("::users/usernames-check",{texto:a}).then(function(a){return e.username_match=a.data.usernames,e.verificandoUsername=!1,e.username_match.map(function(e){return e.username})});c.warning("No eres titular","No puedes editar.")},e.cambiaEpsCheck=function(a){if(e.es_titular)return e.verificandoEps=!0,d.put("::alumnos/eps-check",{texto:a}).then(function(a){return e.eps_match=a.data.eps,e.verificandoEps=!1,e.eps_match.map(function(e){return e.eps})});c.warning("No eres titular","No puedes editar.")},"","==alumnos/botonEditReligion.tpl.html",h="==directives/botonPazysalvo.tpl.html",b="==directives/botonesResetPassword.tpl.html",g="==directives/botonCiudadNac.tpl.html",f="==directives/botonCiudadDoc.tpl.html","==directives/botonCiudadResid.tpl.html",v="==directives/botonTipoDoc.tpl.html","==alumnos/botonEditUsername.tpl.html",_="==alumnos/botonEditEps.tpl.html","'==alumnos/popoverAlumnoGrid.tpl.html'","'mouseenter'","' '",m='uib-popover-template="views+\'==alumnos/popoverAlumnoGrid.tpl.html\'" popover-trigger="\'mouseenter\'" popover-title="{{ row.entity.nombres + \' \' + row.entity.apellidos }}" popover-popup-delay="500" popover-append-to-body="true"',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,exporterSuppressColumns:["edicion"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Alumnos - MyVC.csv",enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,expandableRowTemplate:"==alumnos/expandableRowTemplate.tpl.html",expandableRowHeight:110,expandableRowScope:{agregarAcudiente:e.agregarAcudiente,quitarAcudiente:e.quitarAcudiente,cambiarAcudiente:e.cambiarAcudiente,resetPass:e.resetPass,cambiarCiudad:e.cambiarCiudad,cambiaUsernameCheck:e.cambiaUsernameCheck},columnDefs:[{field:"no",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{field:"nombres",minWidth:130,pinnedLeft:!0,filter:{condition:function(e,a,r){return r.entity.nombres.toLowerCase().indexOf(e.toLowerCase())>-1}},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;" '+m+'><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:110,filter:{condition:o.filter.CONTAINS}},{field:"sexo",displayName:"Sex",width:40},{field:"no_matricula",displayName:"# matrícula",minWidth:80,enableColumnMenu:!0},{field:"username",filter:{condition:o.filter.CONTAINS},displayName:"Usuario",cellTemplate:b,editableCellTemplate:"==alumnos/botonEditUsername.tpl.html",minWidth:135},{field:"deuda",displayName:"Deuda",type:"number",cellFilter:'currency:"$":0',minWidth:70},{field:"pazysalvo",displayName:"A paz?",cellTemplate:h,minWidth:60,enableCellEdit:!1},{field:"telefono",displayName:"Teléfono",minWidth:80},{field:"celular",displayName:"Celular",minWidth:90},{field:"religion",displayName:"Religión",minWidth:70,editableCellTemplate:"==alumnos/botonEditReligion.tpl.html"},{field:"tipo_doc",displayName:"Tipo documento",minWidth:120,cellTemplate:v,enableCellEdit:!1},{field:"documento",minWidth:100,cellFilter:"formatNumberDocumento"},{field:"ciudad_doc",displayName:"Ciud Docu",minWidth:120,cellTemplate:f,enableCellEdit:!1},{field:"direccion",displayName:"Dirección",minWidth:70},{field:"barrio",minWidth:70},{field:"tipo_sangre",displayName:"RH",minWidth:70},{field:"estrato",minWidth:70,type:"number"},{field:"fecha_nac",displayName:"Nacimiento",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"ciudad_nac",displayName:"Ciud Nacimi",minWidth:120,cellTemplate:g,enableCellEdit:!1},{field:"ciudad_resid",displayName:"Ciud Resid",minWidth:120,cellTemplate:"==directives/botonCiudadResid.tpl.html",enableCellEdit:!1},{field:"eps",displayName:"EPS",minWidth:100,editableCellTemplate:_}],multiSelect:!1,exporterHeaderFilter:function(e){return"A paz?"===e?"Paz y salvo":"Matrícula"===e?"Grupo":e},exporterFieldCallback:function(a,r,t,n){return"no"===t.name?a.renderContainers.body.visibleRowCache.indexOf(r)+1:"grupo_id"===t.name?e.dato.grupo.nombre:"ciudad_nac"===t.name?r.entity.ciudad_nac_nombre:"pazysalvo"===t.name?n?"Si":"No":"tipo_doc"===t.name&&n&&n.tipo?n.tipo:n},onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){if(t!==n){if(l.hasRoleOrPerm("Profesor")&&e.USER.profes_can_edit_alumnos){if(!e.es_titular)return a[r.field]=n,void c.warning("No eres el titular")}else if(!l.hasRoleOrPerm("Admin"))return a[r.field]=n,void c.warning("Actualmente no hay permiso para editar");if(a.alumno_id||(a.alumno_id=fila.id),"sexo"===r.field&&"M"!==(t=t.toUpperCase())&&"F"!==t)return c.warning("Debe usar M o F"),void(a.sexo=n);if("fecha_matricula"===r.field)return e.cambiarFechaMatricula(a);if("tipo_sangre"===r.field&&(t=t.toUpperCase(),!(e.tipos_sangre.indexOf(t)>-1)))return c.warning("Debe usar: "+e.tipos_sangre.join(" ")),void(a.tipo_sangre=n);if("estrato"===r.field&&(t<0||t>9))return c.warning("Valor no admitido"),void(a.estrato=n);if("documento"===r.field&&10!==t.length&&0!==t.length)return void c.warning("Debe ser de diez dígitos");d.put("::alumnos/guardar-valor",{alumno_id:a.alumno_id,propiedad:r.field,valor:t}).then(function(e){return c.success("Alumno(a) actualizado con éxito")},function(e){return a[r.field]=n,c.error("Cambio no guardado","Error")})}if("religion"!==r.field)return e.$apply()})}}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("MatriculasCtrl",["$scope","App","$state","$interval","$uibModal","$filter","AuthService","toastr","$http",function(e,a,r,t,n,o,i,s,u){i.verificar_acceso(),e.dato={sortMatricula:!1,sortMatriculaReverse:!1,sortNombres:!1,sortNombresReverse:!1,sortType:"apellidos",sortReverse:!1},e.dato_f={sortMatricula:!1,sortMatriculaReverse:!1,sortNombres:!1,sortNombresReverse:!1,sortType:"apellidos",sortReverse:!1},e.alumnos_encontrados=[],e.texto_a_buscar="",e.year_ant=e.USER.year-1,e.perfilPath=a.images+"perfil/",e.views=a.views,e.alumnos_all=[],e.dato.grupo="",u.get("::grupos").then(function(a){var r,t,n,o,i;for(o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),e.grupos=a.data,t=0,n=(i=e.grupos).length;t<n;t++)(r=i[t]).id===o&&(e.dato.grupo=r);return e.traerAlumnos(e.dato.grupo)}),e.editar=function(e){return r.go("panel.alumnos.editar",{alumno_id:e.alumno_id})},e.onGrupoSelect=function(a,r){if(a)return localStorage.setItem("matr_grupo",a.id),e.traerAlumnos(a)},e.traerAlumnos=function(a){var r,t,n,o,i,s;for(n=[],o=0,i=(s=e.grupos).length;o<i;o++)(t=s[o]).orden_grado===a.orden_grado-1&&n.push(t);return r=n.length>0?n[0].grado_id:null,u.put("::matriculas/alumnos-grado-anterior",{grupo_actual:a,grado_ant_id:r,year_ant:e.year_ant}).then(function(a){var r,t,n,o,i;for(e.alumnos_all=a.data,i=[],t=0,n=(o=e.alumnos_all).length;t<n;t++)(r=o[t]).estado_ant=r.estado,r.fecha_retiro_ant=r.fecha_retiro,r.fecha_retiro=new Date(r.fecha_retiro),r.fecha_matricula_ant=r.fecha_matricula,i.push(r.fecha_matricula=new Date(r.fecha_matricula));return i})},e.matricularUno=function(a){var r;if(e.dato.grupo.id)return r={alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id,year_id:e.USER.year_id},u.post("::matriculas/matricularuno",r).then(function(e){return e=e.data,a.matricula_id=e.id,a.grupo_id=e.grupo_id,a.estado="MATR",a.fecha_matricula_ant=e.fecha_matricula.date,a.fecha_matricula=new Date(e.fecha_matricula.date),s.success("Alumno matriculado con éxito","Matriculado"),a},function(e){return s.error("No se pudo matricular el alumno.","Error")});s.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.reMatricularUno=function(a){var r;if(e.dato.grupo.id)return r={matricula_id:a.matricula_id},u.put("::matriculas/re-matricularuno",r).then(function(e){return e=e.data,s.success("Alumno rematriculado","Matriculado"),a},function(e){return s.error("No se pudo matricular el alumno.","Error")});s.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.matricularEn=function(a){return n.open({templateUrl:"==alumnos/matricularEn.tpl.html",controller:"MatricularEnCtrl",resolve:{alumno:function(){return a},grupos:function(){return e.grupos},USER:function(){return e.USER}}}).result.then(function(e){return console.log("Cierra")})},e.setAsistente=function(a){return u.put("::matriculas/set-asistente",{matricula_id:a.matricula_id,grupo_id:e.dato.grupo.grupo_id}).then(function(e){return s.success("Guardado como asistente")},function(e){return s.error("No se pudo guardar como asistente","Error")})},e.setNewAsistente=function(a){return u.put("::matriculas/set-new-asistente",{alumno_id:a.alumno_id,grupo_id:e.dato.grupo.id}).then(function(e){return console.log("Cambios guardados")},function(e){return s.error("No se pudo crear asistente","Error")})},e.cambiarFechaRetiro=function(e){return u.put("::matriculas/cambiar-fecha-retiro",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return s.success("Fecha retiro guardada")},function(a){return e.fecha_retiro=e.fecha_retiro_ant,s.error("No se pudo guardar la fecha","Error")})},e.cambiarFechaMatricula=function(e){return u.put("::matriculas/cambiar-fecha-matricula",{matricula_id:e.matricula_id,fecha_matricula:e.fecha_matricula}).then(function(e){return s.success("Fecha matricula guardada")},function(a){return e.fecha_matricula=e.fecha_matricula_ant,s.error("No se pudo guardar la fecha","Error")})},e.desertar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),u.put("::matriculas/desertar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return s.success("Alumno desertado")},function(e){return s.error("No se pudo desertar","Problema")})},e.retirar=function(e){var a;return a=e.fecha_retiro,null===e.fecha_retiro_ant&&(a=new Date,e.fecha_retiro=a),u.put("::matriculas/retirar",{matricula_id:e.matricula_id,fecha_retiro:e.fecha_retiro}).then(function(e){return s.success("Alumno retirado")},function(e){return s.error("No se pudo desmatricular","Problema")})},e.buscar_por_nombre=function(){if(""!==e.texto_a_buscar)return u.put("::buscar/por-nombre",{texto_a_buscar:e.texto_a_buscar}).then(function(a){return e.alumnos_encontrados=a.data},function(e){return s.error("No se pudo buscar","Problema")});s.warning("Escriba término a buscar")},e.filterActuales=function(a){return a.grupo_id===e.dato.grupo.id},e.filterNOActuales=function(a){return a.grupo_id!==e.dato.grupo.id}}]).controller("MatricularEnCtrl",["$scope","$uibModalInstance","alumno","grupos","USER","$http","toastr","$state",function(e,a,r,t,n,o,i,s){var u,l,c,d,p;for(e.alumno=r,e.grupos=t,e.$state=s,e.USER=n,e.dato={},localStorage.matr_grupo&&(d=parseInt(localStorage.matr_grupo)),l=0,c=(p=e.grupos).length;l<c;l++)(u=p[l]).id===d&&(e.dato.grupo=u);return e.ok=function(){var r;if(e.dato.grupo.id)return r={alumno_id:e.alumno.alumno_id,grupo_id:e.dato.grupo.id,year_id:e.USER.year_id,crear_matri:e.alumno.crear_matri},o.post("::matriculas/matricular-en",r).then(function(r){if("Ya matriculado"!==(r=r.data))return e.alumno.matricula_id=r.id,e.alumno.grupo_id=r.grupo_id,i.success("Alumno matriculado con éxito","Matriculado"),a.close(e.alumno);i.warning("Ya tiene matrícula en ese grupo")},function(e){return i.error("No se pudo matricular el alumno.","Error")});i.warning("Debes definir el grupo al que vas a matricular.","Falta grupo")},e.toggleNuevo=function(r){var t;return r.nuevo=!r.nuevo,r.alumno_id||(r.alumno_id=r.id),t={alumno_id:r.alumno_id,propiedad:"nuevo",valor:r.nuevo},o.put("::alumnos/guardar-valor",t).then(function(r){return console.log("Cambios guardados"),a.close(e.alumno)},function(e){return r.nuevo=!r.nuevo,i.error("Cambio no guardado","Error")})},e.toggleRepitente=function(r){var t;return r.repitente=!r.repitente,r.alumno_id||(r.alumno_id=r.id),t={alumno_id:r.alumno_id,propiedad:"repitente",valor:r.repitente},o.put("::alumnos/guardar-valor",t).then(function(r){return console.log("Cambios guardados"),a.close(e.alumno)},function(e){return r.repitente=!r.repitente,i.error("Cambio no guardado","Error")})},e.toggleEgresado=function(r){var t;return r.egresado=!r.egresado,r.alumno_id||(r.alumno_id=r.id),t={alumno_id:r.alumno_id,propiedad:"egresado",valor:r.egresado},o.put("::alumnos/guardar-valor",t).then(function(r){return console.log("Cambios guardados"),a.close(e.alumno)},function(e){return r.egresado=!r.egresado,i.error("Cambio no guardado","Error")})},e.toggleCrearMatri=function(e){return e.crear_matri=!e.crear_matri},e.toggleActive=function(r){var t;return r.is_active=!r.is_active,r.alumno_id||(r.alumno_id=r.id),t={alumno_id:r.alumno_id,user_id:r.user_id,propiedad:"is_active",valor:r.is_active},o.put("::alumnos/guardar-valor",t).then(function(r){return console.log("Cambios guardados"),a.close(e.alumno)},function(e){return r.is_active=!r.is_active,i.error("Cambio no guardado","Error")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("MatriculasDetallesCtrl",["$scope","App","$state","$uibModal","$filter","AuthService","toastr","$http",function(e,a,r,t,n,o,i,s){o.verificar_acceso(),e.year_ant=e.USER.year-1,e.perfilPath=a.images+"perfil/",e.views=a.views,e.matricula_detalle=!1,e.matric_cargando=!1,e.detallesAlumno=function(){return s.put("::detalles/alumno",{year_id:e.USER.year_id,alumno_id:parseInt(r.params.alumno_id)}).then(function(a){return e.matriculas=a.data})},e.detallesAlumno(),e.matricSeleccionada=function(a){var r,t,n,o,i;for(t=0,n=(i=e.matriculas).length;t<n;t++)(o=i[t]).matricula_id===a.matricula_id?o.seleccionada=!0:o.seleccionada=!1;return r={alumno_id:a.alumno_id,year_id:a.year_id,matricula_id:a.matricula_id},e.matric_cargando=!0,e.matricula_detalle=!1,s.put("::detalles/grupos-periodos",r).then(function(r){var t,n,o,i,s;for(r=r.data,e.matricula_detalle=r,e.matric_cargando=!1,s=[],t=0,n=(i=e.matricula_detalle).length;t<n;t++)o=i[t],s.push(o.year=a.year);return s})},e.eliminarMatric=function(a){if(!1,confirm("¿Está seguro que quiere eliminar la matricula "+a+" definitivamente?"))return s.put("::detalles/eliminar-matricula-destroy",{matricula_id:a}).then(function(r){return 0===parseInt(r.data)?i.warning("No se eliminó matricula"):(i.success("Matricula "+a+" eliminada."),e.matriculas=n("filter")(e.matriculas,{matricula_id:"!"+a},!0))},function(e){return i.error("No se pudo eliminar la matricula "+a,"Error")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").directive("matriculasDetallesPeriodosDir",[function(){return{restrict:"E",templateUrl:"==alumnos/matriculasDetallesPeriodos.tpl.html",controller:"MatriculasDetallesPeriodosCtrl"}}]).controller("MatriculasDetallesPeriodosCtrl",["$scope","App","$rootScope","$state","$interval","uiGridConstants","$uibModal","$filter","AuthService","toastr","$http",function(e,a,r,t,n,o,i,s,u,l,c){e.eliminarNotasPeriodo=function(e,a){if(confirm("¿Está seguro? estas notas no se podrán recuperar si las borra."))return c.put("::detalles/eliminar-notas-periodo",{alumno_id:parseInt(t.params.alumno_id),grupo_id:a.id,periodo_id:e.id}).then(function(e){return 0===parseInt(e.data)?l.warning("No se eliminó ninguna nota"):l.success("Notas eliminadas: "+e.data)},function(e){return l.error("No se pudo eliminar las notas","Error")})},e.eliminarMatriculaDestroy=function(a,r){if(!1,1===a.length?confirm("Solo queda esta matricula para este grupo, ¿Está seguro que quiere eliminarla definitivamente?"):confirm("¿Está seguro que quiere eliminar la matricula "+r+" definitivamente?"))return c.put("::detalles/eliminar-matricula-destroy",{matricula_id:r}).then(function(t){return 0===parseInt(t.data)?l.warning("No se eliminó matricula"):(l.success("Matricula "+r+" eliminada."),e.matriculas=s("filter")(e.matriculas,{matricula_id:"!"+r}),a=s("filter")(a,{matricula_id:"!"+r})),e.$parent.detallesAlumno()},function(e){return l.error("No se pudo eliminar la matricula "+r,"Error")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("CarteraCtrl",["$scope","App","$state","$uibModal","$filter","AuthService","toastr","$http","uiGridConstants","Upload","$timeout","Acentos","DownloadServ",function(e,a,r,t,n,o,i,s,u,l,c,d,p){var m,f,g;o.verificar_acceso(),e.dato={},e.gridOptions={},e.perfilPath=a.images+"perfil/",e.views=a.views,e.images=a.images,e.gridScope=e,e.mySelectedRows=[],e.valorDeuda=0,e.hombresGrupo=0,e.mujeresGrupo=0,e.dato.grupo="",s.get("::grupos").then(function(a){var r,t,n,o,i;for(o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),e.grupos=a.data,t=0,n=(i=e.grupos).length;t<n;t++)(r=i[t]).id===o&&(e.dato.grupo=r);return e.traerAlumnos(e.dato.grupo)}),e.ver_indorme_listado_deudores=function(){return e.viendo_informe_list_deudores=!e.viendo_informe_list_deudores},e.importarCambios=function(r,t){if(e.f=r,e.errFile=t&&t[0],r)return r.upload=l.upload({url:a.Server+"importar/cartera",data:{file:r}}),r.upload.then(function(a){return c(function(){return r.result=a.data,e.traerAlumnos(e.dato.grupo)})},function(a){if(a.status>0)return e.errorMsg=a.status+": "+a.data},function(e){return r.progress=Math.min(100,parseInt(100*e.loaded/e.total))})},e.onGrupoSelect=function(a,r){if(a)return localStorage.setItem("matr_grupo",a.id),e.traerAlumnos(a)},e.imprimir=function(){return window.print()},e.editar=function(e){return r.go("panel.persona",{persona_id:e.alumno_id,tipo:"alumno"})},m='<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',f="==directives/botonesPazysalvo.tpl.html",g="==directives/botonesResetPassword.tpl.html",e.gridOptions={showGridFooter:!0,showColumnFooter:!0,gridFooterTemplate:"==alumnos/gridFooterCartera.tpl.html",enableSorting:!0,enableFiltering:!0,exporterSuppressColumns:["edicion","foto_nombre"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Alumnos cartera - MyVC.csv",enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEdit:!0,enableCellEditOnFocus:!0,columnDefs:[{name:"no",displayName:"No",width:45,enableCellEdit:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row)+1}}</div>'},{name:"edicion",displayName:"Edición",width:30,enableSorting:!1,enableFiltering:!1,cellTemplate:m,enableCellEdit:!1,enableColumnMenu:!0},{field:"foto_nombre",displayName:"Foto",cellTemplate:'<img width="35px" ng-src="{{grid.appScope.perfilPath + grid.getCellValue(row, col)}}">',width:40},{field:"nombres",minWidth:80,filter:{condition:d.buscarEnGrid},enableHiding:!1},{field:"apellidos",minWidth:80,filter:{condition:d.buscarEnGrid}},{field:"sexo",width:60},{field:"nombre_grupo",displayName:"Grupo"},{field:"username",filter:{condition:d.buscarEnGrid},displayName:"Usuario",cellTemplate:g,minWidth:150},{field:"deuda",displayName:"Deuda",cellTemplate:f,minWidth:150,aggregationType:u.aggregationTypes.sum,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total: {{col.getAggregationValue() | currency:"$":0 }}</div>'},{field:"fecha_pension",displayName:"Fecha hasta",minWidth:150,cellFilter:"date:mediumDate",type:"date"}],multiSelect:!0,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){var o;return t!==n&&(o={},"username"===r.field&&(o.user_id=a.user_id),a.alumno_id||(a.alumno_id=fila.id),o.alumno_id=a.alumno_id,o.propiedad=r.field,o.valor=t,s.put("::alumnos/guardar-valor",o).then(function(e){return i.success("Alumno(a) actualizado con éxito")},function(e){return a[r.field]=n,i.error("Cambio no guardado","Error")})),e.$apply()})}},e.getSelectedRows=function(){return e.mySelectedRows=e.gridApi.selection.getSelectedRows()},e.traerAlumnos=function(a){return s.put("::cartera/alumnos",{grupo_actual:a}).then(function(a){return e.gridOptions.data=a.data,e.gridOptions.columnDefs[6].visible=!1,e.gridApi.grid.refresh()})},e.deuda_total=function(){var a,r,t,o;if(o=0,e.gridOptions.data)for(a=0,r=(t=e.gridOptions.data).length;a<r;a++)o+=t[a].deuda;return n("currency")(o,"$",0)},e.cantidadDeudores=function(){var a,r,t,n,o,i,s;if(s=0,r=0,o=0,e.gridOptions.data)for(t=0,n=(i=e.gridOptions.data).length;t<n;t++)(a=i[t]).pazysalvo||(s+=1),"M"===a.sexo?r++:o++;return e.hombresGrupo=r,e.mujeresGrupo=o,s},e.cambiarValorVarios=function(a,r){var t;return t={alumnos:e.getSelectedRows(),propiedad:r,valor:a},s.put("::alumnos/guardar-valor-varios",t).then(function(t){var n,o,s;for(n=0,o=(s=e.getSelectedRows()).length;n<o;n++)s[n][r]=a;return i.success("Cambios guardados")},function(e){return i.error("Cambio no guardado","Error")})},e.cambiarPazysalvo=function(e){var a;return e.pazysalvo=!e.pazysalvo,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"pazysalvo",valor:e.pazysalvo},s.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.pazysalvo=!e.pazysalvo,i.error("Cambio no guardado","Error")})},e.resetPass=function(e){return t.open({templateUrl:a.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){})},e.traerSoloDeudores=function(a){return s.put("::cartera/solo-deudores",{year_id:e.USER.year_id}).then(function(a){return e.gridOptions.data=a.data,e.gridOptions.columnDefs[6].visible=!0,e.gridApi.grid.refresh()})},e.exportarSoloDeudores=function(a){return p.download("::cartera/exportar-solo-deudores","Deudores "+e.USER.year+".xlsx")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("AcudientesCtrl",["$scope","App","$state","$interval","$uibModal","$filter","AuthService","toastr","$http","uiGridConstants","DownloadServ","Acentos",function(e,a,r,t,n,o,i,s,u,l,c,d){var p,m;i.verificar_acceso(),e.dato={},e.gridOptions={},e.perfilPath=a.images+"perfil/",e.views=a.views,e.gridScope=e,e.dato.grupo="",u.get("::grupos/con-paises-tipos").then(function(a){var r,t,n,o,i,s;for(r=0,localStorage.acud_grupo&&(r=parseInt(localStorage.acud_grupo)),e.grupos=a.data.grupos,e.paises=a.data.paises,e.tipos_doc=a.data.tipos_doc,s=[],n=0,o=(i=e.grupos).length;n<o;n++)t=i[n],parseInt(t.id)===parseInt(r)?(e.dato.grupo=t,s.push(e.selectGrupo(e.dato.grupo))):s.push(void 0);return s}),e.selectGrupo=function(a){var r,t,n,o,i,l,c,d;for(localStorage.acud_grupo=a.id,e.dato.grupo=a,n=0,i=(c=e.grupos).length;n<i;n++)(r=c[n]).active=!1;for(a.active=!0,t=[],o=0,l=(d=e.grupos).length;o<l;o++)(r=d[o]).orden_grado===a.orden_grado-1&&t.push(r);return e.traerAcudientes=function(){return u.put("::acudientes/datos",{grupo_actual:a}).then(function(a){var r,t,n,o,i;for(e.gridOptions.data=a.data.acudientes,i=[],r=0,t=(o=e.gridOptions.data).length;r<t;r++)(n=o[r]).fecha_nac_ant=n.fecha_nac,n.fecha_nac=n.fecha_nac?new Date(n.fecha_nac.replace(/-/g,"/")):n.fecha_nac,i.push(n.subGridOptions.onRegisterApi=function(a){return a.edit.on.afterCellEdit(e,function(a,r,t,n){return s.warning("Desde aquí solo podrás editar Acudientes","No guardado"),e.$apply()})});return i})},e.traerAcudientes()},p='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>'+'<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a>'+"</span>",m="==directives/botonesResetPassword.tpl.html",e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEdit:!0,enableCellEditOnFocus:!0,exporterSuppressColumns:["edicion"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Alumnos - MyVC.csv",enableGridMenu:!0,expandableRowTemplate:"==alumnos/expandableRowTemplate.tpl.html",expandableRowHeight:110,columnDefs:[{name:"no",displayName:"No",width:45,enableCellEdit:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row)+1}}</div>'},{field:"id",width:60,enableCellEdit:!1},{name:"edicion",displayName:"Edición",width:60,enableSorting:!1,enableFiltering:!1,cellTemplate:p,enableCellEdit:!1,enableColumnMenu:!0},{field:"foto_nombre",displayName:"Foto",cellTemplate:'<img width="35px" ng-src="{{grid.appScope.perfilPath + grid.getCellValue(row, col)}}">',width:40},{field:"nombres",minWidth:100,filter:{condition:d.buscarEnGrid},enableHiding:!1},{field:"apellidos",minWidth:100,filter:{condition:d.buscarEnGrid}},{field:"sexo",width:60},{field:"username",filter:{condition:d.buscarEnGrid},displayName:"Usuario",cellTemplate:m,minWidth:150},{field:"documento",displayName:"Documento",minWidth:100,cellFilter:"formatNumberDocumento"},{field:"direccion",displayName:"Dirección",minWidth:90},{field:"barrio",minWidth:80},{field:"telefono",displayName:"Teléfono",minWidth:90},{field:"celular",displayName:"Celular",minWidth:90},{field:"ocupacion",displayName:"Ocupación",minWidth:90}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){if(!e.usuario_creado)return t!==n&&("sexo"===r.field?"M"===t||"F"===t?u.put("::acudientes/guardar-valor",{acudiente_id:a.id,parentesco_id:a.parentesco_id,user_id:a.user_id,propiedad:r.field,valor:t}).then(function(e){return s.success("Acudiente actualizado con éxito","Actualizado")},function(e){return s.error("Cambio no guardado","Error")}):(s.warning("Debe usar M o F"),a.sexo=n):u.put("::acudientes/guardar-valor",{acudiente_id:a.id,parentesco_id:a.parentesco_id,user_id:a.user_id,propiedad:r.field,valor:t}).then(function(e){return s.success("Acudiente actualizado con éxito","Actualizado")},function(e){return s.error("Cambio no guardado","Error")})),e.$apply();e.usuario_creado=!1})}},e.eliminar=function(a){return n.open({templateUrl:"==alumnos/removeAcudiente.tpl.html",controller:"RemoveAcudienteCtrl",resolve:{acudiente:function(){return a}}}).result.then(function(a){return e.gridOptions.data=o("filter")(e.gridOptions.data,{id:"!"+a.id})},function(){})},e.editar=function(a){return n.open({templateUrl:"==alumnos/editAcudienteModal.tpl.html",controller:"EditAcudienteModalCtrl",resolve:{acudiente:function(){return a},paises:function(){return e.paises},tipos_doc:function(){return e.tipos_doc},parentescos:function(){return e.parentescos}}}).result.then(function(a){return e.gridOptions.data=o("filter")(e.gridOptions.data,{id:"!"+a.id})},function(){})},e.cambiarPazysalvo=function(e){var a;return e.pazysalvo=!e.pazysalvo,e.alumno_id||(e.alumno_id=e.id),a={alumno_id:e.alumno_id,propiedad:"pazysalvo",valor:e.pazysalvo},u.put("::alumnos/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.pazysalvo=!e.pazysalvo,s.error("Cambio no guardado","Error")})},e.resetPass=function(e){if(e.user_id)return n.open({templateUrl:a.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){});s.warning("Aún no tiene usuario")},e.traerNOAsignados=function(){return u.put("::acudientes/no-asignados").then(function(a){var r,t,n,o,i;for(e.gridOptions.data=a.data.acudientes,i=[],r=0,t=(o=e.gridOptions.data).length;r<t;r++)(n=o[r]).fecha_nac_ant=n.fecha_nac,i.push(n.fecha_nac=n.fecha_nac?new Date(n.fecha_nac.replace(/-/g,"/")):n.fecha_nac);return i},function(){return s.error("No se pudo traer los acudientes sin asignar")})},e.crearUsuario=function(a){if(!a.user_id)return u.post("::acudientes/crear-usuario",{acudiente:a}).then(function(r){return e.usuario_creado=!0,a.user_id=r.data.id,a.username=r.data.username,s.success("Usuario creado")},function(){return s.error("No se pudo crear el usuario")});s.warning("Ya tiene usuario")},e.exportarAcudientesPlanillas=function(){return c.download("::acudientes-export/acudientes","Asistencia acudientes Per "+e.USER.numero_periodo+" - "+e.USER.year+".xls")},e.verPlanillas=function(){return r.go("panel.informes.planillas-ausencias-acudientes")}}]).controller("RemoveAcudienteCtrl",["$scope","$uibModalInstance","acudiente","$http","toastr","App",function(e,a,r,t,n,o){return e.acudiente=r,e.perfilPath=o.images+"perfil/",e.ok=function(){return t.delete("::acudientes/destroy/"+r.id).then(function(e){return n.success("Acudiente enviado a la papelera.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("NewAcudienteModalCtrl",["$scope","App","$uibModalInstance","alumno","paises","tipos_doc","parentescos","$http","toastr","$filter","$rootScope","$timeout",function(e,a,r,t,n,o,i,s,u,l,c,d){var p,m,f,g;if(e.alumno=t,e.paises=n,e.parentescos=i,e.datos={},e.tipos_doc=o,e.crearTabSelected=!1,e.selectTabSelected=!0,e.perfilPath=a.images+"perfil/",e.acudiente_cambiar=c.acudiente_cambiar,e.creandoUsuario=!1,e.acudiente={sexo:"M",parentesco:e.parentescos[0],tipo_doc:e.tipos_doc[0]},e.acudientes=[],e.acudiente_cambiar&&e.acudiente_cambiar.parentesco)for(p=0,m=(g=e.parentescos).length;p<m;p++)(f=g[p]).parentesco.toLowerCase()===e.acudiente_cambiar.parentesco.toLowerCase()&&(e.acudiente.parentesco=f);return e.selectCrearTab=function(){return e.crearTabSelected=!0,e.selectTabSelected=!1},e.selectSelectTab=function(){return e.crearTabSelected=!1,e.selectTabSelected=!0},e.selecAcudOption=function(a){var r,t,n,o,i;for(i=[],r=0,t=(o=e.parentescos).length;r<t;r++)"Madre"===(n=o[r]).parentesco&&"F"===a.sexo&&(e.acudiente.parentesco=n),"Padre"===n.parentesco&&"M"===a.sexo?i.push(e.acudiente.parentesco=n):i.push(void 0);return i},e.cancel=function(){return r.dismiss("cancel")},e.$on("modal.closing",function(e,a,r){switch(a){case"backdrop click":case"escape key press":if(!confirm("¿Seguro que quiere cerrar sin guardar acudiente?"))return e.preventDefault()}}),s.put("::acudientes/ultimos").then(function(a){return e.sin_repetir(a.data)}),e.refreshAcudientes=function(a){if(a)return s.put("::acudientes/buscar",{termino:a}).then(function(a){return e.sin_repetir(a.data)},function(e){return u.warning("No se pudo encontrar nada.","Problema")})},e.sin_repetir=function(a){var r,n,o,i,s,u,l;for(l=[],n=0,i=a.length;n<i;n++){for(r=a[n],e.existe=!1,o=0,s=(u=t.subGridOptions?t.subGridOptions.data:t.parientes).length;o<s;o++)u[o].id===r.id&&(e.existe=!0);e.existe||l.push(r)}return e.acudientes=l},e.paisNacSelect=function(a,r){return s.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentosNac=a.data})},e.departNacSelect=function(a){return s.get("::ciudades/por-departamento/"+a.departamento).then(function(r){if(e.ciudadesNac=r.data,void 0===e.acudiente.departamento_doc)return e.acudiente.departamento_doc=a,e.departSeleccionado(a)})},e.paisSelecionado=function(a,r){return s.get("::ciudades/departamentos/"+a.id).then(function(r){var t,n,o,i,s;if(e.departamentos=r.data,void 0===e.acudiente.pais_nac){for(i=[],t=0,n=(o=e.paises).length;t<n;t++)(s=o[t]).id===a.id?(e.acudiente.pais_nac=s,i.push(e.paisNacSelect(s))):i.push(void 0);return i}})},e.departSeleccionado=function(a){return s.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yy"},e.restarEstrato=function(){if(e.alumno.estrato>0)return e.alumno.estrato=e.alumno.estrato-1},e.sumarEstrato=function(){if(e.alumno.estrato<10)return e.alumno.estrato=e.alumno.estrato+1},e.crearAcudiente=function(){if(!e.creandoUsuario)return e.acudiente.alumno_id=t.alumno_id,e.creandoUsuario=!0,s.post("::acudientes/crear",e.acudiente).then(function(a){return u.success("Acudiente creado con éxito."),r.close(a.data),e.creandoUsuario=!1},function(a){return u.warning("No se pudo crear al alumno.","Problema"),e.creandoUsuario=!1})},e.seleccionarAcudiente=function(){var a;return a={acudiente_id:e.datos.acudiente.id,alumno_id:t.alumno_id,parentesco:e.acudiente.parentesco.parentesco,ocupacion:e.acudiente.ocupacion},c.acudiente_cambiar&&(a.parentesco_acudiente_cambiar_id=c.acudiente_cambiar.parentesco_id),s.put("::acudientes/seleccionar-parentesco",a).then(function(e){return u.success("Acudiente seleccionado."),delete c.acudiente_cambiar,r.close(e.data)},function(e){return u.warning("No se pudo seleccionar.","Problema")})},e.ocupacionCheck=function(a){return e.verificandoOcupacion=!0,s.put("::acudientes/ocupaciones-check",{texto:a}).then(function(a){return e.ocupaciones_match=a.data.ocupaciones,e.verificandoOcupacion=!1,e.ocupaciones_match.map(function(e){return e.ocupacion})})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("AsignarAcudienteAOtroModalCtrl",["$scope","App","$uibModalInstance","elemento","$uibModal","$http","toastr","$filter","$rootScope","$timeout",function(e,a,r,t,n,o,i,s,u,l){var c,d,p,m;for(e.acudiente=t,e.datos={},e.perfilPath=a.images+"perfil/",e.repetido=!1,e.alumno={},e.parentescos=a.parentescos,c=0,d=(m=e.parentescos).length;c<d;c++)"Madre"===(p=m[c]).parentesco&&"F"===t.sexo&&(e.acudiente.parentesco=p),"Padre"===p.parentesco&&"M"===t.sexo&&(e.acudiente.parentesco=p);return e.seleccionarAcudiente=function(){var a;return a={acudiente_id:e.acudiente.id,alumno_id:e.alumno.alumno_id,parentesco:e.acudiente.parentesco.parentesco,ocupacion:e.acudiente.ocupacion},o.put("::acudientes/seleccionar-parentesco",a).then(function(a){return e.acudiente.parentesco&&(e.acudiente.parentesco=e.acudiente.parentesco.parentesco),r.close(a.data)},function(e){return i.warning("No se pudo seleccionar.","Problema")})},e.quitarAcudiente=function(a,r){return n.open({templateUrl:"==alumnos/quitarAcudienteModalConfirm.tpl.html",controller:"QuitarAcudienteModalConfirmCtrl",resolve:{alumno:function(){return a},acudiente:function(){return r}}}).result.then(function(a){var r,t,n,o,i,s;for(s=[],r=t=0,n=(i=e.acudientes).length;t<n;r=++t)(o=i[r])&&o.id===a.id?s.push(e.acudientes.splice(r,1)):s.push(void 0);return s},function(){})},e.personaCheck=function(a){return e.verificandoPersona=!0,o.put("::alumnos/personas-check",{texto:a,todos_anios:!0}).then(function(a){return e.personas_match=a.data.personas,e.personas_match.map(function(a){return a.perfilPath=e.perfilPath}),e.verificandoPersona=!1,e.personas_match})},e.seleccionarPersona=function(a,r,t){return e.alumno=a,o.put("::acudientes/de-persona",{alumno_id:a.alumno_id}).then(function(a){var r,t,n,o;for(r=0,t=(o=a.data.acudientes).length;r<t;r++)(n=o[r]).id===e.acudiente.id&&(i.warning("Ya tiene este acudiente."),e.repetido=!0,n.repetido=!0);return e.acudientes=a.data.acudientes},function(){return i.error("Error trayendo acudientes de "+a.nombres)})},e.cancel=function(){return e.acudiente.parentesco&&(e.acudiente.parentesco=e.acudiente.parentesco.parentesco),r.dismiss("cancel")}}]).controller("QuitarAcudienteModalConfirmCtrl",["$scope","App","$uibModalInstance","alumno","acudiente","$http","toastr",function(e,a,r,t,n,o,i){return e.acudiente=n,e.alumno=t,e.perfilPath=a.images+"perfil/",e.ok=function(){var a;return a={parentesco_id:e.acudiente.parentesco_id},o.put("::acudientes/quitar-parentesco-alumno",a).then(function(e){return r.close(e.data)},function(e){return i.warning("No se pudo seleccionar.","Problema")})},e.cancel=function(){return r.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("EditAcudienteModalCtrl",["$scope","App","$uibModalInstance","acudiente","paises","tipos_doc","parentescos","$http","toastr","$filter","$rootScope",function(e,a,r,t,n,o,i,s,u,l,c){var d,p,m,f;if(e.acudiente=t,e.paises=n,e.parentescos=i,e.datos={},e.tipos_doc=o,e.perfilPath=a.images+"perfil/",e.creandoUsuario=!1,e.cancel=function(){return r.dismiss("cancel")},e.paisNacSelect=function(a,r){return s.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentosNac=a.data})},e.departNacSelect=function(a){return s.get("::ciudades/por-departamento/"+a.departamento).then(function(r){if(e.ciudadesNac=r.data,void 0===e.acudiente.departamento_doc)return e.acudiente.departamento_doc=a,e.departSeleccionado(a)})},e.paisSelecionado=function(a,r){return s.get("::ciudades/departamentos/"+a.id).then(function(r){var t,n,o,i,s;if(e.departamentos=r.data,void 0===e.acudiente.pais_nac){for(i=[],t=0,n=(o=e.paises).length;t<n;t++)(s=o[t]).id===a.id?(e.acudiente.pais_nac=s,i.push(e.paisNacSelect(s))):i.push(void 0);return i}})},e.departSeleccionado=function(a){return s.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yy"},e.restarEstrato=function(){if(e.alumno.estrato>0)return e.alumno.estrato=e.alumno.estrato-1},e.sumarEstrato=function(){if(e.alumno.estrato<10)return e.alumno.estrato=e.alumno.estrato+1},e.crearAcudiente=function(){if(!e.creandoUsuario)return e.acudiente.alumno_id=alumno.alumno_id,e.creandoUsuario=!0,s.post("::acudientes/crear",e.acudiente).then(function(a){return u.success("Acudiente creado con éxito."),r.close(a.data),e.creandoUsuario=!1},function(a){return u.warning("No se pudo crear al alumno.","Problema"),e.creandoUsuario=!1})},e.seleccionarAcudiente=function(){var a;return a={acudiente_id:e.datos.acudiente.id,alumno_id:alumno.alumno_id,parentesco:e.acudiente.parentesco.parentesco,ocupacion:e.acudiente.ocupacion},c.acudiente_cambiar&&(a.parentesco_acudiente_cambiar_id=c.acudiente_cambiar.parentesco_id),s.put("::acudientes/seleccionar-parentesco",a).then(function(e){return u.success("Acudiente seleccionado."),delete c.acudiente_cambiar,r.close(e.data)},function(e){return u.warning("No se pudo seleccionar.","Problema")})},e.ocupacionCheck=function(a){return e.verificandoOcupacion=!0,s.put("::acudientes/ocupaciones-check",{texto:a}).then(function(a){return e.ocupaciones_match=a.data.ocupaciones,e.verificandoOcupacion=!1,e.ocupaciones_match.map(function(e){return e.ocupacion})})},null===e.acudiente.tipo_doc)e.acudiente.tipo_doc=e.tipos_doc[0];else for(d=0,p=(m=e.tipos_doc).length;d<p;d++)f=m[d],e.acudiente.tipo_doc===f.id&&(e.acudiente.tipo_doc=f);return null===e.acudiente.ciudad_nac?(e.acudiente.pais_nac={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisNacSelect(e.acudiente.pais_nac,e.acudiente.pais_nac)):(s.get("::ciudades/datosciudad/"+e.acudiente.ciudad_nac).then(function(a){var r,t,n,o,i,s,u,l,c,d,p,m,f;for(e.paises=a.data.paises,e.departamentosNac=a.data.departamentos,e.ciudadesNac=a.data.ciudades,n=0,s=(d=e.paises).length;n<s;n++)(c=d[n]).id===a.data.pais.id&&(e.acudiente.pais_nac=c);for(o=0,u=(p=e.departamentosNac).length;o<u;o++)(t=p[o]).departamento===a.data.departamento.departamento&&(e.acudiente.departamento_nac=t);for(f=[],i=0,l=(m=e.ciudadesNac).length;i<l;i++)(r=m[i]).id===a.data.ciudad.id?f.push(e.acudiente.ciudad_nac=r):f.push(void 0);return f}),null===e.acudiente.ciudad_doc?(e.acudiente.pais_doc={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisDocSelect(e.acudiente.pais_doc,e.acudiente.pais_doc)):s.get("::ciudades/datosciudad/"+e.acudiente.ciudad_doc).then(function(a){return a=a.data,e.paises=a.paises,e.departamentos=a.departamentos,e.ciudades=a.ciudades,e.acudiente.pais_doc=a.pais,e.acudiente.departamento_doc=a.departamento,e.acudiente.ciudad_doc=a.ciudad}))}])}.call(this),function(){angular.module("myvcFrontApp").controller("CambiarCiudadModalCtrl",["$scope","$uibModalInstance","persona","paises","tipo_ciudad","tipo_persona","$http","toastr","$filter",function(e,a,r,t,n,o,i,s,u){return e.persona=r,e.paises=t,e.tipo_ciudad=n,e.modificarCiudades=!1,e.datos={},e.creando_ciudad=!1,e.creando_departamento=!1,e.creando_pais=!1,e.ciudad_new="",e.departamento_new="",e.pais_new="",e.modificando_depart=!1,e.crearCiudad=function(){return e.creando_ciudad=!0,e.$broadcast("paisSeleccionadoEvent2")},e.crearDepartamento=function(){return e.creandodepartamento=!0},e.crearPais=function(){return e.creandopais=!0},e.guardarCiudad=function(a,r){var t;if(e.datos.pais)if(e.datos.departamento||""!==r){if(""!==a)return t=e.datos.departamento?departamento.departamento:r,i.post("::ciudades/guardar-ciudad",{ciudad:a,departamento:t,pais_id:e.datos.pais.id}).then(function(a){return s.success("Creado correctamente: "+a.data.ciudad),e.datos.departamento&&e.ciudades.push(a.data),e.creandociudad=!1,e.ciudad_new="",e.departamento_new="",e.guardar=!0,i.get("::paises").then(function(a){return e.paises=a.data,e.paisSelect(u("filter")(e.paises,{id:1})[0])},function(e){return s.error("No se pudo traer las ciudades.")})},function(e){return s.error("No se pudo crear","Error")});s.warning("Debe escribir la nueva ciudad.")}else s.warning("Debe seleccionar departamento o escribir uno nuevo.");else s.warning("Debes seleccionar un pais.")},e.guardarPais=function(){return i.post("::paises/guardar",e.pais_new).then(function(a){return s.success("Creado correctamente: "+a.data.paisnuevo),e.paises.push(a.data),e.paisSelect(e.ciudad_new.pais)},function(e){return s.error("No se pudo crear","Error")})},e.escribeEnDepartamentoNew=function(){return e.datos.departamento=void 0},e.actualizarCiudad=function(e){return i.put("::ciudades/actualizar-ciudad",e).then(function(a){return s.success("Actualizado: "+e.ciudad),e.editandoCiudad=!1},function(e){return s.error("No se pudo actualizar","Error")})},e.actualizarDepartamento=function(a){return i.put("::ciudades/actualizar-departamento",a).then(function(r){var t,n,o;for(s.success("Actualizado: "+a.departamento),a.editandoDepart=!1,e.ciudad_new.pais,t=0,n=(o=e.ciudades).length;t<n;t++)o[t].departamento=a.departamento;return e.modificando_depart=!0},function(e){return s.error("No se pudo actualizar","Error")})},e.actualizarPais=function(e){return i.put("::paises/actualizar",e).then(function(a){return s.success("Actualizado: "+e.pais),e.editandoPais=!1,e.editandoAbrev=!1},function(e){return s.error("No se pudo actualizar","Error")})},e.paisSelect=function(a,r){return i.put("::ciudades/departamentos-by-id",{pais_id:a.id}).then(function(t){return e.departamentos=t.data.departamentos,void 0===e.datos.pais&&(e.datos.pais=a),e.$broadcast("paisSeleccionadoEvent"+r)})},e.paisSelect(u("filter")(e.paises,{id:1})[0],1),e.departamentoSelect=function(a,r){if(a)return e.departamento_new="",i.get("::ciudades/por-departamento/"+a.departamento).then(function(t){return e.ciudades=t.data,void 0===e.datos.departamento&&(e.datos.departamento=a),e.$broadcast("departamentoSeleccionadoEvent"+r)})},e.eliminarCiudad=function(a){return i.delete("::ciudades/destroy/"+a.id).then(function(r){return s.success("Ciudad enviada a la papelera.","Eliminado"),e.ciudades=u("filter")(e.ciudades,{id:"!"+a.id})},function(e){return s.warning("No se pudo enviar a la papelera.","Problema")})},e.ok=function(t){var u,l;if(!e.seleccionandoCiudad)return e.seleccionandoCiudad=!0,u=e.datos.ciudad,t&&(u=t),l={propiedad:n,valor:u.id},"acudiente"===o?(l.acudiente_id=r.id,l.parentesco_id=r.parentesco_id,l.user_acud_id=r.user_id):l.alumno_id=r.alumno_id,i.put("::"+o+"s/guardar-valor",l).then(function(e){return s.success("Seleccionado."),r[n+"_nombre"]=u.ciudad,r[n]=u.id,a.close(r)},function(e){return s.warning("No se pudo seleccionar.","Problema")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").controller("CambiarPromovidoModalCtrl",["$scope","$uibModalInstance","persona","$http","toastr",function(e,a,r,t,n){return e.persona=r,e.opciones_promo=[{id:1,disabled:!1,valor:"Automático",descripcion:"Significa que aún no se ha definido su promoción"},{id:2,disabled:!0,valor:"Promovido (calculado)",descripcion:"Que ya se calculó en Informes y se definió como Promovido"},{id:3,disabled:!0,valor:"No promovido (calculado)",descripcion:"Que ya se calculó en Informes y se definió como NO Promovido"},{id:4,disabled:!0,valor:"Promoción pendiente (calculado)",descripcion:"Que ya se calculó en Informes y se definió como Promoción pendiente"},{id:5,disabled:!1,valor:"Promovido (manual)",descripcion:"Que un usuario administrador lo ha definido como Promovido"},{id:6,disabled:!1,valor:"No promovido (manual)",descripcion:"Que un administrador lo ha definido como NO Promovido"},{id:7,disabled:!1,valor:"Promoción pendiente (manual)",descripcion:"Que un administrador lo ha definido como Promoción pendiente"}],e.setPromovido=function(e){if(!1===e.disabled)return t.put("::matriculas/set-promovido",{valor:e.valor,matricula_id:r.matricula_id}).then(function(t){return n.success("Actualizado: "+e.valor),r.promovido=e.valor,a.close(r)},function(e){return n.error("No se pudo actualizar","Error")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("PromocionarNotasCtrl",["$scope","App","$rootScope","$state","$timeout","uiGridConstants","uiGridEditConstants","$uibModal","$filter","AuthService","toastr","$http","EscalasValorativasServ",function(e,a,r,t,n,o,i,s,u,l,c,d,p){l.verificar_acceso(),e.dato={},e.gridScope=e,e.views=a.views,e.perfilPath=a.images+"perfil/",e.hasRoleOrPerm=l.hasRoleOrPerm,e.dato.grupo="",d.get("::grupos").then(function(a){var r,t,n,o,i,s;for(o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),e.grupos=a.data,s=[],t=0,n=(i=e.grupos).length;t<n;t++)r=i[t],parseInt(r.id)===parseInt(o)?(e.dato.grupo=r,s.push(e.selectGrupo(e.dato.grupo))):s.push(void 0);return s}),p.escalas().then(function(a){return e.escalas=a,e.escala_maxima=p.escala_maxima()},function(e){return console.log("No se trajeron las escalas valorativas",e)}),e.cambiaNotaComport=function(a,r,t){var n;if(e.dato.grupo.titular_id===e.USER.persona_id||e.hasRoleOrPerm("admin"))return a.id?(n=a.nota,d.put("::nota_comportamiento/update/"+a.id,{nota:a.nota}).then(function(e){return c.success("Nota cambiada: "+a.nota)},function(e){return c.error("No pudimos guardar la nota "+a.nota),a.nota=n})):((n={}).nota=a.nota,n.year_id=r.year_id,n.alumno_id=e[t].alumno.id,n.periodo_id=r.id,d.put("::nota_comportamiento/crear",n).then(function(e){var r;return r=e.data.nota_comport,a.id=r.id,a.year_id=r.year_id,a.nombres=r.nombres,a.apellidos=r.apellidos,a.alumno_id=r.alumno_id,a.foto_id=r.foto_id,a.foto_nombre=r.foto_nombre,a.sexo=r.sexo,a.periodo_id=r.periodo_id,c.success("Nota creada: "+a.nota)},function(e){return c.error("No pudimos guardar la nota "+n.nota),a=n}));c.warning("No eres el titular para cambiar comportamiento.")},e.selectGrupo=function(a){var r,t,n;for(console.log(e.dato),localStorage.matr_grupo=a.id,e.dato.grupo=a,r=0,t=(n=e.grupos).length;r<t;r++)n[r].active=!1;return a.active=!0,d.put("::alumnos/de-grupo/"+a.id).then(function(a){var r,t,n,o,i,s;for(e.alumnos=a.data.alumnos,t=0,localStorage.matr_grupo&&(t=parseInt(localStorage.alumno_seleccionado_id)),s=[],n=0,o=(i=e.alumnos).length;n<o;n++)r=i[n],parseInt(r.id)===t?(e.dato.selected_alumno=r,s.push(e.selectAlumno(e.dato.selected_alumno))):s.push(void 0);return s})},e.selectAlumno=function(a){return localStorage.alumno_seleccionado_id=a.id,e.dato.periodo_id=void 0,d.put("::alumnos/years-con-notas",{alumno_id:a.id}).then(function(a){return e.years_notas=a.data.years,e.years_dest=a.data.years_dest})},e.eligirPeriodoNotas=function(a,r,t,n,o){var i,s,u,l;for(e.dato.periodo_id=r.id,i=0,s=(l=a.periodos).length;i<s;i++)u=l[i],1===n?u.seleccionado_origen=!1:u.seleccionado_destino=!1;return 1===n?r.seleccionado_origen=!0:r.seleccionado_destino=!0,d.put("::notas/alumno-periodo-grupo",{alumno_id:e.dato.selected_alumno.id,periodo_id:r.id,grupo_id:a.grupo_id}).then(function(i){return 1===n?(e.datos_origen={grupo:a,periodo:r,num_year:t,alumno:o},e.notas_origen=i.data.notas):(e.datos_destino={grupo:a,periodo:r,num_year:t,alumno:o},e.notas_destino=i.data.notas,$.isArray(e.notas_destino.asignaturas)?void 0:e.notas_destino.asignaturas=[e.notas_destino.asignaturas[Object.keys(e.notas_destino.asignaturas)[0]]])})},e.copiarTodasLasDefinitivas=function(){var a,r,t,n;if(confirm("¿Seguro que quiere copiar todas las definitivas?")){if(e.pasando_definitivas)return;for(e.pasando_definitivas=!0,r=0,t=(n=e.notas_origen.asignaturas).length;r<t;r++)a=n[r],e.pasarNota(a,!0);return setTimeout(()=>e.pasando_definitivas=!1,2e3)}},e.pasarNota=function(a,r){var t,n,o,i,s;if(!r){if(e.pasando_nota)return;e.pasando_nota=!0}for(n=0,o=0,i=(s=e.notas_destino.asignaturas).length;o<i;o++)(t=s[o]).materia_id===a.materia_id&&(n+=1,t.nf_id?(e.asign_temp=a,d.put("::definitivas_periodos/update",{nf_id:t.nf_id,nota:a.nota_asignatura,num_periodo:e.datos_destino.periodo.numero}).then(function(r){return e.evento_definitiva_cambiada(!1,a)},function(r){return e.pasando_nota=!1,400===r.status?c.warning("Parece que no tienes permisos","Lo sentimos"):c.error("No pudimos guardar la nota "+a.nota_asignatura,"",{timeOut:8e3})})):d.put("::definitivas_periodos/update",{alumno_id:e.dato.selected_alumno.id,nota:a.nota_asignatura,asignatura_id:t.asignatura_id,num_periodo:e.datos_destino.periodo.numero}).then(function(r){return e.evento_definitiva_cambiada(!0,a,r.data[0])},function(r){return e.pasando_nota=!1,400===r.status?c.warning("Parece que no tienes permisos","Lo sentimos"):c.error("No pudimos guardar la nota "+a.nota_asignatura,"",{timeOut:8e3})}));if(0===n)return c.warning("No coincide con ninguna materia destino."),e.pasando_nota=!1},e.evento_definitiva_cambiada=function(a,r,t){var o,i,s,u,l,d,p,m;if(a){for(c.success("Creada: "+r.nota_asignatura),m=[],i=0,u=(d=e.notas_destino.asignaturas).length;i<u;i++)(o=d[i]).asignatura_id===t.asignatura_id?(o.nf_id=t.id,o.nota_asignatura=t.nota,o.manual=1,o.recuperada=0,e.pasando_nota=!1,m.push(n(function(){return e.$apply()}))):m.push(void 0);return m}for(s=0,l=(p=e.notas_destino.asignaturas).length;s<l;s++)(o=p[s]).materia_id===e.asign_temp.materia_id&&(o.nota_asignatura=e.asign_temp.nota_asignatura,o.manual=1,n(function(){return e.$apply()}));return c.success("Cambiada: "+r.nota_asignatura),e.pasando_nota=!1},e.cambiaNotaDef=function(a,r,t,n){if(!(r>e.escala_maxima.porc_final||"undefined"===r||void 0===r))return t?d.put("::definitivas_periodos/update",{nf_id:t,nota:r}).then(function(e){return a.manual||(a.manual=1),c.success("Cambiada: "+r)},function(e){return 400===e.status?c.warning("Parece que no tienes permisos","Lo sentimos"):c.error("No pudimos guardar la nota "+r,"",{timeOut:8e3})}):d.put("::definitivas_periodos/update",{alumno_id:e.alumno_traido.alumno_id,nota:r,asignatura_id:a.asignatura_id,num_periodo:n}).then(function(e){return c.success("Creada: "+r),e=e.data[0],a.nf_id=e.id,a.recuperada=0,a.manual=1},function(e){return 400===e.status?c.warning("Parece que no tienes permisos","Lo sentimos"):c.error("No pudimos guardar la nota "+r,"",{timeOut:8e3})});c.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.toggleNotaFinalRecuperada=function(e,a,r){return d.put("::definitivas_periodos/toggle-recuperada",{nf_id:r,recuperada:a}).then(function(r){return a&&!e.manual?(e.manual=1,c.success("Indicará que es recuperada, así que también será manual.")):a?c.success("Recuperada"):c.success("No recuperada")},function(e){return 400===e.status?c.warning("Parece que no tienes permisos","Lo sentimos"):c.error("No pudimos cambiar.","",{timeOut:8e3})})},e.toggleNotaFinalManual=function(e,a,r){return d.put("::definitivas_periodos/toggle-manual",{nf_id:r,manual:a}).then(function(r){return!a&&e.nota_final.recuperada?(e.nota_final.recuperada=!1,c.success("Será automática y no recuperada.")):a?c.success("Nota manual."):c.success("Ahora la calculará el sistema.")},function(e){return 400===e.status?c.warning("Parece que no tienes permisos","Lo sentimos"):c.error("No pudimos cambiar.","",{timeOut:8e3})})},e.verDetalleNota=function(a,r){s.open({templateUrl:"==notas/notaFinalDetalleModal.tpl.html",controller:"NotaFinalDetalleModalCtrl",resolve:{alumno:function(){return r},asignatura:function(){return a},USER:function(){return e.USER},escala_maxima:function(){return e.escala_maxima}}}).result.then(function(e){if("Eliminada"===e)return a.eliminada=!0},function(){})}}]).controller("NotaFinalDetalleModalCtrl",["$scope","$uibModalInstance","alumno","asignatura","AuthService","$http","toastr","$filter","USER","escala_maxima",function(e,a,r,t,n,o,i,s,u,l){return e.alumno=r,e.nota=t,e.hasRoleOrPerm=n.hasRoleOrPerm,e.escala_maxima=l,o.put("::historiales/nota-final-detalle",{nf_id:t.nf_id}).then(function(a){return e.cambios=a.data.cambios,e.nota_detalle=a.data.nota},function(e){return i.warning("No se pudo traer el historial.","Problema")}),e.eliminarNota=function(){return o.delete("::definitivas_periodos/destroy/"+t.nf_id).then(function(e){return i.success("Nota eliminada","Recarga para ver"),a.close("Eliminada")},function(e){return i.error("No se pudo eliminar nota.","Problema")})},e.ok=function(){return a.close(r)},e.cambiaNotaDef=function(a,r,t,n){if(!(r>e.escala_maxima.porc_final||"undefined"===r||void 0===r))return t?o.put("::definitivas_periodos/update",{nf_id:t,nota:r}).then(function(e){return a.manual||(a.manual=1),i.success("Cambiada: "+r)},function(e){return 400===e.status?i.warning("Parece que no tienes permisos","Lo sentimos"):i.error("No pudimos guardar la nota "+r,"",{timeOut:8e3})}):o.put("::definitivas_periodos/update",{alumno_id:e.alumno_traido.alumno_id,nota:r,asignatura_id:a.asignatura_id,num_periodo:n}).then(function(e){return i.success("Creada: "+r),e=e.data[0],a.nf_id=e.id,a.recuperada=0,a.manual=1},function(e){return 400===e.status?i.warning("Parece que no tienes permisos","Lo sentimos"):i.error("No pudimos guardar la nota "+r,"",{timeOut:8e3})});i.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.toggleNotaFinalRecuperada=function(e,a,r){return o.put("::definitivas_periodos/toggle-recuperada",{nf_id:r,recuperada:a}).then(function(r){return a&&!e.manual?(e.manual=1,i.success("Indicará que es recuperada, así que también será manual.")):a?i.success("Recuperada"):i.success("No recuperada")},function(e){return 400===e.status?i.warning("Parece que no tienes permisos","Lo sentimos"):i.error("No pudimos cambiar.","",{timeOut:8e3})})},e.toggleNotaFinalManual=function(e,a,r){return o.put("::definitivas_periodos/toggle-manual",{nf_id:r,manual:a}).then(function(r){return!a&&e.nota_final.recuperada?(e.nota_final.recuperada=!1,i.success("Será automática y no recuperada.")):a?i.success("Nota manual."):i.success("Ahora la calculará el sistema.")},function(e){return 400===e.status?i.warning("Parece que no tienes permisos","Lo sentimos"):i.error("No pudimos cambiar.","",{timeOut:8e3})})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("AsistenciasCtrl",["$scope","toastr","$http","$uibModal","$state","$rootScope","$filter","App","AuthService","$timeout","EscalasValorativasServ","$stateParams","NotasServ",function(e,a,r,t,n,o,i,s,u,l,c,d,p){u.verificar_acceso(),e.asignatura={},e.grupo_id=n.params.grupo_id,e.datos={},e.perfilPath=s.images+"perfil/",e.views=s.views,e.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.ausencia_edit={},e.tardanza_edit={},e.alumno_aus_tard_edit={},e.opts_picker={minDate:new Date("1/1/2017"),showWeeks:!1,startingDay:0},e.hasRoleOrPerm=u.hasRoleOrPerm,r.put("::asistencias/detailed",{con_grupos:!0}).then(function(a){var r,t,n,o,i,s;for(e.alumnos=a.data.alumnos,e.grupos=a.data.grupos,o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),s=[],t=0,n=(i=e.grupos).length;t<n;t++)r=i[t],parseInt(r.id)===parseInt(o)?(e.grupo=r,s.push(e.traerAsistencias(e.grupo))):s.push(void 0);return s},function(e){return a.error("No se pudo traer las notas con asignaturas.")}),localStorage.inmovible_activado?e.inmovible_activado="true"===localStorage.inmovible_activado:e.inmovible_activado=!0,localStorage.ver_institucion?e.ver_institucion="true"===localStorage.ver_institucion:e.ver_institucion=!0,localStorage.ver_clases?e.ver_clases="true"===localStorage.ver_clases:e.ver_clases=!0,e.toggleInmovible=function(){if(e.inmovible_activado=!e.inmovible_activado,localStorage.inmovible_activado=e.inmovible_activado,!e.inmovible_activado)return $("td.fixed-cell").css({transform:"translate(0, 0)"})},e.toggleClases=function(){return e.ver_clases=!e.ver_clases,localStorage.ver_clases=e.ver_clases},e.toggleInstitucion=function(){return e.ver_institucion=!e.ver_institucion,localStorage.ver_institucion=e.ver_institucion},e.traerAsistencias=function(t){var o,i,s;for(localStorage.matr_grupo=t.id,n.go(".",{grupo_id:t.id},{notify:!1}),r.put("::asistencias/detailed",{grupo_id:t.id,con_grupos:!1}).then(function(a){var r,t,n,o,i,s,u,l,c,d,p,m,f,g,_,h;for(e.alumnos=a.data.alumnos,_=[],n=0,u=(p=e.alumnos).length;n<u;n++){for(o=0,l=(m=(r=p[n]).ausencias_clase).length;o<l;o++)(t=m[o]).backup=t.fecha_hora,t.fecha_hora?t.fecha_hora.replace&&(t.fecha_hora=new Date(t.fecha_hora.replace(/-/g,"/"))):t.fecha_hora=new Date;for(i=0,c=(f=r.ausencias).length;i<c;i++)(t=f[i]).backup=t.fecha_hora,t.fecha_hora?t.fecha_hora.replace&&(t.fecha_hora=new Date(t.fecha_hora.replace(/-/g,"/"))):t.fecha_hora=new Date;for(s=0,d=(g=r.tardanzas).length;s<d;s++)(h=g[s]).backup=h.fecha_hora,h.fecha_hora?h.fecha_hora.replace&&(h.fecha_hora=new Date(h.fecha_hora.replace(/-/g,"/"))):h.fecha_hora=new Date;_.push(function(){var e,a,t,n;for(n=[],a=0,e=(t=r.tardanzas_clase).length;a<e;a++)(h=t[a]).backup=h.fecha_hora,h.fecha_hora?h.fecha_hora.replace?n.push(h.fecha_hora=new Date(h.fecha_hora.replace(/-/g,"/"))):n.push(void 0):n.push(h.fecha_hora=new Date);return n}())}return _},function(e){return a.error("No se pudo traer las asistencias.")}),o=0,i=(s=e.grupos).length;o<i;o++)s[o].active=!1;return t.active=!0,e.grupo_id=t.id,e.grupo=t},e.seleccionarFila=function(a){var r,t,n;for(r=0,t=(n=e.alumnos).length;r<t;r++)n[r].seleccionado=!1;return a.seleccionado=!0},e.cambiaAusencia=function(e,t){var n,o,s,u,l,c,d,p,m;if(e[t+"_count"]>e[t].length){for(p=[],l=s=0,c=e[t+"_count"]-e[t].length-1;0<=c?s<=c:s>=c;l=0<=c?++s:--s)o={alumno_id:e.alumno_id,entrada:"ausencias"===t?1:0,tipo:"ausencia"},p.push(r.post("::ausencias/store",o).then(function(a){return a=a.data,e[t].push(a)},function(e){return a.warning("No se pudo agregar ausencia.","Problema")}));return p}if(e[t+"_count"]<e[t].length){for(m=[],l=u=0,d=e[t].length-e[t+"_count"]-1;0<=d?u<=d:u>=d;l=0<=d?++u:--u)n=e[t][e[t].length-l-1].id,m.push(r.delete("::ausencias/destroy/"+n).then(function(a){return a=a.data,e[t]=i("filter")(e[t],{id:"!"+a.id})},function(e){return a.warning("No se pudo quitar ausencia.","Problema")}));return m}},e.cambiaTardanza=function(e,t){var n,o,s,u,l,c,d,p,m;if(e[t+"_count"]>e[t].length){for(d=[],u=o=0,l=e[t+"_count"]-e[t].length-1;0<=l?o<=l:o>=l;u=0<=l?++o:--o)n={alumno_id:e.alumno_id,entrada:"tardanzas"===t?1:0,tipo:"tardanza"},d.push(r.post("::ausencias/store",n).then(function(a){return a=a.data,e[t].push(a)},function(e){return a.warning("No se pudo agregar tardanza.","Problema")}));return d}if(e[t+"_count"]<e[t].length){for(p=[],u=s=0,c=e[t].length-e[t+"_count"]-1;0<=c?s<=c:s>=c;u=0<=c?++s:--s)m=e[t][e[t].length-u-1].id,p.push(r.delete("::ausencias/destroy/"+m).then(function(a){return a=a.data,e.tardanzas=i("filter")(e.tardanzas,{id:"!"+a.id})},function(e){return a.warning("No se pudo quitar tardanza.","Problema")}));return p}},e.clickAusenciaObject=function(a,r){return a.backup=a.fecha_hora,a.fecha_hora?a.fecha_hora.replace&&(a.fecha_hora=new Date(a.fecha_hora.replace(/-/g,"/"))):a.fecha_hora=new Date,e.ausencia_edit=a,e.alumno_aus_tard_edit=r,a.isOpen=!a.isOpen},e.clickTardanzaObject=function(a,r){return a.backup=a.fecha_hora,a.fecha_hora?a.fecha_hora.replace&&(a.fecha_hora=new Date(a.fecha_hora.replace(/-/g,"/"))):a.fecha_hora=new Date,e.tardanza_edit=a,e.alumno_aus_tard_edit=r,a.isOpen=!a.isOpen},e.guardarCambioAusencia=function(t){var n;return n={ausencia_id:t.id,fecha_hora:i("date")(t.fecha_hora,"yyyy-MM-dd HH:mm:ss")},r.put("::ausencias/guardar-cambios-ausencia",n).then(function(a){return a=a.data,e.ausencia_edit.isOpen=!1,e.tardanza_edit.isOpen=!1},function(e){return a.warning("No se pudo agregar tardanza.","Problema")})},e.cancelarCambioAusencia=function(e){return e.isOpen=!1},e.cancelarCambioTardanza=function(e){return e.isOpen=!1},e.eliminarAusencia=function(e,t){return r.delete("::ausencias/destroy/"+e.id).then(function(a){return a=a.data,t.ausencias=i("filter")(t.ausencias,{id:"!"+a.id}),e.isOpen=!1},function(e){return a.warning("No se pudo quitar ausencia.","Problema")})},e.eliminarTardanza=function(e,t){return r.delete("::ausencias/destroy/"+e.id).then(function(a){return a=a.data,t.tardanzas=i("filter")(t.tardanzas,{id:"!"+a.id}),e.isOpen=!1},function(e){return a.warning("No se pudo quitar tardanza.","Problema")})},e.showFrases=function(a){return t.open({templateUrl:"==notas/showFrases.tpl.html",controller:"ShowFrasesCtrl",size:"lg",resolve:{alumno:function(){return a},frases:function(){return r.get("::frases")},asignatura:function(){return e.asignatura},USER:function(){return e.USER}}}).result.then(function(e){return a.frases=e.frases_asignatura},function(e){return console.log(e)})}}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS",function(e,a,r,t){return e.state("panel.notas",{url:"^/notas/:asignatura_id/:profesor_id",views:{maincontent:{templateUrl:"==notas/notas.tpl.html",controller:"NotasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Notas"}]}}},resolve:{escalas:["EscalasValorativasServ",function(e){return e.escalas()}]},data:{displayName:"Notas",icon_fa:"fa fa-graduation-cap",needed_permissions:[t.can_work_like_teacher,t.can_work_like_admin,t.can_edit_notas],pageTitle:"Notas - MyVc"}}).state("panel.definitivas_periodos",{url:"^/definitivas-periodos/:profesor_id",params:{profesor_id:{value:null}},views:{maincontent:{templateUrl:"==notas/definitivasPeriodos.tpl.html",controller:"DefinitivasPeriodosCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Definitivas periodos"}]}}},resolve:{escalas:["EscalasValorativasServ",function(e){return e.escalas()}],asignaturas_definitivas:["$http","AuthService","$stateParams",function(e,a,r){return a.hasRoleOrPerm(["alumno","acudiente"])?"Sin alumnos":r.profesor_id?e.get("::definitivas_periodos",{params:{profesor_id:r.profesor_id}}):e.get("::definitivas_periodos")}]},data:{displayName:"Notas",icon_fa:"fa fa-graduation-cap",needed_permissions:[t.can_work_like_teacher,t.can_work_like_admin,t.can_edit_notas],pageTitle:"Definitivas - MyVc"}}).state("panel.comportamiento",{url:"^/comportamiento/:grupo_id",views:{maincontent:{templateUrl:"==notas/comportamiento.tpl.html",controller:"ComportamientoCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Comportamiento"}]}}},resolve:{comportamiento:["ComportamientoServ","$stateParams",function(e,a){return e.detallados(a.grupo_id)}]},data:{displayName:"Comportamiento",icon_fa:"fa fa-street-view",needed_permissions:[t.can_work_like_teacher,t.can_work_like_admin,t.can_edit_notas],pageTitle:"Comportamiento - MyVc"}}).state("panel.notas_alumno",{url:"^/notas_alumno/:alumno_id",params:{alumno_id:{value:null}},views:{maincontent:{templateUrl:"==notas/notasAlumno.tpl.html",controller:"NotasAlumnoCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Notas alumno"}]}}},resolve:{alumnos:["$http","AuthService","resolved_user",function(e,a,r){return a.hasRoleOrPerm(["alumno","acudiente"])||"Alumno"===r.tipo?"Sin alumnos":e.get("::alumnos/sin-matriculas")}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]},data:{displayName:"Notas alumno",icon_fa:"fa fa-graduation-cap",pageTitle:"Notas alumno - MyVc"}}).state("panel.boletin_acudiente",{url:"/boletin_acudiente/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{maincontent:{templateUrl:"==informes/boletinesPeriodo.tpl.html",controller:"BoletinesPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o;return n=r.defer(),(o=t.getObject("requested_alumno"))&&e.put("::boletines/detailed-notas/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletín del periodo",pageTitle:"Boletín del periodo - MyVc"}}).state("panel.notas_perdidas_profesor_edit",{url:"^/notas_perdidas_profesor_edit",views:{maincontent:{templateUrl:"==notas/notasPerdidasProfesorEdit.tpl.html",controller:"NotasPerdidasProfesorEditCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Notas perdidas a editar"}]}}},data:{displayName:"Notas perdidas a editar",icon_fa:"fa fa-graduation-cap",needed_permissions:[t.can_work_like_teacher,t.can_work_like_admin,t.can_edit_notas],pageTitle:"Notas perdidas a editar - MyVc"}})}]).directive("verTablaDefinitivasPeriodos",["App",function(e){return{restrict:"E",templateUrl:`${e.views}notas/verTablaDefinitivasPeriodos.tpl.html`}}])}.call(this),function(){angular.module("myvcFrontApp").filter("juicioValorativo",[function(){return function(e,a,r){var t;return t={},angular.forEach(a,function(a){if(e>=a.porc_inicial&&e<=a.porc_final)return t.desempenio=a.desempenio,t.valoracion=a.valoracion}),r?t.desempenio:t.valoracion}}]).filter("soloAsignaturasConPerdidas",["$filter",function(e){return function(a,r){return!0===r||"perdidas"===r?(this.asignaturas_resp=[],angular.forEach(a,function(a){if(e("soloUnidadesConPerdidas")(a.unidades,!0).length)return this.asignaturas_resp.push(a)}),this.asignaturas_resp):a}}]).filter("soloUnidadesConPerdidas",["$filter",function(e){return function(a,r){return!0===r||"perdidas"===r?(this.unidades_resp=[],angular.forEach(a,function(a){if(e("soloSubunidadesPerdidas")(a.subunidades,!0).length)return this.unidades_resp.push(a)}),this.unidades_resp):a}}]).filter("soloSubunidadesPerdidas",["Perfil",function(e){return function(a,r){return!0===r||"perdidas"===r?(this.subunidades_resp=[],angular.forEach(a,function(a){if(a.nota&&a.nota.nota<e.User().nota_minima_aceptada)return this.subunidades_resp.push(a)}),this.subunidades_resp):a}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("NotasCtrl",["$scope","toastr","$http","$uibModal","$state","$rootScope","$filter","App","AuthService","$timeout","EscalasValorativasServ","$stateParams","NotasServ",function(e,a,r,t,n,o,i,s,u,l,c,d,p){u.verificar_acceso(),e.asignatura={},e.asignatura_id=n.params.asignatura_id,e.datos={},e.UNIDAD=e.USER.unidad_displayname,e.SUBUNIDAD=e.USER.subunidad_displayname,e.UNIDADES=e.USER.unidades_displayname,e.SUBUNIDADES=e.USER.subunidades_displayname,e.perfilPath=s.images+"perfil/",e.views=s.views,e.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.ocultando_ausencias=!0,e.ausencia_edit={},e.tardanza_edit={},e.alumno_aus_tard_edit={},e.opts_picker={minDate:new Date("1/1/2017"),showWeeks:!1,startingDay:0},e.hasRoleOrPerm=u.hasRoleOrPerm,p.detalladas(d.asignatura_id,d.profesor_id,!0).then(function(a){return e.asignatura=a.asignatura,e.alumnos=a.alumnos,e.unidades=a.unidades,e.asignaturas=a.asignaturas,e.arreglarDatos()},function(e){return a.error("No se pudo traer las notas con asignaturas.")}),c.escalas().then(function(a){return e.escalas=a},function(e){return console.log("No se trajeron las escalas valorativas",e)}),e.escala_maxima=c.escala_maxima(),e.isSimonBolivar=function(){return"casb.micolevirtual.com"===document.location.hostname},e.arreglarDatos=function(){var a,r,t,n,o,i,s,u,c,d,p,m,f,g,_,h,v,b,y,w,C,S,A,E;for(e.subunidadesunidas=[],n=0,u=(h=e.unidades).length;n<u;n++)for(0===(E=h[n]).subunidades.length&&e.subunidadesunidas.push({empty:!0}),o=0,c=(v=E.subunidades).length;o<c;o++)S=v[o],e.subunidadesunidas.push(S);for(localStorage.ocultando_ausencias&&(e.ocultando_ausencias="true"===localStorage.ocultando_ausencias),localStorage.historial_activado&&(e.historial_activado="true"===localStorage.historial_activado),localStorage.inmovible_activado?e.inmovible_activado="true"===localStorage.inmovible_activado:e.inmovible_activado=!0,localStorage.titulos_activado?e.titulos_activado="true"===localStorage.titulos_activado:l(function(){return e.toggleTitulos()},200),i=0,d=(b=e.alumnos).length;i<d;i++){for(s=0,p=(y=(a=b[i]).ausencias).length;s<p;s++)(t=y[s]).fecha_hora&&(t.fecha_hora=new Date(t.fecha_hora));for(g=0,m=(w=a.tardanzas).length;g<m;g++)(A=w[g]).fecha_hora&&(A.fecha_hora=new Date(A.fecha_hora))}for(_=0,f=(C=e.asignaturas).length;_<f;_++)r=C[_],parseInt(r.asignatura_id)===parseInt(e.asignatura.asignatura_id)&&(r.active=!0);return l(function(){return localStorage.tab_horiz_or_verti&&"vertical"===localStorage.tab_horiz_or_verti?e.setTabVertically():e.setTabHorizontally()},1)},e.setTabVertically=function(){var a;if(localStorage.tab_horiz_or_verti="vertical",e.tab_horiz_or_verti="vertical",a=$("table tr"),angular.forEach(a,function(e,a){var r;return r=$(e).find(".input-nota"),angular.forEach(r,function(e,a){return $(e).attr("tabindex",a+1)})}),e.eleFocus&&e.eleFocus.focus)return e.eleFocus.focus()},e.setTabHorizontally=function(){var a;if(localStorage.tab_horiz_or_verti="horizontal",e.tab_horiz_or_verti="horizontal",a=$(".input-nota"),angular.forEach(a,function(e,a){return $(e).attr("tabindex",a+1)}),e.eleFocus)return e.eleFocus.focus()},e.onInputFocus=function(a){return e.eleFocus=a.currentTarget},e.traerNotasDeAsignatura=function(a){var r,t,o;for(n.go(".",{asignatura_id:a.asignatura_id},{notify:!1}),p.detalladas(a.asignatura_id,a.profesor_id,!1).then(function(a){return e.asignatura=a.asignatura,e.alumnos=a.alumnos,e.unidades=a.unidades,e.arreglarDatos()}),r=0,t=(o=e.asignaturas).length;r<t;r++)o[r].active=!1;return a.active=!0,e.asignatura_id=a.asignatura_id},e.toggleHistorial=function(){if(e.historial_activado=!e.historial_activado,localStorage.historial_activado=e.historial_activado,e.historial_activado)return a.info("Ahora dale doble click a la nota que quieres ver")},e.toggleInmovible=function(){if(e.inmovible_activado=!e.inmovible_activado,localStorage.inmovible_activado=e.inmovible_activado,!e.inmovible_activado)return $("td.fixed-cell").css({transform:"translate(0, 0)"})},e.toggleTitulos=function(){return e.titulos_activado=!e.titulos_activado,localStorage.titulos_activado=e.titulos_activado},e.seleccionarFila=function(a){var r,t,n;for(r=0,t=(n=e.alumnos).length;r<t;r++)n[r].seleccionado=!1;return a.seleccionado=!0},e.toggleAusencias=function(){return e.ocultando_ausencias=!e.ocultando_ausencias,localStorage.ocultando_ausencias=e.ocultando_ausencias},e.cambiaAusencia=function(t){var n,o,s,u,l,c,d,p,m;if(t.ausencias_count>t.ausencias.length){for(p=[],l=s=0,c=t.ausencias_count-t.ausencias.length-1;0<=c?s<=c:s>=c;l=0<=c?++s:--s)o={alumno_id:t.alumno_id,asignatura_id:e.asignatura_id,cantidad_ausencia:1},p.push(r.post("::ausencias/store",o).then(function(e){return e=e.data,t.ausencias.push(e)},function(e){return a.warning("No se pudo agregar ausencia.","Problema")}));return p}if(t.ausencias_count<t.ausencias.length){for(m=[],l=u=0,d=t.ausencias.length-t.ausencias_count-1;0<=d?u<=d:u>=d;l=0<=d?++u:--u)n=t.ausencias[t.ausencias.length-l-1].id,m.push(r.delete("::ausencias/destroy/"+n).then(function(e){return e=e.data,t.ausencias=i("filter")(t.ausencias,{id:"!"+e.id})},function(e){return a.warning("No se pudo quitar ausencia.","Problema")}));return m}},e.cambiaTardanza=function(t){var n,o,s,u,l,c,d,p,m;if(t.tardanzas_count>t.tardanzas.length){for(d=[],u=o=0,l=t.tardanzas_count-t.tardanzas.length-1;0<=l?o<=l:o>=l;u=0<=l?++o:--o)n={alumno_id:t.alumno_id,asignatura_id:e.asignatura_id,cantidad_tardanza:1},d.push(r.post("::ausencias/store",n).then(function(e){return e=e.data,t.tardanzas.push(e)},function(e){return a.warning("No se pudo agregar tardanza.","Problema")}));return d}if(t.tardanzas_count<t.tardanzas.length){for(p=[],u=s=0,c=t.tardanzas.length-t.tardanzas_count-1;0<=c?s<=c:s>=c;u=0<=c?++s:--s)m=t.tardanzas[t.tardanzas.length-u-1].id,p.push(r.delete("::ausencias/destroy/"+m).then(function(e){return e=e.data,t.tardanzas=i("filter")(t.tardanzas,{id:"!"+e.id})},function(e){return a.warning("No se pudo quitar tardanza.","Problema")}));return p}},e.clickAusenciaObject=function(a,r){return a.backup=a.fecha_hora,a.fecha_hora?a.fecha_hora=new Date(a.fecha_hora):a.fecha_hora=new Date,e.ausencia_edit=a,e.alumno_aus_tard_edit=r,a.isOpen=!a.isOpen},e.clickTardanzaObject=function(a,r){return a.backup=a.fecha_hora,a.fecha_hora?a.fecha_hora=new Date(a.fecha_hora):a.fecha_hora=new Date,e.tardanza_edit=a,e.alumno_aus_tard_edit=r,a.isOpen=!a.isOpen},e.guardarCambioAusencia=function(t){var n;return n={ausencia_id:t.id,fecha_hora:i("date")(t.fecha_hora,"yyyy-MM-dd HH:mm:ss")},r.put("::ausencias/guardar-cambios-ausencia",n).then(function(a){return a=a.data,alumno.tardanzas.push(a),e.ausencia_edit.isOpen=!1,e.tardanza_edit.isOpen=!1},function(e){return a.warning("No se pudo agregar tardanza.","Problema")})},e.cancelarCambioAusencia=function(e){return e.isOpen=!1},e.cancelarCambioTardanza=function(e){return e.isOpen=!1},e.eliminarAusencia=function(e,t){return r.delete("::ausencias/destroy/"+e.id).then(function(a){return a=a.data,t.ausencias=i("filter")(t.ausencias,{id:"!"+a.id}),e.isOpen=!1},function(e){return a.warning("No se pudo quitar ausencia.","Problema")})},e.eliminarTardanza=function(e,t){return r.delete("::ausencias/destroy/"+e.id).then(function(a){return a=a.data,t.tardanzas=i("filter")(t.tardanzas,{id:"!"+a.id}),e.isOpen=!1},function(e){return a.warning("No se pudo quitar tardanza.","Problema")})},e.cambiaNotaDef=function(t,n,o){if(!(n>e.escala_maxima.porc_final||"undefined"===n||void 0===n))return r.put("::definitivas_periodos/update",{nf_id:o,nota:n}).then(function(e){return t.nota_final.manual||(t.nota_final.manual=1),a.success("Cambiada: "+n)},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})});a.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.toggleNotaFinalRecuperada=function(e,t,n){return r.put("::definitivas_periodos/toggle-recuperada",{nf_id:n,recuperada:t}).then(function(r){return t&&!e.nota_final.manual?(e.nota_final.manual=1,a.success("Indicará que es recuperada, así que también será manual.")):t?a.success("Recuperada"):a.success("No recuperada")},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos cambiar.","",{timeOut:8e3})})},e.toggleNotaFinalManual=function(e,t,n){return r.put("::definitivas_periodos/toggle-manual",{nf_id:n,manual:t}).then(function(r){return!t&&e.nota_final.recuperada?(e.nota_final.recuperada=!1,a.success("Será automática y no recuperada.")):t?a.success("Nota manual."):a.success("Ahora la calculará el sistema.")},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos cambiar.","",{timeOut:8e3})})},e.cambiaNota=function(t,n){if(!(t.nota>e.escala_maxima.porc_final||"undefined"===t.nota||void 0===t.nota))return r.put("::notas/update/"+t.id,{nota:t.nota}).then(function(e){return a.success("Cambiada: "+t.nota),t.updated_at=t.updated_at},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+t.nota,"",{timeOut:8e3})});a.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.showFrases=function(a){return t.open({templateUrl:"==notas/showFrases.tpl.html",controller:"ShowFrasesCtrl",size:"lg",resolve:{alumno:function(){return a},frases:function(){return r.get("::frases")},asignatura:function(){return e.asignatura},USER:function(){return e.USER}}}).result.then(function(e){return a.frases=e.frases_asignatura},function(e){return console.log(e)})},e.promedioTotal=function(e){var a,r,t,n,o;for(a=0,r=0,t=(o=e.notas).length;r<t;r++)a+=(n=o[r]).nota*n.subunidad_porc*n.unidad_porc;return e.total_definit=parseInt(i("number")(a,0)),i("number")(a,1)},e.verDetalleNota=function(a,r){e.historial_activado&&t.open({templateUrl:"==notas/notaDetalleModal.tpl.html",controller:"NotaDetalleModalCtrl",resolve:{alumno:function(){return r},nota:function(){return a}}}).result.then(function(e){if("Eliminada"===e)return a.eliminada=!0},function(){})},e.verifClickNotaRapida=function(a){l(function(){var r;if(o.notaRapida.enable)return a.backup?o.notaRapida.valorNota!==a.nota?(a.backup=a.nota,a.nota=o.notaRapida.valorNota):(r=a.backup,a.backup=a.nota,a.nota=r):(a.backup=a.nota,a.nota=o.notaRapida.valorNota),e.cambiaNota(a)})},e.columnaNotaRapida=function(t){l(function(){var n,i,s,u,l,c,d,p;if(o.notaRapida.enable){for(d=[],s=0,u=(c=e.alumnos).length;s<u;s++)n=c[s],d.push(function(){var s,u,c,d;for(d=[],s=0,u=(c=n.notas).length;s<u;s++)(l=c[s]).subunidad_id===t?(l.backup?o.notaRapida.valorNota!==l.nota?(l.backup=l.nota,l.nota=o.notaRapida.valorNota):(p=l.backup,l.backup=l.nota,l.nota=p):(l.backup=l.nota,l.nota=o.notaRapida.valorNota),i=0,d.push(r.put("::notas/update/"+l.id,{nota:l.nota}).then(function(r){if((i+=1)===e.alumnos.length-1)return a.success(i+1+" notas guardadas.")},function(e){return a.error("No pudimos guardar la nota "+l.nota,"",{timeOut:8e3})}))):d.push(void 0);return d}());return d}return a.info("Activa la Nota Rápida para cambiar todas las notas de esta columna.")})},e.filaNotaRapida=function(e,t){l(function(){var t,n,i,s,u,l,c;if(o.notaRapida.enable){for(l=[],n=0,i=(u=e.notas).length;n<i;n++)(s=u[n]).backup?o.notaRapida.valorNota!==s.nota?(s.backup=s.nota,s.nota=o.notaRapida.valorNota):(c=s.backup,s.backup=s.nota,s.nota=c):(s.backup=s.nota,s.nota=o.notaRapida.valorNota),t=0,l.push(r.put("::notas/update/"+s.id,{nota:s.nota}).then(function(r){if((t+=1)===e.notas.length-1)return a.success(t+1+" notas guardadas.")},function(e){return a.error("No pudimos guardar la nota "+s.nota,"",{timeOut:8e3})}));return l}return a.info("Activa la Nota Rápida para cambiar todas las notas de este alumno.")})}}]).controller("ShowFrasesCtrl",["$scope","$uibModalInstance","alumno","frases","asignatura","$http","toastr","$filter","USER","AuthService",function(e,a,r,t,n,o,i,s,u,l){return e.alumno=r,e.frases=t.data,e.asignatura=n,e.USER=u,e.hasRoleOrPerm=l.hasRoleOrPerm,e.alumno.newFrase="",o.get("::frases_asignatura/show/"+r.alumno_id+"/"+n.asignatura_id).then(function(a){return e.frases_asignatura=a.data},function(e){return i.warning("No se pudo traer frases.","Problema")}),e.addFrase=function(){var a;return""!==e.alumno.newFrase?(a={alumno_id:r.alumno_id,frase:e.alumno.newFrase,asignatura_id:e.asignatura.asignatura_id},o.post("::frases_asignatura/store",a).then(function(a){return e.frases_asignatura=a.data,i.success("Frase añadida.")},function(e){return i.warning("No se pudo añadir frase.","Problema")})):i.warning("No ha copiado ninguna frase")},e.addFrase_id=function(){var a;return e.alumno.newFrase_by_id?(a={alumno_id:r.alumno_id,frase_id:e.alumno.newFrase_by_id.id,asignatura_id:e.asignatura.asignatura_id},o.post("::frases_asignatura/store/"+e.alumno.newFrase_by_id.id,a).then(function(a){return i.success("Frase añadida."),e.frases_asignatura=a.data},function(e){return i.warning("No se pudo añadir frase.","Problema")})):i.warning("No ha seleccionado frase")},e.quitarFrase=function(a){return o.delete("::frases_asignatura/destroy/"+a.id).then(function(r){return i.success("Frase quitada"),e.frases_asignatura=s("filter")(e.frases_asignatura,{id:"!"+a.id})},function(e){return i.warning("No se pudo quitar la frase.","Problema")})},e.ok=function(){return a.close({alumno:r,frases_asignatura:e.frases_asignatura})},e.$on("modal.closing",function(t,n,o){switch(n){case"backdrop click":case"cancel":case"escape key press":return a.close({alumno:r,frases_asignatura:e.frases_asignatura}),t.preventDefault()}})}]).controller("NotaDetalleModalCtrl",["$scope","$uibModalInstance","alumno","nota","AuthService","$http","toastr","$filter",function(e,a,r,t,n,o,i,s){return e.alumno=r,e.nota=t,e.hasRoleOrPerm=n.hasRoleOrPerm,o.put("::historiales/nota-detalle",{nota_id:t.id}).then(function(a){return e.cambios=a.data.cambios,e.nota_detalle=a.data.nota},function(e){return i.warning("No se pudo traer el historial.","Problema")}),e.eliminarNota=function(){return o.delete("::notas/destroy/"+t.id).then(function(e){return i.success("Nota eliminada","Puede recargar y será creada de nuevo"),a.close("Eliminada")},function(e){return i.error("No se pudo eliminar nota.","Problema")})},e.ok=function(){return a.close(r)}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("DefinitivasPeriodosCtrl",["$scope","toastr","$http","$uibModal","$state","$rootScope","$filter","App","asignaturas_definitivas","AuthService","$timeout","EscalasValorativasServ","Excel",function(e,a,r,t,n,o,i,s,u,l,c,d,p){var m,f,g,_,h;for(l.verificar_acceso(),e.asignatura={},e.asignatura_id=n.params.asignatura_id,e.datos={},e.UNIDAD=e.USER.unidad_displayname,e.SUBUNIDAD=e.USER.subunidad_displayname,e.UNIDADES=e.USER.unidades_displayname,e.SUBUNIDADES=e.USER.subunidades_displayname,e.perfilPath=s.images+"perfil/",e.views=s.views,e.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.opts_picker={minDate:new Date("1/1/2017"),showWeeks:!1,startingDay:0},e.dato={asignatura:{}},e.ocultando_ausencias=!0,e.hasRoleOrPerm=l.hasRoleOrPerm,e.showTableToPrint=!1,e.escala_maxima=d.escala_maxima(),e.selectAsignatura=function(a){var r,t,n;for(localStorage.asignatura_id_def=a.asignatura_id,e.dato.asignatura=a,r=0,t=(n=e.asignaturas).length;r<t;r++)n[r].active=!1;return a.active=!0},"Sin alumnos"===u&&(a.warning("No parece que tengas acceso"),n.go("panel")),e.asignaturas=u.data,f=0,e.USER.is_superuser&&(0===e.asignaturas.length?a.warning("Profesor no tiene asignaturas"):e.dato.asignatura.nombres_profesor=e.asignaturas[0].nombres_profesor),localStorage.asignatura_id_def&&(f=parseInt(localStorage.asignatura_id_def)),g=0,_=(h=e.asignaturas).length;g<_;g++)m=h[g],parseInt(m.asignatura_id)===parseInt(f)&&(e.dato.asignatura=m,e.selectAsignatura(e.dato.asignatura));e.cambiaNotaDef=function(t,n,o,i,s){if(!(n>e.escala_maxima.porc_final||"undefined"===n||void 0===n))return o?r.put("::definitivas_periodos/update",{nf_id:o,nota:n,num_periodo:i}).then(function(e){return t["manual_"+i]=1,a.success("Cambiada: "+n)},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})}):r.put("::definitivas_periodos/update",{alumno_id:t.alumno_id,nota:n,asignatura_id:e.dato.asignatura.asignatura_id,num_periodo:i}).then(function(e){return a.success("Creada: "+n),e=e.data[0],t["nf_id_"+i]=e.id,t["nfinal"+i+"_desactualizada"]=0,t["periodo_id"+i]=e.periodo_id,t["recuperada_"+i]=0,t["manual_"+i]=1},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})});a.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.arreglarDuplicados=function(t){var n;return n=e.periodos[t],r.get("::definitivas_periodos/arreglar-duplicados?periodo_id="+n.id).then(function(e){return console.log(e)},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+nota,"",{timeOut:8e3})})},e.cambiaNotaRecuFinal=function(t,n,o){if(!(n>e.escala_maxima.porc_final||"undefined"===n||void 0===n))return t.promedio_automatico>n&&a.error("Debe ser mayor que la definitiva.","No guardado"),o?r.put("::definitivas_periodos/update-recuperacion",{rf_id:o,nota:n}).then(function(e){return a.success("Cambiada: "+n)},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})}):r.put("::definitivas_periodos/update-recuperacion",{alumno_id:t.alumno_id,nota:n,asignatura_id:e.dato.asignatura.asignatura_id}).then(function(e){return a.success("Creada: "+n),e=e.data,t.recu_id=e.id,t.recu_year=e.year,t.recu_nota=e.nota},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})});a.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.eliminarRecuperacion=function(e,t){if(confirm("¿Seguro que desea eliminar nota?"))return r.put("::definitivas_periodos/eliminar-recuperada",{rf_id:t}).then(function(r){return a.success("Eliminada. Puede volver a crearla cuando quiera"),e.recu_id=void 0,e.recu_year=void 0,e.recu_nota=void 0},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos eliminar nota "+nota)})},e.toggleNotaRecuperada=function(e,t,n,o){return r.put("::definitivas_periodos/toggle-recuperada",{nf_id:n,recuperada:t,num_periodo:o}).then(function(r){return t&&!e["manual_"+o]?(e["manual_"+o]=1,a.success("Indicará que es recuperada, así que también será manual.")):t?a.success("Recuperada"):a.success("No recuperada")},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la recuperación.",{timeOut:8e3})})},e.toggleNotaManual=function(e,t,n,o){return r.put("::definitivas_periodos/toggle-manual",{nf_id:n,manual:t,num_periodo:o}).then(function(r){return!t&&e["recuperada_"+o]?(e["recuperada_"+o]=0,a.success("Será automática y no recuperada.")):t?a.success("Nota manual."):a.success("Ahora la calculará el sistema.")},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la recuperación.",{timeOut:8e3})})},e.promedioTotalDef=function(a){var r;return r=0,r=a.promedio_automatico?a.promedio_automatico:(a.nota_final_per1+a.nota_final_per2+a.nota_final_per3+a.nota_final_per4)/4,a.nota_requerida=0,a.total_definit=0,r<e.nota_minima_aceptada&&(a.nota_requerida=i("number")(e.nota_minima_aceptada-r,0)),a.total_definit=i("number")(r,0),a.total_definit},e.toggleAusencias=function(){return e.ocultando_ausencias=!e.ocultando_ausencias,localStorage.ocultando_ausencias=e.ocultando_ausencias},e.cambiaAusencia=function(t){var n,o,s,u,l,c,d,p,m;if(t.ausencias_count>t.ausencias.length){for(p=[],l=s=0,c=t.ausencias_count-t.ausencias.length-1;0<=c?s<=c:s>=c;l=0<=c?++s:--s)o={alumno_id:t.alumno_id,asignatura_id:e.asignatura_id,cantidad_ausencia:1},p.push(r.post("::ausencias/store",o).then(function(e){return e=e.data,t.ausencias.push(e)},function(e){return a.warning("No se pudo agregar ausencia.","Problema")}));return p}if(t.ausencias_count<t.ausencias.length){for(m=[],l=u=0,d=t.ausencias.length-t.ausencias_count-1;0<=d?u<=d:u>=d;l=0<=d?++u:--u)n=t.ausencias[t.ausencias.length-l-1].id,m.push(r.delete("::ausencias/destroy/"+n).then(function(e){return e=e.data,t.ausencias=i("filter")(t.ausencias,{id:"!"+e.id})},function(e){return a.warning("No se pudo quitar ausencia.","Problema")}));return m}},e.cambiaTardanza=function(t){var n,o,s,u,l,c,d,p,m;if(t.tardanzas_count>t.tardanzas.length){for(d=[],u=o=0,l=t.tardanzas_count-t.tardanzas.length-1;0<=l?o<=l:o>=l;u=0<=l?++o:--o)n={alumno_id:t.alumno_id,asignatura_id:e.asignatura_id,cantidad_tardanza:1},d.push(r.post("::ausencias/store",n).then(function(e){return e=e.data,t.tardanzas.push(e)},function(e){return a.warning("No se pudo agregar tardanza.","Problema")}));return d}if(t.tardanzas_count<t.tardanzas.length){for(p=[],u=s=0,c=t.tardanzas.length-t.tardanzas_count-1;0<=c?s<=c:s>=c;u=0<=c?++s:--s)m=t.tardanzas[t.tardanzas.length-u-1].id,p.push(r.delete("::ausencias/destroy/"+m).then(function(e){return e=e.data,t.tardanzas=i("filter")(t.tardanzas,{id:"!"+e.id})},function(e){return a.warning("No se pudo quitar tardanza.","Problema")}));return p}},e.verComoReporte=function(){return e.showTableToPrint=!0},e.exportListToExcel=function(e){return p.tableToExcel(e,"Listado personalizado")},e.clickAusenciaObject=function(a,r){return a.backup=a.fecha_hora,a.fecha_hora?a.fecha_hora=new Date(a.fecha_hora):a.fecha_hora=new Date,e.ausencia_edit=a,e.alumno_aus_tard_edit=r,a.isOpen=!a.isOpen},e.clickTardanzaObject=function(a,r){return a.backup=a.fecha_hora,a.fecha_hora?a.fecha_hora=new Date(a.fecha_hora):a.fecha_hora=new Date,e.tardanza_edit=a,e.alumno_aus_tard_edit=r,a.isOpen=!a.isOpen},e.guardarCambioAusencia=function(t){var n;return n={ausencia_id:t.id,fecha_hora:i("date")(t.fecha_hora,"yyyy-MM-dd HH:mm:ss")},r.put("::ausencias/guardar-cambios-ausencia",n).then(function(a){return a=a.data,alumno.tardanzas.push(a),e.ausencia_edit.isOpen=!1,e.tardanza_edit.isOpen=!1},function(e){return a.warning("No se pudo agregar tardanza.","Problema")})},e.cancelarCambioAusencia=function(e){return e.isOpen=!1},e.cancelarCambioTardanza=function(e){return e.isOpen=!1},e.eliminarAusencia=function(e,t){return r.delete("::ausencias/destroy/"+e.id).then(function(a){return a=a.data,t.ausencias=i("filter")(t.ausencias,{id:"!"+a.id}),e.isOpen=!1},function(e){return a.warning("No se pudo quitar ausencia.","Problema")})},e.eliminarTardanza=function(e,t){return r.delete("::ausencias/destroy/"+e.id).then(function(a){return a=a.data,t.tardanzas=i("filter")(t.tardanzas,{id:"!"+a.id}),e.isOpen=!1},function(e){return a.warning("No se pudo quitar tardanza.","Problema")})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("NotasAlumnoCtrl",["$scope","toastr","$http","$uibModal","$state","alumnos","escalas","$rootScope","$filter","App","AuthService","Perfil","EscalasValorativasServ","$cookies",function(e,a,r,t,n,o,i,s,u,l,c,d,p,m){if(c.verificar_acceso(),e.hasRoleOrPerm=c.hasRoleOrPerm,"Sin alumnos"===!(o=o.data)&&(e.filtered_alumnos=o),e.perfilPath=l.images+"perfil/",e.views=l.views,e.datos={grupo:""},e.USER=d.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.escalas=i,e.config={solo_notas_perdidas:"todas"},e.hasRoleOrPerm(["alumno","acudiente"])||"Alumno"===e.USER.tipo?(e.hasRoleOrPerm(["alumno","acudiente"])||"Alumno"===e.USER.tipo)&&console.log(e.mis_acudidos):r.get("::grupos").then(function(a){return a=a.data,e.grupos=a}),p.escalas().then(function(a){return e.escalas=a,e.escala_maxima=p.escala_maxima()},function(e){return console.log("No se trajeron las escalas valorativas",e)}),e.verBoletin=(()=>{var r,t,o,i;for(t=0,o=(i=e.mis_acudidos).length;t<o;t++)if(!0===(r=i[t]).seleccionado){if(!r.pazysalvo)return void a.info("Lo sentimos. Debe estar a paz y salvo");m.putObject("requested_alumno",[{alumno_id:r.alumno_id,grupo_id:r.grupo_id}]),n.go("panel.boletin_acudiente",{periodo_a_calcular:e.USER.numero_periodo})}}),e.verMiBoletin=(()=>{if(e.USER.pazysalvo)return m.putObject("requested_alumno",[{alumno_id:e.USER.persona_id,grupo_id:e.USER.grupo_id}]),n.go("panel.boletin_acudiente",{periodo_a_calcular:e.USER.numero_periodo});a.info("Lo sentimos. Debe estar a paz y salvo")}),e.cambiaNotaComport=function(t,n){var o;if(e.datos.grupo.titular_id===e.USER.persona_id||e.hasRoleOrPerm("admin"))return t.id?(o=t.nota,r.put("::nota_comportamiento/update/"+t.id,{nota:t.nota}).then(function(e){return a.success("Nota cambiada: "+t.nota)},function(e){return a.error("No pudimos guardar la nota "+t.nota),t.nota=o})):((o={}).nota=t.nota,o.year_id=n.year_id,o.alumno_id=e.datos.selected_alumno.alumno_id,o.periodo_id=n.id,r.put("::nota_comportamiento/crear",o).then(function(e){var r;return r=e.data.nota_comport,t.id=r.id,t.year_id=r.year_id,t.nombres=r.nombres,t.apellidos=r.apellidos,t.alumno_id=r.alumno_id,t.foto_id=r.foto_id,t.foto_nombre=r.foto_nombre,t.sexo=r.sexo,t.periodo_id=r.periodo_id,a.success("Nota creada: "+t.nota)},function(e){return a.error("No pudimos guardar la nota "+o.nota),t=o}));a.warning("No eres el titular para cambiar comportamiento.")},e.verNotasAlumno=function(t,n){return t||(t=e.datos.selected_alumno.alumno_id),n||(n=e.datos.grupo.id),r.get("::notas/alumno/"+t+"/"+n).then(function(r){var t,n,o,i,s,u;if((r=r.data)[0]){for(e.alumno_traido=r[0],e.periodos_notas=r[0].periodos,u=[],n=0,o=(s=e.alumno_traido.notas_tercer_per).length;n<o;n++)t=s[n],i=4*e.USER.nota_minima_aceptada-3*t.nota_final_year,u.push(t.nota_faltante=i<=0?"":i);return u}return e.periodos_notas=void 0,a.warning("Sin matrícula este año.")},function(e){return a.warning("Lo sentimos, No se trajeron las notas")})},e.seleccionarAcudido=function(t){var n,o,i;if(t.pazysalvo){for(n=0,o=(i=e.mis_acudidos).length;n<o;n++)i[n].seleccionado=!1;return t.seleccionado=!0,r.get("::notas/alumno/"+t.alumno_id+"/"+t.grupo_id).then(function(r){var t,n,o,i,s,u;if((r=r.data)[0]){for(e.alumno_traido=r[0],e.periodos_notas=r[0].periodos,u=[],n=0,o=(s=e.alumno_traido.notas_tercer_per).length;n<o;n++)t=s[n],i=4*e.USER.nota_minima_aceptada-3*t.nota_final_year,u.push(t.nota_faltante=i<=0?"":i);return u}return e.periodos_notas=void 0,a.warning("Sin matrícula este año.")},function(e){return a.warning("Lo sentimos, No se trajeron las notas")})}a.info("Lo sentimos. Debe estar a paz y salvo")},n.params.alumno_id){if("Alumno"===e.USER.tipo)return void a.warning("No puedes ver otras notas");e.verNotasAlumno(n.params.alumno_id,e.USER.grupo_id)}return"Alumno"===e.USER.tipo&&e.USER.pazysalvo&&e.verNotasAlumno(e.USER.persona_id,e.USER.grupo_id),e.cambiaNotaDef=function(t,n,o,i){if(!(n>e.escala_maxima.porc_final||"undefined"===n||void 0===n))return o?r.put("::definitivas_periodos/update",{nf_id:o,nota:n}).then(function(e){return t.manual||(t.manual=1),a.success("Cambiada: "+n)},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})}):r.put("::definitivas_periodos/update",{alumno_id:e.alumno_traido.alumno_id,nota:n,asignatura_id:t.asignatura_id,num_periodo:i}).then(function(e){return a.success("Creada: "+n),e=e.data[0],t.nf_id=e.id,t.recuperada=0,t.manual=1},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+n,"",{timeOut:8e3})});a.error("No puede ser mayor de "+e.escala_maxima.porc_final,"NO guardada",{timeOut:8e3})},e.toggleNotaFinalRecuperada=function(e,t,n){return r.put("::definitivas_periodos/toggle-recuperada",{nf_id:n,recuperada:t}).then(function(r){return t&&!e.manual?(e.manual=1,a.success("Indicará que es recuperada, así que también será manual.")):t?a.success("Recuperada"):a.success("No recuperada")},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos cambiar.","",{timeOut:8e3})})},e.toggleNotaFinalManual=function(e,t,n){return r.put("::definitivas_periodos/toggle-manual",{nf_id:n,manual:t}).then(function(r){return!t&&e.nota_final.recuperada?(e.nota_final.recuperada=!1,a.success("Será automática y no recuperada.")):t?a.success("Nota manual."):a.success("Ahora la calculará el sistema.")},function(e){return 400===e.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos cambiar.","",{timeOut:8e3})})},e.cambiaNota=function(e,t){return r.put("::notas/update/"+e.id,{nota:e.nota}).then(function(r){return r=r.data,a.success("Cambiada: "+e.nota)},function(r){return 400===r.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+e.nota,"",{timeOut:8e3})})},e.selectGrupo=function(a){return a?e.filtered_alumnos=u("filter")(o,{grupo_id:a.id},!0):(e.filtered_alumnos=o,m.putObject("requested_alumno","")),e.datos.selected_alumno=""}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("NotasPerdidasProfesorEditCtrl",["$scope","toastr","$http","$uibModal","$state","$filter","App","AuthService",function(e,a,r,t,n,o,i,s){s.verificar_acceso(),e.hasRoleOrPerm=s.hasRoleOrPerm,e.datos={},e.grupos=[],e.gruposOriginales=[],e.profesores=[],e.perfilPath=i.images+"perfil/",e.views=i.views,e.periodos=[{numero_periodo:0,label:"Todos los periodos"},{numero_periodo:1,label:"Primer Periodo"},{numero_periodo:2,label:"Segundo Periodo"},{numero_periodo:3,label:"Tercer Periodo"},{numero_periodo:4,label:"Cuarto Periodo"}],s.hasRoleOrPerm(["profesor"])?r.put("::notas-perdidas/profesor-grupos",{profesor_id:e.USER.persona_id,periodo_a_calcular:e.USER.numero_periodo}).then(function(a){return e.grupos=a.data,e.gruposOriginales=a.data},function(e){return a.error("No se trajeron las notas")}):r.get("::contratos").then(function(a){return e.profesores=a.data},function(e){return a.error("No se trajeron los profesores")}),e.verNotasPerdidasProfesor=function(){return e.datos.profesor?r.put("::notas-perdidas/profesor-grupos",{profesor_id:e.datos.profesor.profesor_id,periodo_a_calcular:10}).then(function(a){return e.grupos=a.data,e.gruposOriginales=a.data},function(e){return a.error("No se trajeron las notas")}):a.warning("Debes elegir profesor")},e.selectFiltrarPeriodo=function(a){var r;return 0===a.numero_periodo?e.grupos=angular.copy(e.gruposOriginales):(r=[],e.gruposOriginales.forEach(function(e){var t;if(t={grupo_id:e.grupo_id,nombre:e.nombre,asignaturas:[]},e.asignaturas.forEach(function(e){var r;if(r={asignatura_id:e.asignatura_id,alias_materia:e.alias_materia,alumnos:[]},e.alumnos.forEach(function(e){var t,n;if((n=e.notas.filter(function(e){return e.numero_periodo===a.numero_periodo})).length>0)return(t=angular.copy(e)).notas=n,r.alumnos.push(t)}),r.alumnos.length>0)return t.asignaturas.push(r)}),t.asignaturas.length>0)return r.push(t)}),e.grupos=r)},e.cambiaNota=function(e){return r.put("::notas/update/"+e.nota_id,{nota:e.nota,num_periodo:e.numero_periodo}).then(function(r){return r=r.data,a.success("Cambiada: "+e.nota)},function(r){return 400===r.status?a.warning("Parece que no tienes permisos","Lo sentimos"):a.error("No pudimos guardar la nota "+e.nota,"",{timeOut:8e3})})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("CumpleanosPorMesesCtrl",["$scope","App","Perfil","meses_cumple","$state","$filter",function(e,a,r,t,n,o){var i,s,u,l,c,d,p,m;for(e.meses_cumple=t.data,e.tamanio_letra=15,e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.alinear="center",e.aumentar_letra=function(){return e.tamanio_letra=e.tamanio_letra+2},e.disminuir_letra=function(){return e.tamanio_letra=e.tamanio_letra-2},e.setAlinear=function(a){return e.alinear=a},e.establecerColumnas=function(e){if(!0!==e.apretado)return e.apretado=!0,e.alumnos_temp=e.alumnos.splice(parseInt(e.alumnos.length/2),e.alumnos.length)},e.setAlinear2=function(a){return e.alinear2=a},e.establecerColumnas2=function(e){return e.apretado=!1,e.alumnos=e.alumnos.concat(e.alumnos_temp),e.alumnos_temp=[]},s=0,l=(p=e.meses_cumple).length;s<l;s++){for(u=0,c=(m=(d=p[s]).alumnos).length;u<c;u++)(i=m[u]).day_nac=i.fecha_nac.substr(8,2);d.alumnos=o("orderBy")(d.alumnos,"day_nac"),d.alumnos_temp=[]}return e.quitar_mes=function(e){return e.quitado=!0},e.$emit("cambia_descripcion","Cumpleaños por meses ")}]).directive("draggable",["$document",function(e){return function(a,r,t){var n,o,i,s,u,l,c;return[l,c,n,s,u]=[null,null,null,null,null],o=function(e){return c=e.pageY-u,(l=e.pageX-s)<0&&(l=0),c<0&&(c=0),a.$apply(function(){return a.$parent.events.push({mousemove:{x:l,y:c,pageX:e.pageX,pageY:e.pageY,startY:u,startX:s}})}),n.css({top:c+"px",left:l+"px"})},i=function(){return e.unbind("mousemove",o),e.unbind("mouseup",i),a.elem&&(a.elem.top=c,a.elem.left=l),a.$apply(function(){return a.$parent.events.push({mouseup:{x:l,y:c}})})},s=0,u=0,a.elem&&(l=a.elem.left,c=a.elem.top),n=null,r.css({position:"relative",cursor:"pointer"}),r.on("mousedown",function(r){if(1===r.which)return r.preventDefault(),n=t.$$element.parent(),a.$apply(function(){return a.$parent.events=[{mousedown:{x:l,y:c,pageX:r.pageX,pageY:r.pageY,startY:u,startX:s}}]}),s=r.pageX-l,u=r.pageY-c,e.on("mousemove",o),e.on("mouseup",i)})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("CalcularPromovidosModalCtrl",["$scope","$uibModalInstance","USER","$http","toastr","$interval","grupos",function(e,a,r,t,n,o,i){return e.USER=r,e.grupos=i,e.calcularTodos=function(){return e.porcentajePromov=0,e.bloqueadoPromov=!0,e.grupo_temp_calculado_promov=!0,e.grupo_temp_indce_promov=0,e.intervalo_promov=o(function(){var a;if(e.grupo_temp_calculado_promov)return e.grupo_temp_calculado_promov=!1,a=e.grupos[e.grupo_temp_indce_promov],e.porcentajePromov=parseInt(100*(e.grupo_temp_indce_promov+1)/e.grupos.length),t.put("::promovidos/calcular-grupo",{grupo_id:a.grupo_id}).then(function(r){if(n.success(a.nombre+" calculado con éxito"),e.grupo_temp_calculado_promov=!0,e.grupo_temp_indce_promov=e.grupo_temp_indce_promov+1,e.grupo_temp_indce_promov===e.grupos.length)return o.cancel(e.intervalo_promov)},function(r){return e.grupo_temp_calculado_promov=!0,n.warning("No se pudo calcular "+a.nombre+". Intentaremos de nuevo.")})},20)},e.calcularGrupo=function(e){return e.calculando?console.log("Calculando"):(e.calculando=!0,t.put("::promovidos/calcular-grupo",{grupo_id:e.grupo_id}).then(function(a){return n.success(e.nombre+" calculado con éxito"),e.calculando=!1},function(a){return e.calculando=!1,n.warning("No se pudo calcular "+e.nombre)}))},e.ok=function(){return a.close()},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").controller("ComportamientoCtrl",["$scope","$filter","$state","comportamiento","$uibModal","App","$http","AuthService","toastr","EscalasValorativasServ",function(e,a,r,t,n,o,i,s,u,l){var c,d,p,m;for(s.verificar_acceso(),e.perfilPath=o.images+"perfil/",e.profesor_id=localStorage.profesor_id,e.frases=t[0],e.alumnos=t[1],e.grupo=t[2],e.hasRoleOrPerm=s.hasRoleOrPerm,e.tipos=[{tipo_frase:"Todas"},{tipo_frase:"Debilidad"},{tipo_frase:"Amenaza"},{tipo_frase:"Oportunidad"},{tipo_frase:"Fortaleza"}],l.escalas().then(function(a){return e.escalas=a,e.escala_maxima=l.escala_maxima()},function(e){return console.log("No se trajeron las escalas valorativas",e)}),e.fraseCheck=function(a){return e.verificandoFrase=!0,i.put("::nota_comportamiento/frases-check",{texto:a}).then(function(a){return e.frases_match=a.data.frases,e.verificandoFrase=!1,e.frases_match.map(function(e){return e.frase})})},e.comprobadorLibro=function(e){return e.libro.per1_conta=0,e.libro.per1_conta=e.libro.per1_col1?e.libro.per1_conta+1:e.libro.per1_conta,e.libro.per1_conta=e.libro.per1_col2?e.libro.per1_conta+1:e.libro.per1_conta,e.libro.per1_conta=e.libro.per1_col3?e.libro.per1_conta+1:e.libro.per1_conta,e.libro.per2_conta=0,e.libro.per2_conta=e.libro.per2_col1?e.libro.per2_conta+1:e.libro.per2_conta,e.libro.per2_conta=e.libro.per2_col2?e.libro.per2_conta+1:e.libro.per2_conta,e.libro.per2_conta=e.libro.per2_col3?e.libro.per2_conta+1:e.libro.per2_conta,e.libro.per3_conta=0,e.libro.per3_conta=e.libro.per3_col1?e.libro.per3_conta+1:e.libro.per3_conta,e.libro.per3_conta=e.libro.per3_col2?e.libro.per3_conta+1:e.libro.per3_conta,e.libro.per3_conta=e.libro.per3_col3?e.libro.per3_conta+1:e.libro.per3_conta,e.libro.per4_conta=0,e.libro.per4_conta=e.libro.per4_col1?e.libro.per4_conta+1:e.libro.per4_conta,e.libro.per4_conta=e.libro.per4_col2?e.libro.per4_conta+1:e.libro.per4_conta,e.libro.per4_conta=e.libro.per4_col3?e.libro.per4_conta+1:e.libro.per4_conta},d=0,p=(m=e.alumnos).length;d<p;d++)(c=m[d]).periodoLibro=1,e.comprobadorLibro(c);return e.selectPeriodo=function(e,a){return a.periodoLibro=e},e.cambiaLibro=function(a,r,t){return i.put("::nota_comportamiento/guardar-libro",{valor:a,campo:t,libro_id:r.libro.id}).then(function(a){return e.comprobadorLibro(r),u.success("Cambios guardados")},function(e){return u.error("Error guardando libro")})},e.addFrase=function(e){var a;if(e.agregando_frase=!0,e.newfrase)return a={comportamiento_id:e.nota.id,frase_id:e.newfrase.id},i.post("::definiciones_comportamiento/store",a).then(function(a){return u.success("Frase agregada con éxito"),e.newfrase.definicion_id=a.data.id,e.definiciones.push(e.newfrase),e.newfrase=null,e.agregando_frase=!1},function(a){return u.error("No se pudo agregar la frase","Problema"),e.agregando_frase=!1});u.warning("Debe seleccionar frase")},e.addFraseEscrita=function(e){var a;if(e.agregando_frase=!0,""!==e.newfrase_escrita)return a={comportamiento_id:e.nota.id,frase:e.newfrase_escrita},i.post("::definiciones_comportamiento/store-escrita",a).then(function(a){return u.success("Frase agregada con éxito"),e.newfrase_escrita="",e.definiciones.push(a.data),e.agregando_frase=!1},function(a){return u.error("No se pudo agregar la frase","Problema"),e.agregando_frase=!1});u.warning("Debe escribir la frase")},e.cambiaNota=function(a,r){var t;return void 0===(t=a[r])&&(a[r]=e.escala_maxima.porc_final,t=a[r]),i.put("::nota_comportamiento/update/"+a.id,{[r]:t}).then(function(e){return u.success("Dato cambiado: "+t)},function(e){return u.error("No pudimos guardar el dato "+t),a[r]=t})},e.quitarFrase=function(e,r){var t;return t=e.definicion_id?e.definicion_id:e.id,i.delete("::definiciones_comportamiento/destroy/"+t).then(function(n){return u.success("Definicion quitada"),e.definicion_id?r.definiciones=a("filter")(r.definiciones,{definicion_id:"!"+t}):r.definiciones=a("filter")(r.definiciones,{id:"!"+t})},function(e){return u.error("No pudimos quitar frase","Problema")})}}]).filter("porTipoFrase",[function(){return function(e,a){var r,t,n,o;if("Todas"===a||void 0===a)return e;for(o=[],t=0,n=e.length;t<n;t++)a===(r=e[t]).tipo_frase&&o.push(r);return o}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider","App","PERMISSIONS",function(e,a,r){e.state("panel.actividades",{url:"^/actividades?grupo_id&asign_id&compartidas",params:{grupo_id:null,asign_id:null,compartidas:null},views:{maincontent:{templateUrl:`${a.views}actividades/actividades.tpl.html`,controller:"ActividadesCtrl",resolve:{datos:["$q","$http","$stateParams",function(e,a,r){var t,n;return t=e.defer(),r.compartidas?a.put("::actividades/compartidas").then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}):(n={grupo_id:r.grupo_id,asign_id:r.asign_id},a.put("::actividades/datos",n).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)})),t.promise}]}},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Actividades"}]}}},data:{displayName:"Actividades",icon_fa:"fa fa-soccer-ball-o",pageTitle:"Actividades - MyVc"}}),e.state("panel.respuestas",{url:"^/respuestas?actividad_id",params:{actividad_id:null},views:{maincontent:{templateUrl:`${a.views}actividades/respuestas.tpl.html`,controller:"RespuestasCtrl",resolve:{datos:["$q","$http","$stateParams",function(e,a,r){var t,n;return t=e.defer(),n={actividad_id:r.actividad_id},a.put("::respuestas/actividad",n).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise}]}},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Respuestas"}]}}},data:{displayName:"Respuestas",icon_fa:"fa fa-soccer-ball-o",pageTitle:"Respuestas - MyVc"}}),e.state("panel.mis_actividades",{url:"^/mis-actividades?alumno_id&asign_id",params:{alumno_id:null,asign_id:null},views:{maincontent:{templateUrl:`${a.views}actividades/misActividades.tpl.html`,controller:"MisActividadesCtrl",resolve:{datos:["$q","$http","$stateParams",function(e,a,r){var t,n;return t=e.defer(),n={alumno_id:r.alumno_id,asign_id:r.asign_id},a.put("::mis-actividades/datos",n).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise}]}},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Mis actividades"}]}}},data:{displayName:"Mis actividades",icon_fa:"fa fa-soccer-ball-o",pageTitle:"Mis actividades - MyVc"}}),e.state("panel.mi_actividad",{url:"^/mi-actividad?actividad_id",params:{actividad_id:null},views:{maincontent:{templateUrl:`${a.views}actividades/miActividad.tpl.html`,controller:"MiActividadCtrl",resolve:{datos:["$q","$http","$stateParams",function(e,a,r){var t,n;return t=e.defer(),n={actividad_id:r.actividad_id},a.put("::mis-actividades/mi-actividad",n).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise}]}},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Actividad"}]}}},data:{displayName:"Actividad",icon_fa:"fa fa-soccer-ball-o",pageTitle:"Actividad - MyVc"}}).state("panel.editar_actividad",{url:"^/editar-actividad?actividad_id",params:{actividad_id:null},views:{maincontent:{templateUrl:`${a.views}actividades/editarActividad.tpl.html`,controller:"EditarActividadCtrl",resolve:{datos:["$q","$http","$stateParams",function(e,a,r){var t;return t=e.defer(),0,r.actividad_id?r.actividad_id:localStorage.pregunta_edit.actividad_id,a.put("::actividades/edicion",{actividad_id:r.actividad_id}).then(function(e){var a,r,n,o,i;if(localStorage.pregunta_edit)for(a=0,r=(i=e.data.actividad.preguntas).length;a<r;a++)n=i[a],o=JSON.parse(localStorage.pregunta_edit),n.id===o.id&&(localStorage.pregunta_edit=JSON.stringify(n));return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise}]}},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar actividad"}]}}},data:{displayName:"Editar actividad",icon_fa:"fa fa-soccer-ball-o",pageTitle:"Editar actividad - MyVc"}}).state("panel.editar_actividad.pregunta",{url:"/pregunta?pregunta_id",views:{preguntacontent:{templateUrl:`${a.views}actividades/editarPregunta.tpl.html`,controller:"EditarPreguntaCtrl",resolve:{datos:["$q","$http","$stateParams","$location",function(e,a,r,t){var n,o;return n=e.defer(),r.pregunta_id?a.put("::preguntas/edicion",{pregunta_id:r.pregunta_id}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e)}):localStorage.pregunta_edit?(o=JSON.parse(localStorage.pregunta_edit),n.resolve(o)):(console.log("No se ha provisto id ni pregunta"),n.reject("No se ha provisto id ni pregunta")),n.promise}]}},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Pregunta"}]}}},data:{displayName:"Pregunta",icon_fa:"fa fa-question",pageTitle:"Pregunta - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("ActividadesCtrl",["$scope","App","$rootScope","$state","$http","$uibModal","$filter","AuthService","datos","$stateParams","toastr",function(e,a,r,t,n,o,i,s,u,l,c){s.verificar_acceso(),e.grupo_id=l.grupo_id,e.asign_id=l.asign_id,e.compartidas=l.compartidas,e.grupos=u.grupos,e.otras_asignaturas=u.otras_asignaturas,e.mis_asignaturas=u.mis_asignaturas,e.$state=t,e.AuthService=s,e.actv_alumnos=u.actv_alumnos,e.actv_profes=u.actv_profes,e.actv_acudi=u.actv_acudi,e.actv_x_respon=u.actv_x_respon,e.perfilPath=a.images+"perfil/",e.views=a.views,r.menucompacto=!0,l.asign_id&&(e.grupo_id=u.grupo_id),e.crear=function(e){return n.post("::actividades/crear",{asignatura_id:e}).then(function(e){return e=e.data,c.success("Actividad creada","Ahora a editar"),t.go("panel.editar_actividad",{actividad_id:e.id})},function(e){return c.error("No se pudo crear actividad.","Error")})},e.eliminarActividad=function(e,r){return o.open({templateUrl:a.views+"actividades/removeActividad.tpl.html",controller:"RemoveActividadCtrl",resolve:{actividad:function(){return e}}}).result.then(function(e){return r.actividades=i("filter")(r.actividades,{id:"!"+e.id})})}}]).controller("RemoveActividadCtrl",["$scope","$uibModalInstance","actividad","$http","toastr",function(e,a,r,t,n){return e.actividad=r,e.ok=function(){return t.delete("::actividades/destroy/"+r.id).then(function(e){return n.success("Actividad enviada a la papelera.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("EditarActividadCtrl",["$scope","App","$rootScope","$state","$http","$uibModal","$filter","AuthService","datos","toastr","$stateParams","$timeout","$location","$anchorScroll",function(e,a,r,t,n,o,i,s,u,l,c,d,p,m){var f,g,_,h,v,b,y,w,C;for(s.verificar_acceso(),e.actividad_id=c.actividad_id,e.datos={selected_grupos:[]},e.mostrando_detalles_actividad=!0,e.perfilPath=a.images+"perfil/",e.views=a.views,e.actividad=u.actividad,e.grupos=u.grupos,e.compartidas=u.compartidas,h=0,b=(w=e.compartidas).length;h<b;h++)for(g=w[h],v=0,y=(C=e.grupos).length;v<y;v++)(_=C[v]).id===g.grupo_id&&e.datos.selected_grupos.push(_);e.actividad.finaliza_at?e.actividad.finaliza_at=new Date(e.actividad.finaliza_at):e.actividad.finaliza_at=new Date,e.actividad.inicia_at?e.actividad.inicia_at=new Date(e.actividad.inicia_at):e.actividad.inicia_at=new Date,e.actividad.para_alumnos=!!e.actividad.para_alumnos,e.actividad.para_profesores=!!e.actividad.para_profesores,e.actividad.para_acudientes=!!e.actividad.para_acudientes,e.editor_options={allowedContent:!0,entities:!1},e.restar=function(a){if(e.actividad[a]>0)return e.actividad[a]=e.actividad[a]-1},e.sumar=function(a){if(e.actividad[a]<1e3)return e.actividad[a]=parseInt(e.actividad[a])+1},e.onEditorReady=function(){return console.log("Editor listo")},f=function(e){return e<10&&(e="0"+e),e},e.ftime_to_string=function(e){var a,r,t;return a=f(e.getHours()),r=f(e.getMinutes()),t=f(e.getSeconds()),e.yyyymmdd()+"T"+a+":"+r+":"+t+".000Z"},e.guardarActividad=function(a){var r,o;return r=e.ftime_to_string(e.actividad.finaliza_at),e.actividad.finaliza_at_str=r,o=e.ftime_to_string(e.actividad.inicia_at),e.actividad.inicia_at_str=o,n.put("::actividades/guardar",e.actividad).then(function(r){if(r=r.data,l.success("Cambios guardados"),a)return t.go("panel.actividades",{asign_id:e.actividad.asignatura_id})},function(e){return l.error("No se pudo guardar cambios")})},e.editar_pregunta=function(a){return t.go("panel.editar_actividad",{actividad_id:e.actividad.id}),localStorage.pregunta_edit=JSON.stringify(a),d(function(){return t.go("panel.editar_actividad.pregunta")})},e.crearPregunta=function(){return u={actividad_id:e.actividad_id},n.post("::preguntas/crear",u).then(function(a){return a=a.data,e.actividad.preguntas.push(a),e.editar_pregunta(a)},function(e){return l.error("No se pudo crear pregunta")})},e.cambios_pregunta_guardados=function(a){return e.actividad.preguntas=i("filter")(e.actividad.preguntas,{id:"!"+a.id}),e.actividad.preguntas.push(a),e.actividad.preguntas=i("orderBy")(e.actividad.preguntas,"orden")},e.duplicar_pregunta=function(a){return a.orden=e.actividad.preguntas.length,n.put("::preguntas/duplicar-pregunta",a).then(function(a){return a=a.data,l.success("Pregunta duplicada"),e.actividad.preguntas.push(a),d(function(){return p.hash("end-preguntas"),m()})},function(e){return l.error("No se pudo duplicar")})},e.on_sort_preguntas=function(e,a,r,t,o){var i,s,c,d,p,m;for(m=[],s=c=0,d=a.length;c<d;s=++c)(p=a[s]).orden=s,(i={})[""+p.id]=s,m.push(i);return u={sortHash:m},n.put("::preguntas/update-orden",u).then(function(e){return!0},function(e){return l.warning("No se pudo ordenar","Problema"),!1})},e.para_alumnos_toggle=function(a){return n.put("::actividades/para-alumnos-toggle",{actividad_id:e.actividad.id,para_alumnos:a}).then(function(e){return a?l.success("Debe haber al menos un grupo seleccionado"):l.info("No la realizarán los alumnos")},function(e){return l.warning("No se pudo guardar cambio","Problema"),!1})},e.para_profesores_toggle=function(a){return n.put("::actividades/para-profesores-toggle",{actividad_id:e.actividad.id,para_profesores:a}).then(function(e){return a?l.success("La realizarán los docentes"):l.info("No la realizarán los docentes")},function(e){return l.warning("No se pudo guardar cambio","Problema"),!1})},e.para_acudientes_toggle=function(a){return n.put("::actividades/para-acudientes-toggle",{actividad_id:e.actividad.id,para_acudientes:a}).then(function(e){return a?l.success("La realizarán los acudientes"):l.info("No la realizarán los acudientes")},function(e){return l.warning("No se pudo guardar cambio","Problema"),!1})},e.toggle_compartida=function(a){return n.put("::actividades/set-compartida",{actividad_id:e.actividad.id,compartida:a}).then(function(e){return l.success("Compartida: "+a)},function(e){return l.warning("No se pudo establecer compartida","Problema"),!1})},e.select_grupo_compartido=function(a){return n.put("::actividades/insert-grupo-compartido",{actividad_id:e.actividad.id,grupo_id:a.id}).then(function(e){return l.success("Grupo agregado")},function(e){return l.warning("No se pudo agregar grupo","Problema"),!1})},e.quitando_grupo_compartido=function(a){return n.put("::actividades/quitando-grupo-compartido",{actividad_id:e.actividad.id,grupo_id:a.id}).then(function(e){return l.success("Grupo quitado")},function(e){return l.warning("No se pudo quitar grupo","Problema"),!1})},e.ver_preguntas=function(){return e.mostrando_preguntas=!0,e.mostrando_detalles_actividad=!1},e.ver_detalles_actividad=function(){return e.mostrando_detalles_actividad=!0}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("MisActividadesCtrl",["$scope","App","$rootScope","$state","$http","$uibModal","$filter","AuthService","datos","$stateParams","toastr",function(e,a,r,t,n,o,i,s,u,l,c){var d,p,m,f;if(s.verificar_acceso(),e.grupo_id=l.grupo_id,e.asign_id=l.asign_id,e.grupos=u.grupos,e.otras_asignaturas=u.otras_asignaturas,e.mis_asignaturas=u.mis_asignaturas,e.perfilPath=a.images+"perfil/",e.views=a.views,r.menucompacto=!0,l.asign_id)for(p=0,m=(f=e.mis_asignaturas).length;p<m;p++)(d=f[p]).asignatura_id===parseInt(e.asign_id)&&(e.actividades=d.actividades,e.asignatura=d);e.crear=function(e){return n.post("::actividades/crear",{asignatura_id:e}).then(function(e){return e=e.data,c.success("Actividad creada","Ahora a editar"),t.go("panel.editar_actividad",{actividad_id:e.id})},function(e){return c.error("No se pudo crear actividad.","Error")})},e.eliminarActividad=function(e,r){return o.open({templateUrl:a.views+"actividades/removeActividad.tpl.html",controller:"RemoveActividadCtrl",resolve:{actividad:function(){return e}}}).result.then(function(e){return r.actividades=i("filter")(r.actividades,{id:"!"+e.id})})}}]).controller("RemoveActividadCtrl",["$scope","$uibModalInstance","actividad","$http","toastr",function(e,a,r,t,n){return e.actividad=r,e.ok=function(){return t.delete("::actividades/destroy/"+r.id).then(function(e){return n.success("Actividad enviada a la papelera.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("MiActividadCtrl",["$scope","App","$rootScope","$state","$http","$uibModal","$filter","AuthService","datos","$stateParams","toastr",function(e,a,r,t,n,o,i,s,u,l,c){s.verificar_acceso(),e.actividad_id=l.actividad_id,e.perfilPath=a.images+"perfil/",e.views=a.views,e.actividad=u.actividad,e.actividad_resuelta=u.actividad_resuelta,r.menucompacto=!0,e.seleccionar_opcion=function(a,r){var t,o,i;for(u={actividad_resuelta_id:e.actividad_resuelta.id,pregunta_id:a.id,tipo_pregunta:a.tipo_pregunta,opcion_id:r.id,opcion_cuadricula_id:null},e.actividad.one_by_one||n.put("::mis-actividades/seleccionar-opcion",u).then(function(){return c.success("Selección guardada")},function(){return c.error("No se pudo guardar selección")}),t=0,o=(i=a.opciones).length;t<o;t++)i[t].seleccionada=!1;return r.seleccionada=!0},e.finalizar_actividad=function(){return o.open({templateUrl:a.views+"actividades/finalizarActividad.tpl.html",controller:"FinalizarActividadCtrl",resolve:{actividad:function(){return e.actividad}}}).result.then(function(a){return t.go("panel.mis_actividades",{alumno_id:e.USER.persona_id})})}}]).controller("FinalizarActividadCtrl",["$scope","$uibModalInstance","actividad","$http","toastr",function(e,a,r,t,n){return e.actividad=r,e.ok=function(){return t.put("::mis-actividades/finalizar-actividad",{actividad_resuelta_id:r.actividad_resuelta_id}).then(function(){return n.info("Has finalizado actividad"),a.close(r)},function(){return n.error("No se pudo guardar selección")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("EditarPreguntaCtrl",["$scope","App","$rootScope","$state","$http","$uibModal","$filter","AuthService","datos","toastr","$stateParams","$location","$anchorScroll","$timeout",function(e,a,r,t,n,o,i,s,u,l,c,d,p,m){s.verificar_acceso(),e.pregunta_id=c.pregunta_id,e.perfilPath=a.images+"perfil/",e.views=a.views,e.pregunta=u,e.editor_options={allowedContent:!0,entities:!1},m(function(){return d.hash("scroll-pregunta"),p()}),e.onEditorReady=function(){return console.log("Editor listo")},e.guardar_cambios=function(a){return n.put("::preguntas/guardar",e.pregunta).then(function(r){if(r=r.data,e.$parent.cambios_pregunta_guardados(e.pregunta),l.success("Cambios guardados"),a)return t.go("panel.editar_actividad",{actividad_id:e.pregunta.actividad_id})},function(e){return l.error("No se pudo guardar cambios")})},e.restar=function(a){if(e.pregunta[a]>0)return e.pregunta[a]=e.pregunta[a]-1},e.sumar=function(a){if(e.pregunta[a]<1e3)return e.pregunta[a]=parseInt(e.pregunta[a])+1},e.cancelar=function(){return t.go("panel.editar_actividad",{actividad_id:e.pregunta.actividad_id})},e.add_opcion=function(){var a,r;return r={definicion:"Opcion "+((a=e.pregunta.opciones.length)+1),orden:a,pregunta_id:e.pregunta.id,is_correct:!1},n.put("::opciones/add-opcion",r).then(function(a){return a=a.data,l.success("Opción agregada"),e.pregunta.opciones.push(a)},function(e){return l.error("No se pudo agregar")})},e.toggle_opcion_otra=function(a){return n.put("::preguntas/toggle-opcion-otra",{id:e.pregunta.id,opcion_otra:a}).then(function(r){return r=r.data,l.success("Opción OTRA agregada"),e.pregunta.opcion_otra=a},function(e){return l.error("No se pudo agregar OTRA")})},e.setOpcionCorrect=function(a){return n.put("::opciones/set-opcion-correct",a).then(function(r){var t,n,o,i,s;for(r=r.data,s=[],t=0,n=(i=e.pregunta.opciones).length;t<n;t++)o=i[t],s.push(o.is_correct=a===o);return s},function(e){return l.error("No se pudo establecer correcta")})},e.eliminarOpcion=function(a){return n.delete("::opciones/destroy/"+a.id).then(function(r){return r=r.data,l.success("Opción eliminada"),e.pregunta.opciones=i("filter")(e.pregunta.opciones,{id:"!"+a.id})},function(e){return l.error("No se pudo establecer correcta")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("RespuestasCtrl",["$scope","App","$rootScope","$state","$http","$uibModal","$filter","AuthService","datos","$stateParams","toastr",function(e,a,r,t,n,o,i,s,u,l,c){var d,p,m,f,g,_,h,v,b,y,w;for(s.verificar_acceso(),e.actividad_id=l.actividad_id,e.perfilPath=a.images+"perfil/",e.views=a.views,e.plantilla=e.views+"notas/popoverAlumnoInfo.tpl.html?"+Math.random().toString(36).slice(2),e.actividad=u.actividad,e.grupos=u.grupos,r.menucompacto=!0,e.alumnos_unidos=[],p=0,g=(b=e.grupos).length;p<g;p++)for(m=0,_=(y=b[p].alumnos).length;m<_;m++)d=y[m],e.alumnos_unidos.push(d);for(e.cantOpcMaxi=0,f=0,h=(w=e.actividad.preguntas).length;f<h;f++)v=w[f],e.cantOpcMaxi=v.opciones.length>e.cantOpcMaxi?v.opciones.length:e.cantOpcMaxi;e.getOpcionesMaximas=function(){return new Array(e.cantOpcMaxi)},e.finalizar_actividad=function(){return o.open({templateUrl:a.views+"actividades/finalizarActividad.tpl.html",controller:"FinalizarActividadCtrl",resolve:{actividad:function(){return e.actividad}}}).result.then(function(a){return t.go("panel.mis_actividades",{alumno_id:e.USER.persona_id})})}}]).controller("FinalizarActividadCtrl",["$scope","$uibModalInstance","actividad","$http","toastr",function(e,a,r,t,n){return e.actividad=r,e.ok=function(){return t.put("::mis-actividades/finalizar-actividad",{actividad_resuelta_id:r.actividad_resuelta_id}).then(function(){return n.info("Has finalizado actividad"),a.close(r)},function(){return n.error("No se pudo guardar selección")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider",function(e){e.state("panel.profesores.nuevo",{url:"/nuevo",views:{edit_profesor:{templateUrl:"==profesores/profesoresNew.tpl.html",controller:"ProfesoresNewCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo profesor"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-graduation-cap",pageTitle:"Profesor nuevo - MyVc"}}).state("panel.profesores.editar",{url:"/editar/:profe_id",views:{edit_profesor:{templateUrl:"==profesores/profesoresEdit.tpl.html",controller:"ProfesoresEditCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar alumno"}]}}},data:{displayName:"Editar",icon_fa:"fa fa-graduation-cap",pageTitle:"Editar profesor - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("ProfesoresCtrl",["$scope","$uibModal","toastr","uiGridConstants","$http","$state","App","$filter","Acentos",function(e,a,r,t,n,o,i,s,u){var l,c,d,p,m,f;e.gridScope=e,e.current_year=e.USER.year_id,e.views=i.views,e.perfilPath=i.images+"perfil/",e.editar=function(e){return o.go("panel.profesores.editar",{profe_id:e.id})},e.eliminar=function(r){return a.open({templateUrl:"==profesores/removeProfesor.tpl.html",controller:"RemoveProfesorCtrl",resolve:{profesor:function(){return r}}}).result.then(function(a){return e.gridOptions.data=s("filter")(e.gridOptions.data,{alumno_id:"!"+a.alumno_id})})},c='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',d="==profesores/botonContratar.tpl.html",f="==directives/botonesResetPassword.tpl.html",m="==directives/botonIsActive.tpl.html",l="==profesores/botonEditUsername.tpl.html",e.gridOptions={enableSorting:!0,enableFiltering:!0,exporterSuppressColumns:["edicion"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Todos los docentes - MyVC.csv",enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"no",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{name:"contrato",pinnedLeft:!0,displayName:"Contrato",width:75,enableFiltering:!1,cellTemplate:d,enableCellEdit:!1},{field:"nombres",enableHiding:!1,minWidth:150,pinnedLeft:!0,filter:{condition:u.buscarEnGrid},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;"><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:150},{field:"id",displayName:"Id",width:50,enableFiltering:!1,enableCellEdit:!1},{name:"edicion",displayName:"Edición",width:50,enableSorting:!1,enableFiltering:!1,cellTemplate:c,enableCellEdit:!1},{field:"is_active",displayName:"Activo?",cellTemplate:m,minWidth:60,enableCellEdit:!1},{field:"sexo",displayName:"Sex",width:40},{field:"num_doc",displayName:"Documento",minWidth:130,cellFilter:"formatNumberDocumento"},{field:"username",filter:{condition:t.filter.CONTAINS},displayName:"Usuario",cellTemplate:f,editableCellTemplate:l,minWidth:135},{field:"fecha_nac",displayName:"Nacimiento",cellFilter:"date:mediumDate",type:"date",minWidth:100},{field:"celular",minWidth:100},{field:"titulo",minWidth:200},{field:"email_usu",displayName:"Email",minWidth:250},{field:"direccion",minWidth:200}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,t,o,i){return o!==i&&n.put("::profesores/update/"+a.id,a).then(function(e){return r.success("Profesor actualizado con éxito","Actualizado")},function(e){return r.error("Cambio no guardado","Error")}),e.$apply()})}},e.toggleActive=function(e){var a;return e.is_active=!e.is_active,a={persona_id:e.persona_id,user_id:e.user_id,propiedad:"is_active",valor:e.is_active},n.put("::profesores/guardar-valor",a).then(function(e){return console.log("Cambios guardados")},function(a){return e.is_active=!e.is_active,r.error("Cambio no guardado","Error")})},n.get("::profesores").then(function(a){return e.gridOptions.data=a.data}),e.$on("profesorcreado",function(a,r){return e.gridOptions.data.push(r)}),e.quitarContrato=function(a){return n.delete("::contratos/destroy/"+a).then(function(t){return r.success("Quitado de este año "+e.USER.year),e.gridCurrentOptions.data=s("filter")(e.gridCurrentOptions.data,{contrato_id:"!"+a}),s("filter")(e.gridOptions.data,{contrato_id:a})[0].year_id=null},function(e){return r.error("No se pudo agregar el profesor al presente año","Problema")})},e.contratar=function(a){return n.post("::contratos",{profesor_id:a.id}).then(function(t){var n;return r.success(a.nombres+" contratado para este año"),t=t.data[0],e.gridCurrentOptions.data.push(t),(n=s("filter")(e.gridOptions.data,{id:t.profesor_id})[0]).year_id=e.current_year,n.contrato_id=t.contrato_id},function(e){return e.data.contratado?r.warning("Este profesor ya está contratado"):r.error("No se pudo agregar el profesor al presente año","Problema")})},p='<a uib-tooltip="Quitar de año actual" tooltip-placement="left" class="btn btn-default btn-xs shiny danger" ng-click="grid.appScope.quitarContrato(row.entity.contrato_id)"><i class="fa fa-times "></i></a>',e.gridCurrentOptions={enableSorting:!0,enableFiltering:!0,exporterSuppressColumns:["edicion"],exporterCsvColumnSeparator:";",exporterMenuPdf:!1,exporterMenuExcel:!1,exporterCsvFilename:"Docentes contratados - MyVC.csv",enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"no",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{field:"profesor_id",displayName:"Id",width:50,enableFiltering:!1,enableCellEdit:!1},{name:"edicion",displayName:"Edición",width:50,enableSorting:!1,enableFiltering:!1,cellTemplate:p,enableCellEdit:!1},{field:"nombres",enableHiding:!1,minWidth:100},{field:"apellidos",minWidth:100},{field:"sexo",displayName:"Sex",width:40},{field:"username",filter:{condition:t.filter.CONTAINS},displayName:"Usuario",cellTemplate:f,editableCellTemplate:l,minWidth:135},{field:"fecha_nac",displayName:"Nacimiento",minWidth:100},{field:"email_usu",displayName:"Email",minWidth:250},{field:"celular",minWidth:100}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,t,o,i){return o!==i&&n.put("::profesores/update/"+a.profesor_id,a).then(function(e){return r.success("Profesor actualizado con éxito","Actualizado")},function(e){return r.error("Cambio no guardado","Error")}),e.$apply()})}},n.get("::contratos").then(function(a){return e.gridCurrentOptions.data=a.data},function(e){return r.error("No se trajeron los profesores contratados")}),e.cambiaUsernameCheck=function(a){return e.verificandoUsername=!0,n.put("::users/usernames-check",{texto:a}).then(function(a){return e.username_match=a.data.usernames,e.verificandoUsername=!1,e.username_match.map(function(e){return e.username})})},e.resetPass=function(e){return a.open({templateUrl:i.views+"usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){})}}]).controller("RemoveProfesorCtrl",["$scope","$uibModalInstance","profesor","$http","toastr",function(e,a,r,t,n){return e.profesor=r,e.ok=function(){return t.delete("::profesores/destroy/"+r.id).then(function(e){return n.success("Profesor enviado a la papelera.","Eliminado")},function(e){return n.warning("No se pudo enviar a la papelera.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("ProfesoresNewCtrl",["$scope","$http","toastr","$filter","$state",function(e,a,r,t,n){e.profesor={sexo:"M",password:"1234567",fecha_nac:new Date("1990-01-01")},e.estados_civiles=[{estado_civil:"Soltero"},{estado_civil:"Casado"},{estado_civil:"Divorciado"},{estado_civil:"Viudo"}],a.get("::paises").then(function(a){return e.paises=a.data}),a.get("::tiposdocumento").then(function(a){return e.tipos_doc=a.data}),e.crear=function(){return e.profesor.fecha_nac=t("date")(e.profesor.fecha_nac,"yyyy-MM-dd"),a.post("::profesores/store",e.profesor).then(function(a){return r.success("Profesor creado"),e.$emit("profesorcreado",a.data),n.go("panel.profesores")},function(e){return r.error("Profesor NO creado","Problema")})},e.paisNacSelect=function(r,t){return a.get("::ciudades/departamentos/"+r.id).then(function(a){if(e.departamentosNac=a.data,void 0===e.profesor.pais_doc)return e.profesor.pais_doc=r,e.paisSelecionado(r)})},e.departNacSelect=function(r){return a.get("::ciudades/por-departamento/"+r.departamento).then(function(a){if(e.ciudadesNac=a.data,void 0===e.profesor.departamento_doc)return e.profesor.departamento_doc=r,e.departSeleccionado(r)})},e.paisSelecionado=function(r,t){return a.get("::ciudades/departamentos/"+r.id).then(function(a){return e.departamentos=a.data})},e.departSeleccionado=function(r){return a.get("::ciudades/por-departamento/"+r.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yy"}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("ProfesoresEditCtrl",["$scope","toastr","$http","$state","$filter",function(e,a,r,t,n){e.data={},e.profesor={},e.paises=[{id:1,pais:"COLOMBIA"}],e.tipos_doc=[{id:1,tipo:"CC"}],e.departamentos=[{id:1,departamento:"ANTIOQUIA"}],e.ciudades=[{id:1,ciudad:"MEDELLÍN"}],e.sangres=[{sangre:"O+"},{sangre:"O-"},{sangre:"A+"},{sangre:"A-"},{sangre:"B+"},{sangre:"B-"},{sangre:"AB+"},{sangre:"AB-"}],e.estados_civiles=[{estado_civil:"Soltero"},{estado_civil:"Casado"},{estado_civil:"Divorciado"},{estado_civil:"Viudo"}],r.get("::profesores/show/"+t.params.profe_id).then(function(a){var t,n,o,i;if(e.profesor=a.data[0],e.profesor.fecha_nac=new Date(e.profesor.fecha_nac),e.profesor.password="",e.profesor.password2="",e.profesor.estado_civil)for(n=0,o=(i=e.estados_civiles).length;n<o;n++)(t=i[n]).estado_civil===e.profesor.estado_civil&&(e.profesor.estado_civil=t);else e.profesor.estado_civil=e.estados_civiles[0];return null===e.profesor.ciudad_nac?(e.profesor.pais_nac={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisNacSelect(e.profesor.pais_nac,e.profesor.pais_nac)):r.get("::ciudades/datosciudad/"+e.profesor.ciudad_nac).then(function(a){var r,t,n,o,i,s,u,l,c,d,p,m,f;for(e.paises=a.data.paises,e.departamentosNac=a.data.departamentos,e.ciudadesNac=a.data.ciudades,n=0,s=(d=e.paises).length;n<s;n++)(c=d[n]).id===a.data.pais.id&&(e.profesor.pais_nac=c);for(o=0,u=(p=e.departamentosNac).length;o<u;o++)(t=p[o]).departamento===a.data.departamento.departamento&&(e.profesor.departamento_nac=t);for(f=[],i=0,l=(m=e.ciudadesNac).length;i<l;i++)(r=m[i]).id===a.data.ciudad.id?f.push(e.profesor.ciudad_nac=r):f.push(void 0);return f}),null===e.profesor.ciudad_doc?(e.profesor.pais_doc={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisDocSelect(e.profesor.pais_doc,e.profesor.pais_doc)):r.get("::ciudades/datosciudad/"+e.profesor.ciudad_doc).then(function(a){return a=a.data,e.paises=a.paises,e.departamentos=a.departamentos,e.ciudades=a.ciudades,e.profesor.pais_doc=a.pais,e.profesor.departamento_doc=a.departamento,e.profesor.ciudad_doc=a.ciudad}),r.get("::tiposdocumento").then(function(a){var r,t,n,o,i;if(e.tipos_doc=a.data,null===e.profesor.tipo_doc)return e.profesor.tipo_doc=e.tipos_doc[0];for(o=[],r=0,t=(n=e.tipos_doc).length;r<t;r++)i=n[r],e.profesor.tipo_doc===i.id?o.push(e.profesor.tipo_doc=i):o.push(void 0);return o})}),r.get("::paises").then(function(a){return e.paises=a.data},function(e){return a.error("No se pudo traer los paises")}),e.guardar=function(){if(0===e.profesor.password.length){if(e.profesor.password.length>0)return void a.warning("Si lo quieres es cambiar la contraseña, debes copiarla 2 veces.")}else{if(e.profesor.password.length<3)return void a.warning("La contraseña debe tener al menos 3 caracteres");if(e.profesor.password!==e.profesor.password2)return void a.warning("Las contraseñas deben ser iguales")}return r.put("::profesores/update/"+e.profesor.profesor_id,e.profesor).then(function(e){return a.success("Profesor actualizado con éxito")},function(e){return a.error("No se guardaron los cambios","Problemas")})},e.paisNacSelect=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(r){if(e.departamentosNac=r.data,void 0===e.profesor.pais_doc)return e.profesor.pais_doc=a,e.paisDocSelect(a)})},e.departNacSelect=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(r){if(e.ciudadesNac=r.data,void 0===e.profesor.departamento_doc)return e.profesor.departamento_doc=a,e.departDocSelect(a)})},e.paisDocSelect=function(a,t){return r.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentos=a.data})},e.departDocSelect=function(a){return r.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yyyy"}}])}.call(this),function(){angular.module("myvcFrontApp").controller("AreasCtrl",["$scope","toastr","$filter","$http","$uibModal",function(e,a,r,t,n){var o,i;return e.creando=!1,e.editando=!1,e.currentArea={},e.currenAreaEdit={},e.gridScope=e,e.cancelarCrear=function(){return e.creando=!1},e.cancelarEdit=function(){return e.editando=!1},e.crear=function(){return t.post("::areas",e.currentArea).then(function(r){return e.gridOptions.data.push(r.data),delete e.currentArea,a.success("Area creada con éxito")},function(e){return a.error("Error creando","Problema")})},e.guardar=function(){return t.put("::areas/update/"+e.currentAreaEdit.id,e.currentAreaEdit).then(function(r){return delete e.currentAreaEdit,a.success("Area actualizada con éxito"),e.cancelarEdit()},function(e){return a.error("Error guardando","Problema")})},e.editar=function(a){return e.currentAreaEdit=a,e.editando=!0},e.eliminar=function(a){return n.open({templateUrl:"==areas/removeArea.tpl.html",controller:"RemoveAreaCtrl",resolve:{area:function(){return a}}}).result.then(function(a){return e.gridOptions.data=r("filter")(e.areas,{id:"!"+a.id})})},o='<a uib-tooltip="Editar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',i='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"id",type:"number",maxWidth:50,enableFiltering:!1},{name:"edicion",displayName:"Edición",maxWidth:50,enableSorting:!1,enableFiltering:!1,cellTemplate:o+i,enableCellEdit:!1},{field:"orden",type:"number",maxWidth:40,enableSorting:!1},{field:"nombre",enableHiding:!1},{field:"alias",displayName:"Alias"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){return t!==n&&(e.currentAreaEdit=a,e.guardar()),e.$apply()})}},t.get("::areas").then(function(a){return e.areas=a.data,e.gridOptions.data=e.areas})}]).controller("RemoveAreaCtrl",["$scope","$uibModalInstance","area","$http","toastr",function(e,a,r,t,n){return e.area=r,e.ok=function(){return t.delete("::areas/destroy/"+r.id).then(function(e){return n.success("Grupo eliminado: "+r.nombre,"Eliminado")},function(e){return n.warning("Problema","No se pudo eliminar el area.")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("LoginCtrl",["$scope","$rootScope","AUTH_EVENTS","AuthService","$location","$cookies","Perfil","App","$http","toastr","$sce",function(e,a,r,t,n,o,i,s,u,l,c){e.logueando=!0,e.recuperando=!1,e.registrando=!1,e.perfilPath=s.images+"perfil/",e.logoPathDefault="images/Logo_MyVc_Header.gif",e.logoPath="images/Logo_Colegio_Header.gif",e.verPublicacionDetalle=function(){return l.info("Debes loguearte para ver más detalles.")},u.get(e.logoPath).then(function(){return console.log("imagen existe")},function(){return e.logoPath=e.logoPathDefault}),e.abrirImagenBlank=function(e){return window.open(e,"_blank")},e.ir_prematricular=function(){return e.mostrando_prematricular=!e.mostrando_prematricular,e.mostrando_prematricular?e.estilo_login="height: 600px !important;":e.estilo_login=""},e.guardar_prematricula=function(){var a;return e.guardando=!0,(a=e.credentials).nombres.length&&a.apellidos.length&&a.celular.length&&a.documento.length?(a.estado="PREA",a.nuevo=1,a.year=e.year.year+1,a.grupo_id=e.year.grupo_prematr.id,u.put("::login/crear-prematricula",a).then(function(a){return l.success(a.data.estado),e.credentials={username:"",password:"",sexo:"M",nombres:"",apellidos:"",celular:"",documento:""},e.ir_prematricular()},function(){return e.logoPath=e.logoPathDefault})):l.error("Faltan datos, por favor escíbelos todos.")},u.put("::publicaciones/ultimas").then(function(a){var r,t,n,o,i;for(e.publicaciones=a.data.publicaciones,e.year=a.data.year,i=[],r=0,t=(o=e.publicaciones).length;r<t;r++)n=o[r],i.push(n.contenido=c.trustAsHtml(n.contenido));return i},function(){return e.logoPath=e.logoPathDefault}),e.credentials={username:"",password:"",sexo:"M",nombres:"",apellidos:"",celular:"",documento:""},e.host=n.host(),e.login=function(e){return localStorage.removeItem("xtoken"),i.deleteUser(),t.login_credentials(e).then(function(e){t.verificar().then(function(e){return localStorage.removeItem("logueando")},function(e){return console.log("Falló en Verificar",e)})})},e.enviarPass=function(e){return u.post("::login/ver-pass",{email:e,ruta:location.origin+location.pathname}).then(function(e){return alert("Ahora, verifica tu correo")},function(){return alert("Parece que el correo no está registrado.")})},e.to_recuperando=function(){return e.logueando=!1,e.recuperando=!0,e.registrando=!1},e.to_registrando=function(){return e.logueando=!1,e.recuperando=!1,e.registrando=!0},e.to_logueando=function(){return e.logueando=!0,e.recuperando=!1,e.registrando=!1}}]).controller("ResetPasswordCtrl",["$scope","$state","$stateParams","$cookies","Perfil","App","$http","toastr",function(e,a,r,t,n,o,i,s){e.reseteando=!1,e.username=r.username,e.logoPath="images/Logo_Colegio_Header.gif",r.numero<1e4&&(console.log("Reseteo inválido, deja de intentarlo."),a.go("login")),e.credentials={password1:"",password2:""},e.reset=function(t){return e.reseteando=!0,t.password1!==t.password2?(s.warning("Las contraseñas no coinciden."),void(e.reseteando=!1)):t.password1.length<4?(s.warning("Debe tener al menos 4 caracteres"),void(e.reseteando=!1)):i.put("::login/reset-password",{password1:t.password1,numero:r.numero,username:r.username}).then(function(r){return"Token inválido"===r.data?(s.warning("Token inválido"),e.reseteando=!1):a.go("login")},function(a){return console.log("No se pudo resetear"),e.reseteando=!1})}}])}.call(this),function(){angular.module("myvcFrontApp").directive("loginDialog",["AUTH_EVENTS","App",function(e,a){return{restrict:"A",templateUrl:"==login/login-form.html",link:function(a){var r;return r=function(){return a.visible=!0},a.visible=!1,a.$on(e.notAuthenticated,r),a.$on(e.sessionTimeout,r)}}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("LogoutCtrl",["$scope","$state","Perfil",function(e,a,r){return console.log("A salir!!"),a.go("login")}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider",function(e){return e.state("panel.niveles",{url:"^/niveles",views:{maincontent:{templateUrl:"==grados/niveles.tpl.html",controller:"NivelesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Niveles educativos"}]}}},data:{displayName:"Niveles",icon_fa:"fa fa-graduation-cap",pageTitle:"Niveles - MyVc"}}),e.state("panel.niveles.nuevo",{url:"/nuevo",views:{edit_nivel:{templateUrl:"==grados/nivelesNew.tpl.html",controller:"NivelesNewCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-graduation-cap",pageTitle:"Nivel nuevo - MyVc"}}),e.state("panel.niveles.editar",{url:"/editar/:nivel_id",views:{edit_nivel:{templateUrl:"==grados/nivelesEdit.tpl.html",controller:"NivelesEditCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar"}]}}},data:{displayName:"Editar",icon_fa:"fa fa-graduation-cap",pageTitle:"Editar nivel - MyVc"}}),e.state("panel.grados",{url:"^/grados",views:{maincontent:{templateUrl:"==grados/grados.tpl.html",controller:"GradosCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Grados"}]}}},resolve:{niveles:["$http",function(e){return e.get("::niveles_educativos").then(function(e){return e.data})}]},data:{displayName:"Grados",icon_fa:"fa fa-graduation-cap",pageTitle:"Grados - MyVc"}}),e.state("panel.grados.nuevo",{url:"/nuevo",views:{edit_grado:{templateUrl:"==grados/gradosNew.tpl.html",controller:"GradosNewCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-graduation-cap",pageTitle:"Grado nuevo - MyVc"}}),e.state("panel.grados.editar",{url:"/editar/:grado_id",views:{edit_grado:{templateUrl:"==grados/gradosEdit.tpl.html",controller:"GradosEditCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar"}]}}},data:{displayName:"Editar",icon_fa:"fa fa-graduation-cap",pageTitle:"Editar grado - MyVc"}}),e.state("panel.grupos",{url:"^/grupos",views:{maincontent:{templateUrl:"==grados/grupos.tpl.html",controller:"GruposCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Grupos"}]}}},resolve:{grados:["$http",function(e){return e.get("::grados").then(function(e){return e.data})}],profesores:["$http",function(e){return e.get("::contratos").then(function(e){return e.data})}]},data:{displayName:"Grupos",icon_fa:"fa fa-graduation-cap",pageTitle:"Grupos - MyVc"}}),e.state("panel.grupos.nuevo",{url:"/nuevo",views:{edit_grupo:{templateUrl:"==grados/gruposNew.tpl.html",controller:"GruposNewCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Nuevo"}]}}},data:{displayName:"Nuevo",icon_fa:"fa fa-graduation-cap",pageTitle:"Grupo nuevo - MyVc"}}),e.state("panel.grupos.editar",{url:"/editar/:grupo_id",views:{edit_grupo:{templateUrl:"==grados/gruposEdit.tpl.html",controller:"GruposEditCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar"}]}}},data:{displayName:"Editar",icon_fa:"fa fa-graduation-cap",pageTitle:"Editar grupo - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("GradosCtrl",["$scope","$filter","$state","App","niveles","$uibModal","toastr","$http",function(e,a,r,t,n,o,i,s){var u,l;e.grados={nivel:{}},e.gridScope=e,e.niveles=n,e.editar=function(e){return r.go("panel.grados.editar",{grado_id:e.id})},e.eliminar=function(r){return o.open({templateUrl:"==grados/removeGrado.tpl.html",controller:"RemoveGradoCtrl",size:"sm",resolve:{grado:function(){return r}}}).result.then(function(r){return e.grados=a("filter")(e.grados,{id:"!"+r.id}),e.gridOptions.data=e.grados})},u='<a uib-tooltip="Editar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',l='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{name:"edicion",displayName:"Edición",maxWidth:50,enableSorting:!1,enableFiltering:!1,cellTemplate:u+l,enableCellEdit:!1},{field:"nombre",enableHiding:!1},{field:"abrev",displayName:"abreviatura",maxWidth:50,enableSorting:!1},{field:"orden",type:"number",maxWidth:50},{field:"nivel_educativo_id",displayName:"Nivel Educativo",editDropdownOptionsArray:n,cellFilter:"mapNivel:grid.appScope.niveles",editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"id",editDropdownValueLabel:"nombre"},{name:"nn",displayName:"",maxWidth:20,enableSorting:!1,enableFiltering:!1}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){return t!==n&&s.put("::grados/update/"+a.id,a).then(function(e){return i.success("Grado actualizado con éxito","Actualizado")},function(e){return i.error("Cambio no guardado","Error")}),e.$apply()})}},s.get("::grados").then(function(a){return e.grados=a.data,e.gridOptions.data=e.grados}),e.$on("gradocreado",function(a,r){return e.grados.push(r),e.gridOptions.data=e.grados})}]).filter("mapNivel",["$filter",function(e){return function(a,r){return a?e("filter")(r,{id:a})[0].nombre:""}}]).controller("RemoveGradoCtrl",["$scope","$uibModalInstance","grado","$http","toastr",function(e,a,r,t,n){return e.grado=r,e.ok=function(){return t.delete("::grados/destroy/"+r.id).then(function(e){return n.success("Grado "+e.nombre+" eliminado con éxito","Eliminado")},function(e){return n.error("No se pudo eliminar a "+row.nombre)}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("GradosNewCtrl",["$scope","toastr","$http",function(e,a,r){return e.grado={orden:1},e.restarOrden=function(){if(e.grado.orden>0)return e.grado.orden=e.grado.orden-1},e.sumarOrden=function(){if(e.grado.orden<40)return e.grado.orden=e.grado.orden+1},e.crear=function(){return r.post("::grados/store",e.grado).then(function(r){return r=r.data,e.$emit("gradocreado",r),a.success("Grado "+r.nombre+" creado")},function(e){return a.error("Falló al intentar guardar")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("GradosEditCtrl",["$scope","$state","$http","toastr",function(e,a,r,t){return r.get("::grados/show/"+a.params.grado_id).then(function(a){return e.grado=a.data}),e.guardar=function(){return r.put("::grados/update/"+e.grado.id,e.grado).then(function(e){return t.success("Se guardaron los cambios.")},function(e){return t.error("Falló al intentar guardar")})},e.restarOrden=function(){if(e.grado.orden>0)return e.grado.orden=e.grado.orden-1},e.sumarOrden=function(){if(e.grado.orden<40)return e.grado.orden=e.grado.orden+1}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("GruposCtrl",["$scope","$filter","$state","grados","profesores","$uibModal","$http","toastr","AuthService",function(e,a,r,t,n,o,i,s,u){var l,c,d;e.gridScope=e,e.grados=t,e.profesores=n,e.hasRoleOrPerm=u.hasRoleOrPerm,e.editar=function(e){return r.go("panel.grupos.editar",{grupo_id:e.id})},e.eliminar=function(r){return o.open({templateUrl:"==grados/removeGrupo.tpl.html",controller:"RemoveGrupoCtrl",resolve:{grupo:function(){return r}}}).result.then(function(r){return e.grupos=a("filter")(e.grupos,{id:"!"+r.id}),e.gridOptions.data=e.grupos})},l='<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',c='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a>',d='<a uib-tooltip="Listado de alumnos" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ui-sref="panel.listalumnos({grupo_id: row.entity.id})"><i class="fa fa-users "></i></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"orden",type:"number",width:40},{name:"edicion",displayName:"Edición",width:80,enableSorting:!1,enableFiltering:!1,cellTemplate:l+c+d,enableCellEdit:!1},{field:"nombre",enableHiding:!1,minWidth:100},{field:"abrev",displayName:"Abrev",minWidth:30},{field:"titular_id",displayName:"Titular",minWidth:130,editDropdownOptionsArray:n,cellFilter:"mapProfesores:grid.appScope.profesores",editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"profesor_id",editDropdownValueLabel:"nombre_completo"},{field:"grado_id",displayName:"Grado",minWidth:90,editDropdownOptionsArray:t,cellFilter:"mapGrado:grid.appScope.grados",editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"id",editDropdownValueLabel:"nombre"},{field:"cant_alumnos",displayName:"Canti alumnos",enableSorting:!1,enableCellEdit:!1},{field:"cupo",displayName:"Cupo",minWidth:40,type:"number"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){var o;return t!==n&&(o={abrev:a.abrev,grado_id:a.grado_id,nombre:a.nombre,orden:a.orden,titular_id:a.titular_id,caritas:a.caritas,cupo:a.cupo,id:a.id},i.put("::grupos/update",o).then(function(e){return s.success("Grupo actualizado con éxito","Actualizado")},function(e){return s.error("Cambio no guardado","Error")})),e.$apply()})}},e.cambiarCaritas=function(e){var a;return e.caritas=!e.caritas,a={abrev:e.abrev,grado_id:e.grado_id,nombre:e.nombre,orden:e.orden,titular_id:e.titular_id,caritas:e.caritas,id:e.id},i.put("::grupos/update",a).then(function(e){return s.success("Grupo actualizado con éxito","Actualizado")},function(e){return s.error("Cambio no guardado","Error")})},i.get("::grupos/cant-alumnos").then(function(a){var r,t,n,o;for(e.grupos=a.data,t=0,n=(o=e.grupos).length;t<n;t++)(r=o[t]).caritas=!!r.caritas;return e.gridOptions.data=e.grupos}),e.$on("grupocreado",function(a,r){return e.grupos.push(r),e.gridOptions.data=e.grupos})}]).filter("mapGrado",["$filter",function(e){return function(a,r){return a?e("filter")(r,{id:a})[0].nombre:"Elija..."}}]).controller("RemoveGrupoCtrl",["$scope","$uibModalInstance","grupo","$http","toastr",function(e,a,r,t,n){return e.grupo=r,e.ok=function(){return t.delete("::grupos/destroy/"+r.id).then(function(e){return n.success("Grupo "+r.nombre+" eliminado con éxito.","Eliminado")},function(e){return n.warning("No se pudo eliminar al grupo.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("GruposNewCtrl",["$scope","$http","toastr",function(e,a,r){return e.grupo={orden:1,caritas:!1,valormatricula:0,valorpension:0},a.get("::grados").then(function(a){return e.grados=a.data}),a.get("::contratos").then(function(a){return e.profesores=a.data}),e.restarOrden=function(){if(e.grupo.orden>0)return e.grupo.orden=e.grupo.orden-1},e.sumarOrden=function(){if(e.grupo.orden<40)return e.grupo.orden=e.grupo.orden+1},e.crear=function(){return a.post("::grupos/store",e.grupo).then(function(a){return e.$emit("grupocreado",a.data),r.success("Grupo "+a.data.nombre+" creado")},function(e){return r.error("No se pudo crear el grupo","Error")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("GruposEditCtrl",["$scope","$state","$http","toastr",function(e,a,r,t){return r.get("::grupos/show/"+a.params.grupo_id).then(function(a){return e.grupo=a.data}),r.get("::grados").then(function(a){return e.grados=a.data}),r.get("::contratos").then(function(a){return e.profesores=a.data}),e.guardar=function(){var a;return e.grupo.titular.profesor_id?e.grupo.titular_id=e.grupo.titular.profesor_id:e.grupo.titular_id=e.grupo.titular.id,a=e.grupo.titular,delete e.grupo.titular,e.grupo.grado_id=e.grupo.grado.id,r.put("::grupos/update",e.grupo).then(function(r){return t.success("Grupo "+r.data.nombre+" editado."),e.grupo.titular=a},function(r){return e.grupo.titular=a})},e.restarOrden=function(){if(e.grupo.orden>0)return e.grupo.orden=e.grupo.orden-1},e.sumarOrden=function(){if(e.grupo.orden<40)return e.grupo.orden=e.grupo.orden+1}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("NivelesCtrl",["$scope","$filter","$state","toastr","$http",function(e,a,r,t,n){var o,i;e.gridScope=e,e.editar=function(e){return r.go("panel.niveles.editar",{nivel_id:e.id})},e.eliminar=function(r){return $htt.delete("niveles_educativos/"+r.id).then(function(r){return e.niveles=a("filter")(e.niveles,{id:"!"+r.data.id}),e.gridOptions.data=e.niveles},function(e){return t.warning("No se pudo eliminar.")})},o='<a uib-tooltip="Editar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',i='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"orden",type:"number",maxWidth:50,enableSorting:!1},{name:"edicion",displayName:"Edición",maxWidth:50,enableSorting:!1,enableFiltering:!1,cellTemplate:o+i,enableCellEdit:!1},{field:"nombre",enableHiding:!1},{field:"abrev",displayName:"Abreviatura"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,o,i){return o!==i&&n.put("::niveles_educativos/update/"+a.id,a).then(function(e){return t.success("Nivel actualizado","Actualizado")},function(e){return t.error("Cambio no guardado","Error")}),e.$apply()})}},n.get("::niveles_educativos").then(function(a){return e.niveles=a.data,e.gridOptions.data=e.niveles})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("NivelesNewCtrl",["$scope","$http","toastr","$state",function(e,a,r,t){e.nivel={orden:0},e.restarOrden=function(){if(e.nivel.orden>0)return e.nivel.orden=e.nivel.orden-1},e.sumarOrden=function(){if(e.nivel.orden<40)return e.nivel.orden=e.nivel.orden+1},e.crear=function(){return a.post("::niveles_educativos/store",e.nivel).then(function(e){return r.success("Nivel creado."),t.go("panel.niveles",{},{reload:!0})},function(e){return r.error("Falló al intentar guardar")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("NivelesEditCtrl",["$scope","toastr","$state","$http",function(e,a,r,t){return e.nivel={},t.get("::niveles_educativos/"+r.params.nivel_id).then(function(a){return e.nivel=a.data}),e.guardar=function(){return t.put("niveles_educativos/"+r.params.nivel_id,e.nivel).then(function(e){return a.success("Se guardó nivel")},function(e){return a.error("Falló al intentar guardar")})},e.restarOrden=function(){if(e.nivel.orden>0)return e.nivel.orden=e.nivel.orden-1},e.sumarOrden=function(){if(e.nivel.orden<40)return e.nivel.orden=e.nivel.orden+1}}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App",function(e,a){return e.state("panel.areas",{url:"^/areas",views:{maincontent:{templateUrl:"==areas/areas.tpl.html",controller:"AreasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Areas"}]}}},data:{displayName:"Areas",icon_fa:"fa fa-graduation-cap",pageTitle:"Áreas - MyVc"}}),e.state("panel.materias",{url:"^/materias",views:{maincontent:{templateUrl:"==areas/materias.tpl.html",controller:"MateriasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Materias"}]}}},resolve:{areas:["$http",function(e){return e.get("::areas").then(function(e){return e.data})}]},data:{displayName:"Materias",icon_fa:"fa fa-graduation-cap",pageTitle:"Materias - MyVc"}}),e.state("panel.asignaturas",{url:"^/asignaturas",views:{maincontent:{templateUrl:"==areas/asignaturas.tpl.html",controller:"AsignaturasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Asignaturas"}]}}},resolve:{datosAsignaturas:["$http",function(e){return e.put("::asignaturas/datos-asignaturas").then(function(e){return e.data})}]},data:{displayName:"Asignaturas",icon_fa:"fa fa-graduation-cap",pageTitle:"Asignatura - MyVc"}}),e.state("panel.listasignaturas",{url:"^/listasignaturas/:profesor_id",params:{profesor_id:{value:null}},views:{maincontent:{templateUrl:"==areas/listAsignaturas.tpl.html",controller:"ListAsignaturasCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:["$stateParams",function(e){return localStorage.profesor_id=e.profesor_id,"Listado de asignaturas"}]}}},data:{displayName:"Listado de asignaturas",icon_fa:"fa fa-graduation-cap",pageTitle:"Mis asignaturas - MyVc"}}),e.state("panel.frases",{url:"^/frases",views:{maincontent:{templateUrl:"==areas/frases.tpl.html",controller:"FrasesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Frases"}]}}},data:{displayName:"Frases",icon_fa:"fa fa-graduation-cap",pageTitle:"Frases - MyVc"}})}])}.call(this),function(){angular.module("myvcFrontApp").controller("MateriasCtrl",["$scope","toastr","$http","areas","$uibModal","$filter",function(e,a,r,t,n,o){var i,s;return e.creando=!1,e.editando=!1,e.currentmateria={},e.currenmateriaEdit={},e.areas=t,e.gridScope=e,e.cancelarCrear=function(){return e.creando=!1},e.cancelarEdit=function(){return e.editando=!1},e.crear=function(){return r.post("::materias",e.currentmateria).then(function(r){return e.gridOptions.data.push(r.data),delete e.currentmateria,a.success("Materia creada con éxito")},function(e){return a.error("Error creando","Problema")})},e.guardar=function(){return r.put("::materias/update/"+e.currentmateriaEdit.id,e.currentmateriaEdit).then(function(r){return e.currentmateriaEdit.area_id=r.data.area_id,delete e.currentmateriaEdit,a.success("Materia actualizada con éxito"),e.cancelarEdit()},function(e){return a.error("Error guardando","Problema")})},e.editar=function(a){return a.area=o("filter")(t,{id:a.area_id})[0],e.currentmateriaEdit=a,e.editando=!0},e.eliminar=function(a){return n.open({templateUrl:"==areas/removeMateria.tpl.html",controller:"RemovemateriaCtrl",resolve:{materia:function(){return a}}}).result.then(function(a){return e.gridOptions.data=o("filter")(e.gridOptions.data,{id:"!"+a.id})})},i='<a uib-tooltip="Editar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',s='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',e.gridOptions={enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,multiSelect:!1,columnDefs:[{field:"id",type:"number",maxWidth:50,enableFiltering:!1},{name:"edicion",displayName:"Edición",maxWidth:50,enableSorting:!1,enableFiltering:!1,cellTemplate:i+s,enableCellEdit:!1},{field:"materia",enableHiding:!1,filter:{condition:function(a,r,t){var n;return n=o("filter")(e.gridOptions.data,{materia:a}),o("filter")(n,{materia:r}).length>0}}},{field:"alias",displayName:"Alias"},{field:"area_id",displayName:"Area",editDropdownOptionsArray:t,cellFilter:"mapAreas:grid.appScope.areas",editableCellTemplate:"ui-grid/dropdownEditor",filter:{condition:function(a,r){var t;return t=o("filter")(e.areas,{nombre:a}),o("filter")(t,{id:r},!0).length>0}},editDropdownIdLabel:"id",editDropdownValueLabel:"nombre"},{name:"nn",displayName:"",maxWidth:20,enableSorting:!1,enableFiltering:!1}],onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){return t!==n&&(e.currentmateriaEdit=a,e.guardar()),e.$apply()})}},r.get("::materias").then(function(a){var r,t,n,i,s;for(e.gridOptions.data=a.data.materias,e.areas=a.data.mat_por_areas,e.areas=o("orderBy")(e.areas,"orden"),s=[],t=0,n=(i=e.areas).length;t<n;t++)r=i[t],s.push(r.materias=o("orderBy")(r.materias,"orden"));return s}),e.onSortMaterias=function(e,t,n,o,i,s){var u,l,c,d,p,m,f,g,_,h;for(_=[],h=[],u={},console.log(n,e,s.area),d=c=0,m=t.length;c<m;d=++c)(g=t[d]).orden=d,(l={})[""+g.id]=d,_.push(l);if(u.partFrom={sortHash:_},t!==n){for(d=p=0,f=n.length;p<f;d=++p)(g=n[d]).orden=d,(l={})[""+g.id]=d,h.push(l);u.partTo={sortHash:h,area_id:s.area.id}}return r.put("::materias/update-orden",u).then(function(e){return!0},function(e){return a.warning("No se pudo ordenar","Problema"),!1})},e.onSortAreas=function(e,t,n,o,i){var s,u,l,c,d,p,m;for(m=[],console.log(e,t,n,o,i),d=c=0,p=t.length;c<p;d=++c)(s=t[d]).orden=d,(l={})[""+s.id]=d,m.push(l);return u={sortHash:m},r.put("::areas/update-orden",u).then(function(e){return!0},function(e){return a.warning("No se pudo ordenar","Problema"),!1})}}]).filter("mapAreas",["$filter",function(e){return function(a,r){var t;return a&&(t=e("filter")(r,{id:a})[0])?t.nombre:"Elija..."}}]).controller("RemovemateriaCtrl",["$scope","$uibModalInstance","materia","$http","toastr",function(e,a,r,t,n){return e.materia=r,e.ok=function(){return t.delete("::materias/destroy/"+r.id).then(function(e){return n.success("Materia "+r.nombre+" eliminada con éxito.","Eliminada")},function(e){return n.warning("Problema","No se pudo eliminar la Materia.")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").controller("AsignaturasCtrl",["$scope","$http","datosAsignaturas","$uibModal","$filter","App","AuthService","toastr","$timeout",function(e,a,r,t,n,o,i,s,u){var l,c;return i.verificar_acceso(),e.creando=!1,e.editando=!1,e.currentasignatura={grupo:void 0,profesor:void 0},e.currenasignaturaEdit={},e.copiando=!1,e.show_materias_todas=!1,e.USER.show_materias_todas&&(e.show_materias_todas=parseInt(e.USER.show_materias_todas)),e.asignaturas=[],e.materias=r.materias,e.grupos=r.grupos,e.profesores=r.profesores,e.perfilPath=o.images+"perfil/",a.get("::asignaturas/papelera").then(function(a){return e.asignaturas_eliminadas=a.data},function(e){return s.error("Error trayendo las asignaturas de papelera","Problema")}),e.restaurarAsignatura=function(e){if(!e.restaurando)return e.restaurando=!0,a.put("::asignaturas/restaurar",{asignatura_id:e.asignatura_id}).then(function(e){return s.success("Listo. Debes actualizar la página para ver los cambios.")},function(a){return e.restaurando=!1,s.error("Error restaurando","Problema")})},e.cambiarMostrarTodasMaterias=function(r){return a.put("::years/mostrar-todas-materias",{can:r,year_id:e.USER.year_id}).then(function(e){return s.success(e.data)},function(e){return s.error("No guardado.","Problema")})},e.gridScope=e,e.seleccionaGrupo=function(a,r){var t;if(a=void 0===a?{id:"!"}:a,e.gridOptions.data=n("filter")(e.asignaturas,{grupo_id:a.id},!0),void 0!==e.currentasignatura.profesor)return t=e.currentasignatura.profesor.id,e.gridOptions.data=n("filter")(e.gridOptions.data,{profesor_id:t},!0)},e.mostrarTodas=function(a,r){return e.gridOptions.data=e.asignaturas},e.seleccionaProfe=function(a,r){var t;if(a){if(a=void 0===a?{profesor_id:"!"}:a,e.gridOptions.data=n("filter")(e.asignaturas,{profesor_id:a.profesor_id},!0),e.currentasignatura.grupo)return t=e.currentasignatura.grupo.id,e.gridOptions.data=n("filter")(e.gridOptions.data,{grupo_id:t},!0)}else if(e.currentasignatura.grupo)return t=e.currentasignatura.grupo.id,e.gridOptions.data=n("filter")(e.gridOptions.data,{grupo_id:t},!0)},e.filtrarAsignaturas=function(){var a,r;if(e.gridOptions.data=e.asignaturas,void 0!==e.currentasignatura.grupo&&(a=e.currentasignatura.grupo.id,e.gridOptions.data=n("filter")(e.gridOptions.data,{grupo_id:a},!0)),void 0!==e.currentasignatura.profesor)return r=e.currentasignatura.profesor.id,e.gridOptions.data=n("filter")(e.gridOptions.data,{profesor_id:r},!0)},e.cancelarCrear=function(){return e.creando=!1},e.cancelarEdit=function(){return e.editando=!1},e.copiarAsignaturas=function(){return e.copiando=!1,a.post("::asignaturas/copiar",{grupo_id_origen:e.currentasignatura.grupo.id,grupo_id_destino:e.currentasignatura.grupo_destino.id}).then(function(a){return e.copiando=!0,s.success("Asignaturas copiadas. Actualice")},function(e){return s.error("Error creando","Problema")})},e.toggleDia=function(e,r){var t;return e[r]=!e[r],t={asignatura_id:e.id,dia:r,valor:e[r]},a.put("::asignaturas/toggle-dia",t).then(function(e){return console.log("Cambios guardados")},function(a){return e[r]=!e[r],s.error("Cambio no guardado","Error")})},e.crear=function(){return a.post("::asignaturas",e.currentasignatura).then(function(a){return e.asignaturas.push(a.data),e.filtrarAsignaturas(),e.cancelarCrear(),s.success("Asignatura creada con éxito")},function(e){return s.error("Error creando","Problema")})},e.guardar=function(){return a.put("::asignaturas/update/"+e.currentasignaturaEdit.id,e.currentasignaturaEdit).then(function(a){return e.currentasignaturaEdit.area_id=a.data.area_id,s.success("Asignatura actualizada con éxito"),e.cancelarEdit()},function(e){return s.error("Error guardando","Problema")})},e.editar=function(a){return a.materia=n("filter")(r.materias,{id:a.materia_id},!0)[0],a.grupo=n("filter")(r.grupos,{id:a.grupo_id},!0)[0],a.profesor=n("filter")(r.profesores,{profesor_id:a.profesor_id},!0)[0],e.currentasignaturaEdit=a,e.editando=!0},e.eliminar=function(a){return t.open({templateUrl:"==areas/removeAsignatura.tpl.html",controller:"RemoveAsignaturaCtrl",resolve:{asignatura:function(){return a}}}).result.then(function(a){return e.asignaturas=n("filter")(e.asignaturas,{id:"!"+a.id}),e.gridOptions.data=e.asignaturas,e.filtrarAsignaturas()},function(a){var r,t,n,o,i;for(t=n=0,o=(i=e.asignaturas).length;n<o;t=++n)(r=i[t]).id===a.id&&(r.cantidad_notas=a.cantidad_notas,e.asignaturas.splice(t,1,a));return u(function(){return e.$apply()})})},l='<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',c='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a><span ng-show="true" uib-tooltip="Cantidad notas">{{row.entity.cantidad_notas}}</span>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"id",type:"number",width:60,enableFiltering:!1,enableCellEdit:!1,enableColumnMenu:!1},{name:"edicion",displayName:"Edición",width:80,enableSorting:!1,enableFiltering:!1,cellTemplate:l+c,enableCellEdit:!1,enableColumnMenu:!1},{field:"materia_id",displayName:"Materia",editDropdownOptionsArray:r.materias,cellFilter:"mapMaterias:grid.appScope.materias",filter:{condition:function(e,a){var t;return t=n("filter")(r.materias,{materia:e}),n("filter")(t,{id:a},!0).length>0}},editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"id",editDropdownValueLabel:"materia",enableCellEditOnFocus:!0,minWidth:150},{field:"grupo_id",displayName:"Grupos",editDropdownOptionsArray:r.grupos,cellFilter:"mapGrupos:grid.appScope.grupos",filter:{condition:function(e,a){var t;return t=n("filter")(r.grupos,{nombre:e}),n("filter")(t,{id:a},!0).length>0}},editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"id",editDropdownValueLabel:"nombre",enableCellEditOnFocus:!0,minWidth:80},{field:"profesor_id",displayName:"Profesor",editDropdownOptionsArray:r.profesores,cellFilter:"mapProfesores:grid.appScope.profesores",filter:{condition:function(e,a){return n("filter")(r.profesores,function(r){var t,n,o;return t=!!r.nombres&&r.nombres.toLowerCase().indexOf(e.toLowerCase())>-1,n=!!r.apellidos&&r.apellidos.toLowerCase().indexOf(e.toLowerCase())>-1,o=r.profesor_id===a,(t||n)&&o}).length>0}},editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"profesor_id",editDropdownValueLabel:"nombre_completo",enableCellEditOnFocus:!0,minWidth:140},{field:"creditos",displayName:"IH",type:"number",minWidth:50},{field:"lunes",displayName:"Lunes",minWidth:50,cellTemplate:"==areas/botonLunes.tpl.html",enableCellEdit:!1},{field:"martes",displayName:"Martes",minWidth:50,cellTemplate:"==areas/botonMartes.tpl.html",enableCellEdit:!1},{field:"miercoles",displayName:"Miércoles",minWidth:50,cellTemplate:"==areas/botonMiercoles.tpl.html",enableCellEdit:!1},{field:"jueves",displayName:"Jueves",minWidth:50,cellTemplate:"==areas/botonJueves.tpl.html",enableCellEdit:!1},{field:"viernes",displayName:"Viernes",minWidth:50,cellTemplate:"==areas/botonViernes.tpl.html",enableCellEdit:!1},{name:"nn",displayName:"",width:10,enableSorting:!1,enableFiltering:!1,enableColumnMenu:!1}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){return t!==n&&(e.currentasignaturaEdit=a,e.guardar()),e.$apply()})}},a.get("::asignaturas").then(function(a){return e.asignaturas=a.data,e.gridOptions.data=e.asignaturas})}]).filter("mapMaterias",["$filter",function(e){return function(a,r){var t;return a?(t=e("filter")(r,{id:a},!0)[0])?t.materia:"En papelera...":"Elija..."}}]).filter("mapGrupos",["$filter",function(e){return function(a,r){return a?e("filter")(r,{id:a},!0)[0].nombre:"Elija..."}}]).filter("mapProfesores",["$filter",function(e){return function(a,r){var t;return a&&(t=e("filter")(r,{profesor_id:a},!0)).length>0?t[0].nombres+" "+t[0].apellidos:"Elija..."}}]).controller("RemoveAsignaturaCtrl",["$scope","$uibModalInstance","asignatura","$http","toastr",function(e,a,r,t,n){return e.asignatura=r,t.put("::asignaturas/detalle-asignatura",{asignatura_id:r.id}).then(function(a){return e.unidades=a.data.unidades,e.cantidad_notas=a.data.cantidad_notas,r.cantidad_notas=e.cantidad_notas},function(e){return n.warning("Problema","No se pudo traer detalle de la asignatura.")}),e.ok=function(){return t.delete("::asignaturas/destroy/"+r.id).then(function(e){return n.success("asignatura "+r.nombre+" eliminada con éxito.","Eliminada")},function(e){return n.warning("Problema","No se pudo eliminar la asignatura.")}),a.close(r)},e.cancel=function(){return a.dismiss(r)}}])}.call(this),function(){angular.module("myvcFrontApp").controller("ListAsignaturasCtrl",["$scope","$http","toastr","$state","$cookies","$rootScope","AuthService","App","resolved_user","$filter","$uibModal",function(e,a,r,t,n,o,i,s,u,l,c){return e.UNIDAD=e.USER.unidad_displayname,e.GENERO_UNI=e.USER.genero_unidad,e.SUBUNIDAD=e.USER.subunidad_displayname,e.GENERO_SUB=e.USER.genero_subunidad,e.UNIDADES=e.USER.unidades_displayname,e.SUBUNIDADES=e.USER.subunidades_displayname,e.hasRoleOrPerm=i.hasRoleOrPerm,e.dato={},e.views=s.views+"areas/",e.mes=(new Date).getMonth(),e.profesor={},t.params.profesor_id?(e.profesor_id=t.params.profesor_id,a.get("::asignaturas/listasignaturas/"+t.params.profesor_id).then(function(a){return e.asignaturas=a.data.asignaturas,e.profesor=a.data.info_profesor,e.gruposcomportamientos=a.data.grados_comp,e.grupos=a.data.grupos,e.pedidos=a.data.pedidos,e.materias=a.data.materias},function(e){return r.error("No se pudo traer las asignaturas")})):a.get("::asignaturas/listasignaturas").then(function(a){var r,t,n,o,i;for(e.asignaturas=a.data.asignaturas,e.gruposcomportamientos=a.data.grados_comp,e.grupos=a.data.grupos,e.pedidos=a.data.pedidos,e.materias=a.data.materias,i=[],r=0,t=(o=e.pedidos).length;r<t;r++)1!==(n=o[r]).materia_to_add_accepted&&1!==n.asignatura_to_remove_accepted||(n.estado=":: APROBADO ::  "),0===n.materia_to_add_accepted||0===n.asignatura_to_remove_accepted?i.push(n.estado=":: RECHAZADO ::  "):i.push(void 0);return i},function(e){return r.error("No se pudo traer tus asignaturas")}),e.irAComportamiento=function(a){return t.params.profesor_id?localStorage.profesor_id=t.params.profesor_id:localStorage.profesor_id=e.USER.persona_id,t.go("panel.comportamiento",{grupo_id:a.id})},e.solicitarMateria=function(){if(e.dato.grupo)if(e.dato.materia){if(!(!e.dato.creditos>0))return a.put("::ChangesAskedAssignment/solicitar-materia",{grupo_id:e.dato.grupo.id,materia_id:e.dato.materia.id,creditos:e.dato.creditos}).then(function(a){return e.pedidos.push(a.data.pedido),r.success("Materia solicitada. Un administrador lo revisará.")},function(e){return r.error("No se pudo solicitar materia")});r.warning("Debes asignar la intensidad horaria.")}else r.warning("Debes seleccionar una materia.");else r.warning("Debes seleccionar un grupo.")},e.quitarSolicitud=function(t){return a.put("::ChangesAsked/destruir-pedido-asignatura",{asked_id:t.asked_id,assignment_id:t.assignment_id}).then(function(a){return e.pedidos=l("filter")(e.pedidos,{asked_id:"!"+t.asked_id}),r.success("Solicitada eliminada")},function(e){return r.error("No se pudo solicitar materia")})},e.noEsMia=function(a){var t,n,o,i;for(t=0,n=(i=e.pedidos).length;t<n;t++)if((o=i[t]).asignatura_to_remove_id===a.asignatura_id&&!o.asignatura_to_remove_accepted)return void r.info("Ya has hecho esta solicitud");return c.open({templateUrl:"==areas/asignaturaNoEsMia.tpl.html",controller:"AsignaturaNoEsMiaCtrl",resolve:{asignatura:function(){return a}}}).result.then(function(a){return r.success("Has solicitado remoción de asignatura."),e.pedidos.push(a.pedido)})},e.irDefinitivas=function(e){return localStorage.asignatura_id_def=e.asignatura_id,t.go("panel.definitivas_periodos",{profesor_id:t.params.profesor_id})},e.open=function(e){return t.go("panel.unidades",{asignatura_id:e.asignatura_id})}}]).controller("AsignaturaNoEsMiaCtrl",["$scope","$uibModalInstance","asignatura","$http","toastr","App",function(e,a,r,t,n,o){return e.asignatura=r,e.ok=function(){var e;return e={asignatura_id:r.asignatura_id},t.put("::ChangesAskedAssignment/pedir-quitar-asignatura",e).then(function(e){return a.close(e.data)},function(e){return n.error("Problema","No se pudo hacer solicitud.")})},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").controller("FrasesCtrl",["$scope","toastr","$filter","$http","$uibModal","App","AuthService",function(e,a,r,t,n,o,i){var s;return i.verificar_acceso(),e.currentFrase={},e.currentFraseEdit={},e.creando=!1,e.gridScope=e,e.tipos=[{tipo_frase:"Debilidad"},{tipo_frase:"Amenaza"},{tipo_frase:"Oportunidad"},{tipo_frase:"Fortaleza"}],e.currentFrase.tipo_frase={tipo_frase:"Fortaleza"},e.cancelarCrear=function(){return e.creando=!1},e.crear=function(){return t.post("::frases/store",e.currentFrase).then(function(r){return e.gridOptions.data.push(r.data),e.currentFrase.frase="",e.cancelarCrear(),a.success("Frase creada con éxito")},function(e){return a.error("Error creando","Problema")})},e.guardar=function(){return t.put("::frases/update/"+e.currentFraseEdit.id,e.currentFraseEdit).then(function(r){return e.currentFraseEdit.frase=r.data.frase,a.success("Frase actualizada con éxito")},function(e){return a.error("Error guardando","Problema")})},e.eliminar=function(a){return n.open({templateUrl:o.views+"areas/removeFrase.tpl.html",controller:"RemoveFraseCtrl",resolve:{frase:function(){return a}}}).result.then(function(a){return e.gridOptions.data=r("filter")(e.gridOptions.data,{id:"!"+a.id})})},'<a uib-tooltip="Editar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',s='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a>',e.gridOptions={enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"id",type:"number",width:70,enableCellEdit:!1},{name:"edicion",displayName:"Edición",width:60,enableSorting:!1,enableFiltering:!1,cellTemplate:s,enableCellEdit:!1},{field:"tipo_frase",displayName:"Tipo",width:90,enableCellEdit:!1},{field:"frase",displayName:"Frase",minWidth:300}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a,a.edit.on.afterCellEdit(e,function(a,r,t,n){return t!==n&&(e.currentFraseEdit=a,e.guardar()),e.$apply()})}},t.get("::frases").then(function(a){return e.gridOptions.data=a.data})}]).controller("RemoveFraseCtrl",["$scope","$uibModalInstance","frase","$http","toastr",function(e,a,r,t,n){return e.frase=r,e.ok=function(){return t.delete("::frases/destroy/"+r.id).then(function(e){return n.success('frase "'+r.frase+'" eliminada con éxito.',"Eliminada")},function(e){return n.warning("Problema","No se pudo eliminar la frase.")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("PaisesCtrl",["$scope",function(e){e.gridOptions={enableSorting:!0,columnDefs:[{field:"pais"},{field:"abreviación"},{field:"id"}],onRegisterApi:function(a){return e.gridApi=a}}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("CiudadesCtrl",["$scope","toastr","$http","paises","$filter",function(e,a,r,t,n){e.paises=t.data,e.datos={},e.creando_ciudad=!1,e.creando_departamento=!1,e.creando_pais=!1,e.ciudad_new="",e.departamento_new="",e.pais_new="",e.modificando_depart=!1,e.crearCiudad=function(){return e.creando_ciudad=!0,e.$broadcast("paisSeleccionadoEvent2")},e.crearDepartamento=function(){return e.creandodepartamento=!0},e.crearPais=function(){return e.creandopais=!0},e.guardarPais=function(t){return t?(t=t.toUpperCase(),e.creandopais=!0,r.post("::paises/store",{pais_new:t}).then(function(r){return a.success("Creado correctamente: "+t),e.paises=r.data,e.creandopais=!1,e.pais_new="",e.mostrarAgregarPais=!1},function(e){return a.error("No se pudo crear","Error")})):a.warning("Debes escribir el nombre del pais.")},e.guardarCiudad=function(t,o){var i;if(e.datos.pais)if(e.datos.departamento||""!==o){if(""!==t)return i=e.datos.departamento?departamento.departamento:o,r.post("::ciudades/guardar-ciudad",{ciudad:t,departamento:i,pais_id:e.datos.pais.id}).then(function(t){return a.success("Creado correctamente: "+t.data.ciudad),e.datos.departamento&&e.ciudades.push(t.data),e.creandociudad=!1,e.ciudad_new="",e.departamento_new="",e.guardar=!0,r.get("::paises").then(function(a){return e.paises=a.data,e.paisSelect(n("filter")(e.paises,{id:1})[0])},function(e){return a.error("No se pudo traer las ciudades.")})},function(e){return a.error("No se pudo crear","Error")});a.warning("Debe escribir la nueva ciudad.")}else a.warning("Debe seleccionar departamento o escribir uno nuevo.");else a.warning("Debes seleccionar un pais.")},e.escribeEnDepartamentoNew=function(){return e.datos.departamento=void 0},e.actualizarCiudad=function(e){return r.put("::ciudades/actualizar-ciudad",e).then(function(r){return a.success("Actualizado: "+e.ciudad),e.editandoCiudad=!1},function(e){return a.error("No se pudo actualizar","Error")})},e.actualizarDepartamento=function(t){return r.put("::ciudades/actualizar-departamento",t).then(function(r){var n,o,i;for(a.success("Actualizado: "+t.departamento),t.editandoDepart=!1,e.ciudad_new.pais,n=0,o=(i=e.ciudades).length;n<o;n++)i[n].departamento=t.departamento;return e.modificando_depart=!0},function(e){return a.error("No se pudo actualizar","Error")})},e.actualizarPais=function(e){return r.put("::paises/actualizar",e).then(function(r){return a.success("Actualizado: "+e.pais),e.editandoPais=!1,e.editandoAbrev=!1},function(e){return a.error("No se pudo actualizar","Error")})},e.paisSelect=function(a,t){return r.put("::ciudades/departamentos-by-id",{pais_id:a.id}).then(function(r){return e.departamentos=r.data.departamentos,void 0===e.datos.pais&&(e.datos.pais=a),e.$broadcast("paisSeleccionadoEvent"+t)})},e.paisSelect(n("filter")(e.paises,{id:1})[0],1),e.departamentoSelect=function(a,t){if(a)return e.departamento_new="",r.get("::ciudades/por-departamento/"+a.departamento).then(function(r){return e.ciudades=r.data,void 0===e.datos.departamento&&(e.datos.departamento=a),e.$broadcast("departamentoSeleccionadoEvent"+t)})},e.eliminarCiudad=function(t){return r.delete("::ciudades/destroy/"+t.id).then(function(r){return a.success("Ciudad enviada a la papelera.","Eliminado"),e.ciudades=n("filter")(e.ciudades,{id:"!"+t.id})},function(e){return a.warning("No se pudo enviar a la papelera.","Problema")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("MensajesCtrl",["$scope","$rootScope","$interval",function(e,a,r){}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider",function(e){return e.state("panel.filemanager",{url:"/filemanager",views:{maincontent:{templateUrl:"==fileManager/fileManager.tpl.html",controller:"FileManagerCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Administrador de archivos"}]}}},data:{displayName:"Administrador de archivos",icon_fa:"fa fa-cube",pageTitle:"Imágenes - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("FileManagerCtrl",["$scope","Upload","$timeout","$filter","App","$http","Perfil","$uibModal","resolved_user","toastr","AuthService","ProfesoresServ",function(e,a,r,t,n,o,i,s,u,l,c,d){var p,m;e.USER=u,e.subir_intacta={intacta:"Normal"},e.hasRoleOrPerm=c.hasRoleOrPerm,e.cantUp=10,e.tabFileManager="mis_img",e.views=n.views,e.search_alu="",function(){e.dato={imgUsuario:{id:e.USER.imagen_id,nombre:e.USER.imagen_nombre},imgOficial:{id:e.USER.foto_id,nombre:e.USER.foto_nombre}}}(),e.perfilPath=n.images+"perfil/",e.imgFiles=[],e.errorMsg="",e.fileReaderSupported=null!==window.FileReader&&null===window.FileAPI,e.dato.usuarioElegido=[],e.dato.tipo_a_cambiar="alumno",e.usuariosall=[],e.profesores=[],o.get("::myimages").then(function(a){var r,t,n,o,i;if(a=a.data,e.imagenes_privadas=a.imagenes_privadas,e.imagenes_publicas=a.imagenes_publicas,e.logo=a.logo,e.dato.imgParaUsuario=a.imagenes_privadas[0],e.grupos=a.grupos,e.profesores=a.profesores,localStorage.grupo_selected_imgs){for(i=[],t=0,n=(o=e.grupos).length;t<n;t++)(r=o[t]).id===parseInt(localStorage.grupo_selected_imgs)?(e.dato.grupo=r,i.push(e.grupoSelect(r))):i.push(void 0);return i}},function(e){return l.error("No se trajeron las imágenes.")}),e.hasRoleOrPerm(["profesor","admin"])&&(e.cantUp=2),localStorage.tabFileManager?e.tabFileManager=localStorage.tabFileManager:(localStorage.tabFileManager=e.tabFileManager,r(function(){return e.tabFileManager="mis_img"})),localStorage.tipo_img_a_cambiar?e.dato.tipo_a_cambiar=localStorage.tipo_img_a_cambiar:localStorage.tipo_img_a_cambiar="alumno",e.selectTab=function(a){return localStorage.tabFileManager=a,e.tabFileManager=localStorage.tabFileManager},e.cambiar_tipo_img_a_cambiar=function(e){return localStorage.tipo_img_a_cambiar=e},e.select_imagen_item=function(a){var r,t,n;for(r=0,t=(n=e.imagenes_privadas).length;r<t;r++)n[r].selected=!1;return a.selected=!0,e.dato.selectedImg=a},e.uploadFiles=function(a){var r,t,n,o,i;if(e.imagenes_privadas.length>2&&e.hasRoleOrPerm(["alumno","acudiente"])&&l.warning("No tiene permiso para subir más imágenes"),e.imgFiles=a,e.errorMsg="",a&&a.length){for(i=[],t=n=0,o=a.length;0<=o?n<o:n>o;t=0<=o?++n:--n)r=a[t],i.push(p(r));return i}},p=function(a){return e.errorMsg=null,m(a),e.generateThumb(a)},e.generateThumb=function(a){if(null!==a&&e.fileReaderSupported&&a.type.indexOf("image")>-1)return r(function(){var e;return(e=new FileReader).readAsDataURL(a),e.onload=function(e){return r(function(){return a.dataUrl=e.target.result})}})},m=function(r){var t;if(t="Intacta"===e.subir_intacta.intacta?"-intacta":"","Firma"===e.subir_intacta.intacta&&(t="-firma"),!(r.size>1e7))return a.upload({url:n.Server+"myimages/store"+t,file:r}).progress(function(e){var a;return a=parseInt(100*e.loaded/e.total),r.porcentaje=a}).success(function(a,r,t,n){var o,i,s,u,c;if("Intacta"===e.subir_intacta.intacta)return e.imagenes_publicas.push(a);if("Firma"===e.subir_intacta.intacta){for(l.success("Ahora elige el docente..."),e.imagenes_privadas.push(a),e.selectTab("imgs_usus"),e.dato.tipo_a_cambiar="profesor",c=[],i=0,s=(u=e.imagenes_privadas).length;i<s;i++)(o=u[i]).id===a.id?c.push(e.dato.selectedImg=o):c.push(void 0);return c}return e.imagenes_privadas.push(a)}).error(function(e){return console.log("Falla uploading: ",e)}).xhr(function(e){});e.errorMsg="Archivo excede los 10MB permitidos."},e.pedirCambioUsuario=function(a){return a.id?o.put("::images-users/cambiar-imagen-perfil/"+e.USER.user_id,{imagen_id:a.id}).then(function(r){return r=r.data,e.hasRoleOrPerm("admin")?(i.setImagen(r.imagen_id,a.nombre),e.$emit("cambianImgs",{image:r}),l.success("Imagen principal cambiada")):l.info("Ahora espera que un administrador acepte tu imagen","Solicitado")},function(e){return l.error("No se pudo cambiar imagen","Problema")}):l.warning("Selecciona una imagen")},e.pedirCambioOficial=function(a){return a.id?o.put("::images-users/cambiar-imagen-oficial/"+e.USER.user_id,{foto_id:a.id}).then(function(r){return r=r.data,e.hasRoleOrPerm("admin")?(i.setOficial(r.foto_id,a.nombre),e.$emit("cambianImgs",{foto:r}),l.success("Foto oficial cambiada")):l.info("Ahora espera que un administrador acepte tu imagen","Solicitado")},function(e){return l.error("No se pudo cambiar foto","Problema")}):l.warning("Selecciona una imagen")},e.pedirCambioFirma=function(a){var r;return a.id?(r={imgFirmaProfe:a.id},o.put("::perfiles/cambiarfirmaunprofe/"+e.USER.persona_id,r).then(function(a){return l.success("Firma cambiada con éxito"),e.USER.firma_id=a.data.id,e.USER.firma_nombre=a.data.nombre},function(e){return l.error("Error al asignar foto al profesor","Problema")})):l.warning("Selecciona una imagen")},e.cambiarLogoColegio=function(a){return o.put("::myimages/cambiarlogocolegio",{logo_id:a.id}).then(function(r){return l.success("Logo del colegio cambiado"),e.logo.logo=a.nombre,e.logo.logo_id=a.id,console.log(e.logo,a)},function(e){return l.error("No se pudo cambiar el logo","Problema")})},e.grupoSelect=function(a,r){return localStorage.grupo_selected_imgs=a.id,o.get("::grupos/listado/"+a.id).then(function(a){return a=a.data,e.alumnos=a,a[0].selected=!0,e.dato.alumnoElegido=a[0],e.alumSelect(e.dato.alumnoElegido)},function(e){return l.error("No se pudo traer los usuarios")})},e.rotarImagen=function(e){return o.put("::images-users/rotarimagen/"+e.id).then(function(a){return e.nombre="",l.success("Imagen rotada"),e.nombre=a.data+"?"+(new Date).getTime()},function(e){return l.error("Imagen no rotada")})},e.rotarImagenIzquierda=function(e){return o.put("::images-users/rotar-imagen-izquierda/"+e.id).then(function(a){return e.nombre="",l.success("Imagen rotada"),e.nombre=a.data+"?"+(new Date).getTime()},function(e){return l.error("Imagen no rotada")})},e.publicarImagen=function(a){return o.put("::myimages/publicar-imagen/"+a.id).then(function(r){return l.info("Ahora la imagen es pública"),e.imagenes_privadas=t("filter")(e.imagenes_privadas,{id:"!"+a.id}),e.imagenes_publicas.push(a)},function(e){return l.error("Imagen no publicada")})},e.privatizarImagen=function(a){return o.put("::myimages/privatizar-imagen/"+a.id).then(function(r){if(!(r=r.data).imagen)return l.info("Ahora la imagen es privada"),a.user_id===e.USER.user_id&&e.imagenes_privadas.push(a),e.imagenes_publicas=t("filter")(e.imagenes_publicas,{id:"!"+a.id});l.warning("No puede ser logo del año "+r.imagen.is_logo_of_year)},function(e){return l.error("Imagen no privatizada")})},e.borrarImagen=function(a,r,n){return s.open({templateUrl:"==fileManager/removeImage.tpl.html",controller:"RemoveImageCtrl",size:"md",resolve:{imagen:function(){return a},user_id:function(){return r},datos_imagen:function(){var t;return t={imagen_id:a.id,user_id:r},o.put("::myimages/datos-imagen",t).then(function(a){return e.datos_imagen=a.data},function(e){return l.error("Error al traer datos de imagen","Problema"),{}})}}}).result.then(function(a){return e.hasRoleOrPerm("admin")?(n?(e.imagenes_del_usuario=t("filter")(e.imagenes_del_usuario,{id:"!"+a.id}),e.dato.selectedImgDelUsuario=void 0):a.publica?e.imagenes_publicas=t("filter")(e.imagenes_publicas,{id:"!"+a.id}):e.imagenes_privadas=t("filter")(e.imagenes_privadas,{id:"!"+a.id}),l.success("La imagen ha sido removida.")):a.user_id===e.USER.user_id?(l.success("La imagen ha sido removida."),a.publica?e.imagenes_publicas=t("filter")(e.imagenes_publicas,{id:"!"+a.id}):e.imagenes_privadas=t("filter")(e.imagenes_privadas,{id:"!"+a.id})):l.info("Un administrador borrará la imagen ya que no fuiste tú quien la subió","Solicitado")})},e.cambiarImgUnUsuario=function(a,r){var n;if(!1,r?confirm("Esto quitará la imágen de tu lista. ¿Seguro que deseas cambiar la imagen de este usuario?"):confirm("¿Ya no quieres que esta sea su imagen de perfil?"))return n={},r&&(n.imagen_id=r.id),o.put("::images-users/cambiar-imagen-un-usuario/"+a.user_id,n).then(function(n){return r?(a.imagen_id=r.id,a.imagen_nombre=r.nombre,e.imagenes_privadas=t("filter")(e.imagenes_privadas,function(e){return e.id!==r.id}),e.dato.selectedImg=void 0,e.imagenes_del_usuario.push(r),l.success("Imagen asignada con éxito")):(a.imagen_id=null,a.imagen_nombre="default_male.png",l.success("Imagen quitada con éxito"))},function(e){return l.error("Error al asignar imagen a usuario","Problema")})},e.cambiarFotoUnUsuario=function(a,r){var n;if(!1,r?confirm("Esto quitará la imágen de tu lista. ¿Seguro que deseas cambiar la imagen de este usuario?"):confirm("¿Ya no quieres que esta sea su foto oficial?"))return n={},r&&(n.imagen_id=r.id),o.put("::images-users/cambiar-foto-un-usuario/"+a.user_id,n).then(function(n){return r?(a.imagen_id=r.id,a.foto_nombre=r.nombre,e.imagenes_privadas=t("filter")(e.imagenes_privadas,function(e){return e.id!==r.id}),e.dato.selectedImg=void 0,e.imagenes_del_usuario.push(r),l.success("Foto asignada con éxito")):(a.foto_id=null,a.foto_nombre="default_male.png",l.success("Foto quitada con éxito"))},function(e){return l.error("Error al asignar foto oficial","Problema")})},e.cambiarFirmaUnProfe=function(a,r){var n;return!1,(r?confirm("Esto quitará la imágen de tu lista. ¿Seguro que deseas asignar firma a este usuario?"):confirm("¿Ya no quieres que sea su firma?"))&&(n={},r&&(n.imagen_id=r.id)),o.put("::images-users/cambiar-firma-un-profe/"+a.profesor_id,n).then(function(n){return r?(a.firma_id=r.id,a.firma_nombre=r.nombre,e.imagenes_privadas=t("filter")(e.imagenes_privadas,function(e){return e.id!==r.id}),e.dato.selectedImg=void 0,e.imagenes_del_usuario.push(r),l.success("Firma asignada con éxito")):(a.firma_id=null,a.firma_nombre=null,l.success("Firma quitada con éxito"))},function(e){return l.error("Error al asignar firma","Problema")})},e.alumSelect=function(a){var r,t,n,i;for(t=0,n=(i=e.alumnos).length;t<n;t++)i[t].selected=!1;return a.selected=!0,e.dato.alumnoElegido=a,r={usuario_id:a.user_id},o.put("::images-users/imagenes-de-usuario",r).then(function(a){return e.imagenes_del_usuario=a.data,e.mostrando_opt_img_de_alum=!0},function(e){return l.error("Error trayendo imagenes del usuario","Problema")})},e.profeSelect=function(a,r){var t;return t={usuario_id:a.user_id},o.put("::images-users/imagenes-de-usuario",t).then(function(a){return e.imagenes_del_usuario=a.data,e.mostrando_opt_img_de_prof=!0},function(e){return l.error("Error trayendo imagenes del usuario","Problema")})},e.moveImgToMe=function(a,r){var n;return e.dato.selectedImgDelUsuario?(n={img_id:a.id},o.put("::images-users/move-img-to-me",n).then(function(r){return e.imagenes_privadas.push(a),e.imagenes_del_usuario=t("filter")(e.imagenes_del_usuario,function(e){return e.id!==a.id}),e.dato.selectedImgDelUsuario=void 0,l.success("Ahora la imagen te pertenece.")},function(e){return l.error("Error mover imagen","Problema")})):l.warning("Seleccione la imagen que quiere tomar.")}}]).filter("filterByNomApell",["Acentos",function(e){return function(a,r){var t,n,o,i,s,u;if(r){if(""!==r){for(n=[],r=e.remove(r),i=0,s=a.length;i<s;i++)t=a[i],u=e.remove(t.nombres),o=e.remove(t.apellidos),-1===u.indexOf(r)&&-1===o.toLowerCase().indexOf(r)||n.push(t);return n}return a}return a}}])}.call(this),function(){angular.module("myvcFrontApp").controller("RemoveImageCtrl",["$scope","$uibModalInstance","imagen","user_id","datos_imagen","App","$http","AuthService","toastr",function(e,a,r,t,n,o,i,s,u){e.imagesPath=o.images+"perfil/",e.imagen=r,e.datos_imagen=n,e.hasRoleOrPerm=s.hasRoleOrPerm,e.ok=function(){return i.delete("::myimages/destroy/"+r.id).then(function(e){return console.log("Proceso de eliminado exitoso")},function(e){return u.error("No se pudo eliminar la imagen.")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","USER_ROLES","PERMISSIONS",function(e,a,r){return e.state("panel.papelera",{url:"^/papelera",views:{maincontent:{templateUrl:"==papelera/papelera.tpl.html",controller:"PapeleraCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Papelera de reciclaje"}]}}},data:{displayName:"Papelera",icon_fa:"fa fa-trash",pageTitle:"Papelera - MyVc"}})}])}.call(this),function(){angular.module("myvcFrontApp").controller("PapeleraCtrl",["$scope","App","$state","$http","$uibModal","$filter","toastr",function(e,a,r,t,n,o,i){var s,u,l,c,d,p;return e.restaurarAlum=function(a){return t.put("::alumnos/restore/"+a.alumno_id).then(function(){return e.gridAlumnos.data=o("filter")(e.gridAlumnos.data,{alumno_id:"!"+a.alumno_id}),i.success("Éxito","Alumno restaurado")},function(e){return i.error("No se restauró el alumno","Error")})},e.elimAlum=function(a){return n.open({templateUrl:"==papelera/forceRemoveAlumno.tpl.html",controller:"ForceRemoveAlumnoCtrl",resolve:{alumno:function(){return a}}}).result.then(function(a){return e.gridAlumnos.data=o("filter")(e.gridAlumnos.data,{alumno_id:"!"+a.alumno_id})})},s='<a class="btn btn-default btn-xs shiny info" ng-click="grid.appScope.restaurarAlum(row.entity)"><i class="fa fa-refresh "></i>Restaurar</a>',u='<a uib-tooltip="¡Eliminar completamente!" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.elimAlum(row.entity)"><i class="fa fa-times "></i></a>',e.gridAlumnos={enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"alumno_id",displayName:"Id",maxWidth:40},{name:"edicion",displayName:"Edición",maxWidth:110,enableSorting:!1,enableFiltering:!1,cellTemplate:s+u},{field:"nombres",enableHiding:!1},{field:"apellidos"},{field:"sexo",maxWidth:20},{field:"username",displayName:"Usuario"},{field:"fecha_nac",displayName:"Nacimiento",cellFilter:"date:mediumDate",type:"date"},{field:"direccion",displayName:"Dirección"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a}},e.restaurarGrupo=function(a){return t.put("::grupos/restore/"+a.id).then(function(){return e.gridGrupos.data=o("filter")(e.gridGrupos.data,{id:"!"+a.id}),i.success("Éxito","Grupo restaurado")},function(e){return i.error("No se restauró el grupo","Error")})},e.elimGrupo=function(a){return n.open({templateUrl:"::papelera/forceRemoveGrupo.tpl.html",controller:"ForceRemoveGrupoCtrl",resolve:{grupo:function(){return a}}}).result.then(function(a){return e.gridGrupos.data=o("filter")(e.gridGrupos.data,{id:"!"+a.id})})},l='<a class="btn btn-default btn-xs shiny info" ng-click="grid.appScope.restaurarGrupo(row.entity)"><i class="fa fa-refresh "></i>Restaurar</a>',c='<a uib-tooltip="¡Eliminar completamente!" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.elimGrupo(row.entity)"><i class="fa fa-times "></i></a>',e.gridGrupos={enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"id",displayName:"Id",maxWidth:40},{name:"edicion",displayName:"Edición",maxWidth:110,enableSorting:!1,enableFiltering:!1,cellTemplate:l+c},{field:"nombre",enableHiding:!1},{field:"abrev",displayName:"Abreviatura"},{field:"grado_id",maxWidth:20},{field:"titular_id",displayName:"Titular"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a}},t.get("::alumnos/trashed").then(function(a){return e.gridAlumnos.data=a.data},function(e){return i.warning("No se pudo traer los alumnos eliminados.")}),t.get("::grupos/trashed").then(function(a){return e.gridGrupos.data=a.data},function(e){return i.warning("No se pudo traer los grupos eliminados.")}),e.restaurarUnidad=function(a){return t.put("::unidades/restore/"+a.id).then(function(){return e.gridUnidad.data=o("filter")(e.gridUnidad.data,{id:"!"+a.id}),i.success("Éxito","Unidad restaurada")},function(e){return i.error("No se restauró la unidad","Error")})},e.elimUnidad=function(a){return n.open({templateUrl:"==papelera/forceRemoveUnidad.tpl.html",controller:"ForceRemoveUnidadCtrl",resolve:{unidad:function(){return a}}}).result.then(function(a){return e.gridUnidad.data=o("filter")(e.gridUnidad.data,{id:"!"+a.id})})},d='<a class="btn btn-default btn-xs shiny info" ng-click="grid.appScope.restaurarUnidad(row.entity)"><i class="fa fa-refresh "></i>Restaurar</a>',p='<a uib-tooltip="¡Eliminar completamente!" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.elimUnidad(row.entity)"><i class="fa fa-times "></i></a>',e.gridUnidad={enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"id",displayName:"Id",maxWidth:40},{name:"edicion",displayName:"Edición",maxWidth:110,enableSorting:!1,enableFiltering:!1,cellTemplate:d+p},{field:"definicion",displayName:"Definición",enableHiding:!1},{field:"alias_materia",displayName:"Materia"},{field:"abrev_grupo",displayName:"Grupo"},{field:"numero_periodo",displayName:"Per",maxWidth:20},{field:"porcentaje",displayName:"Porc"}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a}},t.get("::unidades/trashed").then(function(a){return e.gridUnidad.data=a.data},function(e){return i.warning("No se pudo traer las unidades eliminados.")}),t.get("::unidades/trashed").then(function(a){return e.gridUnidad.data=a.data},function(e){return i.warning("No se pudo traer las unidades eliminadas.")})}])}.call(this),function(){angular.module("myvcFrontApp").controller("ForceRemoveAlumnoCtrl",["$scope","$uibModalInstance","alumno","$http","toastr",function(e,a,r,t,n){return e.alumno=r,e.ok=function(){return t.delete("::alumnos/forcedelete/"+r.alumno_id).then(function(e){return n.success("Alumno eliminado con éxito.","Eliminado")},function(e){return n.warning("No se pudo eliminar al alumno.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}]).controller("ForceRemoveGrupoCtrl",["$scope","$uibModalInstance","grupo","$http","toastr",function(e,a,r,t,n){return e.grupo=r,e.ok=function(){return t.delete("::grupos/forcedelete/"+r.id).then(function(e){return n.success("Grupo eliminado con éxito.","Eliminado")},function(e){return n.warning("No se pudo eliminar al grupo.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}]).controller("ForceRemoveUnidadCtrl",["$scope","$uibModalInstance","unidad","$http","toastr",function(e,a,r,t,n){return e.unidad=r,e.ok=function(){return t.delete("::unidades/forcedelete/"+r.id).then(function(e){return n.success("Unidad eliminada con éxito.","Eliminado")},function(e){return n.warning("No se pudo eliminar la unidad.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App",function(e,a){return e.state("panel.bitacora",{url:"/bitacora",views:{maincontent:{templateUrl:`${a.views}bitacora/bitacora.tpl.html`,controller:"BitacoraCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Bitacora"}]}}},data:{displayName:"Bitacora",icon_fa:"fa fa-male",pageTitle:"Bitácora - MyVc"}})}])}.call(this),function(){angular.module("myvcFrontApp").controller("BitacoraCtrl",["$scope","toastr","$state","$http","uiGridConstants","AuthService",function(e,a,r,t,n,o){var i;return e.data={},e.hasRoleOrPerm=o.hasRoleOrPerm,t.get("::contratos").then(function(a){return e.contratos=a.data},function(e){return a.error("No se trajeron los profesores contratados")}),t.get("::bitacoras").then(function(a){return e.gridOptions.data=a.data},function(e){return a.error("No se pudo traer la bitácora")}),e.seleccionaProfe=function(r,n){return t.get("::bitacoras/index/"+r.user_id).then(function(a){return e.gridOptions.data=a.data},function(e){return a.error("No se pudo traer la bitácora")})},i='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',e.gridOptions={enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"id",type:"number",width:60},{name:"edicion",displayName:"Edición",width:40,enableSorting:!1,enableFiltering:!1,cellTemplate:i,enableCellEdit:!1},{field:"descripcion",displayName:"Descripción",filter:{condition:n.filter.CONTAINS}},{field:"affected_element_type",displayName:"Tipo",minWidth:80,filter:{condition:n.filter.CONTAINS}},{field:"affected_element_old_value_int",displayName:"Anterior"},{field:"affected_element_new_value_int",displayName:"Nuevo"},{field:"created_at",displayName:"Fecha",width:150,filter:{condition:n.filter.CONTAINS}}],multiSelect:!1,onRegisterApi:function(a){return e.gridApi=a}}}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","USER_ROLES","PERMISSIONS",function(e,a,r){e.state("panel.usuarios",{url:"^/usuarios",views:{maincontent:{templateUrl:"==usuarios/usuarios.tpl.html",controller:"UsuariosCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Usuarios"}]}}},data:{displayName:"Usuarios",icon_fa:"fa fa-user",needed_permissions:[r.can_edit_usuarios],pageTitle:"Usuarios - MyVc"}}).state("panel.user",{url:"^/user/:username",views:{maincontent:{templateUrl:"==usuarios/user.tpl.html",controller:"UserCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Perfil"}]}}},resolve:{perfilactual:["$http","$stateParams","$q","$state","toastr",function(e,a,r,t,n){var o,i;return o=r.defer(),(i=a.username)||""===i?e.get("::perfiles/username/"+i).then(function(e){return e.data[0].fecha_nac&&(e.data[0].fecha_nac=e.data[0].fecha_nac?new Date(e.data[0].fecha_nac.replace(/-/g,"/")):e.data[0].fecha_nac),o.resolve(e.data[0])},function(e){return o.reject(e)}):(n.warning("Lo sentimos, nombre de usuario no encontrado"),t.go("panel")),o.promise}]},data:{displayName:"Perfil",icon_fa:"fa fa-user"}}).state("panel.user.resumen",{url:"/r",views:{user_detail:{templateUrl:"==usuarios/userResumen.tpl.html",controller:"UserResumenCtrl"}},data:{displayName:"Resumen",icon_fa:"fa fa-user"}}).state("panel.user.configuracion",{url:"/c",views:{user_detail:{templateUrl:"==usuarios/userConfiguracion.tpl.html",controller:"UserConfiguracionCtrl"}},data:{displayName:"Configuración de perfil",icon_fa:"fa fa-user"}}).state("panel.usuarios.roles",{url:"/roles",views:{user_roles:{templateUrl:"==usuarios/roles.tpl.html",controller:"RolesCtrl"}},data:{displayName:"Roles",icon_fa:"fa fa-user-secret"}}).state("panel.usuarios.editar",{url:"/editar/:user_id",views:{edit_user:{templateUrl:"==usuarios/usuariosEdit.tpl.html",controller:"UsuariosEditCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Editar alumno"}]}}},data:{displayName:"Editar",icon_fa:"fa fa-users",pageTitle:"Editar alumno - MyVc"}})}])}.call(this),function(){angular.module("myvcFrontApp").controller("UserCtrl",["$scope","$http","$state","AuthService","Perfil","App","perfilactual","$filter",function(e,a,r,t,n,o,i,s){if(r.params.username,e.perfilactual=i,e.companieros=[],e.profesores=[],e.materias=[],e.canConfig=!1,e.hasRoleOrPerm=t.hasRoleOrPerm,e.perfilPath=o.images+"perfil/",e.setImagenPrincipal(),e.USER.user_id===e.perfilactual.user_id&&(e.canConfig=!0),e.setImagenPrincipal=function(){var a,r,t;return t=(a=o.images+"perfil/")+e.perfilactual.imagen_nombre,r=a+e.perfilactual.foto_nombre,e.imagenPrincipal=t,e.imagenOficial=r},function(){return a.get("::perfiles/profesormispersonas").then(function(a){return a=a.data,e.perfilactual=a[0],e.setImagenPrincipal()},function(e){return toastr.error("No se pudo traer el usuario"),r.transitionTo("panel")})},e.paisNacSelect=function(r,t){return a.get("::ciudades/departamentos/"+r.id).then(function(a){if(e.departamentosNac=a.data,void 0===e.perfilactual.pais_doc)return e.perfilactual.pais_doc=r,e.paisDocSelecionado(r)})},e.departNacSelect=function(r){return a.get("::ciudades/por-departamento/"+r.departamento).then(function(a){if(e.ciudadesNac=a.data,void 0===e.perfilactual.departamento_doc)return e.perfilactual.departamento_doc=r,e.departDocSeleccionado(r)})},e.paisDocSelecionado=function(r,t){return a.get("::ciudades/departamentos/"+r.id).then(function(a){return e.departamentos=a.data})},e.departDocSeleccionado=function(r){return a.get("::ciudades/por-departamento/"+r.departamento).then(function(a){return e.ciudades=a.data})},a.get("::paises").then(function(a){return e.paises=a.data}),a.get("::tiposdocumento").then(function(a){var r;if(e.tipos_doc=a.data,e.perfilactual.tipo_doc&&(r=s("filter")(e.tipos_doc,{id:e.perfilactual.tipo_doc})).length>0)return e.perfilactual.tipo_doc=r[0]}),null===e.perfilactual.ciudad_nac)e.perfilactual.pais_nac={id:1,pais:"COLOMBIA",abrev:"CO"},e.paisNacSelect(e.perfilactual.pais_nac,e.perfilactual.pais_nac);else{if("N/A"===e.perfilactual.ciudad_nac)return;a.get("::ciudades/datosciudad/"+e.perfilactual.ciudad_nac).then(function(a){return e.paises=a.data.paises,e.departamentosNac=a.departamentos,e.ciudadesNac=a.ciudades,e.perfilactual.pais_nac=a.pais,e.perfilactual.departamento_nac=a.departamento,e.perfilactual.ciudad_nac=a.ciudad}),a.get("::ciudades/datosciudad/"+e.perfilactual.ciudad_doc).then(function(a){return e.paises=a.data.paises,e.departamentos=a.departamentos,e.ciudades=a.ciudades,e.perfilactual.pais_doc=a.pais,e.perfilactual.departamento_doc=a.departamento,e.perfilactual.ciudad_doc=a.ciudad})}return e.nameToShow=function(){return"Usu"===e.perfilactual.tipo?e.perfilactual.username.toUpperCase():e.perfilactual.nombres+" "+e.perfilactual.apellidos}}])}.call(this),function(){angular.module("myvcFrontApp").controller("UserConfiguracionCtrl",["$scope","$http","$state","toastr","AuthService","Perfil","App","perfilactual",function(e,a,r,t,n,o,i,s){return n.verificar_acceso(),e.data={},e.comprobando=!1,e.mostrarErrorUsername=!1,e.mostrarErrorPassword=!1,e.canSaveUsername=!1,e.hasRoleOrPerm=n.hasRoleOrPerm,e.perfilPath=i.images+"perfil/",e.perfilactual=s,e.newusername="",e.passantiguo="",e.newpass="",e.newpassverif="",e.status={passCambiado:!1},e.nombresdeusuario=[],a.get("::perfiles/usernames").then(function(a){return e.nombresdeusuario=a.data},function(e){return t.error("No se trajeron los nombres de usuario")}),e.dateOptions={formatYear:"yyyy",allowInvalid:!0},e.guardarEmailRestore=function(e){return a.put("::perfiles/guardar-mi-email-restore",{email_restore:e}).then(function(e){return t.success("Email guardado con éxito")},function(e){return t.error("No se trajeron los nombres de usuario")})},e.$watch("newusername",function(e,a){}),e.comprobarusername=function(r){return e.canSaveUsername=!1,e.comprobando=!0,r.username&&(r=r.username),r===e.perfilactual.username?(t.warning("Copia un nombre de usuario diferente al que ya tienes"),void(e.comprobando=!1)):""===r?(t.warning("Debes copiar un nombre de usuario."),void(e.comprobando=!1)):a.get("::perfiles/comprobarusername/"+r).then(function(a){return(a=a.data)[0].existe?(t.warning("Nombre de usuario ya en uso."),e.mostrarErrorUsername=!0):(e.mostrarErrorUsername=!1,e.canSaveUsername=!0),e.comprobando=!1},function(a){return t.error("No se trajeron los nombres de usuario"),e.comprobando=!1})},e.guardar=function(){var r;return e.canSaveUsername=!1,r={nombres:e.perfilactual.nombres,apellidos:e.perfilactual.apellidos,sexo:e.perfilactual.sexo,fecha_nac:e.perfilactual.fecha_nac,celular:e.perfilactual.celular,tipo:e.perfilactual.tipo,email_persona:e.perfilactual.email_persona},a.put("::perfiles/update/"+e.perfilactual.persona_id,r).then(function(e){return t.success("Datos guardados")},function(a){return t.error("Datos NO guardados","Problema"),e.canSaveUsername=!0})},e.solicitarCambios=function(){return e.canSaveUsername=!1,a.put("::ChangesAsked/solicitar-cambios",e.perfilactual).then(function(e){return t.info("Debes esperar que un administrador acepte cambios","Solicitud realizada",{timeOut:8e3})},function(a){return t.error("Datos NO guardados","Problema"),e.canSaveUsername=!0})},e.CambiarUsername=function(r){return a.put("::perfiles/guardar-username/"+e.perfilactual.user_id,{username:r}).then(function(a){return t.success("Nombre de usuario guardado"),o.User().username=r,e.$emit("cambianImgs",{username:r})},function(e){return t.error("Nombre de usuario NO guardado","Problema")})},e.CambiarPass=function(r,n,o){var i;if(r===n){if(!(r.length<4))return e.cambiandoPass=!0,i={password:n,oldpassword:o},a.put("::perfiles/cambiarpassword/"+e.perfilactual.user_id,i).then(function(a){return t.success("Contraseña cambiada."),e.status.passCambiado=!1,e.cambiandoPass=!1},function(a){return(a=a.data).$error&&"Contraseña antigua es incorrecta"===a.error.message?t.warning(a.error.message):t.error("No se pudo cambiar la contraseña."),e.cambiandoPass=!1});t.warning("La contraseña debe tener mínimo 4 caracteres. Sin espacios ni Ñ ni tildes.")}else t.warning("Las contraseñas no coinciden")},e.CambiarCorreoRestore=function(){var r;return r={email_restore:e.email_restore},a.put("::perfiles/cambiaremailrestore/"+e.perfilactual.user_id,r).then(function(e){return t.success("Contraseña cambiada.")},function(e){return t.error("No se pudo cambiar la contraseña","Problema")})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("UserResumenCtrl",["$scope","$http",function(e,a){return console.log("Perm control")}])}.call(this),function(){angular.module("myvcFrontApp").controller("UsuariosCtrl",["$scope","$http","$state","$rootScope","AuthService","Perfil","App","$uibModal","$filter","toastr",function(e,a,r,t,n,o,i,s,u,l){var c,d,p;return n.verificar_acceso(),e.editar=function(e){return r.go("panel.usuarios.editar",{usuario_id:e.user_id})},e.crearUsuarioAdmin=function(){if(confirm("¿Seguro que desea crear un usuario Administrador?"))return e.creando=!0,a.post("::users/crear-administrador").then(function(a){return l.success("Creado con éxito"),e.gridOptions.data.unshift(a.data.usuario),e.creando=!1},function(){return l.error("No se pudo crear"),e.creando=!1})},e.crearUsuarioPsicologo=function(){if(confirm("¿Seguro que desea crear un usuario Psicólogo?"))return e.creando=!0,a.post("::users/crear-psicologo").then(function(a){return l.success("Creado con éxito"),e.gridOptions.data.unshift(a.data.usuario),e.creando=!1},function(){return l.error("No se pudo crear"),e.creando=!1})},e.crearUsuarioEnfermero=function(){if(confirm("¿Seguro que desea crear un usuario Enfermero?"))return e.creando=!0,a.post("::users/crear-enfermero").then(function(a){return l.success("Creado con éxito"),e.gridOptions.data.unshift(a.data.usuario),e.creando=!1},function(){return l.error("No se pudo crear"),e.creando=!1})},e.eliminar=function(a){return s.open({templateUrl:"==usuarios/removeUsuario.tpl.html",controller:"RemoveUsuarioCtrl",resolve:{usuario:function(){return a}}}).result.then(function(a){return e.gridOptions.data=u("filter")(e.gridOptions.data,{id:"!"+a.id})})},e.resetPass=function(e){return s.open({templateUrl:"==usuarios/resetPass.tpl.html",controller:"ResetPassCtrl",resolve:{usuario:function(){return e}}}).result.then(function(e){})},e.verRoles=function(e){return s.open({templateUrl:"==usuarios/verRoles.tpl.html",controller:"VerRolesCtrl",resolve:{usuario:function(){return e},roles:function(){return a.get("::roles")}}}).result.then(function(e){})},c='<a uib-tooltip="No cambies roles, consulta antes" class="btn btn-default btn-xs shiny" ng-click="grid.appScope.verRoles(row.entity)">Roles</a>',p='<a uib-tooltip="Resetear contraseña" tooltip-placement="right" class="btn btn-default btn-xs shiny" ng-click="grid.appScope.resetPass(row.entity)">Cambiar password</a>',d='<a uib-tooltip="Eliminar usuario" tooltip-placement="right" ng-show="row.entity.is_superuser" class="btn btn-danger btn-xs shiny" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times"></a>',e.gridOptions={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,enableGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"user_id",width:70,enableFiltering:!1,enableCellEdit:!1},{name:"edicion",displayName:"Edición",width:200,enableSorting:!1,enableFiltering:!1,cellTemplate:c+p+d,enableCellEdit:!1},{field:"username",displayName:"Usuario",filter:{condition:function(e,a,r){var t;return!!(t=r.entity).username&&t.username.toLowerCase().indexOf(e.toLowerCase())>-1}},enableHiding:!1},{field:"nombres",cellTemplate:'<div>{{row.entity.nombres + " " + row.entity.apellidos}}</div>',filter:{condition:function(e,a,r){var t;return!!(t=r.entity).nombres&&(t.nombres.toLowerCase().indexOf(e.toLowerCase())>-1||t.apellidos.toLowerCase().indexOf(e.toLowerCase())>-1)}}},{field:"sexo",width:70},{field:"roles",displayName:"Roles",enableCellEdit:!1,cellFilter:"mapRoles",filter:{condition:function(e,a){return u("filter")(a,{name:e}).length>0}}}],multiSelect:!1,onRegisterApi:function(r){return e.gridApi=r,r.edit.on.afterCellEdit(e,function(r,t,n,o){return n!==o&&("username"===t.field?a.put("::perfiles/guardar-username/"+r.user_id,{username:r.username}).then(function(e){return l.success("Nombre de Usuario actualizado con éxito","Actualizado")},function(e){return l.error("Cambio no guardado","Error")}):a.put("::perfiles/update/"+r.persona_id,r).then(function(e){return l.success("Usuario actualizado con éxito","Actualizado")},function(e){return l.error("Cambio no guardado","Error")})),e.$apply()})}},a.get("::perfiles/usuariosall?year_id="+e.USER.year_id).then(function(a){return e.gridOptions.data=a.data}),e.crearTodosLosUsuarios=function(){return a.put("::perfiles/creartodoslosusuarios").then(function(e){return l.success("Usuarios creados con éxito")},function(e){return l.error("No se pudo crear los usuarios","Problema")})}}]).filter("mapRoles",["$filter",function(e){return function(e,a){var r;return e?(r=[],angular.forEach(e,function(e,a){return r.push(e.name)}),r=r.join()):""}}]).controller("RemoveUsuarioCtrl",["$scope","$uibModalInstance","usuario","$http","toastr",function(e,a,r,t,n){return e.usuario=r,e.ok=function(){return t.delete("::perfiles/destroy/"+r.user_id).then(function(e){return n.success("Usuario eliminado con éxito.","Eliminado")},function(e){return n.warning("No se pudo eliminar al usuario.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}]).controller("ResetPassCtrl",["$scope","$uibModalInstance","usuario","$http","toastr",function(e,a,r,t,n){return e.usuario=r,e.newpassword="",e.showPassword=!1,e.ok=function(){return t.put("::perfiles/reset-password/"+r.user_id,{password:e.newpassword}).then(function(e){return n.success("Contraseña cambiada.")},function(e){return n.warning("No se pudo cambiar contraseña.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}]).controller("VerRolesCtrl",["$scope","$uibModalInstance","usuario","roles","$http","toastr",function(e,a,r,t,n,o){return e.usuario=r,e.roles=t.data,e.datos={selecteds:[]},e.datos.selecteds=r.roles,e.seleccionando=function(e,a){return n.put("::roles/addroletouser/"+e.id,{user_id:r.user_id}).then(function(e){return o.success("Rol agregado con éxito.")},function(e){return o.warning("No se pudo agregar el rol al usuario.","Problema")})},e.quitando=function(e,a){return n.put("::roles/removeroletouser/"+e.id,{user_id:r.user_id}).then(function(e){return o.success("Rol quitado con éxito.")},function(e){return o.warning("No se pudo quitar el rol al usuario.","Problema")})},e.ok=function(){return r.roles=e.datos.selecteds,a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("UsuariosEditCtrl",["$scope","$rootScope","$state","$http","toastr",function(e,a,r,t,n){e.data={},e.usuario={},e.tipos=[{tipo:"Alumno"},{tipo:"Profesor"},{tipo:"Acudiente"},{tipo:"Solo usuario"}],e.sangres=[{sangre:"O+"},{sangre:"O-"},{sangre:"A+"},{sangre:"A-"},{sangre:"B+"},{sangre:"B-"},{sangre:"AB+"},{sangre:"AB-"}],t.get("::usuarios/show/"+r.params.usuario_id).then(function(a){return e.usuario=a.data}),e.guardar=function(){return t.put("::alumnos/update/"+e.alumno.id,e.alumno).then(function(e){return n.success("Alumno actualizado correctamente")},function(e){return n.error("No se pudo guardar el alumno")})},e.paisNacSelect=function(a,r){return t.get("::ciudades/departamentos/"+a.id).then(function(r){if(e.departamentosNac=r,void 0===e.alumno.pais_doc)return e.alumno.pais_doc=a,e.paisSelecionado(a)})},e.departNacSelect=function(a){return t.get("::ciudades/por-departamento/"+a.departamento).get().then(function(r){if(e.ciudadesNac=r,void 0===e.alumno.departamento_doc)return e.alumno.departamento_doc=a,e.departSeleccionado(a)})},e.paisSelecionado=function(a,r){return t.get("::ciudades/departamentos/"+a.id).then(function(a){return e.departamentos=a.data})},e.departSeleccionado=function(a){return t.get("::ciudades/por-departamento/"+a.departamento).then(function(a){return e.ciudades=a.data})},e.dateOptions={formatYear:"yyyy"},e.restarEstrato=function(){if(e.alumno.estrato>0)return e.alumno.estrato=e.alumno.estrato-1},e.sumarEstrato=function(){if(e.alumno.estrato<10)return e.alumno.estrato=parseInt(e.alumno.estrato)+1}}])}.call(this),function(){angular.module("myvcFrontApp").controller("RolesCtrl",["$scope","$http","$state","$rootScope","AuthService","toastr","App","$filter",function(e,a,r,t,n,o,i,s){return n.verificar_acceso(),e.hasRoleOrPerm=n.hasRoleOrPerm,e.dato={},e.roles=[],e.permissions=[],a.get("::roles").then(function(a){return e.roles=a.data},function(e){return o.error("No se pudo traer los roles ",e)}),a.get("::permissions").then(function(a){return e.permissions=a.data},function(e){return o.error("No se pudo traer los permissions ",e)}),e.expand=function(e){return e.mostrandoPermisos=!0},e.collapse=function(e){return e.mostrandoPermisos=!1},e.addPermissions=function(e){return a.put("::roles/addpermission/"+e.id,{permission_id:e.newperm.id}).then(function(a){return e.perms.push(a.data),o.success("Permiso agregado al rol "+e.display_name)},function(e){return o.error("No se pudo agregar el permiso","Problema")})},e.removePermission=function(e,r){return a.put("::roles/removepermission/"+e.id,{permission_id:r.id}).then(function(a){return e.perms=s("filter")(e.perms,{id:"!"+r.id}),o.success("Permiso eliminado del rol "+e.display_name)},function(e){return o.error("No se pudo quitar el permiso","Problema")})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("PermissionsCtrl",["$scope","$http",function(e,a){return console.log("Perm control")}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App","PERMISSIONS",function(e,a,r){return e.state("panel.unidades",{url:"^/unidades/:asignatura_id",views:{maincontent:{templateUrl:"==unidades/unidades.tpl.html",controller:"UnidadesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:["AuthService","$q",function(e,a){var r;return r=a.defer(),e.verificar().then(function(e){return r.resolve(e.unidades_displayname)},function(e){return r.resolve("Unidades")}),r.promise}]}}},resolve:{usuario:["AuthService",function(e){return e.verificar()}]},data:{displayName:"Unidades",icon_fa:"fa fa-graduation-cap",pageTitle:"Unidades - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_edit_unidades_subunidades]}}).state("panel.copiar",{url:"^/copiar",views:{maincontent:{templateUrl:"==unidades/copiar.tpl.html",controller:"CopiarCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Copiar"}]}}},data:{displayName:"Copiar",icon_fa:"fa fa-copy",pageTitle:"Copiar - MyVc",needed_permissions:[r.can_work_like_teacher,r.can_edit_unidades_subunidades]}})}])}.call(this),function(){angular.module("myvcFrontApp").controller("UnidadesCtrl",["$scope","$uibModal","$http","$state","$filter","AuthService","toastr","resolved_user","$timeout",function(e,a,r,t,n,o,i,s,u){return o.verificar_acceso(),e.asignatura={},e.asignatura_id=t.params.asignatura_id,e.datos={},e.UNIDAD=e.USER.unidad_displayname,e.GENERO_UNI=e.USER.genero_unidad,e.SUBUNIDAD=e.USER.subunidad_displayname,e.GENERO_SUB=e.USER.genero_subunidad,e.UNIDADES=e.USER.unidades_displayname,e.SUBUNIDADES=e.USER.subunidades_displayname,e.hasRoleOrPerm=o.hasRoleOrPerm,e.activar_crear_unidad=!0,e.unidades=[],r.put("::unidades/de-asignatura-periodo/"+e.asignatura_id+"/"+e.USER.periodo_id).then(function(a){var r,t,o,i,s,u,l,c;if(e.anios_pasados=a.data.anios_pasados,e.mostrar_poco_anteriores=!0,a.data.unidades.length>0){for(r=0,o=(s=a.data.unidades).length;r<o;r++)if((c=s[r]).anim_bloqueada=!1,c.subunidades=n("orderBy")(c.subunidades,"orden"),e.bloquear_animacion(c),c)for(t=0,i=(u=c.subunidades).length;t<i;t++)(l=u[t]).anim_bloqueada=!1,e.bloquear_animacion(l);return e.unidades=a.data.unidades,e.unidades=n("orderBy")(e.unidades,"orden"),e.calcularPorcUnidades()}},function(a){return i.error("No se pudo traer las "+e.UNIDADES,"Problemas")}),r.get("::asignaturas/show/"+e.asignatura_id).then(function(a){if(a=a.data,e.asignatura=a,e.inicializado=!0,e.profesor_id=a.profesor_id,!a)return e.no_asignatura=!0},function(a){return i.error("No se pudo traer los datos de la asignatura"),e.no_asignatura=!0}),e.mostrarUnidadesEliminadas=function(){return e.mostrando_unidades_eliminadas?e.mostrando_unidades_eliminadas=!1:r.put("::unidades/eliminadas/"+e.asignatura_id).then(function(a){return a=a.data,e.unidades_eliminadas=a.unidades_eliminadas,e.subunidades_eliminadas=a.subunidades_eliminadas,e.mostrando_unidades_eliminadas=!0},function(a){return e.mostrando_unidades_eliminadas=!0,i.error("No se pudo traer las unidades eliminadas")})},e.restaurarUnidad=function(a){if(!a.restaurando)return a.restaurando=!0,r.put("::unidades/restore/"+a.id).then(function(r){return e.unidades.push(a),e.calcularPorcUnidades(),u(function(){return e.onSortUnidades(void 0,e.unidades)},100),i.success("Listo.")},function(e){return a.restaurando=!1,i.error("Error restaurando","Problema")})},e.mostrarSubunidadesEliminadas=function(){return e.mostrando_subunidades_eliminadas?e.mostrando_subunidades_eliminadas=!1:r.put("::subunidades/eliminadas/"+e.asignatura_id).then(function(a){return a=a.data,e.subunidades_eliminadas=a.subunidades,e.mostrando_subunidades_eliminadas=!0},function(a){return e.mostrando_subunidades_eliminadas=!0,i.error("No se pudo traer las subunidades eliminadas")})},e.restaurarSubunidad=function(e){if(!e.restaurando)return e.restaurando=!0,r.put("::subunidades/restore/"+e.id).then(function(e){return i.success("Listo. Recargue para ver los cambios")},function(a){return e.restaurando=!1,i.error("Error restaurando","Problema")})},e.copiarUnidade=function(){return e.asignatura.periodo_id=e.USER.periodo_id,e.asignatura.year_id=e.USER.year_id,a.open({templateUrl:"==unidades/copiarUnidadModal.tpl.html",controller:"CopiarUnidadModalCtrl",resolve:{USER:function(){return e.USER},asignatura:function(){return e.asignatura}}}).result.then(function(a){return e.gridOptions.data=n("filter")(e.gridOptions.data,{alumno_id:"!"+a.alumno_id})},function(){})},e.copiarUnidades=function(){return e.asignatura.periodo_id=e.USER.periodo_id,e.asignatura.year_id=e.USER.year_id,localStorage.asignatura_a_copiar=JSON.stringify(e.asignatura),t.go("panel.copiar")},e.calcularPorcUnidades=function(){var a;return a=0,angular.forEach(e.unidades,function(e,r){var t;return a+=e.porcentaje,t=0,angular.forEach(e.subunidades,function(e,a){return t+=e.porcentaje}),e.subunidades.porc_subunidades=t,e.subunidades.unidad_id=e.id}),e.unidades.porc_unidades=a},e.crearUnidad=function(){return e.activar_crear_unidad=!1,e.newunidad.asignatura_id=e.asignatura.asignatura_id,r.post("::unidades",e.newunidad).then(function(a){var r;return(a=a.data).subunidades=[],a.obligatoria=0,a.anim_bloqueada=!1,e.unidades.push(a),r="creado","F"===e.GENERO_UNI&&(r="creada"),i.success(e.UNIDAD+" "+r+". Ahora agrégale "+e.SUBUNIDADES),e.newunidad.definicion="",e.calcularPorcUnidades(),e.activar_crear_unidad=!0,e.bloquear_animacion()},function(a){return i.error("No se pudo crear la unidad","Problemas"),e.activar_crear_unidad=!0})},e.actualizarUnidad=function(a){var t;return t={definicion:a.definicion,porcentaje:a.porcentaje,asignatura_id:a.asignatura_id,periodo_id:e.USER.periodo_id,num_periodo:e.USER.numero_periodo},r.put("::unidades/update/"+a.id,t).then(function(r){var t;return t="actualizado","F"===e.GENERO_UNI&&(t="actualizada"),i.success(e.UNIDAD+" "+t+" con éxito."),a.editando=!1,e.calcularPorcUnidades()},function(a){return i.error("No se pudo actualizar "+e.UNIDAD,"Problemas")})},e.removeUnidad=function(r){return a.open({templateUrl:"==unidades/removeUnidad.tpl.html",controller:"RemoveUnidadCtrl",resolve:{unidad:function(){return r},USER:function(){return e.USER}}}).result.then(function(a){return e.unidades=n("filter")(e.unidades,{id:"!"+a.id}),e.calcularPorcUnidades(),u(function(){return e.onSortUnidades(void 0,e.unidades)},100)})},e.onSortUnidades=function(a,t,n,o,s){var u,l,c,d,p,m,f;for(m=[],d=c=0,p=t.length;c<p;d=++c)(f=t[d]).orden=d,(l={})[""+f.id]=d,m.push(l);return u={sortHash:m},r.put("::unidades/update-orden",u).then(function(e){return!0},function(e){return i.warning("No se pudo ordenar","Problema"),!1}),e.calcularPorcUnidades()},e.onStartSortUnidades=function(e,a,r,t){return console.log(e,a)},e.bloquear_animacion=function(e){if(e)return u(function(){return e.anim_bloqueada=!0},2e3)},e.activar_crear_subunidad=!0,e.onSortSubunidades=function(a,t,n,o,s){var u,l,c,d,p,m,f,g,_,h,v,b,y;if(t===n){for(h=[],d=c=0,f=t.length;c<f;d=++c)(y=t[d]).orden=d,(l={})[""+y.id]=d,h.push(l);u={sortHash:h},r.put("::subunidades/update-orden",u).then(function(e){return!0},function(e){return i.warning("No se pudo ordenar","Problema"),!1})}else{for(v=[],b=[],u={},d=p=0,g=t.length;p<g;d=++p)(y=t[d]).orden=d,(l={})[""+y.id]=d,v.push(l);for(v.length>0&&(u.unidad1_id=t.unidad_id,u.sortHash1=v),d=m=0,_=n.length;m<_;d=++m)(y=n[d]).orden=d,(l={})[""+y.id]=d,b.push(l);v.length>0&&(u.unidad2_id=n.unidad_id,u.sortHash2=b),r.put("::subunidades/update-orden-varias",u).then(function(e){return!0},function(e){return i.warning("No se pudo ordenar","Problema"),!1})}return e.calcularPorcUnidades()},e.addSubunidad=function(a){return e.activar_crear_subunidad=!1,a.newsubunidad?a.newsubunidad.definicion?(a.newsubunidad.porcentaje||(a.newsubunidad.porcentaje=0),a.newsubunidad.nota_default||(a.newsubunidad.nota_default=0),a.newsubunidad.unidad_id=a.id,a.newsubunidad.definicion=a.newsubunidad.definicion.trim(),r.post("::subunidades",a.newsubunidad).then(function(r){var t;return r.data.anim_bloqueada=!1,a.subunidades.push(r.data),t="creado","F"===e.GENERO_SUB&&(t="creada"),i.success(e.SUBUNIDAD+" "+t+" con éxito."),a.newsubunidad.definicion="",e.calcularPorcUnidades(),e.activar_crear_subunidad=!0,e.bloquear_animacion(r.data)},function(a){return i.error("No se pudo crear  "+("M"===e.GENERO_UNI?"el":"la")+scope.SUBUNIDAD,"Problemas"),e.activar_crear_subunidad=!0})):(i.warning("Debes escribir la difinición."),void(e.activar_crear_subunidad=!0)):(i.warning("Aún debes escribir."),void(e.activar_crear_subunidad=!0))},e.ir_a_notas=function(e){return t.go("panel.notas",e)},e.actualizarSubunidad=function(a,t){var n;return n={definicion:a.definicion,porcentaje:a.porcentaje,nota_default:a.nota_default,orden:a.orden,asignatura_id:t.asignatura_id,periodo_id:e.USER.periodo_id,num_periodo:e.USER.numero_periodo},r.put("::subunidades/update/"+a.id,n).then(function(r){var t;return t="actualizado","F"===e.GENERO_SUB&&(t="actualizada"),i.success(e.SUBUNIDAD+" "+t+" con éxito."),a.editando=!1,e.calcularPorcUnidades()},function(a){return i.error("No se pudo actualizar "+e.SUBUNIDAD,"Problemas")})},e.removeSubunidad=function(r,t){return a.open({templateUrl:"==unidades/removeSubunidad.tpl.html",controller:"RemoveSubunidadCtrl",resolve:{subunidad:function(){return t},unidad:function(){return r},USER:function(){return e.USER}}}).result.then(function(a){return r.subunidades=n("filter")(r.subunidades,{id:"!"+t.id}),e.calcularPorcUnidades(),u(function(){return e.onSortSubunidades(void 0,void 0,r.subunidades)},100)})}}]).controller("RemoveUnidadCtrl",["$scope","$uibModalInstance","unidad","$http","toastr","USER",function(e,a,r,t,n,o){return e.unidad=r,e.ok=function(){var e;return e={asignatura_id:r.asignatura_id,periodo_id:o.periodo_id,num_periodo:o.numero_periodo},t.delete("::unidades/destroy/"+r.id,{params:e}).then(function(e){return n.success("Unidad eliminada con éxito.","Eliminada")},function(e){return n.warning("No se pudo eliminar la unidad.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}]).controller("RemoveSubunidadCtrl",["$scope","$uibModalInstance","subunidad","unidad","USER","$http","toastr",function(e,a,r,t,n,o,i){return e.subunidad=r,e.ok=function(){var e;return e={asignatura_id:t.asignatura_id,periodo_id:n.periodo_id,num_periodo:n.numero_periodo},o.delete("::subunidades/destroy/"+r.id,{params:e}).then(function(e){return i.success("Subunidad eliminada con éxito.","Eliminada")},function(e){return i.warning("No se pudo eliminar la subunidad.","Problema")}),a.close(r)},e.cancel=function(){return a.dismiss("cancel")}}]).controller("CopiarUnidadModalCtrl",["$scope","$state","$uibModalInstance","asignatura","USER","$http","toastr","App","$filter",function(e,a,r,t,n,o,i,s,u){return e.asignatura=t,e.UNIDAD=n.unidad_displayname,e.GENERO_UNI=n.genero_unidad,e.SUBUNIDAD=n.subunidad_displayname,e.GENERO_SUB=n.genero_subunidad,e.UNIDADES=n.unidades_displayname,e.SUBUNIDADES=n.subunidades_displayname,e.configuracion={copiar_subunidades:!0,copiar_notas:!0},e.views=s.views,o.get("::profesores/conyears").then(function(a){return e.profesores=a.data},function(e){return i.error("No se pudo traer los profes con años",e)}),e.profesorSelect=function(a,r){return e.years_copy=a.years,e.configuracion.year_from=e.years_copy[e.years_copy.length-1],e.configuracion.periodo_from?(e.configuracion.periodo_from=e.configuracion.year_from.periodos[0],e.periodoSelect(e.configuracion.periodo_from)):e.periodos=e.configuracion.year_from.periodos},e.yearSelect=function(a,r){var t,n,o,i,s;if(e.periodos=a.periodos,e.asignatura_a_copiar&&e.asignatura_a_copiar.periodo_id){for(s=[],t=0,n=(i=e.periodos).length;t<n;t++)(o=i[t]).id===e.asignatura_a_copiar.periodo_id?(e.configuracion.periodo_from=o,s.push(e.periodoSelect(o))):s.push(void 0);return s}},e.periodoSelect=function(a,r){var t;return t=e.asignatura_a_copiar?e.asignatura_a_copiar.profesor_id:e.configuracion.profesor_from.id,o.get("::asignaturas/list-asignaturas-year/"+t+"/"+e.configuracion.periodo_from.id).then(function(a){var r,t,n,o,i,s;if(e.asignaturas=a.data,e.asignatura_a_copiar&&e.asignatura_a_copiar.asignatura_id)for(o=0,i=(s=e.asignaturas).length;o<i;o++)(n=s[o]).asignatura_id===e.asignatura_a_copiar.asignatura_id&&(e.configuracion.asignatura_from=n,e.asignaturaSelect(n));if(e.configuracion.asignatura_from)return t=e.configuracion.asignatura_from.asignatura_id,r=u("filter")(e.asignaturas,{asignatura_id:t})[0],e.configuracion.asignatura_from=r,e.asignaturaSelect(r)},function(e){return i.error("No se pudo traer las asignaturas origen")})},e.asignaturaSelect=function(a,r){var t,n,o;if(a&&a.unidades){for(t=0,n=(o=a.unidades.items).length;t<n;t++)o[t].seleccionada=!0;e.unidades=a.unidades}else e.unidades=[];return e.activar_btn_copiar=!0},e.copiar=function(){var r,n,s;if(e.activar_btn_copiar)return e.activar_btn_copiar=!1,n=u("filter")(e.unidades.items,{seleccionada:!0}),s=[],angular.forEach(n,function(e,a){return s.push(e.id)}),r={copiar_subunidades:e.configuracion.copiar_subunidades,copiar_notas:e.configuracion.copiar_notas,asignatura_to_id:t.asignatura_id,periodo_from_id:e.configuracion.periodo_from.id,periodo_to_id:t.periodo_id,unidades_ids:s,grupo_from_id:e.configuracion.asignatura_from.grupo_id,grupo_to_id:t.grupo_id},o.put("::periodos/copiar",r).then(function(r){return r=r.data,i.success("Copiado con éxito"),e.activar_btn_copiar=!0,e.resultado="Unidades copiadas: "+r.unidades_copiadas+" - Subunidades copiadas: "+r.subunidades_copiadas+" - Notas copidas: "+r.notas_copiadas,a.go("panel.unidades",{asignatura_id:t.asignatura_id},{reload:!0})},function(a){return i.error("No se pudieron copiar los datos"),e.activar_btn_copiar=!0})},e.ok=function(){return r.close(subunidad)},e.cancel=function(){return r.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").controller("CopiarCtrl",["$scope","$uibModal","$http","$filter","$rootScope","AuthService","toastr","App","YearsServ",function(e,a,r,t,n,o,i,s,u){var l;return o.verificar_acceso(),e.UNIDAD=e.USER.unidad_displayname,e.GENERO_UNI=e.USER.genero_unidad,e.SUBUNIDAD=e.USER.subunidad_displayname,e.GENERO_SUB=e.USER.genero_subunidad,e.UNIDADES=e.USER.unidades_displayname,e.SUBUNIDADES=e.USER.subunidades_displayname,e.views=s.views,e.hasRoleOrPerm=o.hasRoleOrPerm,e.configuracion={copiar_subunidades:!0,copiar_notas:!0},e.periodos=[],e.resultado="",l=e.USER.persona_id,e.urlTplSubunidades="==unidades/subunidadespop.tpl.html",e.profesores=[],!0===e.hasRoleOrPerm("admin")&&(e.conprofes=!0),r.get("::profesores/conyears").then(function(a){var r,t,n,o,i,s,u,c,d;if(e.profesores=a.data,localStorage.asignatura_a_copiar){if(e.asignatura_a_copiar=JSON.parse(localStorage.asignatura_a_copiar),delete localStorage.asignatura_a_copiar,e.asignatura_a_copiar.profesor_id){for(c=[],r=0,n=(s=e.profesores).length;r<n;r++){if((i=s[r]).id===e.asignatura_a_copiar.profesor_id)for(e.configuracion.profesor_from=i,e.years_copy=i.years,t=0,o=(u=e.years).length;t<o;t++)(d=u[t]).id===e.asignatura_a_copiar.year_id&&(e.configuracion.year_from=d,e.yearSelect(d));i.id===l?(e.years_copy_to=i.years,e.configuracion.year_to=i.years[i.years.length-1],c.push(e.yearToSelect(i.years[i.years.length-1]))):c.push(void 0)}return c}return e.set_year_copy_to()}return e.set_year_copy_to()},function(e){return i.error("No se pudo traer los profes con años",e)}),e.set_year_copy_to=function(){var a,r,t,n,o;for(o=[],a=0,r=(n=e.profesores).length;a<r;a++)(t=n[a]).id===l?(e.years_copy_to=t.years,e.configuracion.year_to=t.years[t.years.length-1],o.push(e.yearToSelect(t.years[t.years.length-1]))):o.push(void 0);return o},e.profesorSelect=function(a,r){return e.years_copy=a.years,e.configuracion.year_from=e.years_copy[e.years_copy.length-1],e.configuracion.periodo_from?(e.configuracion.periodo_from=e.configuracion.year_from.periodos[0],e.periodoSelect(e.configuracion.periodo_from)):e.periodos=e.configuracion.year_from.periodos},e.yearSelect=function(a,r){var t,n,o,i,s;if(e.periodos=a.periodos,e.asignatura_a_copiar&&e.asignatura_a_copiar.periodo_id){for(s=[],t=0,n=(i=e.periodos).length;t<n;t++)(o=i[t]).id===e.asignatura_a_copiar.periodo_id?(e.configuracion.periodo_from=o,s.push(e.periodoSelect(o))):s.push(void 0);return s}},e.periodoSelect=function(a,n){var o;return o=e.asignatura_a_copiar?e.asignatura_a_copiar.profesor_id:e.configuracion.profesor_from.id,r.get("::asignaturas/list-asignaturas-year/"+o+"/"+e.configuracion.periodo_from.id).then(function(a){var r,n,o,i,s,u;if(e.asignaturas=a.data,e.asignatura_a_copiar&&e.asignatura_a_copiar.asignatura_id)for(i=0,s=(u=e.asignaturas).length;i<s;i++)(o=u[i]).asignatura_id===e.asignatura_a_copiar.asignatura_id&&(e.configuracion.asignatura_from=o,e.asignaturaSelect(o));if(e.configuracion.asignatura_from)return n=e.configuracion.asignatura_from.asignatura_id,r=t("filter")(e.asignaturas,{asignatura_id:n})[0],e.configuracion.asignatura_from=r,e.asignaturaSelect(r)},function(e){return i.error("No se pudo traer las asignaturas origen")})},e.asignaturaSelect=function(a,r){var t,n,o;if(a&&a.unidades){for(t=0,n=(o=a.unidades.items).length;t<n;t++)o[t].seleccionada=!0;return e.unidades=a.unidades}return e.unidades=[]},e.profesorToSelect=function(a,r){if(e.years_copy_to=a.years,e.configuracion.periodo_to)return e.configuracion.periodo_to=e.configuracion.year_to.periodos[0],e.periodoToSelect(e.configuracion.periodo_to)},e.yearToSelect=function(a,r){return e.periodos_to=a.periodos},e.periodoToSelect=function(a,n){return!0===e.conprofes&&(l=e.configuracion.profesor_to.id),r.get("::asignaturas/list-asignaturas-year/"+l+"/"+e.configuracion.periodo_to.id).then(function(a){var r,n;if(a=a.data,e.asignaturas_to=a,e.configuracion.asignatura_to)return n=e.configuracion.asignatura_to.asignatura_id,r=t("filter")(e.asignaturas_to,{asignatura_id:n})[0],e.configuracion.asignatura_to=r,e.asignaturaToSelect(r)},function(e){return i.error("No se pudo traer las asignaturas destino, ",e)})},e.asignaturaToSelect=function(a,r){return a&&a.unidades?e.unidades_to=a.unidades:e.unidades_to=[],e.activar_btn_copiar=!0},e.copiar=function(){var a,n,o;if(e.activar_btn_copiar)return e.activar_btn_copiar=!1,n=t("filter")(e.unidades.items,{seleccionada:!0}),o=[],angular.forEach(n,function(e,a){return o.push(e.id)}),a={copiar_subunidades:e.configuracion.copiar_subunidades,copiar_notas:e.configuracion.copiar_notas,asignatura_to_id:e.configuracion.asignatura_to.asignatura_id,periodo_from_id:e.configuracion.periodo_from.id,periodo_to_id:e.configuracion.periodo_to.id,unidades_ids:o,grupo_from_id:e.configuracion.asignatura_from.grupo_id,grupo_to_id:e.configuracion.asignatura_to.grupo_id},r.put("::periodos/copiar",a).then(function(a){return a=a.data,i.success("Copiado con éxito"),e.activar_btn_copiar=!0,e.resultado="Unidades copiadas: "+a.unidades_copiadas+" - Subunidades copiadas: "+a.subunidades_copiadas+" - Notas copidas: "+a.notas_copiadas,e.unidades_to.items=a.unidades},function(a){return i.error("No se pudieron copiar los datos"),e.activar_btn_copiar=!0})}}])}.call(this),function(){angular.module("myvcFrontApp").directive("unidadDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}unidades/unidadDir.tpl.html`,transclude:!0,scope:{unidad:"=",indice:"="},link:function(e,a,r){},controller:["$scope","$http","toastr","$uibModal","$filter",function(e,a,r,t,n){return e.activar_crear_subunidad=!0,e.onSortSubunidades=function(t,n,o,i,s){var u,l,c,d,p,m,f,g,_,h,v,b,y;if(n===o){for(h=[],d=c=0,f=n.length;c<f;d=++c)(y=n[d]).orden=d,(l={})[""+y.id]=d,h.push(l);u={sortHash:h},a.put("::subunidades/update-orden",u).then(function(e){return!0},function(e){return r.warning("No se pudo ordenar","Problema"),!1})}else{for(v=[],b=[],u={},d=p=0,g=n.length;p<g;d=++p)(y=n[d]).orden=d,(l={})[""+y.id]=d,v.push(l);for(v.length>0&&(u.unidad1_id=n.unidad_id,u.sortHash1=v),d=m=0,_=o.length;m<_;d=++m)(y=o[d]).orden=d,(l={})[""+y.id]=d,b.push(l);v.length>0&&(u.unidad2_id=o.unidad_id,u.sortHash2=b),a.put("::subunidades/update-orden-varias",u).then(function(e){return!0},function(e){return r.warning("No se pudo ordenar","Problema"),!1})}return e.$parent.calcularPorcUnidades()},e.addSubunidad=function(t){return e.activar_crear_subunidad=!1,t.newsubunidad.unidad_id=t.id,a.post("::subunidades",t.newsubunidad).then(function(a){var n;return t.subunidades.push(a.data),n="creado","F"===e.$parent.GENERO_SUB&&(n="creada"),r.success(e.$parent.SUBUNIDAD+" "+n+" con éxito."),t.newsubunidad.definicion="",e.$parent.calcularPorcUnidades(),e.activar_crear_subunidad=!0},function(a){return r.error("No se pudo crear  "+("M"===e.$parent.GENERO_UNI?"el":"la")+scope.$parent.SUBUNIDAD,"Problemas"),e.activar_crear_subunidad=!0})},e.actualizarSubunidad=function(t){var n;return n={definicion:t.definicion,porcentaje:t.porcentaje,nota_default:t.nota_default,orden:t.orden},a.put("::subunidades/update/"+t.id,n).then(function(a){var n;return n="actualizado","F"===e.$parent.GENERO_SUB&&(n="actualizada"),r.success(e.$parent.SUBUNIDAD+" "+n+" con éxito."),t.editando=!1,e.$parent.calcularPorcUnidades()},function(a){return r.error("No se pudo actualizar "+e.$parent.SUBUNIDAD,"Problemas")})},e.removeSubunidad=function(a,r){return t.open({templateUrl:"==unidades/removeSubunidad.tpl.html",controller:"RemoveSubunidadCtrl",resolve:{subunidad:function(){return r}}}).result.then(function(t){return a.subunidades=n("filter")(a.subunidades,{id:"!"+r.id}),e.$parent.calcularPorcUnidades()})}}]}}])}.call(this),function(){angular.module("myvcFrontApp").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,a,r,t){var n;return n=function(){return t.$setViewValue(a.html())},t.$render=function(){return a.html(t.$viewValue||0)},a.bind("blur keyup change",function(){return e.$apply(n)})}}})}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App","PERMISSIONS",function(e,a,r){e.state("panel.disciplina",{url:"^/disciplina",views:{maincontent:{templateUrl:"==comportamiento/disciplina.tpl.html",controller:"DisciplinaCtrl",resolve:{escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Disciplina"}]}}},data:{displayName:"Disciplina",icon_fa:"fa fa-user",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin],pageTitle:"Disciplina - MyVc"}}).state("panel.disciplina.ver-situaciones-por-grupos",{url:"/ver-situaciones-por-grupos",views:{report_content:{templateUrl:"==comportamiento/verSituacionesPorGrupos.tpl.html",controller:"VerSituacionesPorGruposCtrl",resolve:{grupos_situaciones:["$http","$stateParams",function(e,a){return e.put("::comportamiento/situaciones-por-grupos")}]}}},data:{displayName:"Situaciones por grupos",icon_fa:"fa fa-print",pageTitle:"Situaciones por grupos - MyVc"}}).state("panel.disciplina.ver-observador-completo",{url:"/ver-observador-completo/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==comportamiento/verObservadorCompleto.tpl.html",controller:"VerObservadorCompletoCtrl",resolve:{grupo:["$http","$stateParams",function(e,a){return e.put("::comportamiento/observador-completo",{grupo_id:a.grupo_id})}]}}},data:{displayName:"Observador del grupo",icon_fa:"fa fa-print",pageTitle:"Observador del grupo - MyVc"}}).state("panel.disciplina.ver-observador-completo-paginas",{url:"/ver-observador-completo-paginas/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==comportamiento/verObservadorCompletoPaginas.tpl.html",controller:"VerObservadorCompletoPaginasCtrl",resolve:{grupo:["$http","$stateParams",function(e,a){return e.put("::comportamiento/observador-completo",{grupo_id:a.grupo_id})}]}}},data:{displayName:"Observador del grupo",icon_fa:"fa fa-print",pageTitle:"Observador del grupo - MyVc"}}).state("panel.disciplina.ver-observador-periodo",{url:"/ver-observador-periodo/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==comportamiento/verObservadorPeriodo.tpl.html",controller:"VerObservadorPeriodoCtrl",resolve:{grupo:["$http","$stateParams",function(e,a){return e.put("::comportamiento/observador-periodo",{grupo_id:a.grupo_id})}]}}},data:{displayName:"Observador periodo del grupo",icon_fa:"fa fa-print",pageTitle:"Observador periodo del grupo - MyVc"}}).state("panel.ordinales",{url:"^/ordinales",views:{maincontent:{templateUrl:"==comportamiento/ordinales.tpl.html",controller:"OrdinalesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Ordinales"}]}}},data:{displayName:"Ordinales",icon_fa:"fa fa-user",needed_permissions:[r.can_work_like_teacher,r.can_work_like_admin],pageTitle:"Ordinales - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("DisciplinaCtrl",["$scope","toastr","$http","$uibModal","$state","$filter","App","AuthService","escalas","EscalasValorativasServ","ProfesoresServ","$cookies",function(e,a,r,t,n,o,i,s,u,l,c,d){return s.verificar_acceso(),e.perfilPath=i.images+"perfil/",e.views=i.views,e.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.escalas=u,e.escala_maxima=l.escala_maxima(),e.config_infor={},e.datos={grupo:""},d.getObject("config")?e.config_infor=d.getObject("config"):e.config_infor.orientacion="vertical",localStorage.inmovible_activado?e.inmovible_activado="true"===localStorage.inmovible_activado:e.inmovible_activado=!0,e.toggleMostrarDetalle=function(e,a){return e[a]=!e[a]},e.traerProceso=function(){var t;return t=e.datos.grupo.id,r.put("::disciplina/alumnos",{grupo_id:t}).then(function(a){var r,t,n,o,i,s,u,l,c,d,p,m,f,g,_;for(e.alumnos=a.data.alumnos,g=[],t=0,s=(d=e.alumnos).length;t<s;t++){for(n=0,u=(p=(r=d[t]).uniformes_per1).length;n<u;n++)(_=p[n]).fecha_hora=new Date(_.fecha_hora.replace(/-/g,"/"));for(o=0,l=(m=r.uniformes_per2).length;o<l;o++)(_=m[o]).fecha_hora=new Date(_.fecha_hora.replace(/-/g,"/"));for(i=0,c=(f=r.uniformes_per3).length;i<c;i++)(_=f[i]).fecha_hora=new Date(_.fecha_hora.replace(/-/g,"/"));g.push(function(){var e,a,t,n;for(n=[],a=0,e=(t=r.uniformes_per4).length;a<e;a++)_=t[a],n.push(_.fecha_hora=new Date(_.fecha_hora.replace(/-/g,"/")));return n}())}return g},function(e){return a.error("No se trajo los alumnos")})},e.crearFalta=function(a,r,n){return t.open({templateUrl:"==comportamiento/crearFaltaModal.tpl.html",controller:"CrearFaltaCtrl",size:"lg",scope:e,resolve:{alumno:function(){return a},per_num:function(){return n},periodos:function(){return e.periodos},config:function(){return e.config},profesores:function(){return e.profesores},ordinales:function(){return e.ordinales},creando:function(){return!0}}}).result.then(function(e){},function(){})},e.verFaltasModal=function(a,r,n,o){return r.editando=!1,t.open({templateUrl:"==comportamiento/crearFaltaModal.tpl.html",controller:"CrearFaltaCtrl",size:"lg",scope:e,resolve:{alumno:function(){return a},per_num:function(){return n},periodos:function(){return e.periodos},config:function(){return e.config},profesores:function(){return e.profesores},ordinales:function(){return e.ordinales},creando:function(){return!1}}}).result.then(function(e){},function(){})},e.verUniformesModal=function(a,r){return t.open({templateUrl:"==comportamiento/uniformesAlumnoPeriodoModal.tpl.html",controller:"verUniformesAlumnoPeriodoModal",size:"lg",scope:e,resolve:{alumno:function(){return a},per_num:function(){return r},periodos:function(){return e.periodos},config:function(){return e.config},profesores:function(){return e.profesores}}}).result.then(function(e){},function(){})},e.toggleInmovible=function(){if(e.inmovible_activado=!e.inmovible_activado,localStorage.inmovible_activado=e.inmovible_activado,!e.inmovible_activado)return $("td.fixed-cell").css({transform:"translate(0, 0)"})},e.irComportamientoGrupo=function(){return n.go("panel.comportamiento",{grupo_id:e.datos.grupo.id})},r.put("::grupos/con-disciplina").then(function(a){var r,t,n,o,i;for(o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),e.grupos=a.data.grupos,e.config=a.data.config,e.ordinales=a.data.ordinales,e.descripciones_typeahead=a.data.descripciones_typeahead,e.year=a.data.year,t=0,n=(i=e.grupos).length;t<n;t++)(r=i[t]).id===o&&(e.datos.grupo=r,r.active=!0);return e.traerProceso()},function(){return a.error("No se pudo traer los grupos y datos")}),c.contratos().then(function(a){return e.profesores=a},function(e){return a.error("No se pudo traer los profesores.")}),e.selectGrupo=function(a){var r,t,n;for(localStorage.matr_grupo=a.id,e.datos.grupo=a,r=0,t=(n=e.grupos).length;r<t;r++)n[r].active=!1;return a.active=!0,e.traerProceso()},e.$watch("config_infor",function(a,r){return d.putObject("config",a),e.$broadcast("change_config")},!0),e.$broadcast("change_config"),e.verSituacionesPorGrupos=function(){return n.go("panel.disciplina.ver-situaciones-por-grupos",{reload:!0})},e.verObservadorPeriodo=function(){return n.go("panel.disciplina.ver-observador-periodo",{grupo_id:e.datos.grupo.id},{reload:!0})},e.verObservadorCompleto=function(){return n.go("panel.disciplina.ver-observador-completo",{grupo_id:e.datos.grupo.id},{reload:!0})},e.verObservadorCompletoPaginas=function(){return n.go("panel.disciplina.ver-observador-completo-paginas",{grupo_id:e.datos.grupo.id},{reload:!0})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("OrdinalesCtrl",["$scope","toastr","$http","$uibModal","$state","$filter","App","AuthService","Acentos","$interval","$anchorScroll","$location",function(e,a,r,t,n,o,i,s,u,l,c,d){var p,m,f,g,_;if(s.verificar_acceso(),e.datos={},e.perfilPath=i.images+"perfil/",e.views=i.views,e.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.gridOptions={},e.creando=!1,e.editando=!1,e.guardando=!1,e.configuracion={reinicia_por_periodo:0},e.ordinal_new={ordinal:"",descripcion:"",pagina:""},e.configurar=function(){return d.hash("configurar-convivencia"),c()},e.selectYear=function(a){return e.traerOrdinales(a.id,!1)},e.verCrear=function(){return e.creando=!0,e.ordinal_new.year_id=e.datos.year.id},e.cancelarCrear=function(){return e.creando=!1,e.ordinal_new={ordinal:"",descripcion:"",pagina:""}},e.cancelarEditar=function(){return e.editando=!1},e.editar=function(a){return e.ordinal_edit=a,e.editando=!0},e.crear=function(t){if(e.datos.year)return e.guardando=!0,t.year_id=e.datos.year.id,r.post("::ordinales/store",t).then(function(r){return console.log(r.data,e.gridOptions),e.gridOptions.data.push(r.data),a.success("Creado con éxito."),e.guardando=!1},function(){return a.error("No se puedo crear"),e.guardando=!1});a.warning("Elija el año")},e.eliminar=function(t){if(confirm("¿Seguro que desea eliminar?"))return r.put("::ordinales/destroy",{ordinal_id:t.id}).then(function(r){var n,o,i,s;for(e.gridOptions.data.push(r.data),a.success("Eliminado con éxito."),o=n=0,i=(s=e.gridOptions.data).length;n<i;o=++n)if(s[o].id===t.id)return void e.gridOptions.data.splice(o,1)},function(){return a.error("No se puedo crear"),e.guardando=!1})},e.guardar_cambios=function(t){if(e.datos.year)return t.year_id=e.datos.year.id,r.put("::ordinales/update",t).then(function(r){return a.success("Editado con éxito."),e.editando=!1},function(){return a.error("No se puedo crear")});a.warning("Elija el año")},m='<span style="padding-left: 2px; padding-top: 4px;" class="btn-group">'+'<a uib-tooltip="Editar" tooltip-placement="left" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>'+'<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-trash "></i></a>'+"</span>",e.gridOptions={showGridFooter:!0,showColumnFooter:!0,showFooter:!0,enableSorting:!0,enableFiltering:!0,enableGridMenu:!0,enebleGridColumnMenu:!1,enableCellEditOnFocus:!0,columnDefs:[{field:"no",cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{name:"edicion",displayName:"Edit",width:54,enableSorting:!1,enableFiltering:!1,cellTemplate:m,enableCellEdit:!1,enableColumnMenu:!0},{field:"tipo",minWidth:80,filter:{condition:u.buscarEnGrid}},{field:"ordinal",minWidth:70},{field:"descripcion",displayName:"Descripción",minWidth:210,filter:{condition:u.buscarEnGrid}},{field:"pagina",displayName:"Página",minWidth:70}],multiSelect:!1,onRegisterApi:function(t){return e.gridApi=t,t.edit.on.afterCellEdit(e,function(e,t,n,o){if(n!==o)return r.put("::ordinales/guardar-valor",{ordinal_id:e.id,propiedad:t.field,valor:n}).then(function(e){return a.success("Ordinal actualizado con éxito")},function(r){return e[t.field]=o,a.error("Cambio no guardado","Error")})})}},e.traerOrdinales=function(t,n){return r.put("::ordinales/ordinales",{year_id:t,con_datos:n}).then(function(a){return a=a.data,e.configuracion&&(e.config=a.configuracion,e.tipos=a.tipos),e.gridOptions.data=a.ordinales},function(e){return a.error("No se pudo traer los datos.")})},e.guardarValorConfig=function(e,t,n){return r.put("::ordinales/guardar-valor-config",{config_id:e.id,propiedad:t,valor:n}).then(function(e){return a.success("Campo actualizado")},function(e){return a.error("Cambio no guardado","Error")})},e.$parent.years){for(f=0,g=(_=e.$parent.years).length;f<g;f++)(p=_[f]).id===e.USER.year_id&&(e.datos.year=p);return e.traerOrdinales()}return e.Timer=l(function(){var a,r,t;if(e.$parent.years){for(angular.isDefined(e.Timer)&&l.cancel(e.Timer),a=0,r=(t=e.$parent.years).length;a<r;a++)(p=t[a]).id===e.USER.year_id&&(e.datos.year=p);return e.traerOrdinales()}},1e3)}])}.call(this),function(){angular.module("myvcFrontApp").directive("faltasDeLasQueDerivaDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}comportamiento/faltasDeLasQueDerivaDir.tpl.html`}}]).directive("faltasDeLasQueDerivaNuevoDir",["App",function(e){return{restrict:"E",templateUrl:`${e.views}comportamiento/faltasDeLasQueDerivaNuevoDir.tpl.html`}}]).controller("CrearFaltaCtrl",["$scope","$uibModalInstance","alumno","per_num","periodos","config","ordinales","profesores","creando","$http","toastr","App","AuthService",function(e,a,r,t,n,o,i,s,u,l,c,d,p){var m,f,g,_;for(e.alumno=r,e.datos={},e.config=o,e.periodos=n,e.profesores=s,e.ordinales=i,e.perfilPath=d.images+"perfil/",e.falta_new={},e.eliminando=!1,e.hasRoleOrPerm=p.hasRoleOrPerm,m=0,f=(_=e.periodos).length;m<f;m++)(g=_[m]).activo=!1,g.numero===t&&(g.activo=!0,g.creando=u,e.datos.periodo=g);return e.toggleVerCrear=function(e,a){return e.creando=a},e.eliminarFalta=function(a,t){if(!e.eliminando)return confirm("¿Seguro desea eliminar esta falta?")?(e.eliminando=!0,l.put("::disciplina/destroy",{proceso_id:t.id,alumno_id:r.alumno_id}).then(function(a){return c.success("Falta eliminada."),e.eliminando=!1,e.reemplazarAlumno(a.data,t.descripcion,!0)},function(a){return c.error("No se pudo eliminar.","Problema"),e.eliminando=!1})):void 0},e.editarFalta=function(a,r){var t,n,o,i,s,u,l,c;for(r.fecha_hora_aprox&&r.fecha_hora_aprox.replace&&(r.fecha_hora_aprox=new Date(r.fecha_hora_aprox.replace(/-/g,"/"))),e.falta_edit=r,e.falta_edit.selected_ordinales=[],t=0,o=(l=r.proceso_ordinales).length;t<o;t++)for(u=l[t],n=0,i=(c=e.ordinales).length;n<i;n++)s=c[n],u.id===s.id&&e.falta_edit.selected_ordinales.push(s);return a.editando=!0},e.cancelarEditarFalta=function(e){return e.editando=!1},e.seleccionandoOrdinal=function(a){return a.proceso_id=e.falta_edit.id,l.post("::disciplina/asignar-ordinal",a).then(function(e){return c.success("Ordinal asignado.")},function(e){return c.error("No se pudo asignar.","Problema")})},e.quitandoOrdinal=function(a){return a.proceso_id=e.falta_edit.id,l.put("::disciplina/quitar-ordinal",a).then(function(e){return c.success("Ordinal quitado.")},function(e){return c.error("No se pudo quitar.","Problema")})},e.reemplazarAlumno=function(a,r,t){var n,o,i,s,u,l,c,d,p,m;for(e.alumno=a,o=s=0,l=(p=e.alumnos).length;s<l;o=++s)(d=p[o])&&d.alumno_id===a.alumno_id&&e.alumnos.splice(o,1);if(e.alumnos.push(a),r){for(n=!1,i=u=0,c=(m=e.descripciones_typeahead).length;u<c;i=++u)m[i].descripcion===r&&!0!==t&&(n=i);if(n)return t?e.descripciones_typeahead.splice(n,1):e.descripciones_typeahead.push({descripcion:r})}},e.crear_falta=function(t){var n,o,i,s,d,p,m,f,g,_,h,v,b,y;for(e.guardando_new=!0,y=[],n=0,s=(g=r.periodo1).length;n<s;n++)(b=g[n]).seleccionado&&y.push(b);for(o=0,d=(_=r.periodo2).length;o<d;o++)(b=_[o]).seleccionado&&y.push(b);for(i=0,p=(h=r.periodo3).length;i<p;i++)(b=h[i]).seleccionado&&y.push(b);for(f=0,m=(v=r.periodo4).length;f<m;f++)(b=v[f]).seleccionado&&y.push(b);return e.falta_new.dependencias=y,e.falta_new.year_id=t.year_id,e.falta_new.periodo_id=t.id,e.falta_new.alumno_id=e.alumno.alumno_id,l.post("::disciplina/store",e.falta_new).then(function(r){if(c.success("Falta creada."),e.guardando_new=!1,t.creando=!1,e.reemplazarAlumno(r.data,e.falta_new.descripcion),u)return a.close(r.data)},function(a){return e.guardando_new=!1,c.error("No se pudo crear.","Problema")})},e.clickSituacionDerivante=function(a){return console.log(a,e.falta_edit),a.seleccionado?a.become_id=e.falta_edit.id:a.become_id=null,l.put("::disciplina/cambiar-situacion-derivante",a).then(function(e){return c.success("Cambios guardados.")},function(a){return e.guardando_edit=!1,c.error("No se pudo guardar.","Problema")})},e.guardar_falta=function(a){var t,n,o,i,s,u,d,p,m,f,g,_,h,v;for(e.guardando_edit=!0,v=[],t=0,i=(m=r.periodo1).length;t<i;t++)(h=m[t]).seleccionado&&v.push(h);for(n=0,s=(f=r.periodo2).length;n<s;n++)(h=f[n]).seleccionado&&v.push(h);for(o=0,u=(g=r.periodo3).length;o<u;o++)(h=g[o]).seleccionado&&v.push(h);for(p=0,d=(_=r.periodo4).length;p<d;p++)(h=_[p]).seleccionado&&v.push(h);return e.falta_edit.alumno_id=e.alumno.alumno_id,e.falta_edit.dependencias=v,l.put("::disciplina/update",e.falta_edit).then(function(r){return c.success("Cambios guardados."),e.guardando_edit=!1,a.editando=!1,e.reemplazarAlumno(r.data,e.falta_edit.descripcion)},function(a){return e.guardando_edit=!1,c.error("No se pudo guardar.","Problema")})},e.ok=function(){return a.close(e.alumno)}}])}.call(this),function(){angular.module("myvcFrontApp").controller("VerSituacionesPorGruposCtrl",["$scope","toastr","grupos_situaciones",function(e,a,r){return e.grupos_situaciones=r.data.grupos,e.year=e.$parent.year,console.log(e.$parent.year)}])}.call(this),function(){angular.module("myvcFrontApp").controller("VerObservadorCompletoCtrl",["$scope","toastr","grupo","App","Perfil",function(e,a,r,t,n){var o,i,s,u,l,c,d,p;if(e.grupo=r.data.grupo,e.imagenes=r.data.imagenes,e.perfilPath=t.images+"perfil/",e.views=t.views,e.observ={encabezado_margin_top:150,encabezado_margin_left:200},localStorage.imagen_fondo)for(e.observ.imagen=JSON.parse(localStorage.imagen_fondo),o=0,l=(d=e.imagenes).length;o<l;o++)(i=d[o])===e.observ.imagen&&(e.observ.imagen=i);else for(u=0,c=(p=e.imagenes).length;u<c;u++)(s=p[u]).nombre.includes("fondo-observador.png")&&(e.observ.imagen=s);return e.imagenSelect=function(e){return localStorage.imagen_fondo=JSON.stringify(e)},e.USER=n.User(),e.perfilPath=t.images+"perfil/",e.$emit("cambia_descripcion","Observador del alumno ")}]).controller("VerObservadorCompletoPaginasCtrl",["$scope","toastr","grupo","App","Perfil",function(e,a,r,t,n){var o,i,s,u,l,c,d,p;if(e.grupo=r.data.grupo,e.imagenes=r.data.imagenes,e.perfilPath=t.images+"perfil/",e.views=t.views,e.observ={encabezado_margin_top:150,encabezado_margin_left:200},localStorage.imagen_fondo)for(e.observ.imagen=JSON.parse(localStorage.imagen_fondo),o=0,l=(d=e.imagenes).length;o<l;o++)(i=d[o])===e.observ.imagen&&(e.observ.imagen=i);else for(u=0,c=(p=e.imagenes).length;u<c;u++)(s=p[u]).nombre.includes("fondo-observador.png")&&(e.observ.imagen=s);return e.imagenSelect=function(e){return localStorage.imagen_fondo=JSON.stringify(e)},e.USER=n.User(),e.perfilPath=t.images+"perfil/",e.$emit("cambia_descripcion","Observador del alumno ")}])}.call(this),function(){angular.module("myvcFrontApp").controller("VerObservadorPeriodoCtrl",["$scope","toastr","grupo","App","Perfil",function(e,a,r,t,n){var o,i,s,u,l,c,d,p;if(e.grupo=r.data.grupo,e.imagenes=r.data.imagenes,e.perfilPath=t.images+"perfil/",e.views=t.views,e.observ={encabezado_margin_top:150,encabezado_margin_left:200},localStorage.imagen_fondo)for(e.observ.imagen=JSON.parse(localStorage.imagen_fondo),o=0,l=(d=e.imagenes).length;o<l;o++)(i=d[o])===e.observ.imagen&&(e.observ.imagen=i);else for(u=0,c=(p=e.imagenes).length;u<c;u++)(s=p[u]).nombre.includes("fondo-observador.png")&&(e.observ.imagen=s);return e.imagenSelect=function(e){return localStorage.imagen_fondo=JSON.stringify(e)},e.USER=n.User(),e.perfilPath=t.images+"perfil/",e.$emit("cambia_descripcion","Observador del alumno ")}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS",function(e,a,r,t){return e.state("panel.informes",{url:"^/informes",views:{maincontent:{templateUrl:"==informes/informes.tpl.html",controller:"InformesCtrl"},headerContent:{templateUrl:"==panel/panelHeader.tpl.html",controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Informes interactivos"}]}}},resolve:{resolved_user:["AuthService",function(e){return e.verificar()}],alumnos:["AlumnosSinMatriculaServ",function(e){return e.alumnos()}],informes_datos:["InformesServ",function(e){return e.datos()}]},data:{displayName:"Informes",icon_fa:"fa fa-print",pageTitle:"Informes - MyVc",needed_permissions:[t.can_work_like_teacher,t.can_work_like_admin],needed_roles:[r.admin,r.psicologo,r.coord_academico,r.coord_disciplinario,r.secretario]}}).state("panel.informes.boletines_periodo",{url:"/boletines_periodo/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes/boletinesPeriodo.tpl.html",controller:"BoletinesPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::boletines/detailed-notas/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::boletines/detailed-notas/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::boletines/detailed-notas-group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletines periodo",pageTitle:"Boletines periodo - MyVc"}}).state("panel.informes.boletines_periodo2",{url:"/boletines_periodo2/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes2/boletinesPeriodo2.tpl.html",controller:"BoletinesPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::boletines2/detailed-notas/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::boletines2/detailed-notas/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::boletines2/detailed-notas-group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletines periodo",pageTitle:"Boletines periodo - MyVc"}}).state("panel.informes.boletines_periodo3",{url:"/boletines_periodo3/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes2/boletinesPeriodo3.tpl.html",controller:"BoletinesPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::boletines3/detailed-notas/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::boletines3/detailed-notas/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::boletines3/detailed-notas-group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletines periodo",pageTitle:"Boletines periodo - MyVc"}}).state("panel.informes.boletines_periodo4",{url:"/boletines_periodo4/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes2/boletinesPeriodo4.tpl.html",controller:"BoletinesPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::boletines3/detailed-notas/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::boletines3/detailed-notas/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::boletines3/detailed-notas-group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletines periodo",pageTitle:"Boletines periodo - MyVc"}}).state("panel.informes.boletines_periodo5",{url:"/boletines_periodo5/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes2/boletinesPeriodo5.tpl.html",controller:"BoletinesPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::boletines/detailed-notas/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::boletines/detailed-notas/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::boletines/detailed-notas-group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletines periodo",pageTitle:"Boletines periodo - MyVc"}}).state("panel.informes.puestos_grupo_periodo",{url:"/puestos_grupo_periodo/:grupo_id",views:{report_content:{templateUrl:"==informes/puestosGrupoPeriodo.tpl.html",controller:"PuestosGrupoPeriodoCtrl",resolve:{alumnosDat:["$http","$stateParams",function(e,a){return e.put("::puestos/detailed-notas-periodo/"+a.grupo_id)}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{pageTitle:"Puestos periodo - MyVc"}}).state("panel.informes.puestos_grupo_year",{url:"/puestos_grupo_year/:grupo_id/:periodo_a_calcular",views:{report_content:{templateUrl:`${a.views}informes/puestosGrupoYear.tpl.html`,controller:"PuestosGrupoYearCtrl",resolve:{datos_puestos:["$http","$stateParams",function(e,a){var r;return r={grupo_id:a.grupo_id,periodo_a_calcular:a.periodo_a_calcular},e.put("::puestos/detailed-notas-year",r)}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Puestos del año",icon_fa:"fa fa-print",pageTitle:"Puestos del año - MyVc"}}).state("panel.informes.puestos_todos_periodo",{url:"/puestos_todos_periodo",views:{report_content:{templateUrl:"==informes/puestosTodosPeriodo.tpl.html",controller:"PuestosTodosPeriodoCtrl",resolve:{escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{pageTitle:"Puestos todos periodo - MyVc"}}).state("panel.informes.puestos_todos_year",{url:"/puestos_todos_year/:periodo_a_calcular",views:{report_content:{templateUrl:"==informes/puestosTodosYear.tpl.html",controller:"PuestosTodosYearCtrl",resolve:{escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{pageTitle:"Puestos todos año - MyVc"}}).state("panel.informes.planillas_grupo",{url:"/planillas_grupo/:grupo_id/:periodos_a_calcular",views:{report_content:{templateUrl:"==informes/planillas.tpl.html",controller:"PlanillasCtrl",resolve:{asignaturas:["$http","$stateParams",function(e,a){return e.get("::planillas/show-grupo/"+a.grupo_id)}]}}},data:{displayName:"Planillas grupo",icon_fa:"fa fa-print",pageTitle:"Planillas grupo - MyVc"}}).state("panel.informes.notas_perdidas_profesor",{url:"/notas_perdidas_profesor/:profesor_id/:periodo_a_calcular/:solo_periodo",views:{report_content:{templateUrl:"==informes/notasPerdidasProfesor.tpl.html",controller:"NotasPerdidasProfesorCtrl",resolve:{grupos:["$http","$stateParams",function(e,a){var r;return r=!!a.solo_periodo,e.put("::notas-perdidas/profesor-grupos",{profesor_id:a.profesor_id,periodo_a_calcular:a.periodo_a_calcular,solo_periodo:r})}]}}},data:{displayName:"Notas perdidas por profesor",icon_fa:"fa fa-print",pageTitle:"Notas perdidas por profesor - MyVc"}}).state("panel.informes.notas_perdidas_todos",{url:"/notas_perdidas_profesor/:periodo_a_calcular/:solo_periodo",views:{report_content:{templateUrl:"==informes/notasPerdidasTodos.tpl.html",controller:"NotasPerdidasTodosCtrl",resolve:{profesores:["$http","$stateParams",function(e,a){var r;return r=!!a.solo_periodo,e.put("::notas-perdidas/todos",{periodo_a_calcular:a.periodo_a_calcular,solo_periodo:r})}]}}},data:{displayName:"Todas las notas perdidas",icon_fa:"fa fa-print",pageTitle:"Notas perdidas todas - MyVc"}}).state("panel.informes.ver_ausencias",{url:"/ver_ausencias",views:{report_content:{templateUrl:"==informes/verAusencias.tpl.html",controller:"VerAusenciasCtrl",resolve:{grupos_ausencias:["$http","$stateParams",function(e,a){return e.get("::planillas/ver-ausencias")}]}}},data:{displayName:"Ausencias",icon_fa:"fa fa-print",pageTitle:"Ausencias - MyVc"}}).state("panel.informes.ver_simat",{url:"/ver_simat",views:{report_content:{templateUrl:"==informes/verSimat.tpl.html",controller:"VerSimatCtrl",resolve:{grupos_simat:["$http","$stateParams",function(e,a){return e.get("::planillas/ver-simat")}]}}},data:{displayName:"SIMAT",icon_fa:"fa fa-print",pageTitle:"SIMAT - MyVc"}}).state("panel.informes.listas_personalizadas",{url:"/listas_personalizadas",views:{report_content:{templateUrl:"==informes/listasPersonalizadas.tpl.html",controller:"ListasPersonalizadasCtrl",resolve:{grupos_simat:["$http","$stateParams",function(e,a){return e.get("::planillas/listas-personalizadas")}]}}},data:{displayName:"Listas personalizadas",icon_fa:"fa fa-print",pageTitle:"Listas personalizadas - MyVc"}}).state("panel.informes.planillas-ausencias-acudientes",{url:"/planillas-ausencias-acudientes",views:{report_content:{templateUrl:"==informes2/planillasAusenciasAcudientes.tpl.html",controller:"PlanillasAusenciasAcudientesCtrl",resolve:{grupos_acud:["$http","$stateParams",function(e,a){return e.put("::acudientes/planillas-ausencias")}]}}},data:{displayName:"Asistencia acudientes",icon_fa:"fa fa-print",pageTitle:"Planillas asistencia padres - MyVc"}}).state("panel.informes.ver_observador_vertical",{url:"/ver_observador_vertical/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==informes/verObservadorVertical.tpl.html",controller:"VerObservadorVerticalCtrl",resolve:{grupos_observador:["$http","$stateParams",function(e,a){return e.get("::observador/vertical/"+a.grupo_id+"/oficio")}]}}},data:{displayName:"Observador",icon_fa:"fa fa-print",pageTitle:"Observador - MyVc"}}).state("panel.informes.ver_observador_horizontal",{url:"/ver_observador_horizontal/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==informes/verObservadorHorizontal.tpl.html",controller:"VerObservadorHorizontalCtrl",resolve:{grupos_observador:["$http","$stateParams",function(e,a){return e.put("::observador-horizontal/horizontal/"+a.grupo_id)}]}}},data:{displayName:"Observador",icon_fa:"fa fa-print",pageTitle:"Observador - MyVc"}}).state("panel.informes.ver_observador_vertical_todos",{url:"/ver_observador_vertical_todos",views:{report_content:{templateUrl:"==informes/verObservadorVertical.tpl.html",controller:"VerObservadorVerticalCtrl",resolve:{grupos_observador:["$http","$stateParams",function(e,a){return e.get("::observador/vertical-todos")}]}}},data:{displayName:"Observador",icon_fa:"fa fa-print",pageTitle:"Observador - MyVc"}}).state("panel.informes.planillas_profesor",{url:"/planillas_profesor/:profesor_id/:periodos_a_calcular",views:{report_content:{templateUrl:"==informes/planillas.tpl.html",controller:"PlanillasCtrl",resolve:{asignaturas:["$http","$stateParams",function(e,a){return e.get("::planillas/show-profesor/"+a.profesor_id)}]}}},data:{displayName:"Planillas profesor",icon_fa:"fa fa-print",pageTitle:"Planillas profesor - MyVc"}}).state("panel.informes.control_tardanza_entrada",{url:"/control_tardanza_entrada",views:{report_content:{templateUrl:"==informes/controlTardanzaEntrada.tpl.html",controller:"ControlTardanzaEntradaCtrl",resolve:{grupos:["$http","$stateParams",function(e,a){return e.put("::planillas-ausencias/tardanza-entrada")}]}}},data:{displayName:"Control de tardanza entrada",icon_fa:"fa fa-print",pageTitle:"Control de tardanza entrada - MyVc"}}).state("panel.informes.control_asistencia_clase",{url:"/control_asistencia_clase",views:{report_content:{templateUrl:"==informes/controlAsistenciaClase.tpl.html",controller:"ControlAsistenciaClaseCtrl",resolve:{grupos:["$http","$stateParams",function(e,a){return e.put("::planillas-ausencias/tardanza-entrada")}]}}},data:{displayName:"Control asistencia a Clases",icon_fa:"fa fa-print",pageTitle:"Control asistencia a Clases - MyVc"}}).state("panel.informes.planillas_ausencias1",{url:"/planillas_ausencias1/:profesor_id",views:{report_content:{templateUrl:"==informes/planillasAusencias1.tpl.html",controller:"PlanillasAusencias1Ctrl",resolve:{asignaturas:["$http","$stateParams",function(e,a){return e.get("::planillas-ausencias/show-profesor/"+a.profesor_id)}]}}},data:{displayName:"Planillas profesor",icon_fa:"fa fa-print",pageTitle:"Planillas profesor - MyVc"}}).state("panel.informes.unidades_profesor",{url:"/unidades_profesor/:profesor_id",views:{report_content:{templateUrl:"==informes/unidadesProfesor.tpl.html",controller:"UnidadesProfesorCtrl",resolve:{asignaturas:["$http","$stateParams",function(e,a){return e.put("::unidades/de-profesor",{profesor_id:a.profesor_id})}]}}},data:{displayName:"Unidades profesor",icon_fa:"fa fa-print",pageTitle:"Unidades profesor - MyVc"}}).state("panel.informes.cumpleanos_por_meses",{url:"/cumpleanos_por_meses",views:{report_content:{templateUrl:"==informes/cumpleanosPorMeses.tpl.html",controller:"CumpleanosPorMesesCtrl",resolve:{meses_cumple:["$http","$stateParams",function(e,a){return e.put("::informes/cumpleanos-por-meses")}]}}},data:{displayName:"Cumpleaños por meses",icon_fa:"fa fa-print",pageTitle:"Cumpleaños por meses - MyVc"}}).state("panel.informes.acta_evaluacion_promocion",{url:"/acta_evaluacion_promocion",views:{report_content:{templateUrl:"==informes/actaEvaluacionPromocion.tpl.html",controller:"ActaEvaluacionPromocionCtrl",resolve:{datos:["$http","$stateParams",function(e,a){return e.put("::actas-evaluacion/acta-evaluacion-promocion")}]}}},data:{displayName:"Acta de evaluación y promoción",icon_fa:"fa fa-print",pageTitle:"Acta de evaluación y promoción - MyVc"}}).state("panel.informes.boletines_finales",{url:"/boletines_finales/:grupo_id/year_selected/:year_selected",params:{grupo_id:{value:null},year_selected:{value:null}},views:{report_content:{templateUrl:"==informes/boletinesFinales.tpl.html",controller:"BoletinesFinalesCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::bolfinales/detailed-notas-year/"+a.grupo_id,{requested_alumnos:i,year_selected:a.year_selected}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::bolfinales/detailed-notas-year/"+o[0].grupo_id,{requested_alumnos:o,year_selected:a.year_selected}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::bolfinales/detailed-notas-year-group/"+a.grupo_id,{year_selected:a.year_selected}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Boletines finales",pageTitle:"Boletines finales - MyVc"}}).state("panel.informes.boletines_finales_preescolar",{url:"/boletines_finales_preescolar/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==informes/boletinesFinalesPreescolar.tpl.html",controller:"BoletinesFinalesPreescolarCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::bolfinales-preescolar/detailed-notas-year/"+a.grupo_id,{requested_alumnos:i}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::bolfinales-preescolar/detailed-notas-year/"+o[0].grupo_id,{requested_alumnos:o}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::bolfinales-preescolar/detailed-notas-year-group/"+a.grupo_id).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}]}}},data:{displayName:"Boletines finales preescolar",pageTitle:"Boletines finales preescolar - MyVc"}}).state("panel.informes.certificados_estudio",{url:"/certificados_estudio/:grupo_id",params:{grupo_id:{value:null}},views:{report_content:{templateUrl:"==informes/certificadosEstudio.tpl.html",controller:"CertificadosEstudioCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::bolfinales/detailed-notas-year/"+a.grupo_id,{requested_alumnos:i}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::bolfinales/detailed-notas-year/"+o[0].grupo_id,{requested_alumnos:o}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::bolfinales/detailed-notas-year/"+a.grupo_id).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Certificados de estudio",pageTitle:"Certificados de estudio - MyVc"}}).state("panel.informes.certificados_estudio_periodo",{url:"/certificados-estudio-periodo/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes/certificadosEstudio.tpl.html",controller:"CertificadosEstudioCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::bolfinales/detailed-notas-year/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular,aumentar_contador:!0}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::bolfinales/detailed-notas-year/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular,aumentar_contador:!0}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::bolfinales/detailed-notas-year/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular,aumentar_contador:!0}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Certificados de estudio",pageTitle:"Certificados de estudio - MyVc"}}).state("panel.informes.notas_actuales_alumnos",{url:"/notas_actuales_alumnos/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes2/notasActualesAlumnos.tpl.html",controller:"NotasActualesAlumnosCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::notas-actuales-alumnos/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::notas-actuales-alumnos/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::notas-actuales-alumnos/group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Notas actuales",pageTitle:"Notas actuales - MyVc"}}).state("panel.informes.notas_perdidas_actuales_alumnos",{url:"/notas_perdidas_actuales_alumnos/:grupo_id/:periodo_a_calcular",params:{grupo_id:{value:null},periodo_a_calcular:{value:null}},views:{report_content:{templateUrl:"==informes2/notasPerdidasActualesAlumnos.tpl.html",controller:"NotasActualesAlumnosCtrl",resolve:{alumnosDat:["$http","$stateParams","$q","$cookies",function(e,a,r,t){var n,o,i;return n=r.defer(),i=t.getObject("requested_alumnos"),o=t.getObject("requested_alumno"),i?e.put("::notas-actuales-alumnos/"+a.grupo_id,{requested_alumnos:i,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):o?e.put("::notas-actuales-alumnos/"+o[0].grupo_id,{requested_alumnos:o,periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}):e.put("::notas-actuales-alumnos/group/"+a.grupo_id,{periodo_a_calcular:a.periodo_a_calcular}).then(function(e){return n.resolve(e.data)},function(e){return n.reject(e.data)}),n.promise}],escalas:["EscalasValorativasServ",function(e){return e.escalas()}]}}},data:{displayName:"Notas perdidas actuales",pageTitle:"Notas perdidas actuales - MyVc"}})}])}.call(this),function(){angular.module("myvcFrontApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS",function(e,a,r,t){return e.state("panel.informes.listado_profesores",{url:"/listado_profesores",views:{report_content:{templateUrl:"==informes2/listadoProfesores.tpl.html",controller:"ListadoProfesoresCtrl",resolve:{profesores:["$http","$stateParams",function(e){return e.put("::profesores/listado")}]}}},data:{displayName:"Listado profesores",icon_fa:"fa fa-print",pageTitle:"Listado profesores - MyVc"}}).state("panel.informes.ver_cant_alumnos_por_grupos",{url:"/ver_cant_alumnos_por_grupos",views:{report_content:{templateUrl:"==informes2/verCantAlumnosPorGrupos.tpl.html",controller:"VerCantAlumnosPorGruposCtrl",resolve:{grupos:["$http","$stateParams",function(e){return e.put("::grupos/con-cantidad-alumnos")}]}}},data:{displayName:"Ver alumnos por grupos",icon_fa:"fa fa-print",pageTitle:"Ver alumnos por grupos - MyVc"}})}])}.call(this),function(){angular.module("myvcFrontApp").controller("InformesCtrl",["$scope","$http","$state","$uibModal","$stateParams","$filter","App","AuthService","ProfesoresServ","informes_datos","alumnos","$timeout","$cookies","toastr","$interval","DownloadServ","Upload",function(e,a,r,t,n,o,i,s,u,l,c,d,p,m,f,g,_){var h,v,b,y,w,C,S;return s.verificar_acceso(),e.rowsAlum=[],e.$state=r,e.$stateParams=n,e.hasRoleOrPerm=s.hasRoleOrPerm,e.config={periodos_a_calcular:1,mostrar_foto:!0,show_firma_rector:!0,show_rojos:!0,show_porcentajes:!0,show_tabla_perdidas:!0,show_firma_titular:!0,show_firma_secretario:!0,show_cedulas:!0,show_datos:!0,show_info_escalas:!0,show_grafico:!0,periodo_a_calcular:e.USER.numero_periodo,generar_bol_final_prees:!1,informe_tab_actual:e.hasRoleOrPerm(["Coord disciplinario"])},e.filtered_alumnos=c,e.perfilPath=i.images+"perfil/",e.views=i.views,e.mostrar_faltante=!1,e.datos={grupo:""},C=l,e.year_actual=C.year,e.grupos=C.grupos,e.profesores=C.profesores,e.imgs_public=C.imagenes,e.periodos_grupos=C.periodos_grupos,C.periodos_desactualizados&&(e.periodos_desactualizados=C.periodos_desactualizados),r.params.grupo_id&&(h=parseInt(r.params.grupo_id),e.datos.grupo=o("filter")(e.grupos,{id:h},!0)[0],e.filtered_alumnos=o("orderBy")(o("filter")(c,{grupo_id:h},!0),"apellidos")),r.params.profesor_id&&(h=parseInt(r.params.profesor_id),e.datos.profesor=o("filter")(e.profesores,{profesor_id:h},!0)[0]),localStorage.tipo_boletin&&(e.tipo_boletin=localStorage.tipo_boletin),localStorage.tipo_boletin_final&&(e.tipo_boletin_final=localStorage.tipo_boletin_final,"Profesor"===e.USER.tipo&&(e.tipo_boletin_final=1)),e.eligirTipo=function(a){return localStorage.tipo_boletin=a,e.tipo_boletin=a},e.onPrint=function(){var e,a;return(a=document.querySelector(".informes-pages"))&&(a.scrollTop=0),(e=document.querySelector("html"))&&(e.scrollTop=0),d(function(){return window.print()},10)},e.calcularPromovido=function(){return t.open({templateUrl:"==informes2/calcularPromovidosModal.tpl.html",controller:"CalcularPromovidosModalCtrl",resolve:{USER:function(){return e.USER},grupos:function(){return e.grupos}}}).result.then(function(e){},function(){})},e.eligirTipoFinal=function(a){return localStorage.tipo_boletin_final=a,e.tipo_boletin_final=a},e.range=function(e){return new Array(e)},p.getObject("config")?e.config=p.getObject("config"):(e.config.orientacion="vertical",e.config.cant_imagenes=7),p.getObject("requested_alumnos")&&((S=p.getObject("requested_alumnos")).length>0?(y=[],angular.forEach(S,function(e,a){var r;return r=o("filter")(c,{alumno_id:e.alumno_id},!0)[0],y.push(r)}),e.datos.selected_alumnos=y):e.datos.selected_alumno=S[0]),p.getObject("requested_alumno")&&(S=p.getObject("requested_alumno"),b=o("filter")(c,{alumno_id:S[0].alumno_id},!0)[0],e.datos.selected_alumno=b),e.$watch("config",function(a,r){return p.putObject("config",a),e.$broadcast("change_config")},!0),e.selectTab=function(a){return e.config.informe_tab_actual=a,p.putObject("config",e.config)},e.putConfigCookie=function(){return p.putObject("config",e.config)},e.calcularGrupoPeriodo=function(e,r){return e.desabilitado=!0,a.put("::definitivas_periodos/calcular-grupo-periodo",{grupo_id:e.grupo_id,periodo_id:r.id,num_periodo:r.numero}).then(function(a){return m.success(e.nombre+" calculado con éxito")},function(a){return e.desabilitado=!1,m.error("No se pudo calcular las definitivas del grupo "+e.nombre+", Per "+r.numero)})},e.calcularPeriodo=function(r){return e.porcentaje=0,r.bloqueado=!0,e.grupo_temp_calculado=!0,e.grupo_temp_indce=0,e.intervalo=f(function(){var t;if(e.grupo_temp_calculado)return e.grupo_temp_calculado=!1,t=r.grupos[e.grupo_temp_indce],e.porcentaje=parseInt(100*(e.grupo_temp_indce+1)/r.grupos.length),a.put("::definitivas_periodos/calcular-grupo-periodo",{grupo_id:t.grupo_id,periodo_id:r.id,num_periodo:r.numero}).then(function(a){if(m.success(t.nombre+" calculado con éxito"),e.grupo_temp_calculado=!0,e.grupo_temp_indce=e.grupo_temp_indce+1,e.grupo_temp_indce===r.grupos.length)return f.cancel(e.intervalo)},function(a){return e.grupo_temp_calculado=!0,m.warning("No se pudo calcular "+t.nombre+", Per "+r.numero+". Intentaremos de nuevo.")})},20)},e.verBoletinesGrupo=function(t){var n,o,i,s,u,l,c,d,p;if(e.config.generar_bol_final_prees)return e.config.orientacion="vertical",void r.go("panel.informes.boletines_finales_preescolar",{grupo_id:e.datos.grupo.id},{reload:!0});if(e.periodos_desactualizados){for(b=!1,o={},i=0,u=(d=e.periodos_desactualizados).length;i<u;i++)if(c=d[i],e.USER.numero_periodo===c.numero)for(s=0,l=(p=c.grupos).length;s<l;s++)(n=p[s]).grupo_id===e.datos.grupo.id&&(b=!0,o=n);return b?a.put("::definitivas_periodos/calcular-grupo-periodo",{grupo_id:o.grupo_id,periodo_id:e.USER.periodo_id,num_periodo:e.USER.numero_periodo}).then(function(a){return e.verBoletinesGrupoCargar(t)},function(a){return m.warning("No se pudo calcular "+o.nombre+", Per "+e.USER.numero_periodo+". Intentaremos de nuevo.")}):e.verBoletinesGrupoCargar(t)}return e.verBoletinesGrupoCargar(t)},e.verBoletinesGrupoCargar=function(a){if("1"!==a&&1!==a||(a=""),p.remove("requested_alumnos"),p.remove("requested_alumno"),e.datos.grupo.id)return delete localStorage.alumno_boletin,localStorage.grupo_boletines="Boletines "+e.datos.grupo.nombre,e.config.orientacion="vertical",r.go("panel.informes.boletines_periodo"+a,{grupo_id:e.datos.grupo.id,periodo_a_calcular:e.USER.numero_periodo},{reload:!0});m.warning("Debes seleccionar el grupo")},e.verBoletinesAlumnos=function(a){return"1"!==a&&1!==a||(a=""),e.datos.selected_alumnos.length>0?(1===e.datos.selected_alumnos.length?(delete localStorage.grupo_boletines,localStorage.alumno_boletin=e.datos.selected_alumnos[0].apellidos+" "+e.datos.selected_alumnos[0].nombres+" - "+e.datos.grupo.abrev+" Per"+e.USER.numero_periodo):(delete localStorage.alumno_boletin,localStorage.grupo_boletines="Boletines "+e.datos.grupo.nombre),e.config.orientacion="vertical",p.putObject("requested_alumnos",e.datos.selected_alumnos),r.go("panel.informes.boletines_periodo"+a,{grupo_id:e.datos.grupo.id,periodo_a_calcular:e.USER.numero_periodo},{reload:!0})):m.warning("Debes seleccionar al menos un alumno o cargar boletines del grupo completo")},e.verBoletinAlumno=function(a){return"1"!==a&&1!==a||(a=""),p.remove("requested_alumnos"),delete localStorage.grupo_boletines,localStorage.alumno_boletin=e.datos.selected_alumno.apellidos+" "+e.datos.selected_alumno.nombres+" - "+e.datos.grupo.abrev+" Per"+e.USER.numero_periodo,e.datos.selected_alumno?(p.putObject("requested_alumno",[e.datos.selected_alumno]),r.go("panel.informes"),e.config.orientacion="vertical",f(function(){return r.go("panel.informes.boletines_periodo"+a,{periodo_a_calcular:e.USER.numero_periodo})},1,1)):m.warning("Elige un alumno o carga el grupo completo")},e.verNotasActualesAlumno=function(){return p.remove("requested_alumno"),e.datos.selected_alumno?(p.putObject("requested_alumno",[e.datos.selected_alumno]),r.go("panel.informes"),e.config.orientacion="vertical",f(function(){return r.go("panel.informes.notas_actuales_alumnos",{periodo_a_calcular:e.USER.numero_periodo})},1,1)):m.warning("Debes seleccionar al menos un alumno")},e.verNotasActualesAlumnos=function(){return e.datos.selected_alumnos.length>0?(e.config.orientacion="vertical",p.putObject("requested_alumnos",e.datos.selected_alumnos),r.go("panel.informes.notas_actuales_alumnos",{grupo_id:e.datos.grupo.id,periodo_a_calcular:e.USER.numero_periodo},{reload:!0})):m.warning("Debes seleccionar al menos un alumno")},e.verNotasPerdidasActualesAlumno=function(){return e.datos.selected_alumno?(p.putObject("requested_alumno",[e.datos.selected_alumno]),r.go("panel.informes"),e.config.orientacion="vertical",f(function(){return r.go("panel.informes.notas_perdidas_actuales_alumnos",{periodo_a_calcular:e.USER.numero_periodo})},1,1)):m.warning("Debes seleccionar al menos un alumno")},e.verNotasPerdidasActualesAlumnos=function(){return e.datos.selected_alumnos.length>0?(e.config.orientacion="vertical",p.putObject("requested_alumnos",e.datos.selected_alumnos),r.go("panel.informes.notas_perdidas_actuales_alumnos",{grupo_id:e.datos.grupo.id,periodo_a_calcular:e.USER.numero_periodo},{reload:!0})):m.warning("Debes seleccionar al menos un alumno")},e.verListadoDocentes=function(){return e.config.orientacion="oficio_horizontal",r.go("panel.informes.listado_profesores")},e.excelListadoDocentes=function(){return g.download("::excel-docentes/docentes/"+e.USER.year+"/"+e.USER.year_id,"Listado docentes "+e.USER.year+".xls")},e.verCantAlumnosEnGrupos=function(){return e.config.orientacion="vertical",r.go("panel.informes.ver_cant_alumnos_por_grupos")},e.verPuestosPeriodo=function(){if(e.datos.grupo.id)return e.config.orientacion="vertical",r.go("panel.informes.puestos_grupo_periodo",{grupo_id:e.datos.grupo.id,periodos_a_calcular:e.config.periodos_a_calcular});m.warning("Debes seleccionar el grupo")},e.verPuestosYear=function(){if(e.datos.grupo.id)return e.config.orientacion="vertical",r.go("panel.informes.puestos_grupo_year",{grupo_id:e.datos.grupo.id,periodo_a_calcular:e.config.periodo_a_calcular});m.warning("Debes seleccionar el grupo")},e.verTodosPuestosPeriodo=function(){return localStorage.grupos_puestos=JSON.stringify(e.grupos),e.config.orientacion="vertical",r.go("panel.informes.puestos_todos_periodo",{periodos_a_calcular:e.config.periodos_a_calcular})},e.verTodosPuestosYear=function(){return localStorage.grupos_puestos=JSON.stringify(e.grupos),e.config.orientacion="vertical",r.go("panel.informes.puestos_todos_year",{periodo_a_calcular:e.config.periodo_a_calcular})},e.mostrar_nota_faltante=function(){return 3===parseInt(r.params.periodo_a_calcular)&&(r.is("panel.informes.puestos_todos_year")||r.is("panel.informes.puestos_grupo_year"))?e.mostrar_faltante=!e.mostrar_faltante:m.info("Debe calcular PUESTOS DEL AÑO (no periodo) y hasta el periodo 3 ")},e.verPlanillasGrupo=function(){return e.datos.grupo.id?(e.config.orientacion="oficio_horizontal",r.go("panel.informes.planillas_grupo",{grupo_id:e.datos.grupo.id,periodos_a_calcular:e.config.periodos_a_calcular},{reload:!0})):m.warning("Elige un grupo")},e.verPlanillasProfe=function(){return e.datos.profesor?(e.config.orientacion="oficio_horizontal",r.go("panel.informes.planillas_profesor",{profesor_id:e.datos.profesor.profesor_id,periodos_a_calcular:e.config.periodos_a_calcular},{reload:!0})):m.warning("Elige un profesor")},e.verAusencias=function(){return r.go("panel.informes.ver_ausencias",{periodos_a_calcular:e.config.periodos_a_calcular},{reload:!0})},e.listasPersonalizadas=function(){return r.go("panel.informes.listas_personalizadas",{reload:!0})},e.verSimat=function(){return g.download("::simat/alumnos","Alumnos con acudientes "+e.USER.year+".xls"),r.go("panel.informes.ver_simat",{reload:!0})},e.asistenciaPadres=function(){return r.go("panel.informes.planillas-ausencias-acudientes",{reload:!0})},e.importarSimat=function(a,r){if(e.f=a,e.errFile=r&&r[0],a)return a.upload=_.upload({url:i.Server+"importar/algo/"+e.USER.year,data:{file:a}}),a.upload.then(function(e){return d(function(){return a.result=e.data})},function(a){if(a.status>0)return e.errorMsg=a.status+": "+a.data},function(e){return a.progress=Math.min(100,parseInt(100*e.loaded/e.total))})},e.verObservadorVertical=function(){if(e.datos.grupo.id)return r.go("panel.informes.ver_observador_vertical",{grupo_id:e.datos.grupo.id},{reload:!0});m.warning("Debes seleccionar el grupo")},e.verObservadorHorizontal=function(){if(e.datos.grupo.id)return r.go("panel.informes.ver_observador_horizontal",{grupo_id:e.datos.grupo.id},{reload:!0});m.warning("Debes seleccionar el grupo")},e.verObservadorVerticalTodos=function(){return r.go("panel.informes.ver_observador_vertical_todos",{reload:!0})},e.verPlanillasControlTardanzas=function(){return e.config.orientacion="oficio_horizontal",r.go("panel.informes.control_tardanza_entrada",{reload:!0})},e.verPlanillasAsistenciaClase=function(){return e.config.orientacion="oficio_horizontal",r.go("panel.informes.control_asistencia_clase",{reload:!0})},e.verNotasPerdidasProfesor=function(a){return e.datos.profesor?(e.config.orientacion="carta_horizontal",r.go("panel.informes.notas_perdidas_profesor",{profesor_id:e.datos.profesor.profesor_id,periodo_a_calcular:e.config.periodo_a_calcular,solo_periodo:a},{reload:!0})):m.warning("Elige un profesor")},e.verNotasPerdidasTodos=function(a){return e.config.orientacion="carta_horizontal",r.go("panel.informes.notas_perdidas_todos",{periodo_a_calcular:e.config.periodo_a_calcular,solo_periodo:a},{reload:!0})},e.verCumpleanosPorMeses=function(){return e.config.orientacion="carta_horizontal",r.go("panel.informes.cumpleanos_por_meses")},e.verActaEvaluacionPromocion=function(){return e.config.orientacion="carta_horizontal",r.go("panel.informes.acta_evaluacion_promocion",{},{reload:!0})},e.mostrarUnidadesProfe=function(){return e.datos.profesor?(e.config.orientacion="vertical",r.go("panel.informes.unidades_profesor",{profesor_id:e.datos.profesor.profesor_id},{reload:!0})):m.warning("Elige un profesor")},e.verAusencias=function(){return r.go("panel.informes.ver_ausencias",{periodos_a_calcular:e.config.periodos_a_calcular},{reload:!0})},e.selectGrupo=function(a){return a?e.filtered_alumnos=o("orderBy")(o("filter")(c,{grupo_id:a.id},!0),"apellidos"):(e.filtered_alumnos=c,p.putObject("requested_alumno",""),p.putObject("requested_alumnos","")),e.datos.selected_alumnos="",e.datos.selected_alumno=""},e.selectAlumnos=function(e){},e.selectAlumno=function(e){},e.$on("cambia_descripcion",function(a,r){return e.descripcion_informe=r}),e.pdfMaker=function(){var e;return e={content:[["Este es un ejemplo de reporte en pdf"],{table:{headerRows:1,widths:["*","auto",100,"*"],body:[["No","Primero","Segundo","Tercero"],["0","No me gusta!!","No queda bonito","FACILMENTE!"],["1",{text:"En negrita",bold:!0},"Así que ","me mordió la vaca"]]}}]},pdfMake.createPdf(e).open()},e.verBoletinesFinalesGrupo=function(){var a;if(p.remove("requested_alumnos"),p.remove("requested_alumno"),e.datos.grupo.id)return a={grupo_id:e.datos.grupo.id,periodos_a_calcular:e.config.periodos_a_calcular},delete localStorage.alumno_boletin,localStorage.grupo_boletines="Boletines finales "+e.datos.grupo.nombre,2!==e.tipo_boletin_final&&"2"!==e.tipo_boletin_final||(a.year_selected=!0),r.go("panel.informes.boletines_finales",a,{reload:!0});m.warning("Debes seleccionar el grupo")},e.verBoletinesFinalesAlumnos=function(){var a;return e.datos.selected_alumnos.length>0?(p.putObject("requested_alumnos",e.datos.selected_alumnos),1===e.datos.selected_alumnos.length?(delete localStorage.grupo_boletines,localStorage.alumno_boletin=e.datos.selected_alumnos[0].apellidos+" "+e.datos.selected_alumnos[0].nombres+" - "+e.datos.grupo.abrev+" Per"+e.USER.numero_periodo):(delete localStorage.alumno_boletin,localStorage.grupo_boletines="Boletines finales "+e.datos.grupo.nombre),a={grupo_id:e.datos.grupo.id,periodos_a_calcular:e.config.periodos_a_calcular},2!==e.tipo_boletin_final&&"2"!==e.tipo_boletin_final||(a.year_selected=!0),r.go("panel.informes.boletines_finales",a,{reload:!0})):m.warning("Debes seleccionar al menos un alumno o cargar boletines del grupo completo")},e.verBoletinFinalAlumno=function(){return e.datos.selected_alumno?(p.remove("requested_alumnos"),p.putObject("requested_alumno",[e.datos.selected_alumno]),delete localStorage.grupo_boletines,localStorage.alumno_boletin=e.datos.selected_alumno.apellidos+" "+e.datos.selected_alumno.nombres+" - "+e.datos.grupo.abrev+" Per"+e.USER.numero_periodo,r.go("panel.informes"),f(function(){var a;return a={grupo_id:e.datos.grupo.id,periodos_a_calcular:e.config.periodos_a_calcular},2!==e.tipo_boletin_final&&"2"!==e.tipo_boletin_final||(a.year_selected=!0),r.go("panel.informes.boletines_finales",a)},1,1)):m.warning("Elige un alumno o carga el grupo completo")},e.verCertificadosEstudioGrupo=function(a){if(p.remove("requested_alumnos"),p.remove("requested_alumno"),e.datos.grupo.id)return a?r.go("panel.informes.certificados_estudio_periodo",{grupo_id:e.datos.grupo.id,periodo_a_calcular:a},{reload:!0}):r.go("panel.informes.certificados_estudio",{grupo_id:e.datos.grupo.id},{reload:!0});m.warning("Debes seleccionar el grupo")},e.verCertificadosEstudioAlumnos=function(a){return a?e.datos.selected_alumnos.length>0?(p.putObject("requested_alumnos",e.datos.selected_alumnos),r.go("panel.informes.certificados_estudio_periodo",{grupo_id:e.datos.grupo.id,periodo_a_calcular:a},{reload:!0})):m.warning("Debes seleccionar al menos un alumno o cargar boletines del grupo completo"):e.datos.selected_alumnos.length>0?(p.putObject("requested_alumnos",e.datos.selected_alumnos),r.go("panel.informes.certificados_estudio",{grupo_id:e.datos.grupo.id,periodo_a_calcular:a},{reload:!0})):m.warning("Debes seleccionar al menos un alumno o cargar boletines del grupo completo")},e.verCertificadosEstudioAlumno=function(a){return a?e.datos.selected_alumno?(p.remove("requested_alumnos"),p.putObject("requested_alumno",[e.datos.selected_alumno]),r.go("panel.informes"),f(function(){return r.go("panel.informes.certificados_estudio_periodo",{periodo_a_calcular:a})},1,1)):m.warning("Elige un alumno o carga el grupo completo"):e.datos.selected_alumno?(p.remove("requested_alumnos"),p.putObject("requested_alumno",[e.datos.selected_alumno]),r.go("panel.informes"),f(function(){return r.go("panel.informes.certificados_estudio")},1,1)):m.warning("Elige un alumno o carga el grupo completo")},e.meses=[{nombre:"Enero"},{nombre:"Febrero"},{nombre:"Marzo"},{nombre:"Abril"},{nombre:"Mayo"},{nombre:"Junio"},{nombre:"Julio"},{nombre:"Agosto"},{nombre:"Septiembre"},{nombre:"Octubre"},{nombre:"Noviembre"},{nombre:"Diciembre"}],e.numYearActual=e.USER.year,v=[31,28,31,30,31,30,31,31,30,31,30,31],w=function(e,a){return 1!==a||e%4!=0||e%100==0&&e%400!=0?v[a]:29},e.getAllDaysInMonth=function(a){var r,t,n,o,i;for(o=w(e.numYearActual,a),C=[],r=t=1,i=o;1<=i?t<=i:t>=i;r=1<=i?++t:--t)0!==(n=new Date(e.numYearActual,parseInt(a),r).getDay())&&6!==n&&C.push(r);return C}}]).filter("fechaHoraStringShort",["$filter",function(e){return function(a,r){return a?(a=new Date(a),a=isNaN(a)?new Date(a):new Date(r),a=e("date")(a,"MMMdd H:mm")):""}}])}.call(this),function(){angular.module("myvcFrontApp").controller("BoletinesPeriodoCtrl",["$scope","alumnosDat","escalas","$uibModal","$cookies","$state","AuthService",function(e,a,r,t,n,o,i){var s,u,l,c,d,p,m,f;if(e.grupo=a[0],e.year=a[1],e.alumnos=a[2],e.escalas_val=a[3],e.hasRoleOrPerm=i.hasRoleOrPerm,e.escalas=r,o.is("panel.boletin_acudiente")&&(parseInt(o.params.periodo_a_calcular)!==e.USER.numero_periodo&&o.go("panel.boletin_acudiente",{periodo_a_calcular:e.USER.numero_periodo},{reload:!0}),$("body").on("contextmenu",e=>event.preventDefault())),e.year.mostrar_puesto_boletin&&"Acudiente"!==e.USER.tipo&&"Alumno"!==e.USER.tipo)for(l=0,d=(m=e.alumnos).length;l<d;l++)(s=m[l]).texto_puesto=" - Puesto: "+s.puesto+"/"+e.grupo.cantidad_alumnos;if(e.config=n.getObject("config"),e.requested_alumnos=n.getObject("requested_alumnos"),e.requested_alumno=n.getObject("requested_alumno"),void 0===e.config?e.config={mostrar_foto:!0}:void 0===e.config.mostrar_foto&&(e.config.mostrar_foto=!0),e.alumnos[0].asignaturas)e.alumnos[0].asignaturas.length<14?e.ancho_chart=50*e.alumnos[0].asignaturas.length:e.ancho_chart=40*e.alumnos[0].asignaturas.length;else{for(u=0,c=0,p=(f=e.alumnos[0].areas).length;c<p;c++)u+=f[c].cant;e.ancho_chart=u<14?50*u:40*u}return e.ancho_chart>800&&(e.ancho_chart=800),e.$on("change_config",function(){return e.config=n.getObject("config")}),e.requested_alumnos?e.$emit("cambia_descripcion","Mostrando "+e.alumnos.length+" boletines de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.requested_alumno?e.$emit("cambia_descripcion","Mostrando un boletin de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.$emit("cambia_descripcion",e.alumnos.length+" boletines del grupo "+e.grupo.nombre_grupo)}])}.call(this),function(){angular.module("myvcFrontApp").directive("boletinAlumnoDir",["App","Perfil","$filter",function(e,a,r){return{restrict:"EA",templateUrl:"==informes/boletinAlumnoDir.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"="},link:function(r,t,n){var o,i,s,u,l,c,d;for(r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views,c=null!=(u=0===r.year.solo_escalas_valorativas)?u:{true:!1},r.options={chart:{type:"discreteBarChart",height:180,width:r.$parent.ancho_chart,margin:{top:20,right:20,bottom:60,left:55},useInteractiveGuideline:!0,x:function(e){return e.label},y:function(e){return e.value},showYAxis:c,showValues:c,valueFormat:function(e){return d3.format(",.0f")(e)},transitionDuration:500},title:{enable:!1,text:"Definitivas por asignaturas"}},d=[],i=0,s=(l=r.alumno.asignaturas).length;i<s;i++)o=l[i],d.push({label:o.alias_materia,value:o.nota_asignatura});return r.data=[{key:"Definitivas de asignaturas",values:d}]}}}]).directive("boletinAlumnoDir2",["App","Perfil","$filter",function(e,a,r){return{restrict:"EA",templateUrl:"==informes2/boletinAlumnoDir2.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"="},link:function(r,t,n){var o,i,s,u,l,c,d;for(r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views,c=null!=(u=0===r.year.solo_escalas_valorativas)?u:{true:!1},r.options={chart:{type:"discreteBarChart",height:180,width:r.$parent.ancho_chart,margin:{top:20,right:20,bottom:60,left:55},useInteractiveGuideline:!0,x:function(e){return e.label},y:function(e){return e.value},showYAxis:c,showValues:c,valueFormat:function(e){return d3.format(",.0f")(e)},transitionDuration:500},title:{enable:!1,text:"Definitivas por asignaturas"}},d=[],i=0,s=(l=r.alumno.asignaturas).length;i<s;i++)o=l[i],d.push({label:o.alias_materia,value:o.nota_asignatura});return r.data=[{key:"Definitivas de asignaturas",values:d}]}}}]).directive("boletinAlumnoDir3",["App","Perfil","$filter",function(e,a,r){return{restrict:"EA",templateUrl:"==informes2/boletinAlumnoDir3.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"="},link:function(r,t,n){var o,i,s,u,l,c,d,p;for(r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views,r.options={chart:{type:"discreteBarChart",height:180,width:r.$parent.ancho_chart,margin:{top:20,right:20,bottom:60,left:55},useInteractiveGuideline:!0,x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.0f")(e)},transitionDuration:500},title:{enable:!1,text:"Definitivas por asignaturas"}},p=[],i=0,u=(c=r.alumno.areas).length;i<u;i++)for(s=0,l=(d=c[i].asignaturas).length;s<l;s++)o=d[s],p.push({label:o.alias_materia,value:o["nota_final_per"+r.USER.numero_periodo]});return r.data=[{key:"Definitivas de asignaturas",values:p}]}}}]).directive("boletinAlumnoDir4",["App","Perfil","$filter",function(e,a,r){return{restrict:"EA",templateUrl:"==informes2/boletinAlumnoDir4.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"="},link:function(r,t,n){return r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views}}}]).filter("cantPerdidasPer",[function(){return function(e,a,r){return this.suma=0,angular.forEach(e,function(e,r){if(a=parseFloat(a),parseFloat(e.id)===a)return this.suma=this.suma+e.cantNotasPerdidas}),0===this.suma?"":this.suma}}]).directive("boletinAlumnoDir5",["App","Perfil","$filter",function(e,a,r){return{restrict:"EA",templateUrl:"==informes2/boletinAlumnoDir5.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"="},link:function(r,t,n){var o,i,s,u,l;for(r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views,r.options={chart:{type:"discreteBarChart",height:180,width:r.$parent.ancho_chart,margin:{top:20,right:20,bottom:60,left:55},useInteractiveGuideline:!0,x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.0f")(e)},transitionDuration:500},title:{enable:!1,text:"Definitivas por asignaturas"}},l=[],i=0,s=(u=r.alumno.asignaturas).length;i<s;i++)o=u[i],l.push({label:o.alias_materia,value:o.nota_asignatura});return r.data=[{key:"Definitivas de asignaturas",values:l}]}}}]).directive("dynamic",["$compile",function(e){return{restrict:"A",replace:!0,link:function(a,r,t){return a.$watch(t.dynamic,function(t){return r.html(t),e(r.contents())(a)})}}}])}.call(this),function(){angular.module("myvcFrontApp").controller("PuestosGrupoPeriodoCtrl",["$scope","$state","alumnosDat","escalas","$cookies",function(e,a,r,t,n){var o;return r=r.data,e.fechahora=new Date,o=0,e.promedio_periodo=0,e.grupo=r.grupo,e.year=r.year,e.alumnos=r.alumnos,e.ordenAlumnos="-promedio",e.USER.puestos_alfabeticamente&&(e.ordenAlumnos="apellidos"),e.alumnos.forEach(function(e){if(!isNaN(e.comportamiento.nota))return o+=e.comportamiento.nota}),e.promedio_periodo=(o/e.alumnos.length).toFixed(1),e.escalas=t,e.config=n.getObject("config"),e.$on("change_config",function(){return e.config=n.getObject("config")}),e.alumnos_materias=[],e.add_alum_materia=function(a,r){return e.alumnos_materias.push({asignatura:a,alumno:r})}}]).controller("PuestosTodosPeriodoCtrl",["$scope","$state","escalas","$http","toastr","$cookies",function(e,a,r,t,n,o){return e.fechahora=new Date,e.escalas=r,e.grupos_puestos_temp=JSON.parse(localStorage.grupos_puestos),e.grupos_puestos=[],e.ordenAlumnos="-promedio",e.USER.puestos_alfabeticamente&&(e.ordenAlumnos="apellidos"),angular.forEach(e.grupos_puestos_temp,function(a,r){return t.put("::puestos/detailed-notas-periodo/"+a.id).then(function(r){var t;return a.year=r.data.year,a.alumnos=r.data.alumnos,a.grupo=r.data.grupo,t=0,a.alumnos.forEach(function(e){if(!isNaN(e.comportamiento.nota))return t+=e.comportamiento.nota}),a.promedio_periodo=(t/a.alumnos.length).toFixed(1),e.grupos_puestos.push(a)},function(){return n.error("No se trajo grupo "+a.nombre)})}),e.config=o.getObject("config"),e.$on("change_config",function(){return e.config=o.getObject("config")}),e.alumnos_materias=[],e.add_alum_materia=function(a,r){return e.alumnos_materias.push({asignatura:a,alumno:r})}}]).controller("PuestosTodosYearCtrl",["$scope","$state","escalas","$http","toastr","$stateParams","$cookies",function(e,a,r,t,n,o,i){return e.fechahora=new Date,e.escalas=r,e.grupos_puestos_temp=JSON.parse(localStorage.grupos_puestos),e.grupos_puestos=[],e.ordenAlumnos="-promedio_year",e.USER.puestos_alfabeticamente&&(e.ordenAlumnos="apellidos"),angular.forEach(e.grupos_puestos_temp,function(r,i){return t.put("::puestos/detailed-notas-year",{grupo_id:r.id,periodo_a_calcular:o.periodo_a_calcular}).then(function(t){var n,o,i,s,u,l,c,d,p,m,f,g,_;if(r.year=t.data.year,r.alumnos=t.data.alumnos,r.grupo=t.data.grupo,3===parseInt(a.params.periodo_a_calcular))for(i=0,l=(m=r.alumnos).length;i<l;i++)for(s=0,c=(f=(n=m[i]).notas_asig).length;s<c;s++)o=f[s],p=4*e.USER.nota_minima_aceptada-3*o.nota_final_year,o.nota_faltante=p<=0?"":p;for(_=0,u=0,d=(g=r.alumnos).length;u<d;u++)n=g[u],_+=parseFloat(n.comportamiento_prom);return r.comportamiento_prom_year=(_/r.alumnos.length).toFixed(1),e.grupos_puestos.push(r)},function(){return n.error("No se trajo grupo "+r.nombre)})}),e.config=i.getObject("config"),e.$on("change_config",function(){return e.config=i.getObject("config")}),e.alumnos_materias=[],e.add_alum_materia=function(a,r){return e.alumnos_materias.push({asignatura:a,alumno:r})}}])}.call(this),function(){angular.module("myvcFrontApp").filter("puestoAlumno",[function(){return function(e,a){var r;return r=0,angular.forEach(a,function(a){if(e.promedio<a.promedio)return r+=1}),r}}]).filter("notasAsignatura",[function(){return function(e,a){var r;return r="",angular.forEach(e,function(e){return r=r+'<div class="ellipsis350"><b>Per'+a+": "+e.definicion_unidad+"</b></div>",angular.forEach(e.subunidades,function(e,a){if(e.nota)return r=r+(a+1)+". "+e.definicion_subunidad+"<b> => "+e.nota.nota+"</b><br>"})}),r}}]).filter("notasPerdidasAsignaturas",["$filter",function(e){return function(a){return this.cantidad_perdidas=0,angular.forEach(a,function(a){return this.cantidad_perdidas=this.cantidad_perdidas+e("notasPerdidasAsignatura")(a.unidades,!0)}),this.cantidad_perdidas}}]).filter("notasPerdidasAsignatura",["Perfil",function(e){return function(a,r,t){var n;return this.unidades_response=[],this.cantidad_perdidas=0,angular.forEach(a,function(a){var r;if(this.subunis=[],angular.forEach(a.subunidades,function(a){if(a.nota)if(a.nota.nota||0===a.nota.nota){if(a.nota.nota<e.User().nota_minima_aceptada)return this.subunis.push(a)}else if(a.nota<e.User().nota_minima_aceptada)return this.subunis.push(a)},this),this.cantidad_perdidas=this.cantidad_perdidas+this.subunis.length,this.subunis.length>0)return r={unidad_id:a.unidad_id,definicion_unidad:a.definicion_unidad,valor_unidad:a.valor_unidad,orden_unidad:a.orden_unidad,nota_unidad:a.nota_unidad,subunidades:this.subunis},this.unidades_response.push(r)},this),r?this.cantidad_perdidas:(n="",angular.forEach(unidades_response,function(e){return n=n+'<div class="ellipsis350"><b>Per'+t+": "+e.definicion_unidad+"</b></div>",angular.forEach(e.subunidades,function(e,a){return n=n+'<span class="ellipsis250">'+(a+1)+". "+e.definicion_subunidad+" </span><b> => "+e.nota.nota+"</b><br>"})}),n)}}]).filter("notasPerdidasAsignaturaPeriodo",["$filter",function(e){return function(a,r){var t,n,o,i;for(i=0,n=0,o=a.length;n<o;n++)t=a[n],i+=e("notasPerdidasAsignatura")(t.unidades,!0);return i}}]).filter("promAsig",["$filter",function(e){return function(e,a){var r,t,n,o,i,s,u,l;for(u=0,t=0,n=0,i=e.length;n<i;n++)for(o=0,s=(l=e[n].asignaturas).length;o<s;o++)(r=l[o]).asignatura_id===a&&(t++,u+=r.nota_asignatura);return u/t}}]).filter("promGrupoPer",["$filter",function(e){return function(e){var a,r,t;for(t=0,a=0,r=e.length;a<r;a++)t+=e[a].promedio;return t/e.length}}]).filter("notasPerdidasGrupoPer",["$filter",function(e){return function(a){var r,t,n,o;for(t=0,n=0,o=a.length;n<o;n++)r=a[n],t+=e("notasPerdidasAsignaturaPeriodo")(r.asignaturas,!0);return t}}])}.call(this),function(){angular.module("myvcFrontApp").filter("promGrupoYear",[function(){return function(e){var a,r,t;for(t=0,a=0,r=e.length;a<r;a++)t+=e[a].promedio_year;return Math.round(t/e.length)}}]).filter("promAsigYear",["$filter",function(e){return function(e,a){var r,t,n,o,i,s,u,l;for(u=0,r=0,t=0,o=e.length;t<o;t++)for(n=0,i=(l=e[t].notas_asig).length;n<i;n++)(s=l[n]).asignatura_id===a&&(r++,u+=parseFloat(s.nota_final_year));return Math.round(u/r)}}]).filter("notasAsignaturaYear",["$filter",function(e){return function(a){var r,t,n,o;for(0,r="",t=0,n=a.length;t<n;t++)o=a[t],r+=e("notasAsignatura")(o.unidades,o.numero);return r}}]).filter("notasPerdidasAsignaturaYear",["$filter",function(e){return function(a,r){var t,n,o,i,s;for(t=0,n="",o=0,i=a.length;o<i;o++)s=a[o],r?t+=e("notasPerdidasAsignatura")(s.unidades,r,s.numero):n+=e("notasPerdidasAsignatura")(s.unidades,!1,s.numero);return r?t:n}}]).filter("notasPerdidasAsignaturasYear",["$filter",function(e){return function(a){return this.cantidad_perdidas=0,angular.forEach(a,function(a){return this.cantidad_perdidas=this.cantidad_perdidas+e("notasPerdidasAsignaturaYear")(a.periodos,!0)}),this.cantidad_perdidas}}]).filter("notasPerdidasGrupoYear",["$filter",function(e){return function(e){var a,r,t;for(a=0,r=0,t=e.length;r<t;r++)a+=e[r].perdidos_year;return a}}])}.call(this),function(){angular.module("myvcFrontApp").controller("PuestosGrupoYearCtrl",["$scope","datos_puestos","escalas","$cookies","$state",function(e,a,r,t,n){var o,i,s,u,l,c,d,p,m,f,g,_,h;if(a=a.data,e.fechahora=new Date,e.ordenAlumnos="-promedio_year",e.USER.puestos_alfabeticamente&&(e.ordenAlumnos="apellidos"),e.grupo=a.grupo,e.year=a.year,e.alumnos=a.alumnos,3===parseInt(n.params.periodo_a_calcular))for(s=0,c=(f=e.alumnos).length;s<c;s++)for(u=0,d=(g=(o=f[s]).notas_asig).length;u<d;u++)i=g[u],m=4*e.USER.nota_minima_aceptada-3*i.nota_final_year,i.nota_faltante=m<=0?"":m;for(h=0,l=0,p=(_=e.alumnos).length;l<p;l++)o=_[l],h+=parseFloat(o.comportamiento_prom);return e.comportamiento_prom_year=(h/e.alumnos.length).toFixed(1),e.escalas=r,e.config=t.getObject("config"),e.$on("change_config",function(){return e.config=t.getObject("config")}),e.alumnos_materias=[],e.add_alum_materia=function(a,r){return e.alumnos_materias.push({asignatura:a,alumno:r})}}])}.call(this),function(){angular.module("myvcFrontApp").controller("PlanillasCtrl",["$scope","App","Perfil","asignaturas","$state",function(e,a,r,t,n){var o,i,s,u,l;for(t=t.data,e.USER=r.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.year=t[0],e.asignaturas=t[1],e.perfilPath=a.images+"perfil/",e.unidadesdefault=["  ","  ","  ","  ","  "],e.subunidadesdefault=["  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  ","  "],e.isSimonBolivar=function(){return"casb.micolevirtual.com"===document.location.hostname},e.onChangeTitulos=function(a){return e.titulos_planillas=a.split(";"),localStorage.titulos_planillas=a},localStorage.titulos_planillas?(e.titulos_planillas=localStorage.titulos_planillas.split(";"),e.titulos_planillas_string=localStorage.titulos_planillas):localStorage.titulos_planillas="",s=0,u=(l=e.asignaturas).length;s<u;s++)(i=l[s]).alumnos_temp=i.alumnos,i.alumnos_temp.length<34?i.alumnos1=i.alumnos_temp:i.alumnos_temp.length<38?(i.alumnos1=i.alumnos_temp.splice(0,27),i.alumnos2=i.alumnos_temp.splice(0,20)):i.alumnos_temp.length<65&&(i.alumnos1=i.alumnos_temp.splice(0,33),i.alumnos2=i.alumnos_temp.splice(0,32));return n.params.profesor_id?(o=e.asignaturas[0],e.$emit("cambia_descripcion",e.asignaturas.length+" planillas  del profesor "+o.nombres_profesor+" "+o.apellidos_profesor)):n.params.grupo_id?(o=e.asignaturas[0],e.$emit("cambia_descripcion",e.asignaturas.length+" planillas  del grupo "+o.nombre_grupo)):void 0}]).controller("ControlTardanzaEntradaCtrl",["$scope","App","Perfil","$state","grupos",function(e,a,r,t,n){var o,i,s,u,l,c,d,p,m;for(e.USER=r.User(),d=n.data[0],e.year=d,e.grupos=d.grupos,e.perfilPath=a.images+"perfil/",e.numberColumExt=21,e.numberColumInt=4,e.getNumber=function(e){return new Array(e)},s=0,l=(p=e.grupos).length;s<l;s++)for(i=0,u=0,c=(m=p[s].alumnos).length;u<c;u++)o=m[u],3===++i?(o.gris=!0,i=0):o.gris=!1;return e.$emit("cambia_descripcion","Planillas para el control de tardanzas en la entrada."),e.dato={},e.mesSeleccionado=function(){return"-1"===e.mesMostrar?e.numberColumExt=21:(e.dato.mes=""+e.mesMostrar,e.dias=e.getAllDaysInMonth(e.dato.mes),e.numberColumExt=e.dias.length)}}]).controller("ControlAsistenciaClaseCtrl",["$scope","App","Perfil","$state","grupos",function(e,a,r,t,n){var o,i,s,u,l,c,d,p,m;for(e.USER=r.User(),d=n.data[0],e.year=d,e.grupos=d.grupos,e.perfilPath=a.images+"perfil/",e.getNumber=function(e){return new Array(e)},s=0,l=(p=e.grupos).length;s<l;s++)for(i=0,u=0,c=(m=p[s].alumnos).length;u<c;u++)o=m[u],3===++i?(o.gris=!0,i=0):o.gris=!1;return e.$emit("cambia_descripcion","Planillas para de asistencia a clase."),e.dato={},e.mesSeleccionado=function(){return"-1"===e.mesMostrar?e.numberColumExt=21:(e.dato.mes=""+e.mesMostrar,e.dias=e.getAllDaysInMonth(e.dato.mes),e.numberColumExt=e.dias.length)},d=new Date,e.mesMostrar=d.getMonth(),e.mesSeleccionado()}])}.call(this),function(){angular.module("myvcFrontApp").controller("UnidadesProfesorCtrl",["$scope","App","Perfil","asignaturas","$state","toastr","$http",function(e,a,r,t,n,o,i){return e.asignaturas=t.data.asignaturas,e.info_profe=t.data.info_profesor,e.show_extra_column=!1,e.materia_por_pagina=!1,e.USER=r.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.perfilPath=a.images+"perfil/",e.setShowExtraColumn=function(){return e.show_extra_column=!e.show_extra_column},e.setMateriaPorPagina=function(){return e.materia_por_pagina=!e.materia_por_pagina},e.editarUnidad=function(e){return e.editando=!0},e.cancelarEditUnidad=function(e){return e.editando=!1},e.guardarCambiosUnidad=function(a){return a.periodo_id=e.USER.periodo_id,a.num_periodo=e.USER.numero_periodo,i.put("::unidades/update/"+a.id,a).then(function(e){return o.success("Cambios guardados"),a.editando=!1},function(e){return o.error("No se pudo guardar cambios")})},e.editarSubunidad=function(e){return e.editando=!0},e.cancelarEditSubunidad=function(e){return e.editando=!1},e.guardarCambiosSubunidad=function(a,r){return a.asignatura_id=r.asignatura_id,a.periodo_id=e.USER.periodo_id,a.num_periodo=e.USER.numero_periodo,i.put("::subunidades/update/"+a.id,a).then(function(e){return o.success("Cambios guardados"),a.editando=!1},function(e){return o.error("No se pudo guardar cambios")})},e.asignaturas[0],e.$emit("cambia_descripcion",e.asignaturas.length+" asignaturas del profesor "+e.info_profe.nombres_profesor+" "+e.info_profe.apellidos_profesor)}])}.call(this),function(){angular.module("myvcFrontApp").controller("BoletinesFinalesCtrl",["$scope","alumnosDat","escalas","$cookies","$state",function(e,a,r,t,n){return e.grupo=a[0],e.year=a[1],e.alumnos=a[2],e.escalas_val=a[3],e.$state=n,e.escalas=r,e.config=t.getObject("config"),e.requested_alumnos=t.getObject("requested_alumnos"),e.requested_alumno=t.getObject("requested_alumno"),e.$on("change_config",function(){return e.config=t.getObject("config")}),e.requested_alumnos?e.$emit("cambia_descripcion","Mostrando "+e.alumnos.length+" boletines de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.requested_alumno?e.$emit("cambia_descripcion","Mostrando un boletin de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.$emit("cambia_descripcion",e.alumnos.length+" boletines del grupo "+e.grupo.nombre_grupo)}]).controller("BoletinesFinalesPreescolarCtrl",["$scope","alumnosDat","$cookies","$http","toastr",function(e,a,r,t,n){return e.grupo=a[0],e.year=a[1],e.alumnos=a[2],e.config=r.getObject("config"),e.requested_alumnos=r.getObject("requested_alumnos"),e.requested_alumno=r.getObject("requested_alumno"),e.guardar_frase=function(a,r){return t.put("::bolfinales-preescolar/guardar-frase",{definicion:a,asignatura_id:r.asignatura_id,id:r.frases[0].id}).then(function(t){var o,i,s,u,l,c;for(n.success("Frase guardada"),c=[],s=0,u=(l=e.alumnos).length;s<u;s++)o=l[s],c.push(function(){var e,t,n,s;for(s=[],e=0,t=(n=o.asignaturas).length;e<t;e++)(i=n[e]).asignatura_id===r.asignatura_id?s.push(i.frases[0]={definicion:a}):s.push(void 0);return s}());return c},function(){return n.error("No se pudo crear frase")})},e.crear_frase=function(a){return t.put("::bolfinales-preescolar/crear-frase",{asignatura_id:a.asignatura_id}).then(function(r){var t,o,i,s,u,l;for(n.success("Frase creada"),a.frases.push(r.data),l=[],i=0,s=(u=e.alumnos).length;i<s;i++)t=u[i],l.push(function(){var e,n,i,s;for(s=[],e=0,n=(i=t.asignaturas).length;e<n;e++)(o=i[e]).asignatura_id===a.asignatura_id?s.push(o.frases.push(r.data)):s.push(void 0);return s}());return l},function(){return n.error("No se pudo crear frase")})},e.$on("change_config",function(){return e.config=r.getObject("config")}),e.requested_alumnos?e.$emit("cambia_descripcion","Mostrando "+e.alumnos.length+" boletines de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.requested_alumno?e.$emit("cambia_descripcion","Mostrando un boletin de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.$emit("cambia_descripcion",e.alumnos.length+" boletines del grupo "+e.grupo.nombre_grupo)}])}.call(this),function(){angular.module("myvcFrontApp").directive("boletinFinalAlumnoDir",["App","Perfil",function(e,a){return{restrict:"EA",templateUrl:"==informes/boletinFinalAlumnoDir.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"="},link:function(r,t,n){return r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views,r.getDefinitivaObject=function(e,a){var r;return r={},e.forEach(function(e,t){if(e.periodo===a)return r=e}),r}}}}]).directive("boletinFinalAlumnoPreescolarDir",["App","Perfil","$http","toastr",function(e,a,r,t){return{restrict:"EA",templateUrl:"==informes/boletinFinalAlumnoPreescolarDir.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"="},link:function(n,o,i){return n.USER=a.User(),n.USER.nota_minima_aceptada=parseInt(n.USER.nota_minima_aceptada),n.perfilPath=e.images+"perfil/",n.views=e.views,n.eliminar_frase=function(e){return r.put("::bolfinales-preescolar/eliminar-frase",{id:e.id}).then(function(e){return t.success("Frase eliminada. Recargue.")},function(){return t.error("No se pudo eliminar frase")})},n.getConSaltosDeLinea=function(e){return e.replaceAll(/\n/g,"<br>")}}}}]).filter("promedioPeriodo",[function(){return function(e,a){var r,t,n,o,i,s,u;for(u=0,t=0,o=e.length;t<o;t++)for(n=0,i=(s=e[t].definitivas).length;n<i;n++)(r=s[n]).periodo_id&&parseFloat(r.periodo_id)===parseFloat(a)&&(u+=parseFloat(r.DefMateria));return u/e.length}}])}.call(this),function(){angular.module("myvcFrontApp").directive("editNotasMatYearDir",["App","Perfil",function(e,a){return{restrict:"EA",templateUrl:"==informes/editNotasMatYearDir.tpl.html",scope:{asignatura:"=",alumno:"=",alumnosasigs:"="},controller:["$scope","App","$http","EscalasValorativasServ","AuthService","toastr",function(e,r,t,n,o,i){var s;return e.USER=a.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.perfilPath=r.images+"perfil/",e.periodos_materia=[],e.solo_notas_perdidas=!0,e.hasRoleOrPerm=o.hasRoleOrPerm,n.escalas().then(function(a){return e.escalas=a}),s={alumno_id:e.alumno.alumno_id,asignatura_id:e.asignatura.asignatura_id,periodos_a_calcular:"de_usuario"},t.put("::editnota/alum-asignatura",s).then(function(a){return e.periodos_materia=a.data},function(e){}),e.cambiaNota=function(e,a){return t.put("::notas/update/"+e.id,{nota:e.nota}).then(function(a){return i.success("Cambiada: "+e.nota)},function(a){return i.error("No pudimos guardar la nota "+e.nota)})}}]}}])}.call(this),function(){angular.module("myvcFrontApp").directive("certificadoEstudioDir",["App","Perfil",function(e,a){return{restrict:"EA",templateUrl:"==informes/certificadoEstudioDir.tpl.html",scope:{grupo:"=",year:"=",alumno:"=",config:"=",escalas:"=",espaciado:"="},link:function(r,t,n){var o,i;return r.USER=a.User(),r.USER.nota_minima_aceptada=parseInt(r.USER.nota_minima_aceptada),r.perfilPath=e.images+"perfil/",r.views=e.views,i=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],o=new Date,r.fecha_dia=o.getDate(),r.fecha_mes=i[o.getMonth()],r.fecha_year=o.getFullYear(),r.isCoalSchool=function(){return document.domain.includes("coal.micolevirtual.com")},r.isColJordanSchool=function(){return document.domain.includes("coljordan.micolevirtual.com")}}}}])}.call(this),function(){angular.module("myvcFrontApp").controller("CertificadosEstudioCtrl",["$scope","$state","alumnosDat","escalas","$cookies","$stateParams","$http","toastr",function(e,a,r,t,n,o,i,s){var u,l,c,d,p,m,f,g,_,h,v,b,y,w,C,S;for(e.grupo=r[0],e.year=r[1],e.alumnos=r[2],e.escalas_val=r[3],e.$stateParams=o,e.escalas=t,e.config=n.getObject("config"),e.requested_alumnos=n.getObject("requested_alumnos"),e.requested_alumno=n.getObject("requested_alumno"),e.$on("change_config",function(){return e.config=n.getObject("config")}),e.cambia_contador_certificados=function(e,a,r){return console.log(e,a),i.put("::bolfinales/cambiar-"+r,{contador:e,year_id:a}).then(function(e){return s.success("Contador guardado")},function(e){return s.error("Cambio no guardado","Error")})},e.cambia_dato_alumno=function(e,a,r){var t;return console.log(e,a,r),t={alumno_id:a,propiedad:r,valor:e},i.put("::alumnos/guardar-valor",t).then(function(e){return s.success("Cambios guardados")},function(e){return s.error("Cambio no guardado","Error")})},e.espaciado=!1,r[2].length>0&&r[2][0].asignaturas.length<13&&(e.espaciado=!0),d=0,g=(y=r[2]).length;d<g;d++)for(p=0,_=(w=(u=y[d]).areas).length;p<_;p++)for(m=0,h=(C=(l=w[p]).asignaturas).length;m<h;m++)for(c=C[m],f=0,v=(S=u.recuperaciones).length;f<v;f++)b=S[f],c.asignatura_id===b.asignatura_id&&(e.year.show_subasignaturas_en_finales||e.year.cant_asignatura_pierde_year||1===l.asignaturas.length)&&(b.mostrar_en_certificado=!0);return e.requested_alumnos?e.$emit("cambia_descripcion","Mostrando "+e.alumnos.length+" boletines de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.requested_alumno?e.$emit("cambia_descripcion","Mostrando un boletin de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.$emit("cambia_descripcion",e.alumnos.length+" boletines del grupo "+e.grupo.nombre_grupo)}])}.call(this),function(){angular.module("myvcFrontApp").controller("NotasPerdidasProfesorCtrl",["$scope","App","Perfil","grupos","$state","$stateParams",function(e,a,r,t,n,o){return e.grupos=t.data,e.periodo_a_calcular=o.periodo_a_calcular,e.USER=r.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.perfilPath=a.images+"perfil/",e.isSimonBolivar=function(){return"casb.micolevirtual.com"===document.location.hostname},e.$emit("cambia_descripcion","Notas pendientes ")}]).controller("NotasPerdidasTodosCtrl",["$scope","App","Perfil","profesores","$state","$stateParams",function(e,a,r,t,n,o){return e.profesores=t.data,e.periodo_a_calcular=o.periodo_a_calcular,e.USER=r.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.perfilPath=a.images+"perfil/",e.isSimonBolivar=function(){return"casb.micolevirtual.com"===document.location.hostname},e.$emit("cambia_descripcion","Notas pendientes ")}]).controller("VerAusenciasCtrl",["$scope","App","Perfil","grupos_ausencias","$state",function(e,a,r,t,n){return e.grupos_ausencias=t.data,e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.$emit("cambia_descripcion","Ausencias y tardanzas a la institución ")}]).controller("VerSimatCtrl",["$scope","App","Perfil","grupos_simat","$state",function(e,a,r,t,n){return e.grupos_simat=t.data,e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.$emit("cambia_descripcion","Listado SIMAT ")}]).controller("ListasPersonalizadasCtrl",["$scope","App","Perfil","grupos_simat","$state","Excel","$timeout",function(e,a,r,t,n,o,i){var s;return e.grupos_simat_copy=t.data,e.grupos_simat=t.data,e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.titulo_listado={},e.show_documento=!0,e.columnas=2,e.columnasArray=[{titulo:""},{titulo:""}],e.grupo_por_pagina=!1,e.pintar_presenciales=!1,e.campos=[{campo:"ninguno",valor:"Ninguna"},{campo:"documento",valor:"Documento"},{campo:"telefonos",valor:"Teléfonos"},{campo:"username",valor:"Nombre de usuario"},{campo:"deuda",valor:"Deuda"},{campo:"presencial",valor:"Presencial"},{campo:"pazysalvo",valor:"Paz y salvo"},{campo:"ciudad_nac_nombre",valor:"Ciudad nacimiento"},{campo:"es_urbana",valor:"Urbanidad"},{campo:"direccion",valor:"Dirección"},{campo:"email",valor:"Email"},{campo:"fecha_nac",valor:"Fecha nacimiento"},{campo:"edad",valor:"Edad"},{campo:"religion",valor:"Religión"},{campo:"sexo",valor:"Sexo"},{campo:"eps",valor:"EPS"}],e.columnasDatosTd=[e.campos[1]],e.columnasDatos=["documento"],s=localStorage.txt_titulo_listado,e.titulo_listado.texto=s||"<b>LISTADO DE ALUMNOS</b><br>",e.cambia_texto_informativo=function(){return localStorage.txt_titulo_listado=e.titulo_listado.texto},e.cambiaColumnas=function(a){return a<e.columnasArray.length&&e.columnasArray.pop(),a>e.columnasArray.length&&e.columnasArray.push({titulo:""}),localStorage.txt_titulo_listado=e.titulo_listado.texto},e.cambiaColumnasDatos=function(a){var r,t,n,o,i,s,u,l;for(!1,l=[],n=0,i=a.length;n<i;n++)for(t=a[n],o=0,s=(u=e.campos).length;o<s;o++)(r=u[o]).campo===t&&l.push(r);return e.columnasDatosTd=l,console.log(a,e.columnasDatosTd)},e.getNumber=function(e){return new Array(e)},e.todos=function(){return e.grupos_simat=e.grupos_simat_copy},e.selectGrupo=function(a){var r,t,n,o,i;for(i=[],t=0,n=(o=e.grupos_simat_copy).length;t<n;t++)(r=o[t]).id===a.id?i.push(e.grupos_simat=[r]):i.push(void 0);return i},e.exportListToExcel=function(e){return o.tableToExcel(e,"Definitivas por periodo")},e.$emit("cambia_descripcion","Listas personalizadas ")}]).controller("VerObservadorVerticalCtrl",["$scope","App","Perfil","grupos_observador","$state","$http","$stateParams",function(e,a,r,t,n,o,i){return e.grupos_observador=t.data,e.editor_options={allowedContent:!0,entities:!1},e.tamanio_hoja="oficio",e.eligirTamanio=function(a){return e.tamanio_hoja=a,o.get("::observador/vertical/"+i.grupo_id+"/"+a).then(function(a){return e.grupos_observador=a.data},function(){return toast.error("No se pudo traer el observador")})},e.onEditorReady=function(){return console.log("Editor listo")},e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.$emit("cambia_descripcion","Observador del alumno ")}]).controller("VerObservadorHorizontalCtrl",["$scope","App","Perfil","grupos_observador","$state","$http","$stateParams",function(e,a,r,t,n,o,i){var s,u,l,c,d,p,m,f,g,_,h,v;if(e.grupo=t.data.grupo,e.imagenes=t.data.imagenes,e.filasFirst=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],e.observ={encabezado_margin_top:150,encabezado_margin_left:200,color_title:"#00000",color_nombre:"#253383"},localStorage.imagen_fondo)for(e.observ.imagen=JSON.parse(localStorage.imagen_fondo),s=0,p=(g=e.imagenes).length;s<p;s++)(u=g[s])===e.observ.imagen&&(e.observ.imagen=u);else for(c=0,m=(_=e.imagenes).length;c<m;c++)(l=_[c]).nombre.includes("fondo-observador.png")&&(e.observ.imagen=l);if(localStorage.observ)for(d in u=(f=JSON.parse(localStorage.observ)).imagen,h=Object.keys(f))v=h[d],"imagen"!==d&&f.hasOwnProperty(v)&&(e.observ[v]=f[v]);return e.imagenSelect=function(e){return localStorage.imagen_fondo=JSON.stringify(e)},e.$watch("observ",function(e,a){return localStorage.setItem("observ",JSON.stringify(e))},!0),e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.$emit("cambia_descripcion","Observador del alumno ")}]).controller("PlanillasAusenciasAcudientesCtrl",["$scope","App","Perfil","grupos_acud","$state",function(e,a,r,t,n){var o,i,s,u,l;for(e.grupos_acud=t.data.grupos_acud,e.year=t.data.year,e.USER=r.User(),e.perfilPath=a.images+"perfil/",e.fecha_hoy=new Date,e.texto_informativo={},i=localStorage.txt_informativo_asist_padres,e.texto_informativo.texto=i||"<b>PLANILLA ASISTENCIA ASAMBLEA DE PADRES</b><br>",e.cambia_texto_informativo=function(){return localStorage.txt_informativo_asist_padres=e.texto_informativo.texto},e.editor_options={allowedContent:!0,entities:!1},s=0,u=(l=e.grupos_acud).length;s<u;s++)(o=l[s]).alumnos_temp=o.alumnos,o.alumnos_temp.length<31?o.alumnos1=o.alumnos_temp:o.alumnos_temp.length<61?(o.alumnos1=o.alumnos_temp.splice(0,30),o.alumnos2=o.alumnos_temp.splice(0,30)):asign.alumnos_temp.length<91&&(o.alumnos1=o.alumnos_temp.splice(0,30),o.alumnos2=o.alumnos_temp.splice(0,30),o.alumnos3=o.alumnos_temp.splice(0,30));return e.$emit("cambia_descripcion","Planilla de asistencia de padres ")}]).directive("compile",["$compile","$timeout",function(e,a){return{restrict:"A",link:function(r,t,n){return a(function(){return e(t.contents())(r)})}}}])}.call(this),function(){angular.module("myvcFrontApp").controller("NotasActualesAlumnosCtrl",["$scope","App","Perfil","alumnosDat","escalas","$cookies",function(e,a,r,t,n,o){var i,s,u,l,c,d,p,m,f,g,_,h,v,b,y,w,C,S,A;for(e.USER=r.User(),e.USER.nota_minima_aceptada=parseInt(e.USER.nota_minima_aceptada),e.perfilPath=a.images+"perfil/",e.views=a.views,e.grupo=t[0],e.year=t[1],e.alumnos=t[2],e.escalas=n,e.config=o.getObject("config"),e.requested_alumnos=o.getObject("requested_alumnos"),e.requested_alumno=o.getObject("requested_alumno"),u=0,p=(b=e.alumnos).length;u<p;u++)for((i=b[u]).cant_perdidas=0,l=0,m=(y=i.periodos).length;l<m;l++)for((v=y[l]).cant_perdidas=0,c=0,f=(w=v.asignaturas).length;c<f;c++)for((s=w[c]).cant_perdidas=0,d=0,g=(C=s.unidades).length;d<g;d++)for((A=C[d]).cant_perdidas=0,h=0,_=(S=A.subunidades).length;h<_;h++)S[h].nota<e.USER.nota_minima_aceptada&&(A.cant_perdidas+=1,s.cant_perdidas+=1,v.cant_perdidas+=1,i.cant_perdidas+=1);return e.$on("change_config",function(){return e.config=o.getObject("config")}),e.requested_alumnos?e.$emit("cambia_descripcion","Mostrando "+e.alumnos.length+" boletines de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.requested_alumno?e.$emit("cambia_descripcion","Mostrando un boletin de "+e.grupo.cantidad_alumnos+" del grupo "+e.grupo.nombre_grupo):e.$emit("cambia_descripcion",e.alumnos.length+" boletines del grupo "+e.grupo.nombre_grupo)}])}.call(this),function(){angular.module("myvcFrontApp").controller("ListadoProfesoresCtrl",["$scope","App","Perfil","profesores","$state",function(e,a,r,t,n){return e.USER=r.User(),e.profesores=t.data.profesores,e.year=t.data.year,e.perfilPath=a.images+"perfil/",e.$emit("cambia_descripcion",e.profesores.length+"  profesores.")}]).controller("VerCantAlumnosPorGruposCtrl",["$scope","App","Perfil","grupos","$state",function(e,a,r,t,n){var o,i,s,u;for(e.USER=r.User(),e.grupos_cantidades=t.data.grupos,e.periodos_total=t.data.periodos_total,e.perfilPath=a.images+"perfil/",e.cant_total_alumnos=0,e.cant_total_hombres=0,e.cant_total_mujeres=0,i=0,s=(u=e.grupos_cantidades).length;i<s;i++)o=u[i],e.cant_total_alumnos=e.cant_total_alumnos+o.cant_alumnos,e.cant_total_hombres=e.cant_total_hombres+o.cant_hombres,e.cant_total_mujeres=e.cant_total_mujeres+o.cant_mujeres;return e.$emit("cambia_descripcion",e.grupos_cantidades.length+"  grupos.")}])}.call(this),function(){angular.module("myvcFrontApp").controller("ActaEvaluacionPromocionCtrl",["$scope","$interval","App","Perfil","datos","$state","$filter","$uibModal","$http","toastr",function(e,a,r,t,n,o,i,s,u,l){var c;return e.grupos=n.data.grupos,e.year=n.data.year,e.USER=t.User(),e.perfilPath=r.images+"perfil/",e.views=r.views,e.dato={},e.dato.texto_acta_eval=e.year.texto_acta_eval,c=new Date,e.dato.hora_acta=c,e.dato.dia_acta=c,e.cambia_texto_informativo=function(){return u.put("::actas-evaluacion/cambiar-descripcion",{texto_acta_eval:data.texto_acta_eval}).then(function(e){return l.success("Texto guardado")},function(e){return l.warning("No se pudo guardar texto.","Problema")})},e.verAlumnos=function(e){return s.open({templateUrl:"==informes/verAlumnosActaModal.tpl.html",controller:"VerAlumnosActaCtrl",size:"lg",resolve:{alumnos:function(){return e}}}).result.then(function(e){return console.log("Editado")},function(){})},e.editarAlumno=function(e){return s.open({templateUrl:"==informes/editarActaEvaluacionModal.tpl.html",controller:"EditarActaEvaluacionCtrl",size:"lg",resolve:{alumno:function(){return e}}}).result.then(function(e){return console.log("Editado")},function(){})},e.$emit("cambia_descripcion","Acta de evaluación y promoción "+e.USER.year)}]).controller("VerAlumnosActaCtrl",["$scope","$uibModalInstance","alumnos","$http","toastr","App",function(e,a,r,t,n,o){var i,s,u;for(e.perfilPath=o.images+"perfil/",e.views=o.views,e.data={},e.alumnos=r,s=0,u=r.length;s<u;s++)(i=r[s]).fecha_nac&&(i.fecha_nac=new Date(i.fecha_nac)),i.fecha_matricula&&(i.fecha_matricula=new Date(i.fecha_matricula)),i.fecha_retiro&&(i.fecha_retiro=new Date(i.fecha_retiro)),e.alumno=i;return e.guardarValor=function(a,r,o,i){var s;return s={},"sexo"===r&&"M"!==(o=o.toUpperCase())&&"F"!==o?(n.warning("Debe usar M o F"),void(a.sexo=e.alum_copy.sexo)):"estrato"===r&&(o<0||o>9)?(n.warning("Valor no admitido"),void(a.estrato=e.alum_copy.estrato)):(s.alumno_id=a.alumno_id,s.propiedad=r,s.valor=o,s.year_id=a.year_id,i&&(s.year_id=i),t.put("::alumnos/guardar-valor",s).then(function(e){return n.success("Dato actualizado con éxito")},function(t){return a[r]=e.alum_copy[r],n.error("Cambio no guardado","Error")}))},e.ok=function(){return a.close(i)}}]).controller("EditarActaEvaluacionCtrl",["$scope","$uibModalInstance","alumno","$http","toastr","App",function(e,a,r,t,n,o){return e.perfilPath=o.images+"perfil/",e.views=o.views,e.data={},r.fecha_nac&&(r.fecha_nac=new Date(r.fecha_nac)),r.fecha_matricula&&(r.fecha_matricula=new Date(r.fecha_matricula)),r.fecha_retiro&&(r.fecha_retiro=new Date(r.fecha_retiro)),e.alumno=r,t.put("::actas-evaluacion/detalle",{alumno_id:r.alumno_id,grupo_id:r.grupo_id}).then(function(a){return e.alumnos=a.data.alumnos,e.matriculas=a.data.matriculas},function(e){return n.warning("No se pudo traer detalles.","Problema")}),e.guardarValor=function(a,r,o,i){var s;return s={},"sexo"===r&&"M"!==(o=o.toUpperCase())&&"F"!==o?(n.warning("Debe usar M o F"),void(a.sexo=e.alum_copy.sexo)):"estrato"===r&&(o<0||o>9)?(n.warning("Valor no admitido"),void(a.estrato=e.alum_copy.estrato)):(s.alumno_id=a.alumno_id,s.propiedad=r,s.valor=o,s.year_id=a.year_id,i&&(s.year_id=i),t.put("::alumnos/guardar-valor",s).then(function(e){return n.success("Dato actualizado con éxito")},function(t){return a[r]=e.alum_copy[r],n.error("Cambio no guardado","Error")}))},e.ok=function(){return a.close(r)}}])}.call(this),function(){angular.module("myvcFrontApp").filter("decimales",[function(){return function(e,a){return(e=(e=parseFloat(e))%1==0?e.toFixed(0):e.toFixed(a)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}]).filter("decimales_if",[function(){return function(e,a){var r;return r=(e=(e=parseFloat(e))%1==0?e.toFixed(0):e.toFixed(a)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),r=parseFloat(r)}}]).filter("setDecimal",[function(){return function(e,a){var r;return isNaN(e)?e:(r="1"+Array(+(a>0&&a+1)).join("0"),Math.round(e*r)/r)}}]).filter("formatNumberDocumento",["$filter",function(e){return function(a){return!isNaN(a)&&angular.isNumber(+a)?e("number")(a,0):a}}])}.call(this),function(){angular.module("myvcFrontApp").filter("materiasPerdidasYear",[function(){return function(e,a,r){return a?(this.alumnos_response=[],angular.forEach(e,function(e,t){if(this.cant_asig_perdidas=0,angular.forEach(e.notas_asig,function(e,a){if(Math.round(e.nota_final_year)<r)return this.cant_asig_perdidas++}),this.cant_asig_perdidas>=a)return this.alumnos_response.push(e)}),alumnos_response):e}}]).filter("materiasPerdidas",[function(){return function(e,a,r){return a?(this.alumnos_response=[],angular.forEach(e,function(e,t){if(this.cant_asig_perdidas=0,angular.forEach(e.asignaturas,function(e,a){if(Math.round(e.nota_asignatura)<r)return this.cant_asig_perdidas++}),this.cant_asig_perdidas>=a)return this.alumnos_response.push(e)}),alumnos_response):e}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").config(["$stateProvider","App","PERMISSIONS",function(e,a,r){e.state("panel.actividades.votaciones",{url:"/votaciones",views:{actividades_content:{templateUrl:`${a.views}votaciones/votacionesInicio.tpl.html`,controller:"VotacionesInicioCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Votaciones"}]}}},data:{displayName:"Votaciones",icon_fa:"fa fa-legal",pageTitle:"Votaciones - MyVc"}}),e.state("panel.actividades.votaciones.config",{url:"/config",views:{votaciones_view:{templateUrl:`${a.views}votaciones/votaciones.tpl.html`,controller:"VotacionesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Configuración - MyVc"}]}}},data:{displayName:"Configuración",icon_fa:"fa fa-legal",pageTitle:"Configuración - MyVc"}}).state("panel.actividades.votaciones.participantes",{url:"/participantes",views:{votaciones_view:{templateUrl:`${a.views}votaciones/participantes.tpl.html`,controller:"ParticipantesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Participantes"}]}}},data:{needed_permissions:[r.can_edit_participantes],displayName:"Participantes",icon_fa:"fa fa-legal",pageTitle:"Participantes - MyVc"}}).state("panel.actividades.votaciones.candidatos",{url:"/candidatos",views:{votaciones_view:{templateUrl:`${a.views}votaciones/candidatos.tpl.html`,controller:"CandidatosCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Candidatos"}]}}},data:{needed_permissions:[r.can_edit_candidatos],pageTitle:"Candidatos - MyVc"}}).state("panel.actividades.votaciones.votar",{url:"/votar",views:{votaciones_view:{templateUrl:`${a.views}votaciones/votar.tpl.html`,controller:"VotarCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Votar"}]}}},data:{pageTitle:"Votar - MyVc"}}).state("panel.actividades.votaciones.votarprueba",{url:"/prueba",views:{votaciones_view:{templateUrl:`${a.views}votaciones/votarprueba.tpl.html`,controller:"VotarPruebaCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Prueba votación"}]}}},data:{pageTitle:"Prueba votación - MyVc"}}).state("panel.actividades.votaciones.resultados",{url:"/resultados",views:{votaciones_view:{templateUrl:`${a.views}votaciones/resultados.tpl.html`,controller:"ResultadosCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Resultados"}]}}},data:{pageTitle:"Resultados - MyVc"}}).state("panel.actividades.votaciones.tarjetones",{url:"/tarjetones",views:{votaciones_view:{templateUrl:`${a.views}votaciones/tarjetones.tpl.html`,controller:"TarjetonesCtrl"},headerContent:{templateUrl:`${a.views}panel/panelHeader.tpl.html`,controller:"PanelHeaderCtrl",resolve:{titulo:[function(){return"Tarjetones"}]}}},data:{pageTitle:"Tarjetones - MyVc"}})}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("VotacionesCtrl",["$scope","$filter","$http","resolved_user","App","toastr",function(e,a,r,t,n,o){var i,s,u,l,c,d,p,m;e.data={},e.editing=!1,e.gridScope=e,e.votacionEdit={},e.votacion={locked:!1,is_action:!1,fecha_inicio:"",fecha_fin:"",aspiraciones:[{aspiracion:"",abrev:""}]},e.date={dateOptions:{startingDay:1}},e.addAspiracion=function(){return e.votacion.aspiraciones.push({aspiracion:"",abrev:""})},e.removeAspiracion=function(a){return e.votacion.aspiraciones.splice(a,1)},e.addAspiracionEdit=function(a){return r.post("::aspiraciones/store",{votacion_id:a}).then(function(a){return o.success("Aspiración creada."),e.votacionEdit.aspiraciones.push({id:a.data.id,aspiracion:"",abrev:""})},function(e){return o.error("No se pudo crear aspiración.")})},e.updateAspiracionEdit=function(e){return r.put("::aspiraciones/update",e).then(function(e){return o.success("Aspiración modificada.")},function(e){return o.error("No se pudo modificar aspiración.")})},e.removeAspiracionEdit=function(t){return r.delete("::aspiraciones/destroy/"+t.id).then(function(r){return o.success("Aspiración eliminada."),e.votacionEdit.aspiraciones=a("filter")(e.votacionEdit.aspiraciones,{id:"!"+t.id})},function(e){return o.error("No se pudo eliminar aspiración.")})},e.editar=function(a){return e.editing=!0,e.votacionEdit=a},e.eliminar=function(t){return r.delete("::votaciones/destroy/"+t.id).then(function(r){return e.gridOptions.data=a("filter")(e.gridOptions.data,{id:"!"+t.id})},function(e){return o.error("No se pudo eliminar.")})},e.cambiarInAction=function(a){return r.put("::votaciones/set-in-action",{id:a.id,in_action:a.in_action}).then(function(r){var t,n,i,s;if(a.in_action)for(t=0,n=(i=e.gridOptions.data).length;t<n;t++)s=i[t],a.id!==s.id&&(s.in_action=!1);else a.in_action=!1;return o.success("Cambiado")},function(e){return o.error("No se pudo poner en acción.")})},e.cambiarVotanProfes=function(e){return r.put("::votaciones/set-votan-profes",{id:e.id,votan_profes:e.votan_profes}).then(function(e){return o.success("Cambiado")},function(e){return o.error("No se pudo cambiar votan profes.")})},e.cambiarVotanAcudientes=function(e){return r.put("::votaciones/set-votan-acudientes",{id:e.id,votan_acudientes:e.votan_acudientes}).then(function(e){return o.success("Cambiado")},function(e){return o.error("No se pudo cambiar votan acudientes.")})},e.cambiarLocked=function(e){return r.put("::votaciones/set-locked",{id:e.id,locked:e.locked}).then(function(e){return o.success("Cambiado")},function(e){return o.error("No se pudo cambiar bloqueo.")})},e.cambiarPermisoVerResults=function(e){return r.put("::votaciones/set-permiso-ver-results",{id:e.id,can_see_results:e.can_see_results}).then(function(e){return o.success("Cambiado")},function(e){return o.error("No se pudo cambiar el permiso.")})},e.cambiarEventoActual=function(a){return r.put("::votaciones/set-actual",{id:a.id,actual:a.actual}).then(function(r){var t,n,i,s;if(a.actual)for(t=0,n=(i=e.gridOptions.data).length;t<n;t++)s=i[t],a.id!==s.id&&(s.actual=!1);else a.actual=!1;return o.success("Cambiado")},function(e){return o.error("No se pudo volver actual.")})},c='<a uib-tooltip="Editar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only info" ng-click="grid.appScope.editar(row.entity)"><i class="fa fa-edit "></i></a>',d='<a uib-tooltip="X Eliminar" tooltip-placement="right" class="btn btn-default btn-xs shiny icon-only danger" ng-click="grid.appScope.eliminar(row.entity)"><i class="fa fa-times "></i></a>',s="==votaciones/botonEventoActual.tpl.html",l="==votaciones/botonEventoLocked.tpl.html",m="==votaciones/botonVotanProfes.tpl.html",u="==votaciones/botonVotanAcudientes.tpl.html",i="==votaciones/botonEventoInAction.tpl.html",p="==votaciones/botonPermisoVerResults.tpl.html",e.gridOptions={enableSorting:!0,enebleGridColumnMenu:!1,columnDefs:[{name:"id",displayName:"Id",width:40,enableFiltering:!1,enableCellEdit:!1},{name:"edicion",displayName:"Edición",width:50,enableSorting:!1,enableFiltering:!1,cellTemplate:c+d,enableCellEdit:!1},{field:"nombre",enableHiding:!1,minWidth:110},{field:"locked",displayName:"Bloqueado",cellTemplate:l,minWidth:80},{field:"votan_profes",displayName:"Profes votan",minWidth:80,cellTemplate:m},{field:"votan_acudientes",displayName:"Acudientes votan",minWidth:80,cellTemplate:u},{field:"actual",displayName:"Actual",cellTemplate:s,minWidth:80},{field:"in_action",displayName:"En acción",cellTemplate:i,minWidth:80},{field:"can_see_results",displayName:"Permiso",cellTemplate:p,minWidth:80},{field:"fecha_inicio",displayName:"Inicia",cellFilter:"date:mediumDate",type:"date",minWidth:80},{field:"fecha_fin",displayName:"Termina",cellFilter:"date:mediumDate",type:"date",minWidth:80}],multiSelect:!1},1===e.USER.user_id&&e.gridOptions.columnDefs.push({name:"user_id",displayName:"Creador",width:40,enableCellEdit:!1}),r.get("::votaciones").then(function(a){var r,t,n,o,i;for(e.gridOptions.data=a.data,o=[],r=0,t=(n=a.data).length;r<t;r++)(i=n[r]).actual?o.push(localStorage.votacion_actual=i.id):o.push(void 0);return o},function(e){return o.error("Error trayendo los eventos.")}),e.crear=function(){return r.post("::votaciones/store",e.votacion).then(function(a){return(a=a.data).actual&&angular.forEach(e.gridOptions.data,function(e,a){return e.actual=0}),e.votacion={},e.gridOptions.data.push(a)},function(e){return o.error("Falló al intentar guardar")})},e.guardar=function(){return r.post("::votaciones/update/"+e.votacionEdit.id,e.votacionEdit).then(function(a){return o.success("Se hizo el put de la votación"),e.editing=!1},function(e){return o.error("Falló al intentar guardar")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("VotacionesInicioCtrl",["$scope","$rootScope","$interval","resolved_user","App","AuthService","$state",function(e,a,r,t,n,o,i){o.verificar_acceso(),e.hasRoleOrPerm=o.hasRoleOrPerm,e.USER=t,i.is("panel.actividades.votaciones")&&((e.hasRoleOrPerm(["alumno","acudiente"])||"Alumno"===e.USER.tipo)&&i.go("panel.actividades.votaciones.votar"),e.hasRoleOrPerm(["admin","profesor"])&&i.go("panel.actividades.votaciones.config"))}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("CandidatosCtrl",["$scope","$filter","$http","toastr","App",function(e,a,r,t,n){e.perfilPath=n.images+"perfil/",e.aspiraciones=[],e.allinscritos=[],r.get("::candidatos/conaspiraciones").then(function(a){return e.aspiraciones=a.data},function(e){return t.error("No se pudo traer las aspiraciones","Problema")}),r.get("::participantes/allinscritos").then(function(a){return e.allinscritos=a.data},function(e){return t.error("No se pudo traer los inscritos","Problema")}),e.crearCandidato=function(e){var a;return(a={}).user_id=e.newParticip.user_id,a.plancha=e.newParticip.plancha,a.numero=e.newParticip.numero,a.aspiracion_id=e.id,r.post("::candidatos/store",a).then(function(a){return a=a.data,e.candidatos=a,e.newParticip=null,t.success("Candidato creado con éxito")},function(e){return"Candidato ya inscrito"===e.data.error.message?t.warning("Candidato ya inscrito en esta aspiración"):t.warning("No se pudo crear el candidato","Problema")})},e.eliminarCandidato=function(e,n){return r.delete("::candidatos/destroy/"+e).then(function(r){return n.candidatos=a("filter")(n.candidatos,{candidato_id:"!"+e}),t.success("Candidato removido de la candidatura")},function(e){return t.error("No se pudo quitar de la candidatura","Problema")})}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("ParticipantesCtrl",["$scope","$filter","$http","toastr","Acentos",function(e,a,r,t,n){var o,i,s,u;e.participantes=[],e.dato={grupo:""},e.gridOptions={},e.votacion={locked:!1,is_action:!1,fecha_inicio:"",fecha_fin:""},u={},localStorage.votacion_actual&&(u.votacion_id=localStorage.votacion_actual),r.put("::participantes/datos",u).then(function(a){var r,t,n,o,i,s;for(a=a.data,e.grupos=a.grupos,e.votacion=a.votacion,o=0,localStorage.matr_grupo&&(o=parseInt(localStorage.matr_grupo)),s=[],t=0,n=(i=e.grupos).length;t<n;t++)r=i[t],parseInt(r.id)===parseInt(o)?(e.dato.grupo=r,s.push(e.selectGrupo(e.dato.grupo))):s.push(void 0);return s},function(e){return t.warning("Asegúrate de tener al menos un evento como actual.")}),e.traerProfesores=function(){return delete localStorage.matr_grupo,r.put("::participantes/profesores",{votacion_id:e.votacion.id}).then(function(a){var r,t,n,o,i,s,u,l,c,d;for(r=0,o=(u=a.data.participantes).length;r<o;r++)for(t=0,i=(l=u[r].aspiraciones).length;t<i;t++)for(n=0,s=(c=l[t].votos).length;n<s;n++)(d=c[n]).created_at=new Date(d.created_at.replace(/-/g,"/"));return e.participantes=a.data.participantes,e.gridOptions.data=a.data.participantes},function(e){return t.error("Error al traer participantes.")})},e.selectGrupo=function(a){var n,o,i;for(localStorage.matr_grupo=a.id,e.dato.grupo=a,n=0,o=(i=e.grupos).length;n<o;n++)i[n].active=!1;return a.active=!0,r.put("::participantes/votantes",{grupo_id:a.id,votacion_id:e.votacion.id}).then(function(a){var r,t,n,o,i,s,u,l,c,d;for(r=0,o=(u=a.data.participantes).length;r<o;r++)for(t=0,i=(l=u[r].aspiraciones).length;t<i;t++)for(n=0,s=(c=l[t].votos).length;n<s;n++)(d=c[n]).created_at=new Date(d.created_at.replace(/-/g,"/"));return e.participantes=a.data.participantes,e.gridOptions.data=a.data.participantes},function(e){return t.error("Error al traer participantes.")})},e.guardarInscripciones=function(){return e.guardando_inscrip=!0,r.put("::participantes/guardar-inscripciones",{grupos:e.grupos}).then(function(a){return t.success("Inscripciones guardadas."),e.guardando_inscrip=!1},function(a){return t.error("Error al intentar guardar Inscripciones."),e.guardando_inscrip=!1})},i="==directives/botonesResetPassword.tpl.html",s="==alumnos/botonVotos.tpl.html",o='uib-popover-template="views+\'==alumnos/popoverAlumnoGrid.tpl.html\'" popover-trigger="\'mouseenter\'" popover-title="{{ row.entity.nombres + \' \' + row.entity.apellidos }}" popover-popup-delay="500" popover-append-to-body="true"',e.gridOptions={showGridFooter:!0,showColumnFooter:!0,showFooter:!0,enableSorting:!0,enableFiltering:!0,enebleGridColumnMenu:!1,columnDefs:[{field:"no",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}</div>',width:40,enableCellEdit:!1},{field:"nombres",minWidth:130,pinnedLeft:!0,filter:{condition:n.buscarEnGrid},enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" style="padding: 0px;" '+o+'><img ng-src="{{grid.appScope.perfilPath + row.entity.foto_nombre}}" style="width: 35px" />{{row.entity.nombres}}</div>'},{field:"apellidos",minWidth:110,filter:{condition:n.buscarEnGrid}},{name:"Votos",cellTemplate:s,minWidth:200},{field:"sexo",displayName:"Sex",width:40},{field:"username",filter:{condition:n.buscarEnGrid},displayName:"Usuario",cellTemplate:i,editableCellTemplate:"==alumnos/botonEditUsername.tpl.html",minWidth:135},{field:"documento",minWidth:100,cellFilter:"formatNumberDocumento"},{field:"celular",displayName:"Celular",minWidth:80}],multiSelect:!1}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("VotarCtrl",["$scope","$http","toastr",function(e,a,r){e.votaciones=[],e.indexVotando=0,a.get("::votaciones/en-accion-inscrito").then(function(a){var t,n,o,i;if((a=a.data).msg)return r.warning(a.msg,"Atención");for(e.votaciones=a,i=[],t=0,n=(o=e.votaciones).length;t<n;t++)o[t].completos?i.push(e.indexVotando++):i.push(void 0);return i}),e.$on("termineDeVotar",function(){return e.indexVotando++,e.$broadcast("terminaVotacion",e.indexVotando)})}]).controller("chooseCandidatoCtrl",["$scope","$http","$uibModalInstance","App","candidato","aspiracion","votacion_id","toastr",function(e,a,r,t,n,o,i,s){return e.candidato=n,e.aspiracion=o,e.imagesPath=t.images+"perfil/",e.ok=function(){var e;return(e={}).votacion_id=i,n.voto_blanco?(e.blanco_aspiracion_id=o.id,e.voto_blanco=!0):e.candidato_id=n.candidato_id,a.post("::votos/store",e).then(function(e){return(e=e.data).msg?s.info(e.msg):s.success("Voto guardado con éxito"),r.close(e)},function(e){return(e=e.data).data&&e.data.msg?s.error(e.data.msg):s.error("No se pudo guardar el voto."),r.dismiss("Error al guardar")})},e.cancel=function(){return r.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("myvcFrontApp").controller("VotarPruebaCtrl",["$scope","$filter","$http","App","$state","$uibModal","$window",function(e,a,r,t,n,o,i){e.hover=!1,e.aspiraciones=[],e.maxi=n.params.maxi,e.windowHeight=$(i).height()-100,e.wzStep=0,e.votacion={locked:!1,is_action:!1,fecha_inicio:"",fecha_fin:""},r.get("::votaciones/actual").then(function(a){if(e.votacion=a.data,e.votacion.locked)return e.toastr.warning("La votación actual está bloqueada")}),r.get("::candidatos/conaspiraciones").then(function(a){return e.aspiraciones=a.data},function(a){return e.toastr.error("No se pudo traer las aspiraciones","Problema")}),r.get("::participantes/allinscritos").then(function(a){return e.allinscritos=a.data},function(a){return e.toastr.error("No se pudo traer los inscritos","Problema")}),e.currentImg="default_male.jpg",e.imagesPath=t.images+"perfil/",e.mostrarImagen=function(a){return a.iluminado=!0,e.currentImg=a.imagen_nombre},e.ocultarImagen=function(e){return e.iluminado=!1},e.nextAspiracion=function(){if(e.wzStep<e.aspiraciones.length)return e.wzStep+=1},e.prevAspiracion=function(){if(e.wzStep>0)return e.wzStep-=1},e.goAspiracion=function(a){if(e.wzStep=parseInt(e.wzStep),(a=parseInt(a))<e.wzStep)return e.wzStep=a},e.open=function(a,r){if(!e.votacion.locked)return o.open({templateUrl:"==votaciones/chooseCandidato.tpl.html",controller:"chooseCandidatoCtrl",resolve:{candidato:function(){return a},aspiracion:function(){return r},votacion_id:function(){return e.votacion.id}}}).result.then(function(a){return r.votado.push(a),e.nextAspiracion()},function(){});e.toastr.warning("La votación actual está bloqueada")}}]).controller("chooseCandidatoPruebaCtrl",["$scope","$http","$uibModalInstance","App","candidato","aspiracion","toastr",function(e,a,r,t,n,o,i){return e.candidato=n,e.aspiracion=o,e.imagesPath=t.images+"perfil/",e.ok=function(){var e;return{}.candidato_id=n.candidato_id,e={locked:!1,is_action:!1,fecha_inicio:"",fecha_fin:"",completo:!1},i.success("Voto guardado con éxito"),r.close(e)},e.cancel=function(){return r.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").directive("votarPanelDir",["App","Perfil","$http",function(e,a,r){return{restrict:"EA",templateUrl:"==votaciones/votarPanel.tpl.html",scope:{votacion:"="},controller:["$scope","App","toastr","$window","$uibModal",function(e,r,t,n,o){e.USER=a.User(),e.hover=!1,e.maxi=!1,e.windowHeight=$(n).height()-100,e.wzStep=0,e.currentImg="default_male.jpg",e.imagesPath=r.images+"perfil/",e.$parent.$index===e.$parent.indexVotando&&(e.maxi=!0),e.$on("terminaVotacion",function(a,r){if(e.$parent.$index===r)return e.maxi=!0}),e.votacion.completos&&(e.wzStep=e.votacion.aspiraciones.length),e.mostrarImagen=function(a){return a.iluminado=!0,e.currentImg=a.foto_nombre},e.ocultarImagen=function(e){return e.iluminado=!1},e.nextAspiracion=function(){if(e.wzStep<e.votacion.aspiraciones.length)return e.wzStep+=1},e.prevAspiracion=function(){if(e.wzStep>0)return e.wzStep-=1},e.goAspiracion=function(a){if(e.wzStep=parseInt(e.wzStep),(a=parseInt(a))<e.wzStep)return e.wzStep=a},e.open=function(a,r){if(e.votacion.locked)t.warning("La votación está bloqueada.");else{if(!e.votacion.locked_votacion)return o.open({templateUrl:"==votaciones/chooseCandidato.tpl.html",controller:"chooseCandidatoCtrl",resolve:{candidato:function(){return a},aspiracion:function(){return r},votacion_id:function(){return e.votacion.id}}}).result.then(function(a){var n,o,i,s;for(r.votado=!0,n=0,o=0,i=(s=e.votacion.aspiraciones).length;o<i;o++)s[o].votado&&n++;return e.votacion.aspiraciones.length===n&&(e.$emit("termineDeVotar"),e.maxi=!1,t.info("Ahora continúa con la siguiente votación.")),e.nextAspiracion()},function(){});t.warning("Usted está bloqueado en esta votación.")}}}]}}])}.call(this),function(){angular.module("myvcFrontApp").controller("ResultadosCtrl",["$scope","$http","App","toastr",function(e,a,r,t){e.votacion={locked:!1,is_action:!1,fecha_inicio:"",fecha_fin:""},e.imagesPath=r.images+"perfil/",a.put("::votos/show",{permitir:!1}).then(function(a){return e.votaciones=a.data.votaciones,e.year=a.data.year},function(e){return t.error("Error trayendo las votaciones.")})}]).controller("TarjetonesCtrl",["$scope","$http","App","toastr",function(e,a,r,t){e.votacion={locked:!1,is_action:!1,fecha_inicio:"",fecha_fin:""},e.imagesPath=r.images+"perfil/",a.put("::votos/show",{permitir:!0}).then(function(a){return e.votaciones=a.data.votaciones,e.year=a.data.year},function(e){return t.error("Error trayendo las votaciones.")})}])}.call(this),function(){angular.module("myvcFrontApp").directive("loader",[function(){return{restrict:"E",templateUrl:"==directives/loader.tpl.html",scope:{cargando:"="},link:function(e,a,r){}}}])}.call(this),angular.module("uiBreadcrumbs",["ui.router","myvcFrontApp"]).directive("uiBreadcrumbs",["$interpolate","$state","App",function(e,a,r){return{restrict:"E",templateUrl:r.views+"directives/uiBreadcrumbs.tpl.html",scope:{displaynameProperty:"@"},link:function(r){function t(){for(var e=[],t=a.$current;t&&""!==t.name;){var i=n(t),s=o(t);!1!==i&&e.push({displayName:i,route:t.name,icon_fa:s}),t=t.parent}e.reverse(),r.breadcrumbs=e}function n(a){var t,n,o;if(!r.displaynameProperty)return a.name;for(o=r.displaynameProperty.split("."),n=a,t=0;t<o.length;t++){if(!angular.isDefined(n[o[t]]))return a.name;if(!1===n[o[t]])return!1;n=n[o[t]]}return e(n)(a.locals.globals)}function o(a){var r;return r=a,angular.isDefined(r.data.icon_fa)?!1!==r.data.icon_fa&&(r=r.data.icon_fa,e(r)(a.locals.globals)):""}r.breadcrumbs=[],""!==a.$current.name&&t(),r.$on("$stateChangeSuccess",function(){t()})}}}]),function(){angular.module("myvcFrontApp").directive("sidebarMenu",["$rootScope","AuthService","$http","$uibModal","Perfil","toastr","ProfesoresServ","$window","$state","$interval",function(e,a,r,t,n,o,i,s,u,l){return{restrict:"E",replace:!0,templateUrl:"==directives/sidebarMenu.tpl.html",scope:{cargando:"="},link:function(e,a,r){return e.$watch(function(){return s.innerWidth},function(e){return e>880?a.removeClass("hide"):a.addClass("hide")})},controller:["$scope","$attrs","$state","App","$http",function(r,s,u,c,d){var p;return r.perfilPath=c.images+"perfil/",this.groups=[],r.hasRoleOrPerm=a.hasRoleOrPerm,r.mensaje_no_buscar="Alumno en este año ",p=l(function(){return r.USER?(r.mensaje_no_buscar="Alumno en este año "+r.USER.year,r.stopInterval()):r.$parent.USER?(r.mensaje_no_buscar="Alumno en este año "+r.$parent.USER.year,r.stopInterval()):void 0},200),r.stopInterval=function(){if(angular.isDefined(p))return l.cancel(p),p=void 0},r.persona_buscar="",r.templateTypeahead="==alumnos/personaTemplateTypeahead.tpl.html",r.personaCheck=function(e){return r.verificandoPersona=!0,d.put("::alumnos/personas-check",{texto:e}).then(function(e){return r.personas_match=e.data.personas,r.personas_match.map(function(e){return e.perfilPath=r.perfilPath}),r.verificandoPersona=!1,r.personas_match})},r.$state=e.$state,r.persona_id=n.User().persona_id,r.hasRoleOrPerm(["Admin","Profesor"])&&d.get("::grupos").then(function(e){return r.grupos=e.data},function(e){return o.error("No se pudo traer los grupos del menú")}),r.ir_a_persona=function(e,a,r){var t;return t={persona_id:e.alumno_id,tipo:e.tipo},u.go("panel.persona",t)},i.contratos().then(function(e){return r.profesores=e},function(e){return o.error("No se pudo traer los profesores del menú")}),r.listarAsignaturas=function(){return t.open({templateUrl:"==areas/listasignaturasPop.tpl.html",controller:"ListasignaturasPopCtrl"}).result.then(function(e){})},r.irDefinitivas=function(e){return u.go("panel.definitivas_periodos",{profesor_id:e})},r.ir_a_informes=function(){return u.go("panel.informes")},this.clikeando=function(){},this.closeOthers=function(e){return angular.forEach(this.groups,function(e){if(!0===e.menuIsOpen)return e.menuIsOpen=!1})},this.addGroup=function(e){var a;return a=this,this.groups.push(e),e.$on("$destroy",function(r){return a.removeGroup(e)})},this.removeGroup=function(e){var a;if(-1!==(a=this.groups.indexOf(e)))return this.groups.splice(a,1)},this}]}}]).directive("subMenu",[function(){return{require:"^sidebarMenu",restrict:"A",replace:!0,scope:!0,link:function(e,a,r,t){return e.menuIsOpen=!!r.menuIsOpen&&e.$eval(r.menuIsOpen),r.hija?(!0===e.menuIsOpen&&a.addClass("open"),e.toggleOpen=function(){return!1===e.menuIsOpen?(a.addClass("open"),e.menuIsOpen=!0):(a.removeClass("open"),e.menuIsOpen=!1)}):(t.addGroup(e),e.$watch("menuIsOpen",function(e){return!0===e?a.addClass("open"):a.removeClass("open")}),e.toggleOpen=function(){return!1===e.menuIsOpen?(t.closeOthers(e),e.menuIsOpen=!0):e.menuIsOpen=!1})}}}]).directive("myDropDown",["$document",function(e){return{restrict:"A",replace:!0,scope:!0,link:function(e,a,r){e.menuIsOpen=!!r.menuIsOpen&&e.$eval(r.menuIsOpen),!0===e.menuIsOpen&&a.addClass("open"),e.toggleOpen=function(){!0===e.menuIsOpen?(a.addClass("open"),e.menuIsOpen=!0):(a.removeClass("open"),e.menuIsOpen=!1)}}}}]).directive("stopEvent",[function(){return{restrict:"A",link:function(e,a,r){return a.bind(r.stopEvent,function(e){return e.stopPropagation()})}}}]).directive("toggle",function(){var e,a,r,t;return"selected",a={},e=function(e,r){if(a[e]=a[e]||[],-1===a[e].indexOf(r))return a[e].push(r)},r=function(e,r){var t;if(-1!==(t=(a[e]||[]).indexOf(r)))return a[e].splice(t,1)},t=function(e,r){return angular.forEach(a[e]||[],function(e){return e.removeClass("selected")}),r.addClass("selected")},{restrict:"A",link:function(a,n,o){var i;return i=o.toggle||"default",e(i,n),n.on("click",function(){return a.$apply(function(){return t(i,n)})}),a.$on("$destroy",function(){return n.off(),r(i,n)})}}}).controller("ListasignaturasPopCtrl",["$scope","$uibModalInstance","$http","toastr","$state",function(e,a,r,t,n){return e.selectAsignatura=function(e,r){return n.go("panel.notas",{asignatura_id:e,profesor_id:r}),a.close(e)},r.get("::asignaturas/listasignaturas-alone").then(function(a){return e.asignaturas=a.data},function(e){return t.error("No se pudo traer tus asignaturas")}),e.cancel=function(){return a.dismiss("cancel")}}])}.call(this),function(){angular.module("myvcFrontApp").directive("updateTitle",["$rootScope","$timeout",function(e,a){return{link:function(r,t){var n;return n=function(e,r,n){var o;return o="MyVc",r.data&&r.data.pageTitle&&(o=r.data.pageTitle),n&&n.username&&(o=n.username+" - MyVC"),"Boletines periodo - MyVc"!==r.data.pageTitle&&"Boletines finales - MyVc"!==r.data.pageTitle||(localStorage.grupo_boletines?o=localStorage.grupo_boletines+" - MyVC":localStorage.alumno_boletin&&(o=localStorage.alumno_boletin)),a(function(){return t.text(o)},0,!1)},e.$on("$stateChangeSuccess",n)}}}])}.call(this),function(){angular.module("myvcFrontApp").directive("notaRapida",["$rootScope","toastr","EscalasValorativasServ",function(e,a,r){return{restrict:"AE",transclude:!0,templateUrl:"==directives/notaRapida.tpl.html",link:function(t,n,o){return t.valorNotaRapida=100,e.notaRapida.enable?t.activado=!0:t.activado=!1,t.activar=function(){if(!t.activado)return t.activado=!0,e.notaRapida.enable=t.activado,a.info("Nota rápida activada","ACTIVADA")},t.desactivar=function(){return t.activado=!1,e.notaRapida.enable=t.activado,a.info("Nota rápida desactivada","DESACTIVADA")},t.clickInput=function(){if(!$("#input-nota-rapida").is(":focus"))return $("#input-nota-rapida").focus()},t.$on("keydown:27",function(e,a){return t.desactivar()}),r.escalas().then(function(e){return t.escalas=e},function(e){return console.log("No se trajeron las escalas valorativas",e)}),t.setValor=function(a){return e.notaRapida.valorNota=a,t.activar()}}}}]).directive("cambiamodel",["$rootScope",function(e){return{restrict:"A",link:function(a,r,t){return a.$watch(t.ngModel,function(a){return console.log(a),e.notaRapida.valorNota=a})}}}]).directive("keypressEvents",["$document","$rootScope",function(e,a){return{restrict:"A",link:function(){return e.bind("keypress keydown",function(e){if(27===e.which)return a.$broadcast("keydown:27",e)})}}}]).filter("range",function(){return function(e,a,r){var t,n,o,i;for(r=parseInt(r),t=n=o=a=parseInt(a),i=r;o<=i?n<=i:n>=i;t=o<=i?++n:--n)e.push(t);return e}}).run(["$templateCache",function(e){return e.put("/tmpls/draggable-default","<div ng-transclude></div>")}]).directive("draggable",[function(){return{restrict:"AE",transclude:!0,replace:!0,scope:{},templateUrl:function(e,a){return angular.isDefined(a.template)?a.template:"/tmpls/draggable-default"},link:function(e,a,r){var t,n,o;return a=$(a),e.obj={id:null,content:"",group:null},e.placeholder=!1,e.obj.content=a.html(),angular.isDefined(r.id)&&(e.obj.id=r.id),angular.isDefined(r.placeholder)&&(e.placeholder=e.$eval(r.placeholder)),o=angular.isDefined(r.options)?e.$eval(r.options):{},angular.isDefined(r.group)&&(e.obj.group=r.group,o.stack="."+r.group),t={start:function(a,r){e.placeholder&&r.helper.wrap('<div class="dragging"></div>'),e.$apply(function(){e.$emit("draggable.started",{obj:e.obj})})},drag:function(a){e.$apply(function(){e.$emit("draggable.dragging")})},stop:function(a,r){e.placeholder&&r.helper.unwrap(),e.$apply(function(){e.$emit("draggable.stopped")})}},n=angular.extend({},o,t),a.draggable(n)}}}])}.call(this),function(){angular.module("myvcFrontApp").directive("withpaddingDir",["$rootScope","$state",function(e,a){return{link:function(r,t){var n,o;return n=function(e,r,n){return a.includes("panel.actividades")||a.includes("panel.mis_actividades")?$(t).addClass("no-padding"):$(t).removeClass("no-padding")},o=function(e,r){return a.includes("panel.actividades")||a.includes("panel.mis_actividades")?$(t).addClass("no-padding"):$(t).removeClass("no-padding")},e.$on("$stateChangeSuccess",n),e.$on("$viewContentLoaded",o)}}}])}.call(this),function(){angular.module("myvcFrontApp").factory("Perfil",["App","$q","$cookies","$http",function(e,a,r,t){var n;return n={},{setUser:function(e){return n=e},User:function(){return n},save:function(){return n.save()},id:function(){return n.user_id},idioma:function(){return n.idioma_system},setImagen:function(e,a){return n.imagen_id=e,n.imagen_nombre=a},setOficial:function(e,a){return n.foto_id=e,n.foto_nombre=a},nameToShow:function(){return"Usuario"===n.tipo?n.username.toUpperCase():n.nombres+" "+n.apellidos},deleteUser:function(){return n={}}}}])}.call(this),function(){angular.module("myvcFrontApp").factory("AuthService",["$state","$http","$cookies","Perfil","$rootScope","AUTH_EVENTS","$q","$filter","toastr",function(e,a,r,t,n,o,i,s,u){var l;return(l={}).verificar=function(){var e;return e=i.defer(),t.User().user_id?e.resolve(t.User()):localStorage.getItem("xtoken")?void 0!==localStorage.getItem("xtoken")&&"undefined"!==localStorage.getItem("xtoken")&&"[object Object]"!==localStorage.getItem("xtoken")?l.login_from_token().then(function(a){return t.setUser(a),e.resolve(a)},function(a){return console.log("No se logueó from token"),e.reject(a)}):(l.borrarToken(),e.reject("Token mal estructurado.")):(console.log("No hay token"),e.resolve("No hay token."),n.$broadcast(o.notAuthenticated)),e.promise},l.verificar_acceso=function(){var a,r,i,s,u;if(t.User().user_id||e.go("login"),a=!1,r=!1,(u=e.current).data.needed_permissions&&(i=u.data.needed_permissions,l.isAuthorized(i)||(a=!0)),u.data.needed_roles&&(s=u.data.needed_roles,l.isAuthorized(!1,s)||(r=!0)),a&&r&&(n.lastState=u.name,l.isAuthenticated()?n.$broadcast(o.notAuthorized):e.transitionTo("login")),!u.data.needed_roles&&!u.data.needed_permissions)return!0},l.login_credentials=function(r){var t;return t=i.defer(),l.borrarToken(),a.post("::login/credentials",r).then(function(e){var r;return(r=e.data).el_token?(localStorage.setItem("xtoken",r.el_token),r.cambia_anio>0&&(localStorage.cambia_anio=r.cambia_anio),a.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("xtoken"),localStorage.logueando="token_verificado",t.resolve(r.el_token)):(n.$broadcast(o.loginFailed),t.reject("Error en login"))},function(a){return n.$broadcast(o.loginFailed),console.log(a),a?a.status?400===a.status?"Usuario invalidado"===a.data.message?u.error("Te han desactivado","NO ACTIVO",{timeOut:8e3}):u.error("Datos inválidos","",{timeOut:8e3}):-1===a.status?u.error("No parece haber comunicación con el servidor","",{timeOut:8e3}):500===a.status&&u.error("No parece haber comunicación con la Base de datos","",{timeOut:8e3}):a.data?("user_inactivo"===a.data&&u.warning("Usuario desactivado"),a.data.error&&("Token expirado"===a.data.error||"token_expired"===a.error?(u.warning("La sesión ha expirado"),"login"!==e.current.name&&e.go("login")):n.$broadcast(o.loginFailed))):u.error("No parece haber comunicación con el servidor"):u.error("No parece haber comunicación con el servidor"),t.reject("Error en login")}),t.promise},l.login_from_token=function(){var e;return e=i.defer(),a.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("xtoken"),a.post("::login").then(function(a){var r;return r=a.data,n.$broadcast(o.loginSuccess),e.resolve(r)},function(a){return a.data&&"user_inactivo"===a.data.message&&u.warning("Usuario desactivado"),e.reject("Error en login con token.")}),e.promise},l.logout=function(){return a.put("::login/logout",{user_id:t.User().user_id}).then(function(e){return console.log("Sesión cerrada")},function(e){return console.log("No se registró el cierre de sesión.")}),n.lastState=null,n.lastStateParam=null,t.deleteUser(),l.borrarToken(),delete localStorage.logueando,e.transitionTo("login")},l.borrarToken=function(){return localStorage.removeItem("xtoken"),delete a.defaults.headers.common.Authorization},l.isAuthenticated=function(){return!!t.User().user_id},l.isAuthorized=function(e,a){var r,n;if((n=t.User()).is_superuser)return!0;if(r=[],e){if(angular.isArray(e)||(e=[e]),!angular.isArray(n.perms))return!(e.length>0);angular.forEach(e,function(e){if(-1!==n.perms.indexOf(e))return r.push(e)})}if(a){if(angular.isArray(a)||(a=[a]),!angular.isArray(n.roles))return!(a.length>0);angular.forEach(a,function(e){var a,t,o,i;for(i=[],a=0,t=(o=n.roles).length;a<t;a++)o[a].name.toLocaleLowerCase()===e.toLocaleLowerCase()?i.push(r.push(e)):i.push(void 0);return i})}return l.isAuthenticated()&&r.length>0},l.hasRoleOrPerm=function(e,a){var r;if(!angular.isArray(e)){if(!e)return!1;e=[e]}return r=[],angular.forEach(e,function(e){var a;if([],(a=s("filter")(t.User().roles,{name:e}))&&a.length>0)return r.push(e)}),r.length>0},l}])}.call(this),function(){angular.module("myvcFrontApp").factory("NotasServ",["$http","$q",function(e,a){var r;return(r={}).detalladas=function(r,t,n){var o;return o=a.defer(),e.put("::notas/detailed",{asignatura_id:r,profesor_id:t,con_asignaturas:n}).then(function(e){return o.resolve(e.data)},function(e){return o.reject(e)}),o.promise},r}]).factory("AlumnosSinMatriculaServ",["$http","$q","$filter",function(e,a,r){var t,n;return t=[],(n={}).alumnos=function(){var r;return r=a.defer(),t.length>0?r.resolve(t):e.get("::alumnos/sin-matriculas").then(function(e){return t=e.data,r.resolve(t)},function(e){return r.reject(e)}),r.promise},n}]).factory("InformesServ",["$http","$q","$filter",function(e,a,r){var t,n;return t={},(n={}).datos=function(){var r;return r=a.defer(),t.year?r.resolve(t):e.put("::informes/datos").then(function(e){return t=e.data,r.resolve(t)},function(e){return r.reject(e)}),r.promise},n}]).factory("EscalasValorativasServ",["$http","$q","$filter",function(e,a,r){var t,n;return t=[],(n={}).escalas=function(){var r;return r=a.defer(),t.length>0?r.resolve(t):e.get("::escalas").then(function(e){var a,n,o;for(n=0,o=(t=e.data).length;n<o;n++)(a=t[n]).orden=parseInt(a.orden),a.perdido=parseInt(a.perdido),a.porc_final=parseInt(a.porc_final),a.porc_inicial=parseInt(a.porc_inicial),a.id=parseInt(a.id),a.year_id=parseInt(a.year_id);return r.resolve(t)},function(e){return r.reject(e)}),r.promise},n.escala_maxima=function(){return r("orderBy")(t,"orden")[t.length-1]},n}]).factory("AusenciasServ",["$http","$q",function(e,a){var r;return(r={}).detalladas=function(r){var t;return t=a.defer(),e.get("::ausencias/detailed/"+r).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise},r}]).factory("ComportamientoServ",["$http","$q",function(e,a){var r;return(r={}).detallados=function(r){var t;return t=a.defer(),e.get("::nota_comportamiento/detailed/"+r).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise},r.proceso=function(r){var t;return t=a.defer(),e.get("::comportamiento/proceso/"+r).then(function(e){return t.resolve(e.data)},function(e){return t.reject(e)}),t.promise},r}])}.call(this),function(){angular.module("myvcFrontApp").factory("ProfesoresServ",["$http","$q",function(e,a){var r;return(r={}).profesores=[],r.contratos=function(){var t;return t=a.defer(),r.profesores.length>0?t.resolve(r.profesores):e.get("::contratos").then(function(e){return r.profesores=e.data,t.resolve(r.profesores)},function(e){return console.log("No se trajeron los profesores contratados. ",e),t.reject(e.data)}),t.promise},r}])}.call(this),function(){angular.module("myvcFrontApp").factory("YearsServ",["$http","$q",function(e,a){var r;return r=[],{getYears:function(){var t;return t=a.defer(),r.length>0?t.resolve(r):e.get("::years").then(function(e){return r=e.data,t.resolve(r)},function(e){return t.reject(e)}),t.promise}}}])}.call(this),function(){angular.module("myvcFrontApp").factory("DownloadServ",["$http","$q",function(e,a){var r;return(r={}).download=function(r,t){var n;return n=a.defer(),e.get(r,{responseType:"blob"}).then(function(e){var a,r,o,i;return i=e.headers("Content-Type"),(r=e.headers("Content-Disposition"))&&(o=r.match(/.*filename=\"?([^;\"]+)\"?.*/))[1]&&(t=o[1]),t=t.replace(/[<>:"\/\\|?*]+/g,"_"),a=new Blob([e.data],{type:i}),window.saveAs(a,t),n.resolve(t)},function(e){return console.log(e),n.reject(e)}),n.promise},r.download2=function(r,t){var n;return n=a.defer(),e.get(r,{responseType:"arraybuffer"}).then(function(e){var a,r;return a=new Blob([e],{type:"Type:application/vnd.ms-excel; charset=UTF-8"}),r=URL.createObjectURL(a),window.open(r),n.resolve(t)},function(e){return console.log("Pailaaassss",e),n.reject(e)}),n.promise},r}])}.call(this),function(){angular.module("myvcFrontApp").factory("Acentos",["App",function(e){return{remove:function(e){return e=e.toLowerCase().replace(/á/g,"a").replace(/â/g,"a").replace(/é/g,"e").replace(/è/g,"e").replace(/í/g,"i").replace(/ì/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ü/g,"u").replace(/ç/g,"c")},buscarEnGrid:function(e,a,r){var t,n;return this.remove=function(e){return e=e.toLowerCase().replace(/á/g,"a").replace(/â/g,"a").replace(/é/g,"e").replace(/è/g,"e").replace(/í/g,"i").replace(/ì/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ü/g,"u").replace(/ç/g,"c")},n=this.remove(a),t=this.remove(e),-1!==n.indexOf(t)}}}])}.call(this),function(){angular.module("myvcFrontApp").factory("Excel",["$window",function(e){return{tableToExcel:function(e,a){var r,t,n,o;return n=$(e),t=new Blob([n.html()],{type:"application/vnd.ms-excel"}),o=window.URL.createObjectURL(t),r=document.createElement("a"),document.body.appendChild(r),r.href=o,r.download=a+".xls",r.click(),setTimeout(function(){window.URL.revokeObjectURL(o)},0)}}}])}.call(this),angular.module("ngLocale",[],["$provide",function(e){var a="one",r="other";e.value("$locale",{DATETIME_FORMATS:{AMPMS:["a. m.","p. m."],DAY:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],ERANAMES:["antes de Cristo","después de Cristo"],ERAS:["a. C.","d. C."],FIRSTDAYOFWEEK:0,MONTH:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],SHORTDAY:["dom.","lun.","mar.","mié.","jue.","vie.","sáb."],SHORTMONTH:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],STANDALONEMONTH:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],WEEKENDRANGE:[5,6],fullDate:"EEEE, d 'de' MMMM 'de' y",longDate:"d 'de' MMMM 'de' y",medium:"d MMM y H:mm:ss",mediumDate:"d MMM y",mediumTime:"H:mm:ss",short:"d/M/yy H:mm",shortDate:"d/M/yy",shortTime:"H:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"€",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"es-es",localeID:"es_ES",pluralCat:function(e,t){return 1==e?a:r}})}]);